var $jscomp={scope:{}};$jscomp.defineProperty="function"==typeof Object.defineProperties?Object.defineProperty:function(a,b,c){if(c.get||c.set)throw new TypeError("ES3 does not support getters and setters.");a!=Array.prototype&&a!=Object.prototype&&(a[b]=c.value)};$jscomp.getGlobal=function(a){return"undefined"!=typeof window&&window===a?a:"undefined"!=typeof global&&null!=global?global:a};$jscomp.global=$jscomp.getGlobal(this);$jscomp.SYMBOL_PREFIX="jscomp_symbol_";
$jscomp.initSymbol=function(){$jscomp.initSymbol=function(){};$jscomp.global.Symbol||($jscomp.global.Symbol=$jscomp.Symbol)};$jscomp.symbolCounter_=0;$jscomp.Symbol=function(a){return $jscomp.SYMBOL_PREFIX+(a||"")+$jscomp.symbolCounter_++};
$jscomp.initSymbolIterator=function(){$jscomp.initSymbol();var a=$jscomp.global.Symbol.iterator;a||(a=$jscomp.global.Symbol.iterator=$jscomp.global.Symbol("iterator"));"function"!=typeof Array.prototype[a]&&$jscomp.defineProperty(Array.prototype,a,{configurable:!0,writable:!0,value:function(){return $jscomp.arrayIterator(this)}});$jscomp.initSymbolIterator=function(){}};$jscomp.arrayIterator=function(a){var b=0;return $jscomp.iteratorPrototype(function(){return b<a.length?{done:!1,value:a[b++]}:{done:!0}})};
$jscomp.iteratorPrototype=function(a){$jscomp.initSymbolIterator();a={next:a};a[$jscomp.global.Symbol.iterator]=function(){return this};return a};$jscomp.array=$jscomp.array||{};$jscomp.iteratorFromArray=function(a,b){$jscomp.initSymbolIterator();a instanceof String&&(a+="");var c=0,e={next:function(){if(c<a.length){var d=c++;return{value:b(d,a[d]),done:!1}}e.next=function(){return{done:!0,value:void 0}};return e.next()}};e[Symbol.iterator]=function(){return e};return e};
$jscomp.polyfill=function(a,b,c,e){if(b){c=$jscomp.global;a=a.split(".");for(e=0;e<a.length-1;e++){var d=a[e];d in c||(c[d]={});c=c[d]}a=a[a.length-1];e=c[a];b=b(e);b!=e&&null!=b&&$jscomp.defineProperty(c,a,{configurable:!0,writable:!0,value:b})}};$jscomp.polyfill("Array.prototype.keys",function(a){return a?a:function(){return $jscomp.iteratorFromArray(this,function(a){return a})}},"es6-impl","es3");
$jscomp.findInternal=function(a,b,c){a instanceof String&&(a=String(a));for(var e=a.length,d=0;d<e;d++){var k=a[d];if(b.call(c,k,d,a))return{i:d,v:k}}return{i:-1,v:void 0}};$jscomp.polyfill("Array.prototype.find",function(a){return a?a:function(a,c){return $jscomp.findInternal(this,a,c).v}},"es6-impl","es3");
angular.module("account.community",["account.community.service","promotion"]).controller("CommCreditCtrl",["$scope","$state","$ionicHistory","$rootScope","$ionicLoading","eventNames","CreditAPI",function(a,b,c,e,d,k,l){var g=function(){a.records=[];f(function(){d.show({template:"<ion-spinner></ion-spinner>",delay:100})},function(){d.hide()},function(){e.navToIndex()})},h=function(){a.records=void 0;a.pageNumber=void 0;a.hasRecord=void 0;a.initFinish=void 0},f=function(b,f,c){b();l.refresh(function(b){a.records=
b;a.pageNumber=0;a.hasRecord=!(void 0===a.records||0===a.records.length);a.initFinish=!0;f()},function(b){a.initFinish=!0;console.log(b);alert("\u5237\u65b0\u5931\u8d25\uff0c\u8bf7\u7a0d\u540e\u518d\u8bd5");f();c()})};a.loadMore=function(){a.canLoadMore()&&l.getPage(a.pageNumber+1,function(b){if(void 0!==b&&0!==b.length){for(var f=0;f<b.length;f++)a.records.push(b[f]);a.pageNumber++}a.$broadcast("scroll.infiniteScrollComplete")},function(b){alert(b);a.$broadcast("scroll.infiniteScrollComplete")})};
a.refresh=function(){f(function(){},function(){$timeout(function(){a.$broadcast("scroll.refreshComplete")},500)},function(){})};a.canLoadMore=function(){return void 0===a.initFinish?!1:l.hasMoreToLoad()};g();e.$on("$stateChangeStart",function(a,b,f,c,d){if("app.account.community"===b.name||"app.account.community.invite"===b.name||"app.account.community.credit"===b.name||"app.account.community.exchange"===b.name){if("app.account.community.invite"===c.name||"app.account.community.credit"===c.name)return;
g()}"app.account.sales"!==b.name&&"app.account.sales.invite"!==b.name&&"app.account.sales.credit"!==b.name||"app.account.sales.invite"===c.name||"app.account.sales.credit"===c.name||g()});e.$on("event:auth-loginCancelled",function(){h()});e.$on("event:auth-logout-complete",function(){h()});e.$on(k.CREDIT_EXCHANGE_SUCCESS,function(a,b){h()})}]).controller("CommExchangeCtrl",["$scope","$state","$ionicHistory","$rootScope","$ionicLoading","eventNames","CreditExchangeAPI",function(a,b,c,e,d,k,l){a.exchange=
function(b){b.creditAmount>a.$parent.account.credit?alert("\u7231\u5fc3\u6570\u91cf\u4e0d\u8db3\uff0c\u8bf7\u83b7\u5f97\u66f4\u591a\u7231\u5fc3\u518d\u6765\u5151\u6362"):(d.show({template:"<ion-spinner></ion-spinner>",delay:100}),l.exchange(b.id,function(){d.hide();e.$broadcast(k.CREDIT_EXCHANGE_SUCCESS);alert("\u5151\u6362\u6210\u529f")},function(a){d.hide();alert(a)}))};(function(){a.rules=[];d.show({template:"<ion-spinner></ion-spinner>",delay:100});l.getRules(function(b){a.rules=b;d.hide()},function(a){d.hide();
alert(a);e.navToIndex()})})()}]).controller("CommInviteCtrl",["$scope","$state","$ionicHistory","$rootScope","$ionicLoading","eventNames","PromotionAPI","Wechat",function(a,b,c,e,d,k,l,g){var h=function(b){void 0===a.$parent||void 0===a.$parent.account?a.$on("account-ready",function(a,f){b()}):b()},f=function(){a.invitePromotionUrl=l.getShareUrl(a.$parent.account.invitePromotionId);d.show({template:"<ion-spinner></ion-spinner>",delay:100});l.getPublicBatch(a.$parent.account.invitePromotionId,function(b){d.hide();
a.batch=b;g.hookShareAll(!0,l.convertBatchToContent(a.batch),function(){},function(a){alert(a)})},function(a){d.hide();alert("\u672a\u627e\u5230\u5206\u4eab\u6d3b\u52a8\uff0c\u8bf7\u8054\u7cfb\u7ba1\u7406\u5458\u6216\u7a0d\u540e\u518d\u8bd5")})};h(f);e.$on("$stateChangeStart",function(a,b,c,u,d){("app.account.community.invite"===b.name&&"app.account.community.invite"!==u.name&&"app.account.community.exchange"!==u.name&&"app.account.community.credit"!==u.name||"app.account.sales.invite"===b.name&&
"app.account.sales.invite"!==u.name)&&h(f)})}]);
angular.module("account.community.service",["ngResource"]).service("CreditAPI",["$resource","urlConfig",function(a,b){var c=a(b.REST_END_POINT+"/api/account/credit/record",{page:"@page"},{query:{method:"GET",isArray:!1,timeout:1E4}},null),e=function(a,b,f){c.query({page:a},function(a){for(var f=[],c=0;c<a.list.length;c++)k[a.list[c].id]=a.list[c],f.push(a.list[c]);console.log("credit record page data get page success");b(f)},function(a){f(a.data.error)})},d=function(a,b){k={};l=0;c.query({page:0},
function(b){l=b.metaData.total;for(var f=[],c=0;c<b.list.length;c++)k[b.list[c].id]=b.list[c],f.push(b.list[c]);console.log("credit record metaData init success");a(f)},function(a){b(a.data.error)})},k={},l=0;return{getPage:function(a,b,f){e(a,b,f)},get:function(a){return k[a]},refresh:function(a,b){d(a,b)},hasMoreToLoad:function(){return!!(void 0!==k&&0!==Object.keys(k).length&&Object.keys(k).length<l)},clean:function(){k=void 0;l=0}}}]).service("CreditExchangeAPI",["$resource","urlConfig",function(a,
b){var c=a(b.REST_END_POINT+"/api/account/credit/exchangeRule",{},{query:{method:"GET",isArray:!0,timeout:1E4}},null),e=a(b.REST_END_POINT+"/api/account/credit/exchangeRule/:ruleId/exchange",{ruleId:"@ruleId"},{exchange:{method:"POST",isArray:!1,timeout:1E4}},null),d=[],k=function(a,b){d=[];c.query({},function(b){d=b;console.log("credit exchange rule init success");a(d)},function(a){b("\u672a\u627e\u5230\u53ef\u5151\u6362\u5546\u54c1\uff0c\u8bf7\u8054\u7cfb\u7ba1\u7406\u5458\u6216\u7a0d\u540e\u518d\u8bd5")})},
l=function(a,b,f){e.exchange({ruleId:a},function(a){b()},function(a){f(a.data.error)})};return{getRules:function(a,b){void 0===d||0===d.length?k(a,b):a(d)},exchange:function(a,b,f){l(a,b,f)}}}]);angular.module("account",["account.service","smsValidation","wechat","account.community"]).controller("AccountCtrl",["$scope","$state","$rootScope","$ionicLoading","AccountAPI","accountConstants","eventNames",function(a,b,c,e,d,k,l){a.state={info:1,edit:2};var g=function(){a.actState=a.state.info;e.show({template:"<ion-spinner></ion-spinner>",delay:100});d.getAccount(function(b){e.hide();a.account=b;a.$broadcast("account-ready",a.account)},function(a){e.hide();console.log("error getting account, by: "+
a);alert("\u670d\u52a1\u5668\u672a\u54cd\u5e94\uff0c\u83b7\u53d6\u8d26\u6237\u4fe1\u606f\u5931\u8d25\uff0c\u8bf7\u7a0d\u540e\u518d\u8bd5");c.navToIndex()})};a.canEditCompany=function(){return a.account.type===k.ACCOUNT_TYPE_NORMAL};a.canEditEmail=function(){return a.account.type===k.ACCOUNT_TYPE_NORMAL};a.showEdit=function(){a.actState=a.state.edit;a.backupName=a.account.name;a.backupAddress=a.account.address;a.backupCompany=a.account.company;a.backupEmail=a.account.email};a.saveEdit=function(){e.show({template:"<ion-spinner></ion-spinner>",
delay:100});d.saveAccount(a.account,function(b){e.hide();a.actState=a.state.info;a.backupName=void 0;a.backupAddress=void 0;a.backupCompany=void 0;a.backupEmail=void 0},function(a){e.hide();alert(a.data.error)})};a.cancelEdit=function(){a.account.name=a.backupName;a.account.address=a.backupAddress;a.account.company=a.backupCompany;a.account.email=a.backupEmail;a.backupName=void 0;a.backupAddress=void 0;a.backupCompany=void 0;a.backupEmail=void 0;a.actState=a.state.info};g();c.$on("$stateChangeStart",
function(a,b,c,d,e){"app.account"!==b.name&&"app.account.show"!==b.name||"app.account"===d.name||"app.account.show"===d.name||g()});c.$on("event:auth-loginCancelled",function(){d.clean();a.account=void 0});c.$on("event:auth-logout-complete",function(){d.clean();a.account=void 0});c.$on(l.CREDIT_EXCHANGE_SUCCESS,function(a,b){d.clean();g()})}]).controller("SalesOrCommCtrl",["$scope","$rootScope",function(a,b){var c=function(a){a.isSuperDXK?b.navToRoot("app.account.sales.credit"):b.navToRoot("app.account.community.credit")},
e=function(){void 0===a.$parent.account?a.$on("account-ready",function(b,e){c(a.$parent.account)}):c(a.$parent.account)};e();b.$on("$stateChangeStart",function(a,b,c,g,h){"app.account.salesOrComm"===b.name&&"app.account.salesOrComm"!==g.name&&(a.preventDefault(),e())})}]);
angular.module("account.service",["ngResource","http-auth-interceptor","wechat"]).service("AccountAPI",["$resource","urlConfig","Wechat",function(a,b,c){var e,d=a(b.REST_END_POINT+"/api/account",null,{query:{method:"GET",isArray:!1,timeout:1E4},save:{method:"POST",timeout:1E4}},null);return{getAccount:function(a,b){if(void 0===e){var g=c.getOpenId();void 0!==g?c.bind(g,function(c){console.log("wechat bind succeed");d.query({},function(b){e=b;a(e)},b)},function(a){console.log("wechat bind failed by: "+
a);b(a)}):d.query({},function(b){e=b;a(e)},b)}else a(e)},saveAccount:function(a,b,c){d.save(a,function(c){e=a;b()},function(a){c(a)})},clean:function(){e=void 0}}}]);angular.module("agreement",["agreement.service","wechat"]).controller("AgreementCtrl",["$scope","$state","AgreementAPI","agreementConstants","$rootScope","$ionicLoading","eventNames",function(a,b,c,e,d,k,l){var g=function(b,n,v){a.initFinish=!1;k.show({template:"<ion-spinner></ion-spinner>",delay:100});c.findPublicByIdIn(f,function(f){a.toPropose="1"===b;a.showPaygo="1"===n;a.showUser="1"===v;a.publicAgreements=f;a.showUser?c.all(function(b){a.agreementlist=b;k.hide();a.initFinish=!0;for(b=0;b<a.agreementlist.length;b++)a.agreementlist[b].canPayWxpay=
-1<a.agreementlist[b].payMethods.indexOf(e.PAY_METHOD_H5)},function(b){k.hide();a.initFinish=!0;d.navToIndex()}):(k.hide(),a.initFinish=!0)},function(a){console.log("error initializing index, by: "+a);k.hide();alert("\u670d\u52a1\u5668\u672a\u54cd\u5e94\uff0c\u83b7\u53d6\u534f\u8bae\u5931\u8d25\uff0c\u8bf7\u7a0d\u540e\u518d\u8bd5")})},h=function(){a.agreementlist=void 0;a.toPropose=void 0;a.showPaygo=void 0;a.showUser=void 0;a.publicAgreements=void 0;a.initFinish=void 0};a.expired=function(a){return new Date(a.endDate)<
new Date};var f=[e.AGREEMENT_ID_PAYGO_LOCAL_JB_LITE,e.AGREEMENT_ID_PAYGO_LOCAL_ZH,e.AGREEMENT_ID_PAYGO_JB_LITE,e.AGREEMENT_ID_PAYGO_JB,e.AGREEMENT_ID_AUTO_PAYGO,e.AGREEMENT_ID_PAYGO_ZR,e.AGREEMENT_ID_PAYGO_ZH_COLD_CHAIN];g(b.params.toPropose,b.params.paygo,b.params.user);d.$on("$stateChangeStart",function(a,b,f,c,d){"app.agreement"!==b.name&&"app.agreement.list"!==b.name&&"app.agreement.detail"!==b.name||g(f.toPropose,f.paygo,f.user)});d.$on("event:auth-loginCancelled",function(){h()});d.$on("event:auth-logout-complete",
function(){h()});d.$on(l.PROPOSAL_SUCCESS,function(a,b){c.clean()});d.$on(l.AGREEMENT_CHARGE_SUCCESS,function(a,b){c.clean()})}]).controller("AgreementDetailCtrl",["$rootScope","$scope","$stateParams","AgreementAPI","eventNames","agreementConstants",function(a,b,c,e,d,k){var l=function(){e.find(c.id,function(a){b.agreement=a;b.agreement.canPayWxpay=-1<b.agreement.payMethods.indexOf(k.PAY_METHOD_H5)},function(a){b.message=a})};l();a.$on(d.AGREEMENT_CHARGE_SUCCESS,function(a,b){l()})}]).controller("AgreementPublicDetailCtrl",
["$rootScope","$scope","$stateParams","AgreementAPI","eventNames",function(a,b,c,e,d){(function(){e.findPublic(c.id,function(a){b.agreement=a},function(a){b.message=a})})()}]).controller("AgreementChargeCtrl",["$rootScope","$scope","$state","$stateParams","AgreementAPI","$ionicActionSheet","AccountAPI","agreementConstants","eventNames","Wechat","$ionicLoading","$ionicPopup",function(a,b,c,e,d,k,l,g,h,f,p,n){var v=function(){p.show({template:"<ion-spinner></ion-spinner>",delay:100});d.preOrder(b.chargeOrder,
function(a){console.log("pre order succeed");u(a)},function(a){p.hide();console.log("pre order error, by: ",a.data.error);alert(a.data.error)})},u=function(u){b.chargeOrder.orderId=u.orderId;f.doWxPay(u.paymentResponse,function(){p.hide();b.error=void 0;console.log("save order successfull");a.$broadcast(h.AGREEMENT_CHARGE_SUCCESS,suc);alert("\u5145\u503c\u91d1\u989d"+b.chargeOrder.fee+"\u5143\uff0c\u4ee3\u91d1\u5238\u5df2\u7ecf\u53d1\u653e\uff0c\u8bf7\u5230\u6211\u7684\u4f18\u60e0\u5238\u4e2d\u67e5\u770b");
c.go("app.agreement.detail",{id:e.id})},function(){p.hide();alert("\u652f\u4ed8\u5931\u8d25")})};(function(){p.show({template:"<ion-spinner></ion-spinner>",delay:100});d.find(e.id,function(a){b.agreement=a;b.agreement.invoiceTypes=g.INVOICE_TYPES;l.getAccount(function(a){b.account=a;b.chargeOrder={agreement:b.agreement,chargeRule:b.agreement.chargeRules[0],fee:b.agreement.chargeRules[0]?b.agreement.chargeRules[0].chargeAmount:0};b.account.invoiceSetting&&(b.chargeOrder.companyTaxId=b.account.invoiceSetting.companyTaxId);
b.chargeOrder.invoiceType=g.INVOICE_TYPE_NORMAL;p.hide()},function(a){console.log("error getting account, by: "+a);p.hide();alert("\u670d\u52a1\u5668\u672a\u54cd\u5e94\uff0c\u83b7\u53d6\u652f\u4ed8\u4fe1\u606f\u5931\u8d25\uff0c\u8bf7\u7a0d\u540e\u518d\u8bd5")})},function(a){p.hide();b.message=a})})();b.showRules=function(){for(var a=[],f=0;f<b.agreement.chargeRules.length;f++)a[f]={text:"<div>"+b.agreement.chargeRules[f].name+"</div><p>"+b.agreement.chargeRules[f].description+"</p>"};k.show({buttons:a,
buttonClicked:function(a){b.chargeOrder.chargeRule=b.agreement.chargeRules[a];b.chargeOrder.fee=b.chargeOrder.chargeRule.chargeAmount;return!0}})};b.canShowTaxId=function(){return void 0!==b.chargeOrder&&b.chargeOrder.invoiceType!==g.INVOICE_TYPE_NORMAL};b.wxPay=function(){void 0===f.getOpenId()?alert("\u672a\u68c0\u6d4b\u5230\u5fae\u4fe1\u652f\u4ed8\u73af\u5883\uff0c\u8bf7\u5728\u5fae\u4fe1\u516c\u4f17\u53f7\u4e2d\u64cd\u4f5c"):(b.chargeOrder.buyerId=f.getOpenId(),b.chargeOrder.payProvider=g.PAY_PROVIDER_WX,
v())}}]);
angular.module("agreement.service",["ngResource"]).service("AgreementAPI",["$resource","urlConfig","agreementConstants",function(a,b,c){var e=function(a,b){return a.displayIndex-b.displayIndex},d=function(a,b){return a.pinyin>a.pinyin?1:a.pinyin<b.pinyin?-1:0},k=function(a,b){return a.value-b.value},l=a(b.REST_END_POINT+"/api/public/agreement",null,{query:{method:"GET",isArray:!1,timeout:1E4}},null),g,h,f=a(b.REST_END_POINT+"/api/agreement",null,{query:{method:"GET",isArray:!0,timeout:1E4}},null),
p=a(b.REST_END_POINT+"/api/order/charge"),n=a(b.REST_END_POINT+"/api/order/:id/finish"),v,u=function(a,b){l.query({},function(b){console.log("public agreement init success");g=b.contexts.divisions.sort(d);h=b.agreements;h[c.AGREEMENT_ID_AUTO_PAYGO].divisions=g;h[c.AGREEMENT_ID_AUTO_PAYGO].goods.sort(e);h[c.AGREEMENT_ID_AUTO_PAYGO].coverages.sort(k);h[c.AGREEMENT_ID_AUTO_PAYGO].invoiceTypes=c.INVOICE_TYPES;h[c.AGREEMENT_ID_PAYGO_LOCAL_ZH].divisions=g;h[c.AGREEMENT_ID_PAYGO_LOCAL_ZH].goods.sort(e);
h[c.AGREEMENT_ID_PAYGO_LOCAL_ZH].coverages.sort(k);h[c.AGREEMENT_ID_PAYGO_LOCAL_ZH].invoiceTypes=c.INVOICE_TYPES;h[c.AGREEMENT_ID_PAYGO_JB].divisions=g;h[c.AGREEMENT_ID_PAYGO_JB].goods.sort(e);h[c.AGREEMENT_ID_PAYGO_JB].coverages.sort(k);h[c.AGREEMENT_ID_PAYGO_JB].invoiceTypes=c.INVOICE_TYPES;h[c.AGREEMENT_ID_PAYGO_JB_LIMIT_PRICE].divisions=g.filter(function(a){return 100===a.defaultRouteFeeRate});h[c.AGREEMENT_ID_PAYGO_JB_LIMIT_PRICE].goods.sort(e);h[c.AGREEMENT_ID_PAYGO_JB_LIMIT_PRICE].coverages.sort(k);
h[c.AGREEMENT_ID_PAYGO_JB_LIMIT_PRICE].invoiceTypes=c.INVOICE_TYPES;h[c.AGREEMENT_ID_PAYGO_LOCAL_JB_LITE].divisions=g;h[c.AGREEMENT_ID_PAYGO_LOCAL_JB_LITE].goods.sort(e);h[c.AGREEMENT_ID_PAYGO_LOCAL_JB_LITE].coverages.sort(k);h[c.AGREEMENT_ID_PAYGO_LOCAL_JB_LITE].invoiceTypes=c.INVOICE_TYPES;h[c.AGREEMENT_ID_PAYGO_JB_LITE].divisions=g;h[c.AGREEMENT_ID_PAYGO_JB_LITE].goods.sort(e);h[c.AGREEMENT_ID_PAYGO_JB_LITE].coverages.sort(k);h[c.AGREEMENT_ID_PAYGO_JB_LITE].invoiceTypes=c.INVOICE_TYPES;h[c.AGREEMENT_ID_PAYGO_ZH_LIMIT_PRICE].divisions=
g.filter(function(a){return 100===a.defaultRouteFeeRate});h[c.AGREEMENT_ID_PAYGO_ZH_LIMIT_PRICE].goods.sort(e);h[c.AGREEMENT_ID_PAYGO_ZH_LIMIT_PRICE].coverages.sort(k);h[c.AGREEMENT_ID_PAYGO_ZH_LIMIT_PRICE].invoiceTypes=c.INVOICE_TYPES;h[c.AGREEMENT_ID_PAYGO_ZH_COLD_CHAIN].divisions=g;h[c.AGREEMENT_ID_PAYGO_ZH_COLD_CHAIN].goods.sort(e);h[c.AGREEMENT_ID_PAYGO_ZH_COLD_CHAIN].coverages.sort(k);h[c.AGREEMENT_ID_PAYGO_ZH_COLD_CHAIN].invoiceTypes=c.INVOICE_TYPES;h[c.AGREEMENT_ID_PAYGO_ZR].divisions=g;h[c.AGREEMENT_ID_PAYGO_ZR].goods.sort(e);
h[c.AGREEMENT_ID_PAYGO_ZR].coverages.sort(k);h[c.AGREEMENT_ID_PAYGO_ZR].invoiceTypes=c.INVOICE_TYPES;h[c.AGREEMENT_ID_SIGNUP_COUPON].divisions=g.filter(function(a){return 100===a.defaultRouteFeeRate});h[c.AGREEMENT_ID_SIGNUP_COUPON].goods.sort(e);h[c.AGREEMENT_ID_SIGNUP_COUPON].coverages.sort(k);h[c.AGREEMENT_ID_COUPON_TRANSACTION_25].divisions=g.filter(function(a){return 100===a.defaultRouteFeeRate});h[c.AGREEMENT_ID_COUPON_TRANSACTION_25].goods.sort(e);h[c.AGREEMENT_ID_COUPON_TRANSACTION_25].coverages.sort(k);
h[c.AGREEMENT_ID_SIMULATE].divisions=g;h[c.AGREEMENT_ID_SIMULATE].goods.sort(e);h[c.AGREEMENT_ID_SIMULATE].coverages.sort(k);b=Object.keys(h);for(var f=0;f<b.length;f++){for(var u=h[b[f]].coverages[0],y=h[b[f]].coverages[0],n=0;n<h[b[f]].coverages.length;n++)h[b[f]].coverages[n].discountFee=Math.round(h[b[f]].coverages[n].basefee*h[b[f]].discountRate/100),u.value>h[b[f]].coverages[n].value&&(u=h[b[f]].coverages[n]),y.value<h[b[f]].coverages[n].value&&(y=h[b[f]].coverages[n]);h[b[f]].lowCoverage=u;
h[b[f]].highCoverage=y;h[b[f]].backgroundUrl=c.BACKGROUND_ROOT+b[f]+".jpg";h[b[f]].matrix=c.PUBLIC_AGREEMENT_MATRIX[b[f]]}a()},b)},t=function(a,b){f.query({},function(b){v=b;console.log("user agreement init success");b=v;for(var f=0;f<b.length;f++)b[f].goods.sort(e),b[f].coverages.sort(k);a(v)},b)},x=function(a,b,f){void 0===h?u(function(){void 0===h||void 0===h[a]?f("\u534f\u8bae\u672a\u627e\u5230\uff0c\u8bf7\u8054\u7cfb\u7ba1\u7406\u5458"):b(h[a])},f):b(h[a])},r=function(a,b){for(var f={},c=0;c<
b.length;c++)void 0!==a[b[c]]&&(f[b[c]]=a[b[c]]);return f},q=function(a,b,f){t(function(c){for(var d,y=0;y<c.length;y++)c[y].id===parseInt(a)&&(d=c[y]);void 0===d?f("\u672a\u627e\u5230\u534f\u8bae\uff0c\u8bf7\u8054\u7cfb\u7ba1\u7406\u5458"):void 0===g?u(function(){void 0===g?f("\u534f\u8bae\u7ebf\u8def\u672a\u627e\u5230\uff0c\u8bf7\u8054\u7cfb\u7ba1\u7406\u5458"):(d.divisions=g,b(d))},f):(d.divisions=g,b(d))},f)};return{getProposal:function(a,b,f){a===c.AGREEMENT_ID_AUTO_PAYGO||a===c.AGREEMENT_ID_PAYGO_LOCAL_ZH||
a===c.AGREEMENT_ID_PAYGO_JB||a===c.AGREEMENT_ID_PAYGO_JB_LIMIT_PRICE||a===c.AGREEMENT_ID_PAYGO_ZH_LIMIT_PRICE||a===c.AGREEMENT_ID_PAYGO_ZR||a===c.AGREEMENT_ID_PAYGO_LOCAL_JB_LITE||a===c.AGREEMENT_ID_PAYGO_JB_LITE||a===c.AGREEMENT_ID_SIGNUP_COUPON||a===c.AGREEMENT_ID_COUPON_TRANSACTION_25||a===c.AGREEMENT_ID_SIMULATE||a===c.AGREEMENT_ID_PAYGO_ZH_COLD_CHAIN?x(a,b,f):q(a,b,f)},findPublicByIdIn:function(a,b,f){void 0===h?u(function(){void 0===h?f("\u534f\u8bae\u672a\u627e\u5230\uff0c\u8bf7\u8054\u7cfb\u7ba1\u7406\u5458"):
b(r(h,a))},f):b(r(h,a))},all:function(a,b){void 0===v?t(function(){a(v)},function(a){console.log(a);b(a)}):a(v)},findPublic:function(a,b,f){x(a,b,f)},find:function(a,b,f){q(a,b,f)},clean:function(){v=void 0},preOrder:function(a,b,f){(new p(a)).$save({},function(a){b(a)},function(a){f(a)})},finishOrder:function(a,b,f){(new n).$save({id:a},function(a){b(a)},function(a){f(a)})}}}]);angular.module("app",["smsValidation","wechat","account"]).controller("AppCtrl",["$scope","$ionicModal","$rootScope","$state","authService","$ionicHistory","$ionicLoading","CommonAuthenticationService","Wechat","$timeout","$ionicPopup","AccountAPI",function(a,b,c,e,d,k,l,g,h,f,p,n){f(function(){window.loading_screen.finish()},1500);a.isQQBrowser=!!h.isQQBrowser();c.navToRoot=function(a,b){k.nextViewOptions({historyRoot:!0});e.go(a,b)};c.navToIndex=function(){c.navToRoot("app.portal.category")};b.fromTemplateUrl("templates/app/login.html",
{scope:a}).then(function(b){a.modal=b});a.loginConfirmed=function(){d.loginConfirmed()};a.quit=function(){g.quit(function(){c.$broadcast("event:auth-logout-complete")})};a.cancel=function(){d.loginCancelled()};a.$on("event:auth-loginRequired",function(b,f){console.log("Login required");l.hide();a.modal.show()});a.$on("event:auth-loginConfirmed",function(){a.modal.hide()});a.$on("event:auth-loginCancelled",function(){a.modal.hide();k.nextViewOptions({historyRoot:!0});c.navToIndex()});a.$on("event:auth-logout-complete",
function(){k.nextViewOptions({historyRoot:!0});c.navToIndex()});a.$on("event:auth-forbidden",function(){console.log("Auth forbidden");l.hide();a.modal.show()});a.updateAccountPopup=function(b,f,c,d,e){a.data={};a.fieldName=f;a.data[f]=b[f];p.show({template:'<form> <textarea rows="3"  ng-model="data[fieldName]" class="value-right"></textarea></form>',title:d,subTitle:e,scope:a,buttons:[{text:"\u53d6\u6d88"},{text:"<b>\u786e\u8ba4</b>",type:"button-positive",onTap:function(d){if(a.data[f])if("\u672a\u586b\u5199"==
a.data[f]||""==a.data[f])alert("\u8bf7\u786e\u8ba4"+c+"\u540d\u79f0\u6b63\u786e\u518d\u63d0\u4ea4");else{l.show({template:"<ion-spinner></ion-spinner>",delay:100});var u=b[f];b[f]=a.data[f];n.saveAccount(b,function(a){l.hide()},function(a){b[f]=u;alert("\u4fdd\u5b58"+c+"\u4fe1\u606f\u5931\u8d25"+a.data.error);l.hide()})}else d.preventDefault()}}]})};c.$on("$stateChangeStart",function(a,b,f,c,d){console.log(c.name+" to "+b.name)})}]);angular.module("claim",["ionic","claim.service","wechat"]).controller("ClaimCtrl",["$scope","$stateParams","$state","$ionicLoading","$timeout","ClaimAPI","$ionicHistory","Wechat","$ionicPopup","$rootScope","$ionicPopover",function(a,b,c,e,d,k,l,g,h,f,p){a.navtoroot=function(a,b){l.nextViewOptions({historyRoot:!0});c.go(a,b)};var n=function(b,f){a.transtionId=b;a.claim=void 0;e.show({template:"<ion-spinner></ion-spinner>",delay:100});k.get(b,function(b){a.claim=b;if(null!==a.claim.registerno&&void 0!==
a.claim.registerno&&""!==a.claim.registerno)a.showhistoryrecord=!0,a.navtoroot("^.result",{id:a.claim.transactionId,result:a.claim}),v();else if(a.estimaterangelist=[{id:1,name:"\u5c0f\u4e8e1\u4e07\u5143"},{id:2,name:"\u5927\u4e8e\u7b49\u4e8e1\u4e07\u5143"}],a.damageresonlist=[{id:"0100",name:"\u81ea\u7136\u707e\u5bb3"},{id:"0016",name:"\u610f\u5916\u4e8b\u6545\u81f4\u8f66\u4e0a\u8d27\u7269\u635f\u6bc1"},{id:"0018",name:"\u8f66\u8f7d\u8d27\u7269\u6389\u843d"},{id:"0019",name:"\u8f66\u8f7d\u8d27\u7269\u649e\u51fb"},
{id:"0020",name:"\u8f66\u8f86\u4e0e\u9a7e\u9a76\u5458\u540c\u65f6\u5931\u8e2a"},{id:"0024",name:"\u73bb\u7483\u5355\u72ec\u7834\u788e"},{id:"0007",name:"\u884c\u9a76\u4e2d\u5e73\u884c\u5760\u843d"},{id:"0009",name:"\u5168\u8f66\u88ab\u76d7\u7a83"},{id:"0045",name:"\u8f66\u8f86\u505c\u9a76\u635f\u5931"},{id:"0048",name:"\u8fd0\u8f7d\u8d27\u7269\u81ea\u8eab\u539f\u56e0\u8d77\u706b\u5f15\u8d77\u81ea\u71c3"},{id:"5026",name:"\u7ffb\u8f66"},{id:"1328",name:"\u7b2c\u4e09\u65b9\u539f\u56e0"},{id:"1100",
name:"\u5176\u5b83\u539f\u56e0"}],!0===f){if(void 0===a.claim.id||null===a.claim.id)a.claim.losstype=a.damageresonlist[0],a.claim.estimaterange=a.estimaterangelist[0];else{for(b=0;b<a.damageresonlist.length;b++){console.log(a.damageresonlist[b]);var c=a.damageresonlist[b];if(c.id===a.claim.losstype){a.claim.losstype=c;break}}for(b=0;b<a.estimaterangelist.length;b++)if(console.log(a.estimaterangelist[b]),c=a.estimaterangelist[b],c.id===a.claim.estimaterange){a.claim.estimaterange=c;break}}a.claim.damagedate=
new Date(a.claim.damagedate)}e.hide()},function(a){e.hide()})};a.startClaim=function(){null===a.claim.damageplace||void 0===a.claim.damageplace||""===a.claim.damageplace?alert("\u8bf7\u586b\u5199\u51fa\u9669\u5730\u70b9\u3002"):null===a.claim.damagedate||void 0===a.claim.damagedate||""===a.claim.damagedate?alert("\u8bf7\u586b\u5199\u51fa\u9669\u65f6\u95f4\u3002"):null===a.claim.notifyman||void 0===a.claim.notifyman||""===a.claim.notifyman?alert("\u8bf7\u586b\u5199\u62a5\u6848\u4eba\u59d3\u540d\u3002"):
null===a.claim.mobiletel||void 0===a.claim.mobiletel||""===a.claim.mobiletel?alert("\u8bf7\u586b\u5199\u62a5\u6848\u4eba\u624b\u673a\u53f7\u3002"):!1===/^1[3578]\d{9}$/.test(a.claim.mobiletel)?alert("\u8bf7\u586b\u5199\u6b63\u786e\u7684\u62a5\u6848\u4eba\u624b\u673a\u53f7\u3002"):null===a.claim.linkaddress||void 0===a.claim.linkaddress||""===a.claim.linkaddress?alert("\u8bf7\u586b\u5199\u62a5\u6848\u4eba\u90ae\u7bb1\u3002"):null===a.claim.damageobject||void 0===a.claim.damageobject||""===a.claim.damageobject?
alert("\u8bf7\u586b\u5199\u53d7\u635f\u6807\u7684\u3002"):null===a.claim.losstype||void 0===a.claim.losstype||""===a.claim.losstype?alert("\u8bf7\u586b\u5199\u51fa\u73b0\u539f\u56e0\u3002"):null!==a.claim.estimate&&void 0!==a.claim.estimate&&/^\d+$/.test(a.claim.estimate)?null===a.claim.damagedes||void 0===a.claim.damagedes||""===a.claim.damagedes?alert("\u8bf7\u586b\u5199\u4e8b\u6545\u7ecf\u8fc7\u3002"):(a.claim.estimaterange=1E4>=a.claim.estimate?a.estimaterangelist[0]:a.estimaterangelist[1],a.navtoroot("^.confirm",
{result:a.claim})):alert("\u8bf7\u586b\u5199\u6b63\u786e\u7684\u62a5\u635f\u91d1\u989d\u3002")};a.cancelClaim=function(){a.navtoroot("^.start",{result:a.claim})};a.saveClaim=function(){e.show({template:"<ion-spinner></ion-spinner>",delay:100});a.claim.transactionId=a.transtionId;a.claim.losstype=a.claim.losstype.id;a.claim.estimaterange=a.claim.estimaterange.id;1E4<=a.claim.estimate?k.saveClaim(a.claim,function(b){a.claim=b.data;k.commitClaim(a.claim,function(b){e.hide();a.claim=b.data;a.showhistoryrecord=
!0;a.navtoroot("^.result",{id:a.claim.transactionId,result:a.claim})},function(a){e.hide();alert("\u63d0\u4ea4\u62a5\u6848\u51fa\u73b0\u95ee\u9898\u8bf7\u7a0d\u540e\u518d\u8bd5\u3002")})},function(a){e.hide();alert("\u63d0\u4ea4\u62a5\u6848\u51fa\u73b0\u95ee\u9898\u8bf7\u7a0d\u540e\u518d\u8bd5\u3002")}):k.saveClaim(a.claim,function(b){a.navtoroot("^.upload",{id:a.claim.transactionId,result:a.claim})},function(a){e.hide();alert("\u63d0\u4ea4\u62a5\u6848\u51fa\u73b0\u95ee\u9898\u8bf7\u7a0d\u540e\u518d\u8bd5\u3002")})};
var v=function(){a.popover=p.fromTemplate('<ion-popover-view style="position: fixed;top: 0;left: 0;z-index: 10; width: 100%;height: 100%;"><ion-content scroll="false"><div id="rightDisplay" ng-if="bigImage" class="popover-backdrop" style="position: fixed;top: 0;left: 0;z-index: 10; width: 100%;height: 100%;" ng-click="hideBigImage()"><img class="img-responsive" style="position: absolute;top: 10%;left: 50%;z-index: 10;display: block;margin-top: 18px; margin-left: -165px;height: 420px;width: 330px; box-shadow: 0 1px 3px rgba(0, 0, 0, 0.4);" src="{{Url}}"/></div></ion-content></ion-popover-view>',
{scope:a})};a.openPopover=function(b){a.popover.show(b)};a.closePopover=function(){a.popover.hide()};a.bigImage=!1;a.Url="#";a.hideBigImage=function(){a.bigImage=!1;a.closePopover()};a.showBigImage=function(b,f){a.Url=b;a.bigImage=!0;a.openPopover(f)};f.$on("$stateChangeStart",function(b,f,c,d,e){"app.claim.start"!==f.name&&"app.claim.result"!==f.name||"app.claim.confirm"===d.name||void 0===c.id||""===c.id.id||n(c.id,!0);"app.claim.result"===f.name&&v();"app.claim.result"===d.name&&(a.claim=void 0);
"app.claim.upload"===f.name&&"app.claim.confirm"===d.name&&g.hookShareAll(!0,k.getShareContent(c.result),function(){},function(a){alert(a)})});void 0!==b.id&&""!==b.id&&n(b.id,!0)}]).controller("ClaimUploadCtrl",["$scope","$stateParams","$state","$ionicLoading","$timeout","ClaimAPI","$ionicHistory","Wechat","$ionicPopup","$rootScope",function(a,b,c,e,d,k,l,g,h,f){a.navtoroot=function(a,b){l.nextViewOptions({historyRoot:!0});c.go(a,b)};d(function(){window.loading_screen.finish()},1500);var p=function(b){a.transtionId=
b;a.claim=void 0;e.show({template:"<ion-spinner></ion-spinner>",delay:100});k.get(b,function(b){a.claim=b;e.hide()},function(a){e.hide()})},n=null,v=!1;a.getlocation=function(){v=!1;e.show({template:"<ion-spinner></ion-spinner>",delay:100});var b=d(function(){!1===v&&(e.hide(),alert("\u83b7\u53d6\u5730\u7406\u4f4d\u7f6e\u4fe1\u606f\u5931\u8d25\u8bf7\u7a0d\u540e\u518d\u8bd5"))},6E3);g.getUserLocation(function(f){v=!0;b&&d.cancel(b);JSON.stringify(f);var c=f.latitude;f=f.longitude;var e=new qq.maps.LatLng(c,
f);a.claim.latitude=c;a.claim.longitude=f;n.getAddress(e)},function(a){e.hide();alert(a)})};a.uploadFile=function(b){g.chooseImage(function(f){a.claim.imgList[b]=f.toString();e.show({template:"<ion-spinner></ion-spinner>",delay:100});g.uploadImage(a.claim.imgList[b],function(f){k.downloadFile(a.claim.id,f,b,function(f){e.hide();a.claim.imgList[b]=f.data;a.$apply()},function(a){e.hide()})},function(a){e.hide()})},function(a){alert(a)})};a.commitClaim=function(){if(void 0===a.claim.gpsaddress||""===
a.claim.gpsaddress)alert("\u8bf7\u70b9\u51fb\u2018\u83b7\u53d6\u5730\u7406\u4f4d\u7f6e\u4fe1\u606f\u2019\u6309\u94ae\uff0c\u8bbe\u7f6e\u5f53\u524d\u4f4d\u7f6e\u4fe1\u606f\uff01");else if(void 0===a.claim.imgList)alert("\u8bf7\u4f9d\u6b21\u9009\u62e9\u51719\u5f20\u7167\u7247\u8fdb\u884c\u4e0a\u4f20");else{for(var b=0;b<a.claim.imgList.length;b++)if(void 0===a.claim.imgList[b]){alert("\u8bf7\u4f9d\u6b21\u9009\u62e9\u51719\u5f20\u7167\u7247\u8fdb\u884c\u4e0a\u4f20");return}var b=a.claim.imgList.length,
f=9-b;9!==b?alert("\u8bf7\u4f9d\u6b21\u9009\u62e9\u51719\u5f20\u7167\u7247\u8fdb\u884c\u4e0a\u4f20,\u5df2\u4e0a\u4f20"+b+"\u5f20 \u8fd8\u9700"+f+"\u5f20"):(e.show({template:"<ion-spinner></ion-spinner>",delay:100}),k.commitClaim(a.claim,function(b){e.hide();a.claim=b.data;a.showhistoryrecord=!0;a.navtoroot("^.result",{id:a.claim.transactionId,result:a.claim})},function(a){e.hide();alert("\u63d0\u4ea4\u62a5\u6848\u51fa\u73b0\u95ee\u9898\u8bf7\u7a0d\u540e\u518d\u8bd5\u3002")}))}};f.$on("$stateChangeStart",
function(b,f,c,d,e){"app.claim.upload"===d.name&&(a.claim=void 0,v=!1);"app.claim.upload"===f.name&&(JSON.stringify(c),p(c.id))});void 0!==b.id&&""!==b.id&&p(b.id);(function(){n=new qq.maps.Geocoder({complete:function(b){e.hide();a.claim.gpsaddress=b.detail.addressComponents.province===b.detail.addressComponents.city?b.detail.addressComponents.country+b.detail.addressComponents.province+b.detail.addressComponents.city+b.detail.addressComponents.district+b.detail.addressComponents.street+b.detail.addressComponents.streetNumber:
b.detail.addressComponents.country+b.detail.addressComponents.city+b.detail.addressComponents.district+b.detail.addressComponents.street+b.detail.addressComponents.streetNumber;a.$apply()}})})()}]).controller("ClaimListCtrl",["$scope","$stateParams","$state","$ionicLoading","$timeout","ClaimAPI","$ionicHistory","Wechat","$ionicPopup","$rootScope",function(a,b,c,e,d,k,l,g,h,f){d(function(){window.loading_screen.finish()},1500);f.$on("$stateChangeStart",function(b,f,c,d,e){"app.claim.list"===d.name&&
(a.claims=void 0);"app.claim.list"===f.name&&p()});var p=function(){e.show({template:"<ion-spinner></ion-spinner>",delay:100});k.getAll(function(b){JSON.stringify(b);a.claims=b;e.hide()},function(a){e.hide();alert("\u83b7\u53d6\u7406\u8d54\u4fe1\u606f\u5931\u8d25\u8bf7\u7a0d\u540e\u518d\u8bd5\u3002")})};p()}]).controller("ClaimHistoryListCtrl",["$scope","$stateParams","$state","$ionicLoading","$timeout","ClaimAPI","$ionicHistory","Wechat","$ionicPopup",function(a,b,c,e,d,k,l,g,h){d(function(){window.loading_screen.finish()},
1500);(function(b){a.id=b.id;e.show({template:"<ion-spinner></ion-spinner>",delay:100});k.getRecord(b,function(b){JSON.stringify(b);a.claimrecords=b;e.hide()},function(a){e.hide();alert("\u83b7\u53d6\u7406\u8d54\u8bb0\u5f55\u4fe1\u606f\u5931\u8d25\u8bf7\u7a0d\u540e\u518d\u8bd5\u3002")})})(b.id)}]);
angular.module("claim.service",["ngResource"]).service("ClaimAPI",["$resource","urlConfig","wechatConstants",function(a,b,c){var e=a(b.REST_END_POINT+"/api/claim/:transtionId",{transtionId:"@transtionId"},{query:{method:"GET",isArray:!1,timeout:1E4}},null),d=a(b.REST_END_POINT+"/api/claim/queryrecord/:claimid",{claimid:"@claimid"},{query:{method:"GET",isArray:!1,timeout:1E4}},null),k=a(b.REST_END_POINT+"/api/claim/getAll",null,{query:{method:"GET",isArray:!1,timeout:1E4}},null),l=a(b.REST_END_POINT+
"/api/claim/create",null,{save:{method:"POST",isArray:!1,timeout:1E4}},null),g=a(b.REST_END_POINT+"/api/claim/downloadFile/:Id/:fileId/:fileIndex",{transtionId:"@transtionId",fileId:"@fileId",fileIndex:"@fileIndex"},{query:{method:"GET",isArray:!1,timeout:1E4}},null),h=a(b.REST_END_POINT+"/api/claim/save",null,{save:{method:"POST",isArray:!1,timeout:6E4}},null);return{get:function(a,b,c){e.query({transtionId:a},function(a){b(a.data)},function(a){c(a.error)})},getRecord:function(a,b,c){d.query({claimid:a},
function(a){b(a.data)},function(a){c(a.error)})},getAll:function(a,b){k.query(function(b){a(b.data)},function(a){b(a.error)})},saveClaim:function(a,b,c){l.save(a,function(a){b(a)},function(a){c(a)})},commitClaim:function(a,b,c){h.save(a,function(a){b(a)},function(a){c(a)})},downloadFile:function(a,b,c,d,e){g.query({Id:a,fileId:b,fileIndex:c},function(a){d(a)},function(a){e(a)})},getShareUrl:function(a){return b.APP_ROOT+c.CLAIM_SHARE_ROOT+a},getShareContent:function(a){var b={name:"[\u5927\u5723\u4fdd\u9669]\u7533\u8bf7\u7406\u8d54"};
b.description="\u8bf7\u4e0a\u4f20\u4fdd\u5355[\u4fdd\u5355\u53f7:"+a.policyno+"]\u7406\u8d54\u6240\u9700\u6750\u6599";b.url=this.getShareUrl(a.id);return b}}}]);angular.module("emessage","ionic ngCookies angular.filter monospaced.qrcode app account agreement coupon proposal transaction redirect promotion invoice invHistory claim wechat regression portal templates".split(" ")).constant("urlConfig",{REST_END_POINT:"http://m.baoxian72.com/API",APP_ROOT:"http://m.baoxian72.com"}).constant("accountConstants",{ACCOUNT_TYPE_NORMAL:0,ACCOUNT_TYPE_AGREEMENT:1}).constant("agreementConstants",{AGREEMENT_ID_AUTO_PAYGO:"AUTO_PAYGO",AGREEMENT_ID_PAYGO_LOCAL_ZH:"PAYGO_LOCAL_ZH",
AGREEMENT_ID_PAYGO_JB:"PAYGO_JB",AGREEMENT_ID_PAYGO_JB_LIMIT_PRICE:"PAYGO_JB_LIMIT_PRICE",AGREEMENT_ID_PAYGO_ZR:"PAYGO_ZR",AGREEMENT_ID_PAYGO_JB_LITE:"PAYGO_JB_LITE",AGREEMENT_ID_PAYGO_LOCAL_JB_LITE:"PAYGO_LOCAL_JB_LITE",AGREEMENT_ID_SIGNUP_COUPON:"SIGNUP_COUPON",AGREEMENT_ID_COUPON_TRANSACTION_25:"COUPON_TRANSACTION_25",AGREEMENT_ID_PAYGO_ZH_COLD_CHAIN:"PAYGO_ZH_COLD_CHAIN",AGREEMENT_ID_PAYGO_ZH_LIMIT_PRICE:"PAYGO_ZH_LIMIT_PRICE",AGREEMENT_ID_SIMULATE:"SIMULATE",AGREEMENT_TYPE_USER:"USER",AGREEMENT_ROUTE_PRESET_BOTH:"BOTH",
AGREEMENT_ROUTE_PRESET_NONE:"NONE",AGREEMENT_ROUTE_PRESET_EQUAL:"EQUAL",AGREEMENT_ROUTE_PRESET_DISTANCE:"DISTANCE",PUBLIC_AGREEMENT_MATRIX:{AUTO_PAYGO:{region:"\u5168\u56fd\u8303\u56f4\uff08\u6e2f\u6fb3\u53f0\u5730\u533a\u9664\u5916\uff09",mainItem:"\u7efc\u5408\u9669",description:"\u4fdd\u969c\u5168\u9762\uff0c\u5bf9\u4e8e\u8d27\u503c\u76f8\u5bf9\u8f83\u9ad8\u7684\u8d27\u7269\u3002\u5982\u5e38\u89c1\u4ea7\u6210\u54c1\uff0c\u670d\u88c5\u3001\u7535\u5b50\u8bbe\u5907\u3001\u673a\u68b0\u8bbe\u5907\u7b49\u7269\u54c1\u6700\u4e3a\u9002\u7528\u3002\u5c24\u5176\u662f\u5bf9\u4e8e100\u4e07\u4ee5\u4e0a\u8d27\u503c\u7684\u9ad8\u4ef7\u503c\u8d27\u54c1\uff0c\u6b64\u4ea7\u54c1\u53ef\u4e0a\u8c03\u989d\u5ea6\u6700\u9ad8\u8fbe500\u4e07\u5143\uff0c\u66f4\u4e3a\u9002\u7528\u3002\u6b64\u4ea7\u54c1\u4e3a\u3010\u514d\u8ffd\u507f\u3011\u4ea7\u54c1\uff0c\u5373\u627f\u4fdd\u4eba\u653e\u5f03\u5bf9\u6295\u4fdd\u4eba\u7684\u8ffd\u507f\u6743\u3002"},
PAYGO_JB:{region:"\u5168\u56fd\u8303\u56f4\uff08\u6e2f\u6fb3\u53f0\u5730\u533a\u9664\u5916\uff09",mainItem:"\u57fa\u672c\u9669",description:"\u4fdd\u8d39\u66f4\u4f18\u60e0\uff0c\u9002\u5408\u4e8e\u8de8\u7701\u4e1a\u52a1\u3002\u5bf9\u4e8e\u8d27\u503c\u4f4e\uff0c\u5bf9\u4fdd\u9669\u4fdd\u969c\u8303\u56f4\u8981\u6c42\u4e0d\u9ad8\u7684\u8d27\u7269\uff0c\u5982\u539f\u6750\u6599\uff0c\u5927\u5b97\u6563\u8d27\u7b49\u7269\u54c1\u66f4\u9002\u7528\u3002\u627f\u4fdd\u4eba\u653e\u5f03\u5bf9\u6295\u4fdd\u4eba\u7684\u8ffd\u507f\u6743\u3002\u6b64\u4ea7\u54c1\u4e3a\u3010\u514d\u8ffd\u507f\u3011\u4ea7\u54c1\uff0c\u5373\u627f\u4fdd\u4eba\u653e\u5f03\u5bf9\u6295\u4fdd\u4eba\u7684\u8ffd\u507f\u6743\u3002"},
PAYGO_LOCAL_ZH:{region:"\u8fd0\u8f93\u7ebf\u8def\u540c\u7701\u8303\u56f4\u5185\uff08\u6e2f\u6fb3\u53f0\u5730\u533a\u9664\u5916\uff09",mainItem:"\u7efc\u5408\u9669",description:"\u9002\u5408\u4e8e\u7701\u540c\u7701\u8303\u56f4\u5185\uff08\u7701\u7ea7\u533a\u57df\uff09\u7684\u914d\u9001\u4e1a\u52a1\u3002\u5bf9\u4e8e\u56de\u7a0b\u8d27\u6216\u5c3e\u8d27\u5206\u6d3e\u73af\u8282\u66f4\u52a0\u9002\u7528\u3002\u540c\u65f6\u7531\u4e8e\u4fdd\u969c\u9650\u989d\u4e3a20-100\u4e07\u5185\u76845\u6863\uff0c\u5206\u7c7b\u66f4\u7ec6\u81f4\uff0c\u9009\u62e9\u66f4\u7075\u6d3b\u3002\u627f\u4fdd\u4eba\u653e\u5f03\u5bf9\u6295\u4fdd\u4eba\u7684\u8ffd\u507f\u6743\u3002\u6b64\u4ea7\u54c1\u4e3a\u3010\u514d\u8ffd\u507f\u3011\u4ea7\u54c1\uff0c\u5373\u627f\u4fdd\u4eba\u653e\u5f03\u5bf9\u6295\u4fdd\u4eba\u7684\u8ffd\u507f\u6743\u3002"},
PAYGO_JB_LITE:{region:"\u5168\u56fd\u8303\u56f4\uff08\u6e2f\u6fb3\u53f0\u5730\u533a\u9664\u5916\uff09",mainItem:"\u57fa\u672c\u9669",description:"\u4fdd\u8d39\u66f4\u4f18\u60e0\uff0c\u9002\u5408\u4e8e\u8de8\u7701\u4e1a\u52a1\u3002\u5bf9\u4e8e\u8d27\u503c\u4f4e\uff0c\u5bf9\u4fdd\u9669\u4fdd\u969c\u8303\u56f4\u8981\u6c42\u4e0d\u9ad8\u7684\u8d27\u7269\uff0c\u5982\u539f\u6750\u6599\uff0c\u5927\u5b97\u6563\u8d27\u7b49\u7269\u54c1\u66f4\u9002\u7528\u3002\u4ec5\u627f\u4fdd\u7531\u4e8e\u706b\u707e\u3001\u7206\u70b8\u3001\u4ea4\u901a\u5de5\u5177\u610f\u5916\u4e8b\u6545\u5f15\u8d77\u7684\u8d27\u7269\u635f\u5931\u3002\u6bcf\u6b21\u4e8b\u6545\u7edd\u5bf9\u514d\u8d54\uffe525000\u5143\u6216\u8005\u635f\u5931\u91d1\u989d\u768410%\uff0c\u4ee5\u9ad8\u8005\u4e3a\u51c6\u3002\u6b64\u4ea7\u54c1\u4e3a\u3010\u514d\u8ffd\u507f\u3011\u4ea7\u54c1\uff0c\u5373\u627f\u4fdd\u4eba\u653e\u5f03\u5bf9\u6295\u4fdd\u4eba\u7684\u8ffd\u507f\u6743\u3002"},
PAYGO_LOCAL_JB_LITE:{region:"\u5168\u56fd\u8303\u56f4\uff08\u6e2f\u6fb3\u53f0\u5730\u533a\u9664\u5916\uff09",mainItem:"\u57fa\u672c\u9669",description:"\u9002\u5408\u4e8e\u7701\u540c\u7701\u8303\u56f4\u5185\uff08\u7701\u7ea7\u533a\u57df\uff09\u7684\u914d\u9001\u4e1a\u52a1\u3002\u5bf9\u4e8e\u56de\u7a0b\u8d27\u6216\u5c3e\u8d27\u5206\u6d3e\u73af\u8282\u66f4\u52a0\u9002\u7528\u3002\u4ec5\u627f\u4fdd\u7531\u4e8e\u706b\u707e\u3001\u7206\u70b8\u3001\u4ea4\u901a\u5de5\u5177\u610f\u5916\u4e8b\u6545\u5f15\u8d77\u7684\u8d27\u7269\u635f\u5931\u3002\u6bcf\u6b21\u4e8b\u6545\u7edd\u5bf9\u514d\u8d54\uffe525000\u5143\u6216\u8005\u635f\u5931\u91d1\u989d\u768410%\uff0c\u4ee5\u9ad8\u8005\u4e3a\u51c6\u3002\u6b64\u4ea7\u54c1\u4e3a\u3010\u514d\u8ffd\u507f\u3011\u4ea7\u54c1\uff0c\u5373\u627f\u4fdd\u4eba\u653e\u5f03\u5bf9\u6295\u4fdd\u4eba\u7684\u8ffd\u507f\u6743\u3002"},
PAYGO_ZR:{region:"\u5168\u56fd\u8303\u56f4\uff08\u6e2f\u6fb3\u53f0\u5730\u533a\u9664\u5916\uff09",mainItem:"\u8d23\u4efb\u9669",description:"\u4fdd\u969c\u5168\u9762\uff0c\u5bf9\u4e8e\u8d27\u503c\u76f8\u5bf9\u8f83\u9ad8\u7684\u8d27\u7269\u3002\u5982\u5e38\u89c1\u4ea7\u6210\u54c1\uff0c\u670d\u88c5\u3001\u7535\u5b50\u8bbe\u5907\u3001\u673a\u68b0\u8bbe\u5907\u7b49\u7269\u54c1\u6700\u4e3a\u9002\u7528\u3002\u5c24\u5176\u662f\u5bf9\u4e8e100\u4e07\u4ee5\u4e0a\u8d27\u503c\u7684\u9ad8\u4ef7\u503c\u8d27\u54c1\uff0c\u6b64\u4ea7\u54c1\u53ef\u4e0a\u8c03\u989d\u5ea6\u6700\u9ad8\u8fbe250\u4e07\u5143\uff0c\u66f4\u4e3a\u9002\u7528\u3002"},
PAYGO_ZH_COLD_CHAIN:{region:"\u5168\u56fd\u8303\u56f4\uff08\u6e2f\u6fb3\u53f0\u5730\u533a\u9664\u5916\uff09",mainItem:"\u7efc\u5408\u9669",description:"\u672c\u4ea7\u54c1\u4e13\u9879\u9488\u5bf9\u4e8e\u51b7\u51bb\u8089\u7c7b\u5236\u54c1\u5168\u56fd\u8303\u56f4\u5185\u7684\u8fd0\u8f93\u670d\u52a1\u3002\u4ea7\u54c1\u4fdd\u969c\u5168\u9762\uff0c\u4e0d\u4ec5\u627f\u4fdd\u5e38\u89c1\u706b\u707e\u7206\u70b8\u3001\u4ea4\u901a\u4e8b\u6545\u7b49\u8fd0\u8f93\u98ce\u9669\uff0c\u8fd8\u627f\u4fdd\u51b7\u51bb\u8089\u7c7b\u5236\u54c1\u7531\u4e8e\u51b7\u85cf\u673a\u5668\u6216\u9694\u6e29\u8bbe\u5907\u7684\u635f\u574f\u6216\u8005\u8f66\u53a2\u5185\u8d2e\u5b58\u51b0\u5757\u7684\u6eb6\u5316\u6240\u9020\u6210\u7684\u89e3\u51bb\u6eb6\u5316\u800c\u8150\u8d25\u7684\u635f\u5931\u3002\u4fdd\u969c\u989d\u5ea6\u9ad8\uff0c\u6700\u9ad8\u53ef\u6295\u4fdd\u81f3100\u4e07\u5143\u3002\u4fdd\u969c\u8303\u56f4\u5e7f\u6cdb\uff0c\u5982\u5e38\u89c1\u7684\u732a\u725b\u7f8a\u8089\u7c7b\u3001\u9e21\u8089\u7c7b\u3001\u51b7\u51bb\u9c7c\u7c7b\u5236\u54c1\u7b49\u5747\u53ef\u9002\u7528\u3002"}},
BACKGROUND_ROOT:"/img/agreement-public/",PAY_METHOD_CREDIT:"credit",PAY_METHOD_H5:"h5",PAY_METHOD_COUPON:"coupon",PAY_METHOD_SIMULATE:"simulate",PAY_PROVIDER_WX:"wxmppay",PAY_PROVIDER_ALI:"alipay",PAY_PROVIDER_CREDIT:"credit",PAY_PROVIDER_COUPON:"coupon",PAY_PROVIDER_SIMULATE:"simulate",PRODUCT_NAME_SIMULATE:"\u6a21\u62df\u7efc\u5408\u9669",INVOICE_TYPES:{NORMAL:"\u666e\u901a\u53d1\u7968",VALUE_ADDED_SPECIAL:"\u589e\u503c\u7a0e\u4e13\u7528\u53d1\u7968"},INVOICE_TYPE_NORMAL:"NORMAL"}).constant("promotionConstants",
{ENTRY_POINT_PAY_SUCCESS:"PAY_SUCCESS",BATCH_SOURCE_TYPE_TRANSACTION:"TRANSACTION",PIC_URL_DEFAULT:"defaultpic",PIC_ROOT:"img/promotion/"}).constant("publicPromotionConstants",{ACTION_COLLECT:"COLLECT",PIC_ROOT:"img/promotion/"}).constant("promotionBackgroundColors",{"16036acd775e970991e0677af90449f4":"#FFF",a3fb6acd775e77af90449f4970991e06:"#FFF",a3fb6acd775e970991e0677af90449f4:"#FFF","16046acd775e970991e0677af90449f4":"#FFF",a3fb6acd775e77af90449f4970991e56:"#FFF"}).constant("couponConstants",
{COUPON_TYPE_TRANS:"TRANSACTION",COUPON_TYPE_PRODUCT_VOUCHER:"PRODUCT_VOUCHER",COUPON_TYPE_DISCOUNT_VOUCHER:"DISCOUNT_VOUCHER",COUPON_TYPE_LIMIT_PRICE:"LIMIT_PRICE",COUPON_STATUS_NOT_USED:0,COUPON_SCOPE_TYPE_AGREEMENT_TYPE:"AGREEMENT_TYPE",COUPON_SCOPE_TYPE_TAG:"TAG",COUPON_SCOPE_CONFIG_USER:"USER",COUPON_SCOPE_CONFIG_PAYGO:"PAYGO"}).constant("invoiceConstants",{HISTORY_STATUS_PROCESSING:1,HISTORY_STATUS_MAILED:7,ITEM_TYPE_TRANSACTION:"TRANSACTION",ITEM_TYPE_CHARGE_RECORD:"CHARGE_RECORD",TYPES:{NORMAL:"\u666e\u901a\u53d1\u7968",
VALUE_ADDED_SPECIAL:"\u589e\u503c\u7a0e\u4e13\u7528\u53d1\u7968"},TYPE_NORMAL:"NORMAL"}).constant("eventNames",{PROPOSAL_SUCCESS:"proposal-suc",INVOICE_APPLY_SUCCESS:"invoice-apply-suc",AGREEMENT_CHARGE_SUCCESS:"agreement-charge-suc",CREDIT_EXCHANGE_SUCCESS:"credit-exchange-suc"}).run(["$ionicPlatform",function(a){a.ready(function(){window.cordova&&window.cordova.plugins.Keyboard&&(cordova.plugins.Keyboard.hideKeyboardAccessoryBar(!0),cordova.plugins.Keyboard.disableScroll(!0));window.StatusBar&&
StatusBar.styleDefault()})}]).config(["$stateProvider","$urlRouterProvider","$ionicConfigProvider",function(a,b,c){a.state("redirect",{url:"/redirect?providerUserId&mobile&xAuthToken&state&detail",templateUrl:"",controller:"redirectCtrl"}).state("promotion",{url:"/promotion/:id",template:"",controller:"PublicPromotionCtrl"}).state("survey",{url:"/survey/:id",template:"",controller:"PublicSurveyCtrl"}).state("app",{url:"/app",templateUrl:"templates/app/menu.html",controller:"AppCtrl"}).state("app.proposal",
{url:"/proposal?agreementId",views:{menuContent:{template:'<ion-nav-view name="proposalContent" class="proposal"></ion-nav-view>',controller:"ProposalCtrl"}}}).state("app.proposal.start",{url:"/start?payCouponId",views:{proposalContent:{templateUrl:"templates/app/proposal.start.html"}}}).state("app.proposal.pay",{url:"/pay",views:{proposalContent:{templateUrl:"templates/app/proposal.pay.html"}}}).state("app.proposal.result",{url:"/result",views:{proposalContent:{templateUrl:"templates/app/proposal.result.html"}}}).state("app.transaction",
{url:"/transaction",views:{menuContent:{template:'<ion-nav-view name="transactionContent" class="transaction"></ion-nav-view>',controller:"TransactionCtrl"}}}).state("app.transaction.list",{url:"/",views:{transactionContent:{templateUrl:"templates/app/transaction.list.html",controller:"TransactionListCtrl"}}}).state("app.transaction.listQQx5",{url:"/qqx5",views:{transactionContent:{templateUrl:"templates/app/transaction.list.qqx5.html",controller:"TransactionListQQx5Ctrl"}}}).state("app.transaction.detail",
{url:"/:id",views:{transactionContent:{templateUrl:"templates/app/transaction.detail.html",controller:"TransactionDetailCtrl"}}}).state("app.portal",{url:"/portal",views:{menuContent:{template:'<ion-nav-view name="portalContent" class="portal"></ion-nav-view>',controller:"PortalCtrl"}}}).state("app.portal.category",{url:"/:id",views:{portalContent:{templateUrl:"templates/app/portal.html",controller:"PortalCategoryCtrl"}}}).state("app.agreement",{url:"/agreement",views:{menuContent:{template:'<ion-nav-view name="agreementContent" class="agreement"></ion-nav-view>',
controller:"AgreementCtrl"}}}).state("app.agreement.list",{url:"/?toPropose&paygo&user",views:{agreementContent:{templateUrl:"templates/app/agreement.list.html"}}}).state("app.agreement.publicDetail",{url:"/public/:id",views:{agreementContent:{templateUrl:"templates/app/agreement.public.detail.html",controller:"AgreementPublicDetailCtrl"}}}).state("app.agreement.detail",{url:"/:id",views:{agreementContent:{templateUrl:"templates/app/agreement.detail.html",controller:"AgreementDetailCtrl"}}}).state("app.agreement.charge",
{url:"/charge/:id",views:{agreementContent:{templateUrl:"templates/app/agreement.charge.html",controller:"AgreementChargeCtrl"}}}).state("app.claim",{url:"/claim/:id",views:{menuContent:{template:'<ion-nav-view name="claimContent" class="claim"></ion-nav-view>',controller:"ClaimCtrl"}}}).state("app.claim.start",{url:"/start/:id",views:{claimContent:{templateUrl:"templates/app/claim.start.html"}}}).state("app.claim.confirm",{url:"/confirm",views:{claimContent:{templateUrl:"templates/app/claim.confirm.html"}}}).state("app.claim.upload",
{url:"/:id",views:{claimContent:{templateUrl:"templates/app/claim.upload.html",controller:"ClaimUploadCtrl"}},params:{id:null,result:null}}).state("app.claim.historylist",{url:"/historylist/:id",views:{claimContent:{templateUrl:"templates/app/claim.detail.list.html",controller:"ClaimHistoryListCtrl"}}}).state("app.claim.list",{url:"/:id",views:{claimContent:{templateUrl:"templates/app/claim.list.html",controller:"ClaimListCtrl"}}}).state("app.claim.result",{url:"/result/:id",views:{claimContent:{templateUrl:"templates/app/claim.result.html"}},
params:{id:null,result:null}}).state("app.claimIntro",{url:"/claimIntro",views:{menuContent:{templateUrl:"templates/app/public.claimIntro.html"}}}).state("app.account",{url:"/account",views:{menuContent:{template:'<ion-nav-view name="accountContent" class="account"></ion-nav-view>',controller:"AccountCtrl"}}}).state("app.account.show",{url:"/",views:{accountContent:{templateUrl:"templates/app/account.html"}}}).state("app.account.salesOrComm",{url:"/salesOrComm",views:{accountContent:{controller:"SalesOrCommCtrl"}}}).state("app.account.community",
{url:"/community",views:{accountContent:{template:'<ion-nav-view name="communityContent" class="community"></ion-nav-view>'}}}).state("app.account.community.invite",{url:"/invite",views:{communityContent:{templateUrl:"templates/app/account.community.invite.html",controller:"CommInviteCtrl"}}}).state("app.account.community.credit",{url:"/credit",views:{communityContent:{templateUrl:"templates/app/account.community.credit.html",controller:"CommCreditCtrl"}}}).state("app.account.community.exchange",
{url:"/exchange",views:{communityContent:{templateUrl:"templates/app/account.community.exchange.html",controller:"CommExchangeCtrl"}}}).state("app.account.sales",{url:"/sales",views:{accountContent:{template:'<ion-nav-view name="salesContent" class="sales"></ion-nav-view>'}}}).state("app.account.sales.credit",{url:"/credit",views:{salesContent:{templateUrl:"templates/app/account.sales.credit.html",controller:"CommCreditCtrl"}}}).state("app.account.sales.invite",{url:"/invite",views:{salesContent:{templateUrl:"templates/app/account.sales.invite.html",
controller:"CommInviteCtrl"}}}).state("app.promotion",{url:"/promotion/:id?sourceType&sourceDetail",views:{menuContent:{templateUrl:"templates/app/promotion.html",controller:"PromotionCtrl"}}}).state("app.coupon",{url:"/coupon",views:{menuContent:{template:'<ion-nav-view name="couponContent" class="coupon"></ion-nav-view>',controller:"CouponCtrl"}}}).state("app.coupon.list",{url:"/",views:{couponContent:{templateUrl:"templates/app/coupon.list.html",controller:"CouponListCtrl"}}}).state("app.coupon.listQQx5",
{url:"/qqx5",views:{couponContent:{templateUrl:"templates/app/coupon.list.qqx5.html",controller:"CouponListQQx5Ctrl"}}}).state("app.invoice",{url:"/invoice",views:{menuContent:{template:'<ion-nav-view name="invoiceContent" class="invoice"></ion-nav-view>',controller:"InvoiceListCtrl"}}}).state("app.invoice.list",{url:"/",views:{invoiceContent:{templateUrl:"templates/app/invoice.list.html"}}}).state("app.invoice.apply",{url:"/apply",views:{invoiceContent:{templateUrl:"templates/app/invoice.apply.html",
controller:"InvoiceApplyCtrl"}}}).state("app.invHistory",{url:"/invHistory",views:{menuContent:{template:'<ion-nav-view name="invHistoryContent" class="invHistory"></ion-nav-view>',controller:"InvHistoryListCtrl"}}}).state("app.invHistory.list",{url:"/",views:{invHistoryContent:{templateUrl:"templates/app/invHistory.list.html"}}}).state("app.invHistory.detail",{url:"/:id",views:{invHistoryContent:{templateUrl:"templates/app/invHistory.detail.html",controller:"InvHistoryDetailCtrl"}}});b.otherwise("/app/portal/");
c.views.transition("none");c.backButton.text("\u8fd4\u56de")}]);angular.module("coupon",["coupon.service","wechat","ng-iscroll"]).controller("CouponCtrl",["$scope","$state","$ionicHistory","CouponAPI","$rootScope","$ionicLoading","eventNames","couponConstants","agreementConstants",function(a,b,c,e,d,k,l,g,h){var f=function(){a.coupons=[];a.refresh(function(){k.show({template:"<ion-spinner></ion-spinner>",delay:100})},function(){k.hide()},function(){d.navToIndex()})},p=function(){a.coupons=void 0;a.pageNumber=void 0;a.hasCoupon=void 0;a.initFinish=void 0};a.refresh=
function(b,f,c){b();e.refresh(function(b){a.coupons=b;a.pageNumber=0;a.hasCoupon=!(void 0===a.coupons||0===a.coupons.length);a.initFinish=!0;f()},function(b){a.initFinish=!0;console.log(b);alert("\u5237\u65b0\u5931\u8d25\uff0c\u8bf7\u7a0d\u540e\u518d\u8bd5");f();c()})};a.isTransType=function(a){return a.fullfillType===g.COUPON_TYPE_TRANS};a.isLimitPriceType=function(a){return a.fullfillType===g.COUPON_TYPE_LIMIT_PRICE};a.isVoucherType=function(a){return a.fullfillType===g.COUPON_TYPE_PRODUCT_VOUCHER};
a.isDiscountType=function(a){return a.fullfillType===g.COUPON_TYPE_DISCOUNT_VOUCHER};a.isNotUsed=function(a){return a.status===g.COUPON_STATUS_NOT_USED};a.navToProposal=function(a){if(a.fullfillType===g.COUPON_TYPE_TRANS)b.go("app.proposal.start",{agreementId:a.fullfillConfig,payCouponId:a.id});else{for(var f,c,d,e,p=0;p<a.scopes.length;p++)a.scopes[p].type===g.COUPON_SCOPE_TYPE_AGREEMENT_TYPE?(f=1,c=a.scopes[p].config):a.scopes[p].type===g.COUPON_SCOPE_TYPE_TAG&&a.scopes[p].config===g.COUPON_SCOPE_CONFIG_PAYGO?
d=1:a.scopes[p].type===g.COUPON_SCOPE_TYPE_TAG&&a.scopes[p].config===g.COUPON_SCOPE_CONFIG_USER&&(e=1);1===f?b.go("app.proposal.start",{agreementId:c,payCouponId:a.id}):b.go("app.agreement.list",{toPropose:"1",paygo:d,user:e})}};a.loadNext=function(b){a.canLoadNext()&&e.getPage(a.pageNumber+1,function(f){if(void 0!==f&&0!==f.length){for(var c=0;c<f.length;c++)a.coupons.push(f[c]);a.pageNumber++}b()},function(a){alert(a);b()})};a.canLoadNext=function(){return e.hasMoreToLoad()};f();d.$on("$stateChangeStart",
function(a,b,c,d,e){"app.coupon"!==b.name&&"app.coupon.list"!==b.name&&"app.coupon.detail"!==b.name&&"app.coupon.listQQx5"!==b.name||"app.coupon.detail"===d.name||"app.coupon.list"===d.name||"app.coupon.listQQx5"===d.name||f()});d.$on("event:auth-loginCancelled",function(){p()});d.$on("event:auth-logout-complete",function(){p()});d.$on(l.PROPOSAL_SUCCESS,function(a,b){e.clean()});d.$on(l.CREDIT_EXCHANGE_SUCCESS,function(a,b){e.clean()})}]).controller("CouponListCtrl",["$scope","$timeout",function(a,
b){a.loadMore=function(){console.log("load more");a.$parent.loadNext(function(){a.$broadcast("scroll.infiniteScrollComplete")})};a.refresh=function(){a.$parent.refresh(function(){},function(){b(function(){a.$broadcast("scroll.refreshComplete")},500)},function(){})};a.canLoadMore=function(){return a.$parent.canLoadNext()}}]).controller("CouponListQQx5Ctrl",["$scope","$rootScope",function(a,b){a.hasNext=function(){return!!(a.$parent.pageNumber>a.page||a.$parent.canLoadNext())};a.hasPrev=function(){return 0<
a.page};a.nextPage=function(){a.$parent.pageNumber>a.page?a.page++:a.$parent.canLoadNext()?a.$parent.loadNext(function(){a.$parent.pageNumber>a.page&&a.page++}):alert("\u5df2\u7ecf\u662f\u6700\u540e\u4e00\u9875")};a.preOrRefreshPage=function(){1<a.page?a.page--:1!==a.page&&0!==a.page||a.refresh()};a.refresh=function(){a.$parent.refresh(function(){},function(){a.page=0},function(){})};a.page=0;b.$on("$stateChangeStart",function(b,e,d,k,l){"app.coupon"!==e.name&&"app.coupon.list"!==e.name&&"app.coupon.detail"!==
e.name&&"app.coupon.listQQx5"!==e.name||"app.coupon.detail"===k.name||"app.coupon.list"===k.name||"app.coupon.listQQx5"===k.name||(a.page=0)})}]);
angular.module("coupon.service",["ngResource"]).service("CouponAPI",["$resource","urlConfig",function(a,b){var c=a(b.REST_END_POINT+"/api/marketing/coupon",{page:"@page",agreementId:"@agreementId"},{query:{method:"GET",isArray:!1,timeout:1E4}},null),e=function(a,b,f,d){c.query({page:a,agreementId:b},function(a){for(var b=[],c=0;c<a.list.length;c++)k[a.list[c].id]=a.list[c],b.push(a.list[c]);console.log("coupon page data init success");f(b)},function(a){d(a.data.error)})},d=function(a,b){k={};l=0;
c.query({page:0},function(b){l=b.metaData.total;for(var f=[],c=0;c<b.list.length;c++)k[b.list[c].id]=b.list[c],f.push(b.list[c]);console.log("coupon metaData init success");a(f)},function(a){b(a.data.error)})},k={},l=0;return{getPage:function(a,b,f){e(a,void 0,b,f)},refresh:function(a,b){d(a,b)},get:function(a){return k[a]},findAllByAgreementId:function(a,b,f){e(void 0,a,b,f)},hasMoreToLoad:function(){return!!(void 0!==k&&0!==Object.keys(k).length&&Object.keys(k).length<l)},clean:function(){k=void 0;
l=0}}}]);/*
 HTTP Auth Interceptor Module for AngularJS
 (c) 2012 Witold Szczerba
 License: MIT
*/
(function(){angular.module("http-auth-interceptor",["http-auth-interceptor-buffer"]).factory("authService",["$rootScope","httpBuffer",function(a,b){return{loginConfirmed:function(c,e){var d=e||function(a){return a};a.$broadcast("event:auth-loginConfirmed",c);b.retryAll(d)},loginCancelled:function(c,e){b.rejectAll(e);a.$broadcast("event:auth-loginCancelled",c)}}}]).config(["$httpProvider",function(a){a.interceptors.push(["$rootScope","$q","httpBuffer",function(a,c,e){return{responseError:function(b){if(!b.config.ignoreAuthModule)switch(b.status){case 401:var d=
c.defer();e.append(b.config,d);a.$broadcast("event:auth-loginRequired",b);return d.promise;case 403:return d=c.defer(),e.append(b.config,d),a.$broadcast("event:auth-forbidden",b),d.promise}return c.reject(b)}}}])}]);angular.module("http-auth-interceptor-buffer",[]).factory("httpBuffer",["$injector",function(a){function b(b,c){e=e||a.get("$http");e(b).then(function(a){c.resolve(a)},function(a){c.reject(a)})}var c=[],e;return{append:function(a,b){c.push({config:a,deferred:b})},rejectAll:function(a){if(a)for(var b=
0;b<c.length;++b)c[b].deferred.reject(a);c=[]},retryAll:function(a){for(var d=0;d<c.length;++d)b(a(c[d].config),c[d].deferred);c=[]}}}])})();angular.module("invHistory",["invHistory.service"]).controller("InvHistoryListCtrl",["$scope","$state","$ionicHistory","InvHistoryAPI","$rootScope","$ionicLoading","$timeout","invoiceConstants","eventNames",function(a,b,c,e,d,k,l,g,h){var f=function(){a.invHistories=[];n(function(){k.show({template:"<ion-spinner></ion-spinner>",delay:100})},function(){k.hide()},function(){d.navToIndex()})},p=function(){a.invHistories=void 0;a.hasInvHistory=void 0;a.initFinish=void 0},n=function(b,f,c){b();e.refresh(function(b){a.invHistories=
b;a.hasInvHistory=!(void 0===a.invHistories||0===a.invHistories.length);if(a.hasInvHistory)for(var c in a.invHistories)a.invHistories[c].typeAlias=g.TYPES[a.invHistories[c].type],a.invHistories[c].isValueAdded=a.invHistories[c].type!==g.TYPE_NORMAL;a.initFinish=!0;f()},function(b){a.initFinish=!0;console.log(b);alert("\u5237\u65b0\u5931\u8d25\uff0c\u8bf7\u7a0d\u540e\u518d\u8bd5");f();c()})};a.refresh=function(){n(function(){},function(){l(function(){a.$broadcast("scroll.refreshComplete")},500)},function(){})};
a.isProcessing=function(a){return a.status===g.HISTORY_STATUS_PROCESSING};a.isMailed=function(a){return a.status===g.HISTORY_STATUS_MAILED};f();d.$on("$stateChangeStart",function(a,b,c,d,e){"app.invHistory"!==b.name&&"app.invHistory.list"!==b.name&&"app.invHistory.detail"!==b.name||"app.invHistory.detail"===d.name||"app.invHistory.list"===d.name||f()});d.$on("event:auth-loginCancelled",function(){p()});d.$on("event:auth-logout-complete",function(){p()})}]).controller("InvHistoryDetailCtrl",["$scope",
"$rootScope","$stateParams","InvHistoryAPI",function(a,b,c,e){a.invHistory=e.get(c.id);b.$on("$stateChangeStart",function(b,k,l,g,h){"app.invHistory.detail"===k.name&&(a.invHistory=e.get(c.id))})}]);
angular.module("invHistory.service",["ngResource"]).service("InvHistoryAPI",["$resource","urlConfig",function(a,b){var c=a(b.REST_END_POINT+"/api/invoice/",{},{query:{method:"GET",isArray:!0,timeout:1E4}},null),e=function(a,b){d={};c.query({},function(b){for(var c=[],f=0;f<b.length;f++)d[b[f].id]=b[f],c.push(b[f]);console.log("invoice histories init success");a(c)},function(a){b(a.data.error)})},d={};return{refresh:function(a,b){e(a,b)},get:function(a){return d[a]},clean:function(){d=void 0}}}]);angular.module("invoice",["invoice.service"]).controller("InvoiceListCtrl",["$scope","$state","$ionicHistory","InvoiceAPI","$rootScope","$ionicLoading","eventNames","invoiceConstants",function(a,b,c,e,d,k,l,g){var h=function(){a.invoices=[];a.applyInvoices=[];a.refresh(function(){k.show({template:"<ion-spinner></ion-spinner>",delay:100})},function(){k.hide()},function(){d.navToIndex()})},f=function(){a.invoices=void 0;a.applyInvoices=void 0;a.hasInvoice=void 0;a.initFinish=void 0};a.isChargeRecordType=
function(a){return a.type===g.ITEM_TYPE_CHARGE_RECORD};a.isTransactionType=function(a){return a.type===g.ITEM_TYPE_TRANSACTION};a.refresh=function(b,f,c){b();e.refresh(function(b){a.invoices=b;a.hasInvoice=!(void 0===a.invoices||0===a.invoices.length);if(a.hasInvoice)for(b=0;b<a.invoices.length;b++)a.invoices[b].invoiceTypeAlias=g.TYPES[a.invoices[b].invoiceType];a.initFinish=!0;f()},function(b){a.initFinish=!0;console.log(b);alert("\u5237\u65b0\u5931\u8d25\uff0c\u8bf7\u7a0d\u540e\u518d\u8bd5");f();
c()})};a.calcFee=function(a){var b=0,f;for(f in a)!0===a[f].add&&(b+=a[f].amount);return b};a.calcApplyFee=function(){return a.calcFee(a.invoices)};a.calcApplyNo=function(){var b=0,f;for(f in a.invoices)a.invoices.hasOwnProperty(f)&&!0===a.invoices[f].add&&(b+=1);return b};a.validateInvoices=function(b){var f=b.invoiceType,c=b.title,d=b.companyTaxId,e;for(e in a.invoices)if(a.invoices.hasOwnProperty(e)&&!0===a.invoices[e].add&&(f!==a.invoices[e].invoiceType||c!==a.invoices[e].title||d!==a.invoices[e].companyTaxId)){alert("\u65b0\u6dfb\u52a0\u7684\u5f00\u7968\u9879\u4e0e\u5df2\u9009\u4e2d\u7684\u5f00\u7968\u9879\u4fe1\u606f\u4e0d\u4e00\u81f4\uff0c\u8bf7\u5206\u4e24\u6b21\u5f00\u5177\u3002");
b.add=!1;break}};a.apply=function(){a.applyInvoices=[];for(var f in a.invoices)a.invoices.hasOwnProperty(f)&&!0===a.invoices[f].add&&a.applyInvoices.push(a.invoices[f]);void 0!==a.applyInvoices.length&&0!==a.applyInvoices.length?b.go("^.apply"):alert("\u8bf7\u9009\u62e9\u9700\u8981\u5f00\u5177\u7684\u53d1\u7968")};h();d.$on("$stateChangeStart",function(a,b,f,c,d){"app.invoice"!==b.name&&"app.invoice.list"!==b.name&&"app.invoice.apply"!==b.name||"app.invoice.list"===c.name||"app.invoice.apply"===c.name||
h()});d.$on("event:auth-loginCancelled",function(){f()});d.$on("event:auth-logout-complete",function(){f()});d.$on(l.INVOICE_APPLY_SUCCESS,function(a,b){e.clean();f();h()})}]).controller("InvoiceApplyCtrl",["$scope","InvoiceAPI","$rootScope","$state","$ionicLoading","$ionicHistory","invoiceConstants","eventNames",function(a,b,c,e,d,k,l,g){var h=function(){a.invoice={invoiceType:a.$parent.applyInvoices[0].invoiceType,invoiceTypeAlias:l.TYPES[a.$parent.applyInvoices[0].invoiceType],isValueAdded:a.$parent.applyInvoices[0].invoiceType!==
l.TYPE_NORMAL,title:a.$parent.applyInvoices[0].title,companyTaxId:a.$parent.applyInvoices[0].companyTaxId}};a.calcApplyFee=function(){return a.$parent.calcFee(a.invoices)};a.confirm=function(){if(a.invoice.isValueAdded){if(void 0===a.invoice.companyTaxId||""===a.invoice.companyTaxId){alert("\u8bf7\u8f93\u5165\u7eb3\u7a0e\u4eba\u8bc6\u522b\u53f7");return}if(void 0===a.invoice.companyRegisterAddress||""===a.invoice.companyRegisterAddress){alert("\u8bf7\u8f93\u5165\u4f01\u4e1a\u6ce8\u518c\u5730\u5740");
return}if(void 0===a.invoice.companyRegisterPhone||""===a.invoice.companyRegisterPhone){alert("\u8bf7\u8f93\u5165\u4f01\u4e1a\u6ce8\u518c\u7535\u8bdd");return}if(void 0===a.invoice.companyBankName||""===a.invoice.companyBankName){alert("\u8bf7\u8f93\u5165\u4f01\u4e1a\u5f00\u6237\u94f6\u884c");return}if(void 0===a.invoice.companyBankAccountId||""===a.invoice.companyBankAccountId){alert("\u8bf7\u8f93\u5165\u4f01\u4e1a\u94f6\u884c\u8d26\u53f7");return}}if(void 0===a.invoice.title||""===a.invoice.title)alert("\u8bf7\u8f93\u5165\u53d1\u7968\u62ac\u5934");
else if(void 0===a.invoice.name||""===a.invoice.name)alert("\u8bf7\u8f93\u5165\u6536\u4ef6\u4eba\u59d3\u540d");else if(void 0===a.invoice.phone||""===a.invoice.phone)alert("\u8bf7\u8f93\u5165\u6536\u4ef6\u7535\u8bdd");else if(void 0===a.invoice.address||""===a.invoice.address)alert("\u8bf7\u8f93\u5165\u6536\u4ef6\u5730\u5740");else{var f=[],e;for(e in a.$parent.applyInvoices)f.push(a.$parent.applyInvoices[e].id);a.invoice.items=f;d.show({template:"<ion-spinner></ion-spinner>",delay:100});b.apply(a.invoice,
function(){d.hide();alert("\u53d1\u7968\u5c06\u57287\u4e2a\u5de5\u4f5c\u65e5\u5185\u5bc4\u51fa\uff0c\u8bf7\u8010\u5fc3\u7b49\u5019");c.navToRoot("app.invHistory.list");c.$broadcast(g.INVOICE_APPLY_SUCCESS)},function(a){d.hide();alert(a)})}};h();c.$on("$stateChangeStart",function(a,b,c,d,e){"app.invoice.apply"===b.name&&"app.invoice.apply"!==d.name&&h()});c.$on(g.INVOICE_APPLY_SUCCESS,function(){a.invoice=void 0});c.$on("event:auth-loginCancelled",function(){a.invoice=void 0});c.$on("event:auth-logout-complete",
function(){a.invoice=void 0})}]);
angular.module("invoice.service",[]).service("InvoiceAPI",["$resource","urlConfig",function(a,b){var c=a(b.REST_END_POINT+"/api/invoice/item",{},{query:{method:"GET",isArray:!0,timeout:1E4}},null),e=a(b.REST_END_POINT+"/api/invoice/"),d=function(a,b){c.query({},function(b){for(var f=[],c=0;c<b.length;c++)f.push(b[c]);console.log("invoice init success");a(f)},function(a){b(a.data.error)})},k=function(a,b,c){(new e(a)).$save({},function(a){console.log("apply successful");b(a)},function(a){c(a.data.error)})};
return{apply:function(a,b,c){k(a,b,c)},refresh:function(a,b){d(a,b)},clean:function(){invoices=void 0}}}]);angular.module("portal",["category.service","agreement"]).controller("PortalCtrl",["$scope","$state","$rootScope","$ionicLoading","CategoryAPI","accountConstants","eventNames","AgreementAPI","agreementConstants","categoryConstants",function(a,b,c,e,d,k,l,g,h,f){var p=[h.AGREEMENT_ID_PAYGO_LOCAL_JB_LITE,h.AGREEMENT_ID_PAYGO_LOCAL_ZH,h.AGREEMENT_ID_PAYGO_JB_LITE,h.AGREEMENT_ID_PAYGO_JB,h.AGREEMENT_ID_AUTO_PAYGO,h.AGREEMENT_ID_PAYGO_ZR,h.AGREEMENT_ID_PAYGO_ZH_COLD_CHAIN];(function(){e.show({template:"<ion-spinner></ion-spinner>",
delay:100});g.findPublicByIdIn(p,function(b){a.publicAgreements=b;d.findAll(function(b){a.categories=b.category;for(var c in a.categories)b=a.categories[c],a.categories[c].icon=void 0!==f.icon[b.id]?f.icon[b.id]:f.icon[0];e.hide()},function(a){alert("\u670d\u52a1\u5668\u672a\u54cd\u5e94\uff0c\u83b7\u53d6\u54c1\u7c7b\u4fe1\u606f\u5931\u8d25\uff0c\u8bf7\u8054\u7cfb\u7ba1\u7406\u5458\u8bf4\u7a0d\u540e\u518d\u8bd5")})},function(a){e.hide();alert("\u670d\u52a1\u5668\u672a\u54cd\u5e94\uff0c\u83b7\u53d6\u4ea7\u54c1\u4fe1\u606f\u5931\u8d25\uff0c\u8bf7\u8054\u7cfb\u7ba1\u7406\u5458\u8bf4\u7a0d\u540e\u518d\u8bd5")})})()}]).controller("PortalCategoryCtrl",
["$scope","$stateParams",function(a,b){""===b.id?(a.showCategory=!0,a.showQuickIcons=!0,a.rootCategory=!0):(console.log(b.id+" category"),a.categoryId=b.id)}]);
angular.module("category.service",["ngResource"]).constant("categoryConstants",{icon:{0:"ion-ios-list",1:"ion-ios-list",2:"ion-ios-paper",3:"ion-ios-speedometer"}}).service("CategoryAPI",["$resource","urlConfig",function(a,b){var c,e=a(b.REST_END_POINT+"/api/public/category",null,{query:{method:"GET",isArray:!1,timeout:1E4}},null);return{findAll:function(a,b){void 0===c?e.query({},function(b){c=b;a(c)},b):a(c)}}}]);angular.module("promotion",["account.service","agreement.service","promotion.service","wechat.service"]).controller("PromotionCtrl",["$scope","$rootScope","PromotionAPI","promotionConstants","promotionBackgroundColors","$ionicLoading","$ionicHistory","$state","Wechat",function(a,b,c,e,d,k,l,g,h){var f=function(f,h,g){k.show({template:"<ion-spinner></ion-spinner>",delay:100});c.get(f,function(b){a.promotion=b;a.backStyle=void 0!==d[a.promotion.fromPicId]?{"background-color":d[a.promotion.fromPicId]}:
{"background-color":"#FFF"};a.promotion.fromPicUrl=e.PIC_ROOT+a.promotion.fromPicId+"_from.jpg";p(a.promotion.id,h,g)},function(a){k.hide();alert("\u672a\u627e\u5230\u4f18\u60e0\u6d3b\u52a8");b.navToIndex()})},p=function(f,d,e){c.newBatch(f,d,e,function(b){k.hide();a.batch=b.batch;a.gifts=b.gifts;void 0!==a.gifts&&void 0!==a.gifts[0]&&alert("\u611f\u8c22\u53c2\u4e0e\u6d3b\u52a8\uff0c\u5956\u52b1\u5df2\u653e\u5165\u8d26\u6237");h.hookShareTimelineOnly(!0,c.convertBatchToContent(a.batch),function(){n(a.promotion.id,
a.batch.id)},function(a){alert(a)})},function(a){k.hide();alert(a);b.navToIndex()})},n=function(f,d){k.show({template:"<ion-spinner></ion-spinner>",delay:100});c.shareAction(f,d,function(f){k.hide();a.gifts=f.gifts;void 0===a.gifts||void 0===a.gifts[0]?alert("\u6210\u529f\u5206\u4eab"):alert("\u6210\u529f\u5206\u4eab\uff0c\u5956\u52b1\u5df2\u653e\u5165\u8d26\u6237");b.navToIndex()},function(a){k.hide();alert(a);b.navToIndex()})};f(g.params.id,g.params.sourceType,g.params.sourceDetail);a.shareSuccess=
function(){n(a.promotion.id,a.batch.id)};b.$on("$stateChangeStart",function(a,b,c,d,e){"app.promotion"===b.name&&f(c.id,c.sourceType,c.sourceDetail)});b.$on("event:auth-loginCancelled",function(){a.promotion=void 0});b.$on("event:auth-logout-complete",function(){a.promotion=void 0})}]);
angular.module("promotion.service",["ngResource","wechat"]).service("PromotionAPI",["$resource","urlConfig","promotionConstants","wechatConstants",function(a,b,c,e){var d=a(b.REST_END_POINT+"/api/marketing/promotion/:id",{id:"@id",entryPoint:"@entryPoint"},{getPaySuc:{method:"GET",isArray:!0,params:{entryPoint:c.ENTRY_POINT_PAY_SUCCESS}},get:{method:"GET",isArray:!1},action:{method:"POST",isArray:!1}},null),k=a(b.REST_END_POINT+"/api/marketing/promotion/:id/batch/:batchId",{id:"@id",batchId:"@batchId",
sourceType:"@sourceType",sourceDetail:"@sourceDetail",action:"@action"},{"new":{method:"POST",isArray:!1},action:{method:"POST",isArray:!1}}),l=a(b.REST_END_POINT+"/api/public/marketing/promotion/:batchId/",{batchId:"@batchId"}),g,h={};return{getPaySucPromotion:function(a,b){void 0===g?d.getPaySuc({},function(b){g=b[0];a(g)},function(a){b(a)}):a(g)},getPublicBatch:function(a,b,c){l.get({batchId:a},function(a){b(a)},function(a){c(a)})},get:function(a,b,c){void 0===h[a]?d.get({id:a},function(f){h[a]=
f;b(h[a])},function(a){c(a)}):b(h[a])},newBatch:function(a,b,c,d,e){k["new"]({id:a,sourceType:b,sourceDetail:c},function(a){console.log("batch created received");d(a)},function(a){console.log("failed because: "+a.data.error);e(a.data.error)})},shareAction:function(a,b,c,d){k.action({id:a,batchId:b,action:"FROM_SHARE"},function(a){console.log("share success");c(a)},function(a){console.log("failed because: "+a.data.error);d(a.data.error)})},getShareUrl:function(a){return b.REST_END_POINT+e.PROMOTION_SHARE_ROOT+
a},convertBatchToContent:function(a){var b={};b.name=a.toTitle;b.description=a.toDescription;b.url=this.getShareUrl(a.id);return b}}}]);angular.module("proposal",["proposal.service","account.service","promotion.service","coupon.service","wechat"]).controller("ProposalCtrl",["$rootScope","$scope","AgreementAPI","AccountAPI","CouponAPI","Proposal","PromotionAPI","$state","$stateParams","$ionicHistory","$ionicLoading","agreementConstants","promotionConstants","eventNames","Wechat","$ionicActionSheet","$ionicModal",function(a,b,c,e,d,k,l,g,h,f,p,n,v,u,t,x,r){var q={name:"\u4e0d\u4f7f\u7528"},y=function(){p.show({template:"<ion-spinner></ion-spinner>",
delay:100});e.getAccount(function(a){b.account=a;b.canPayCredit=-1<b.agreement.payMethods.indexOf(n.PAY_METHOD_CREDIT);b.canPayAlipay=!1;b.canPayWxpay=-1<b.agreement.payMethods.indexOf(n.PAY_METHOD_H5);b.canPayCoupon=-1<b.agreement.payMethods.indexOf(n.PAY_METHOD_COUPON);b.canPaySimulate=-1<b.agreement.payMethods.indexOf(n.PAY_METHOD_SIMULATE);b.canShowInvoice=b.canPayWxpay;b.isUserAgreementUseWxpay=b.canPayWxpay&&b.agreement.type===n.AGREEMENT_TYPE_USER;b.account.invoiceSetting&&(b.proposal.companyTaxId=
b.account.invoiceSetting.companyTaxId);d.findAllByAgreementId(b.agreement.id,function(a){b.optionalCoupons=a;b.optionalCoupons.unshift(q);b.proposal.optionalCoupon=1!==b.optionalCoupons.length?b.optionalCoupons[1]:b.optionalCoupons[0];b.calcfee(b.proposal);p.hide();g.go("^.pay")},function(a){p.hide();alert("\u670d\u52a1\u5668\u672a\u54cd\u5e94\uff0c\u83b7\u53d6\u652f\u4ed8\u4fe1\u606f\u5931\u8d25\uff0c\u8bf7\u7a0d\u540e\u518d\u8bd5")})},function(a){console.log("error getting account, by: "+a);p.hide();
alert("\u670d\u52a1\u5668\u672a\u54cd\u5e94\uff0c\u83b7\u53d6\u652f\u4ed8\u4fe1\u606f\u5931\u8d25\uff0c\u8bf7\u7a0d\u540e\u518d\u8bd5")})},B=function(c){b.success=c.success;b.orderId=c.orderId;b.proposalNo=c.proposalNo;g.params.agreementId!==n.AGREEMENT_ID_SIMULATE?l.getPaySucPromotion(function(c){p.hide();b.promotion=c;a.navToRoot("^.result")},function(b){console.log("No Pay Success Promotion found");p.hide();a.navToRoot("^.result")}):(console.log("No showing pay Success Promotion"),p.hide(),a.navToRoot("^.result"))},
m=function(){p.show({template:"<ion-spinner></ion-spinner>",delay:100});k.preOrder(b.proposal,function(a){console.log("pre order succeed");z(a)},function(a){p.hide();console.log("pre order error, by: ",a.data.error);alert(a.data.error)})},z=function(a){b.proposal.orderId=a.orderId;a.payProvider===n.PAY_PROVIDER_WX&&a.paymentResponse?t.doWxPay(a.paymentResponse,function(){w(a)},function(){p.hide();alert("\u652f\u4ed8\u5931\u8d25")}):w(a)},w=function(c){c.payProvider===n.PAY_PROVIDER_WX&&c.paymentResponse?
(b.error=void 0,console.log("save transaction successfull"),a.$broadcast(u.PROPOSAL_SUCCESS,c),B(c)):k.finishOrder(b.proposal.orderId,function(c){b.error=void 0;console.log("save transaction successfull");a.$broadcast(u.PROPOSAL_SUCCESS,c);B(c)},function(c){p.hide();console.log("save transaction failed, error:"+c.data.error);b.error=c.data.error;a.navToRoot("^.result")})},A=function(a){a=k.calcFeeDistance(a,function(a){success(a)},function(a){alert("\u83b7\u53d6\u91cc\u7a0b\u6570\u636e\u5931\u8d25\u8bf7\u7a0d\u540e\u518d\u8bd5\u3002")})};
console.log("reloading");(function(f,d){p.show({template:"<ion-spinner></ion-spinner>",delay:100});console.log("Initializing proposal");c.getProposal(f,function(a){b.agreement=a;b.canSetRoutePreset=b.agreement.routePreset===n.AGREEMENT_ROUTE_PRESET_BOTH;b.canSetRouteNoPreset=b.agreement.routePreset===n.AGREEMENT_ROUTE_PRESET_NONE;b.canSetRouteStartEndEqual=b.agreement.routePreset===n.AGREEMENT_ROUTE_PRESET_EQUAL;b.canSetPublicRouteStartEndDetail=b.agreement.routePreset===n.AGREEMENT_ROUTE_PRESET_DISTANCE&&
b.agreement.type!==n.AGREEMENT_TYPE_USER;b.canSetPrivateRouteStartEndDetail=b.agreement.routePreset===n.AGREEMENT_ROUTE_PRESET_DISTANCE&&b.agreement.type===n.AGREEMENT_TYPE_USER;b.proposal=k.init(b.agreement);void 0!==d&&(b.proposal.payCouponId=d);p.hide()},function(b){console.log("error intializing proposal, by: "+b);p.hide();alert("\u670d\u52a1\u5668\u672a\u54cd\u5e94\uff0c\u83b7\u53d6\u534f\u8bae\u5931\u8d25\uff0c\u8bf7\u7a0d\u540e\u518d\u8bd5");a.navToIndex()})})(g.params.agreementId,g.params.payCouponId);
b.calcfee=function(a){k.calcfee(a)};b.showGoods=function(){for(var a=[],c=0;c<b.agreement.goods.length;c++)a[c]={text:"<div>"+b.agreement.goods[c].name+"  \u52a0\u8d39\u7387:"+b.agreement.goods[c].baseFee+"%</div><p>"+b.agreement.goods[c].remark+"</p>"};x.show({buttons:a,buttonClicked:function(a){b.proposal.goods=b.agreement.goods[a];b.calcfee(b.proposal);return!0}})};b.canShowCurFee=function(){return g.params.agreementId!==n.AGREEMENT_ID_SIGNUP_COUPON&&g.params.agreementId!==n.AGREEMENT_ID_COUPON_TRANSACTION_25&&
g.params.agreementId!==n.AGREEMENT_ID_AUTO_PAYGO&&g.params.agreementId!==n.AGREEMENT_ID_PAYGO_LOCAL_ZH&&g.params.agreementId!==n.AGREEMENT_ID_PAYGO_JB&&g.params.agreementId!==n.AGREEMENT_ID_PAYGO_JB_LIMIT_PRICE&&g.params.agreementId!==n.AGREEMENT_ID_PAYGO_LOCAL_JB_LITE&&g.params.agreementId!==n.AGREEMENT_ID_PAYGO_JB_LITE&&g.params.agreementId!==n.AGREEMENT_ID_PAYGO_ZR&&g.params.agreementId!==n.AGREEMENT_ID_PAYGO_ZH_COLD_CHAIN&&g.params.agreementId!==n.AGREEMENT_ID_PAYGO_ZH_LIMIT_PRICE};b.canShowSubTotal=
function(){return g.params.agreementId!==n.AGREEMENT_ID_SIGNUP_COUPON&&g.params.agreementId!==n.AGREEMENT_ID_COUPON_TRANSACTION_25};b.canShowCoupon=function(){return g.params.agreementId!==n.AGREEMENT_ID_SIGNUP_COUPON&&g.params.agreementId!==n.AGREEMENT_ID_COUPON_TRANSACTION_25&&g.params.agreementId!==n.AGREEMENT_ID_PAYGO_JB_LIMIT_PRICE&&g.params.agreementId!==n.AGREEMENT_ID_PAYGO_ZH_LIMIT_PRICE};b.couponDesc=function(a){return void 0!==a.expireAt?a.name+" "+a.expireAt+"\u5230\u671f":a.name};b.canShowTaxId=
function(){return b.proposal.invoiceType!==n.INVOICE_TYPE_NORMAL};b.confirm=function(){b.agreement.type!==n.AGREEMENT_TYPE_USER?(console.log("checking dxt public agreement"),r.fromTemplateUrl("templates/app/public.doc.proposal.html",{scope:b}).then(function(b){a.docProposalModal=b;a.docProposalModal.show();a.docProposalIscroll=new IScroll("#proposal-doc .i-scroll .wrapper",{})})):(console.log("confirmed, going to pay"),y())};b.acceptDoc=function(){a.docProposalModal.hide();a.docProposalIscroll.destroy();
a.docProposalModal.remove();console.log("confirmed, going to pay");y()};b.rejectDoc=function(){a.docProposalModal.hide();a.docProposalIscroll.destroy();a.docProposalModal.remove()};b.creditPay=function(){b.proposal.payProvider=n.PAY_PROVIDER_CREDIT;m()};b.aliPay=function(){b.proposal.payProvider=n.PAY_PROVIDER_ALI;alert("\u7531\u4e8e\u5fae\u4fe1\u5e73\u53f0\u5c4f\u853d\u652f\u4ed8\u5b9d\uff0c\u6682\u4e0d\u652f\u6301\u652f\u4ed8\u5b9d\u4ed8\u6b3e")};b.wxPay=function(){void 0===t.getOpenId()?alert("\u672a\u68c0\u6d4b\u5230\u5fae\u4fe1\u652f\u4ed8\u73af\u5883\uff0c\u8bf7\u5728\u5fae\u4fe1\u516c\u4f17\u53f7\u4e2d\u64cd\u4f5c"):
(b.proposal.buyerId=t.getOpenId(),b.proposal.payProvider=n.PAY_PROVIDER_WX,m())};b.couponPay=function(){b.proposal.payProvider=n.PAY_PROVIDER_COUPON;m()};b.simulatePay=function(){b.proposal.payProvider=n.PAY_PROVIDER_SIMULATE;m()};b.navToPromotion=function(){f.nextViewOptions({historyRoot:!0});g.go("app.promotion",{id:b.promotion.id,sourceType:v.BATCH_SOURCE_TYPE_TRANSACTION,sourceDetail:b.proposal.orderId})};b.changeStartProvince=function(a){a.routeStart=a.routeStartProvince.politicalCitys[0];A(a)};
b.changeEndProvince=function(a){a.routeEnd=a.routeEndProvince.politicalCitys[0];A(a)};b.changeStartCity=function(a){A(a)};b.changeEndCity=function(a){A(a)};a.$on("event:auth-logout-complete",function(){b.agreement=void 0;b.proposal=void 0;b.optionalCoupons=void 0;b.error=void 0})}]);
angular.module("proposal.service",["ngResource"]).service("Proposal",["$resource","urlConfig","agreementConstants","couponConstants",function(a,b,c,e){var d=a(b.REST_END_POINT+"/api/order/transaction"),k=a(b.REST_END_POINT+"/api/order/:id/finish",{id:"@id"},{finish:{method:"POST",isArray:!1,timeout:6E4}}),l=a(b.REST_END_POINT+"/api/public/distance",{routeStart:"@routeStart",routeEnd:"@routeEnd"},{get:{method:"GET",isArray:!1,timeout:6E4}}),g=function(a){var b=a.agreement.routeAdjust,f=1;a.agreement.canChooseTheft&&
a.theftInsure&&(f=a.agreement.productDqRate);var d=a.goods.baseFee/100+1,h=a.route.baseRate/100,g=a.agreement.discountRate/100;-1<a.agreement.payMethods.indexOf(c.PAY_METHOD_H5)&&a.agreement.type===c.AGREEMENT_TYPE_USER&&a.theftInsure?a.listPrice=Math.round(a.coverage.basefee*d*h*b)+50:a.listPrice=Math.round(a.coverage.basefee*d*h*b*f);a.feeNoCoupon=Math.round(a.listPrice*g);void 0!==a.optionalCoupon&&void 0!==a.optionalCoupon.fullfillType?a.optionalCoupon.fullfillType===e.COUPON_TYPE_PRODUCT_VOUCHER?
(a.fee=a.feeNoCoupon-a.optionalCoupon.fullfillConfig,a.optionalCouponId=a.optionalCoupon.id):a.optionalCoupon.fullfillType===e.COUPON_TYPE_LIMIT_PRICE?(a.fee=a.optionalCoupon.fullfillConfig,a.optionalCouponId=a.optionalCoupon.id):a.optionalCoupon.fullfillType===e.COUPON_TYPE_DISCOUNT_VOUCHER&&(a.fee=Math.round(a.optionalCoupon.fullfillConfig/100*a.feeNoCoupon),a.optionalCouponId=a.optionalCoupon.id):(a.fee=a.feeNoCoupon,a.optionalCouponId=void 0)},h=function(a){a.agreement.routePreset===c.AGREEMENT_ROUTE_PRESET_EQUAL&&
(a.routeEnd=a.routeStart);if(a.agreement.routePreset===c.AGREEMENT_ROUTE_PRESET_EQUAL||a.agreement.routePreset===c.AGREEMENT_ROUTE_PRESET_NONE)a.route.name=a.routeStart.name+"\u2014"+a.routeEnd.name,a.route.baseRate=a.routeStart.defaultRouteFeeRate>a.routeEnd.defaultRouteFeeRate?a.routeStart.defaultRouteFeeRate:a.routeEnd.defaultRouteFeeRate;a.agreement.routePreset===c.AGREEMENT_ROUTE_PRESET_DISTANCE&&(a.route.name=a.routeStart.name+"\u2014"+a.routeEnd.name,a.route.baseRate=100)};return{init:function(a){var b=
{};b.agreement=a;b.isZh=a.type===c.AGREEMENT_ID_SIGNUP_COUPON||a.type===c.AGREEMENT_ID_SIMULATE||a.type===c.AGREEMENT_ID_AUTO_PAYGO||a.type===c.AGREEMENT_ID_PAYGO_LOCAL_ZH||a.type===c.AGREEMENT_ID_PAYGO_ZH_COLD_CHAIN||a.type===c.AGREEMENT_ID_PAYGO_ZH_LIMIT_PRICE;b.isZR=a.type===c.AGREEMENT_ID_PAYGO_ZR;b.goods=a.goods[0];a.routePreset===c.AGREEMENT_ROUTE_PRESET_BOTH?b.route=a.routes[0]:a.routePreset===c.AGREEMENT_ROUTE_PRESET_DISTANCE?(a.type===c.AGREEMENT_ID_PAYGO_ZR&&(b.routeStartProvince=a.divisions[0],
b.routeEndProvince=a.divisions[0],b.routeStartCity=b.routeStartProvince.politicalCitys[0],b.routeEndCity=b.routeEndProvince.politicalCitys[0],b.routeStart=b.routeStartProvince.politicalCitys[0],b.routeEnd=b.routeEndProvince.politicalCitys[0],b.route={}),a.type===c.AGREEMENT_TYPE_USER&&(a.invoiceTypes=c.INVOICE_TYPES,b.routeStartProvince=a.divisions[0],b.routeEndProvince=a.divisions[0],b.routeStartCity=b.routeStartProvince.politicalCitys[0],b.routeEndCity=b.routeEndProvince.politicalCitys[0],b.routeStart=
b.routeStartProvince.politicalCitys[0],b.routeEnd=b.routeEndProvince.politicalCitys[0],b.route={})):(b.routeStart=a.divisions[0],b.routeEnd=a.divisions[0],b.route={});b.coverage=a.coverages[0];a.canChooseTheft&&(b.theftInsure=!1);b.invoiceType=c.INVOICE_TYPE_NORMAL;b.agreement.routePreset===c.AGREEMENT_ROUTE_PRESET_DISTANCE?(b.routeDistanceFees=a.routeDistanceFees,this.calcFeeDistance(b,null,null)):this.calcfee(b);return b},calcfee:function(a){h(a);g(a)},save:function(a,b,c){a=new d(a);a.$save({},
b,c);return a},preOrder:function(a,b,c){(new d(a)).$save({},function(a){b(a)},function(a){c(a)})},finishOrder:function(a,b,c){k.finish({id:a},function(a){b(a)},function(a){c(a)})},calcFeeDistance:function(a,b,d){a.agreement.routePreset===c.AGREEMENT_ROUTE_PRESET_DISTANCE&&(new l).$save({routeStart:a.routeStart.name,routeEnd:a.routeEnd.name},function(b){a.routeDistance=b.distance;b=[];for(var c=0,d=0;d<a.agreement.coverages.length;d++)for(var f=a.agreement.coverages[d],e=f.value,q=0;q<a.routeDistanceFees.length;q++){var y=
a.routeDistanceFees[q];e==y.value&&a.routeDistance>y.distanceStart&&a.routeDistance<=y.distanceEnd&&(f.basefee=y.fee,b[c++]=f)}a.distanceCoverages=b;a.coverage=b[0];h(a);g(a)},function(a){d(a)})},doWxPay:function(a,b,c){function d(){WeixinJSBridge.invoke("getBrandWCPayRequest",{appId:a.appId,timeStamp:a.timeStamp,nonceStr:a.nonceStr,"package":a.packagePrepayId,signType:a.signType,paySign:a.paySign},function(a){"get_brand_wcpay_request:ok"==a.err_msg?b():(alert(a.err_msg),c())})}"undefined"==typeof WeixinJSBridge?
document.addEventListener?document.addEventListener("WeixinJSBridgeReady",d,!1):document.attachEvent&&(document.attachEvent("WeixinJSBridgeReady",d),document.attachEvent("onWeixinJSBridgeReady",d)):d()}}}]);angular.module("redirect",["account.service","wechat"]).controller("redirectCtrl",["$stateParams","$state","$ionicHistory","agreementConstants","CommonAuthenticationService","Wechat",function(a,b,c,e,d,k){var l=!!k.isQQBrowser();void 0!==a.providerUserId&&"null"!==a.providerUserId&&k.setOpenId(a.providerUserId);void 0!=a.xAuthToken&&(d.setXAuthToken(a.xAuthToken),d.setMobile(a.mobile));c.nextViewOptions({historyRoot:!0});"agreements"===a.state?b.go("app.agreement.list",{toPropose:"0",paygo:"0",user:"1"}):
"agreementsToPropose"===a.state?b.go("app.agreement.list",{toPropose:"1",paygo:"0",user:"1"}):"coupons"===a.state?!0===l?b.go("app.coupon.listQQx5"):b.go("app.coupon.list"):"account"===a.state?b.go("app.account.show"):"transactions"===a.state?!0===l?b.go("app.transaction.listQQx5"):b.go("app.transaction.list"):"simulate"===a.state?b.go("app.proposal.start",{agreementId:e.AGREEMENT_ID_SIMULATE}):"dxk"===a.state?b.go("app.account.salesOrComm"):b.go("app.portal.category")}]);angular.module("regression",["wechat"]).controller("PublicPromotionCtrl",["$stateParams","$state","urlConfig","wechatConstants",function(a,b,c,e){window.location.replace(c.REST_END_POINT+e.PROMOTION_SHARE_ROOT+a.id)}]).controller("PublicSurveyCtrl",["$stateParams","$state","urlConfig","wechatConstants",function(a,b,c,e){window.location.replace(c.REST_END_POINT+e.SURVEY_SHARE_ROOT+a.id)}]);angular.module("transaction",["transaction.service","wechat","ng-iscroll","account.service"]).controller("TransactionCtrl",["$scope","$state","$ionicHistory","TransAPI","$rootScope","$ionicLoading","eventNames","agreementConstants",function(a,b,c,e,d,k,l,g){var h=function(){a.transactions=[];a.refresh(function(){k.show({template:"<ion-spinner></ion-spinner>",delay:100})},function(){k.hide()},function(){d.navToIndex()})},f=function(){a.transactions=void 0;a.pageNumber=void 0;a.hasTransaction=void 0;
a.initFinish=void 0};a.refresh=function(b,c,d){b();e.refresh(function(b){a.transactions=b;a.pageNumber=0;a.hasTransaction=!(void 0===a.transactions||0===a.transactions.length);a.initFinish=!0;c()},function(b){a.initFinish=!0;console.log(b);alert("\u5237\u65b0\u5931\u8d25\uff0c\u8bf7\u7a0d\u540e\u518d\u8bd5");c();d()})};a.loadNext=function(b){a.canLoadNext()&&e.getPage(a.pageNumber+1,function(c){if(void 0!==c&&0!==c.length){for(var d=0;d<c.length;d++)a.transactions.push(c[d]);a.pageNumber++}b()},function(a){alert(a);
b()})};a.canLoadNext=function(){return e.hasMoreToLoad()};a.isSimulate=function(a){return a.productName===g.PRODUCT_NAME_SIMULATE};h();d.$on("$stateChangeStart",function(a,b,c,d,f){"app.transaction"!==b.name&&"app.transaction.list"!==b.name&&"app.transaction.detail"!==b.name&&"app.transaction.listQQx5"!==b.name||"app.transaction.detail"===d.name||"app.transaction.list"===d.name||"app.transaction.listQQx5"===d.name||h()});d.$on("event:auth-loginCancelled",function(){f()});d.$on("event:auth-logout-complete",
function(){f()});d.$on(l.PROPOSAL_SUCCESS,function(a,b){e.clean()})}]).controller("TransactionListCtrl",["$scope","$timeout",function(a,b){a.loadMore=function(){console.log("load more");a.$parent.loadNext(function(){a.$broadcast("scroll.infiniteScrollComplete")})};a.refresh=function(){a.$parent.refresh(function(){},function(){b(function(){a.$broadcast("scroll.refreshComplete")},500)},function(){})};a.canLoadMore=function(){return a.$parent.canLoadNext()}}]).controller("TransactionListQQx5Ctrl",["$scope",
"$rootScope",function(a,b){a.hasNext=function(){return!!(a.$parent.pageNumber>a.page||a.$parent.canLoadNext())};a.hasPrev=function(){return 0<a.page};a.nextPage=function(){a.$parent.pageNumber>a.page?a.page++:a.$parent.canLoadNext()?a.$parent.loadNext(function(){a.$parent.pageNumber>a.page&&a.page++}):alert("\u5df2\u7ecf\u662f\u6700\u540e\u4e00\u9875")};a.preOrRefreshPage=function(){1<a.page?a.page--:1!==a.page&&0!==a.page||a.refresh()};a.refresh=function(){a.$parent.refresh(function(){},function(){a.page=
0},function(){})};a.page=0;b.$on("$stateChangeStart",function(b,e,d,k,l){"app.transaction"!==e.name&&"app.transaction.list"!==e.name&&"app.transaction.detail"!==e.name&&"app.transaction.listQQx5"!==e.name||"app.transaction.detail"===k.name||"app.transaction.list"===k.name||"app.transaction.listQQx5"===k.name||(a.page=0)})}]).controller("TransactionDetailCtrl",["$scope","$stateParams","TransAPI","AccountAPI","$ionicPopup","$ionicLoading",function(a,b,c,e,d,k){a.transaction=c.get(b.id);(function(){e.getAccount(function(b){a.account=
b},function(a){console.log(a)})})();var l=function(a,b,c){d.alert({title:a,template:b,okText:c})};a.NoEPolicy=function(a){l("\u4ea4\u6613\u672a\u5b8c\u6210","<p>\u5f53\u524d\u4ea4\u6613\u672a\u5b8c\u6210\uff0c\u65e0\u6cd5\u83b7\u53d6\u7535\u5b50\u4fdd\u5355</p>","\u786e\u8ba4")};a.sendEmail=function(b){a.data={};a.data.email=a.account.email;d.show({template:'<form name="ePolicyForm" ><input name="email" type="email" ng-model="data.email" required/> <p class="assertive" ng-show="ePolicyForm.email.$invalid">\u90ae\u7bb1\u5730\u5740\u683c\u5f0f\u9519\u8bef</p>  </form>',
title:"\u53d1\u9001\u7535\u5b50\u4fdd\u5355",subTitle:"\u7535\u5b50\u4fdd\u5355\u5c06\u53d1\u9001\u5230\u4e0b\u65b9\u7535\u5b50\u90ae\u7bb1\u4e2d",scope:a,buttons:[{text:"\u53d6\u6d88"},{text:"<b>\u53d1\u9001</b>",type:"button-positive",onTap:function(d){a.data.email?(k.show({template:"<ion-spinner></ion-spinner>",delay:100}),a.account.email=a.data.email,c.sendEmail(b,a.data.email,function(a){k.hide();l("\u7535\u5b50\u4fdd\u5355\u53d1\u9001\u6210\u529f","<p>\u7535\u5b50\u4fdd\u5355\u5df2\u7ecf\u6210\u529f\u53d1\u9001\u5230\u60a8\u7684\u7535\u5b50\u90ae\u7bb1\uff01</p>",
"\u786e\u8ba4")},function(b){k.hide();a.initFinish=!0;console.log(b);l("\u7535\u5b50\u4fdd\u5355\u53d1\u9001\u5931\u8d25","<p>"+b+"</p>","\u786e\u8ba4");after();failOver()})):d.preventDefault()}}]})}}]);
angular.module("transaction.service",["ngResource"]).service("TransAPI",["$resource","urlConfig",function(a,b){var c=a(b.REST_END_POINT+"/api/transaction",{page:"@page"},{query:{method:"GET",isArray:!1,timeout:1E4}},null),e=a(b.REST_END_POINT+"/api/transaction/:id/email",{id:"@id",email:"@email"},{send:{method:"POST",isArray:!1,timeout:1E4}},null),d=function(a,b,d){c.query({page:a},function(a){for(var c=[],d=0;d<a.list.length;d++)g[a.list[d].id]=a.list[d],c.push(a.list[d]);console.log("transaction page init success");
b(c)},function(a){d(a.data.error)})},k=function(a,b,c,d){e.send({id:a,email:b},function(a){console.log("transaction page init success");c(a)},function(a){d(a.data.error)})},l=function(a,b){g={};h=0;c.query({page:0},function(b){h=b.metaData.total;for(var c=[],d=0;d<b.list.length;d++)g[b.list[d].id]=b.list[d],c.push(b.list[d]);console.log("transaction metaData init success");a(c)},function(a){b(a.data.error)})},g={},h=0;return{getPage:function(a,b,c){d(a,b,c)},refresh:function(a,b){l(a,b)},get:function(a){return g[a]},
sendEmail:function(a,b,c,d){return k(a,b,c,d)},hasMoreToLoad:function(){return!!(void 0!==g&&0!==Object.keys(g).length&&Object.keys(g).length<h)},clean:function(){g=void 0;h=0}}}]);angular.module("common-authentication",["wechat"]).service("CommonAuthenticationService",["$resource","$rootScope","$http","urlConfig","Wechat",function(a,b,c,e,d){var k=a(e.REST_END_POINT+"/sso/userCanRegister/:id",{id:"@id"},{check:{method:"GET",isArray:!1}},null),l=function(a){c.defaults.headers.common["x-auth-token"]=a},g=function(a,b,g,k,u){var f=d.getOpenId();void 0===f&&(f="");void 0==g&&(g="");c.post(e.REST_END_POINT+"/auth","mobile="+a+"&validationCode="+b+"&invitationCode="+g+"&providerUserId="+
f,{ignoreAuthModule:!0,headers:{"Content-Type":"application/x-www-form-urlencoded"}}).success(function(a,b,c,d){l(a.xAuthToken);h=a.mobile;k(a)}).error(function(a,b,c,d){u(a.error)})},h;return{isLoggedIn:function(){return void 0!==c.defaults.headers.common["x-auth-token"]},exist:function(a,b,c){k.check({id:a},b,c)},auth:function(a,b,c,d,e){g(a,b,c,d,e)},quit:function(a){c.post(e.REST_END_POINT+"/sso/quit",{},{ignoreAuthModule:!0})["finally"](function(){delete c.defaults.headers.common["x-auth-token"];
h=void 0;a()})},setXAuthToken:function(a){l(a)},getXAuthToken:function(){return c.defaults.headers.common["x-auth-token"]},setMobile:function(a){h=a},getMobile:function(){return h},clean:function(){h=c.defaults.headers.common["x-auth-token"]=void 0}}}]);angular.module("ng-iscroll",[]).service("iScrollAccessor",function(){var a;return{set:function(b){a=b},get:function(){return a}}}).directive("iScroll",["iScrollAccessor",function(a){return{restrict:"A",link:function(b,c){var e=new IScroll(c[0],{click:!0,bounce:!0,preventDefaultException:{tagName:/^(INPUT|TEXTAREA|BUTTON|SELECT)$/,isContentEditable:/^true$/}});a.set(e);c.on("$destroy",function(){e.destroy();e=null})}}}]).directive("iScrollRefresh",["iScrollAccessor","$timeout",function(a,b){return{restrict:"A",
link:function(c){c.$last&&b(function(){a.get().refresh()})}}}]);var qrcode=function(){function a(b,c){if("undefined"==typeof b.length)throw Error(b.length+"/"+c);var e=function(){for(var a=0;a<b.length&&0==b[a];)a+=1;for(var d=Array(b.length-a+c),f=0;f<b.length-a;f+=1)d[f]=b[f+a];return d}(),f={getAt:function(a){return e[a]},getLength:function(){return e.length},multiply:function(b){for(var c=Array(f.getLength()+b.getLength()-1),e=0;e<f.getLength();e+=1)for(var q=0;q<b.getLength();q+=1)c[e+q]^=d.gexp(d.glog(f.getAt(e))+d.glog(b.getAt(q)));return a(c,0)},mod:function(b){if(0>
f.getLength()-b.getLength())return f;for(var c=d.glog(f.getAt(0))-d.glog(b.getAt(0)),e=Array(f.getLength()),q=0;q<f.getLength();q+=1)e[q]=f.getAt(q);for(q=0;q<b.getLength();q+=1)e[q]^=d.gexp(d.glog(b.getAt(q))+c);return a(e,0).mod(b)}};return f}var b=function(b,d){var f=c[d],h=null,q=0,y=null,B=[],m={},u=function(c,d){for(var g=q=4*b+17,m=Array(g),r=0;r<g;r+=1){m[r]=Array(g);for(var x=0;x<g;x+=1)m[r][x]=null}h=m;n(0,0);n(q-7,0);n(0,q-7);g=e.getPatternPosition(b);for(m=0;m<g.length;m+=1)for(r=0;r<
g.length;r+=1){var x=g[m],u=g[r];if(null==h[x][u])for(var z=-2;2>=z;z+=1)for(var t=-2;2>=t;t+=1)h[x+z][u+t]=-2==z||2==z||-2==t||2==t||0==z&&0==t?!0:!1}for(g=8;g<q-8;g+=1)null==h[g][6]&&(h[g][6]=0==g%2);for(g=8;g<q-8;g+=1)null==h[6][g]&&(h[6][g]=0==g%2);g=e.getBCHTypeInfo(f<<3|d);for(m=0;15>m;m+=1)r=!c&&1==(g>>m&1),6>m?h[m][8]=r:8>m?h[m+1][8]=r:h[q-15+m][8]=r;for(m=0;15>m;m+=1)r=!c&&1==(g>>m&1),8>m?h[8][q-m-1]=r:9>m?h[8][15-m-1+1]=r:h[8][15-m-1]=r;h[q-8][8]=!c;if(7<=b){g=e.getBCHTypeNumber(b);for(m=
0;18>m;m+=1)r=!c&&1==(g>>m&1),h[Math.floor(m/3)][m%3+q-8-3]=r;for(m=0;18>m;m+=1)r=!c&&1==(g>>m&1),h[m%3+q-8-3][Math.floor(m/3)]=r}if(null==y){g=k.getRSBlocks(b,f);m=l();for(r=0;r<B.length;r+=1)x=B[r],m.put(x.getMode(),4),m.put(x.getLength(),e.getLengthInBits(x.getMode(),b)),x.write(m);for(r=x=0;r<g.length;r+=1)x+=g[r].dataCount;if(m.getLengthInBits()>8*x)throw Error("code length overflow. ("+m.getLengthInBits()+">"+8*x+")");for(m.getLengthInBits()+4<=8*x&&m.put(0,4);0!=m.getLengthInBits()%8;)m.putBit(!1);
for(;!(m.getLengthInBits()>=8*x);){m.put(236,8);if(m.getLengthInBits()>=8*x)break;m.put(17,8)}for(var A=0,x=r=0,u=Array(g.length),z=Array(g.length),t=0;t<g.length;t+=1){var p=g[t].dataCount,C=g[t].totalCount-p,r=Math.max(r,p),x=Math.max(x,C);u[t]=Array(p);for(var w=0;w<u[t].length;w+=1)u[t][w]=255&m.getBuffer()[w+A];A+=p;w=e.getErrorCorrectPolynomial(C);p=a(u[t],w.getLength()-1).mod(w);z[t]=Array(w.getLength()-1);for(w=0;w<z[t].length;w+=1)C=w+p.getLength()-z[t].length,z[t][w]=0<=C?p.getAt(C):0}for(w=
m=0;w<g.length;w+=1)m+=g[w].totalCount;m=Array(m);for(w=A=0;w<r;w+=1)for(t=0;t<g.length;t+=1)w<u[t].length&&(m[A]=u[t][w],A+=1);for(w=0;w<x;w+=1)for(t=0;t<g.length;t+=1)w<z[t].length&&(m[A]=z[t][w],A+=1);y=m}g=y;m=-1;r=q-1;x=7;u=0;z=e.getMaskFunction(d);for(t=q-1;0<t;t-=2)for(6==t&&--t;;){for(w=0;2>w;w+=1)null==h[r][t-w]&&(A=!1,u<g.length&&(A=1==(g[u]>>>x&1)),z(r,t-w)&&(A=!A),h[r][t-w]=A,--x,-1==x&&(u+=1,x=7));r+=m;if(0>r||q<=r){r-=m;m=-m;break}}},n=function(a,b){for(var c=-1;7>=c;c+=1)if(!(-1>=a+
c||q<=a+c))for(var d=-1;7>=d;d+=1)-1>=b+d||q<=b+d||(h[a+c][b+d]=0<=c&&6>=c&&(0==d||6==d)||0<=d&&6>=d&&(0==c||6==c)||2<=c&&4>=c&&2<=d&&4>=d?!0:!1)};m.addData=function(a){a=g(a);B.push(a);y=null};m.isDark=function(a,b){if(0>a||q<=a||0>b||q<=b)throw Error(a+","+b);return h[a][b]};m.getModuleCount=function(){return q};m.make=function(){for(var a=0,b=0,c=0;8>c;c+=1){u(!0,c);var d=e.getLostPoint(m);if(0==c||a>d)a=d,b=c}u(!1,b)};m.createTableTag=function(a,b){a=a||2;var c;c='<table style=" border-width: 0px; border-style: none; border-collapse: collapse;'+
(" padding: 0px; margin: "+("undefined"==typeof b?4*a:b)+"px;")+'"><tbody>';for(var d=0;d<m.getModuleCount();d+=1){c+="<tr>";for(var e=0;e<m.getModuleCount();e+=1)c+='<td style="',c+=" border-width: 0px; border-style: none;",c+=" border-collapse: collapse;",c+=" padding: 0px; margin: 0px;",c+=" width: "+a+"px;",c+=" height: "+a+"px;",c+=" background-color: ",c+=m.isDark(d,e)?"#000000":"#ffffff",c+=";",c+='"/>';c+="</tr>"}return c+"</tbody></table>"};m.createSvgTag=function(a,b){a=a||2;b="undefined"==
typeof b?4*a:b;var c=m.getModuleCount()*a+2*b,d,e,f,g,y;y="l"+a+",0 0,"+a+" -"+a+",0 0,-"+a+"z ";g="<svg"+(' width="'+c+'px"')+(' height="'+c+'px"')+' xmlns="http://www.w3.org/2000/svg">';g+='<path d="';for(e=0;e<m.getModuleCount();e+=1)for(f=e*a+b,c=0;c<m.getModuleCount();c+=1)m.isDark(e,c)&&(d=c*a+b,g+="M"+d+","+f+y);g+='" stroke="transparent" fill="black"/>';return g+="</svg>"};m.createImgTag=function(a,b){a=a||2;b="undefined"==typeof b?4*a:b;var c=m.getModuleCount()*a+2*b,d=b,e=c-b;return v(c,
c,function(b,c){return d<=b&&b<e&&d<=c&&c<e?m.isDark(Math.floor((c-d)/a),Math.floor((b-d)/a))?0:1:1})};return m};b.stringToBytes=function(a){for(var b=[],c=0;c<a.length;c+=1){var d=a.charCodeAt(c);b.push(d&255)}return b};b.createStringToBytes=function(a,b){var c=function(){for(var c=p(a),d=function(){var a=c.read();if(-1==a)throw Error();return a},e=0,f={};;){var m=c.read();if(-1==m)break;var g=d(),h=d(),k=d(),m=String.fromCharCode(m<<8|g);f[m]=h<<8|k;e+=1}if(e!=b)throw Error(e+" != "+b);return f}();
return function(a){for(var b=[],d=0;d<a.length;d+=1){var e=a.charCodeAt(d);128>e?b.push(e):(e=c[a.charAt(d)],"number"==typeof e?(e&255)==e?b.push(e):(b.push(e>>>8),b.push(e&255)):b.push(63))}return b}};var c={L:1,M:0,Q:3,H:2},e=function(){var b=[[],[6,18],[6,22],[6,26],[6,30],[6,34],[6,22,38],[6,24,42],[6,26,46],[6,28,50],[6,30,54],[6,32,58],[6,34,62],[6,26,46,66],[6,26,48,70],[6,26,50,74],[6,30,54,78],[6,30,56,82],[6,30,58,86],[6,34,62,90],[6,28,50,72,94],[6,26,50,74,98],[6,30,54,78,102],[6,28,54,
80,106],[6,32,58,84,110],[6,30,58,86,114],[6,34,62,90,118],[6,26,50,74,98,122],[6,30,54,78,102,126],[6,26,52,78,104,130],[6,30,56,82,108,134],[6,34,60,86,112,138],[6,30,58,86,114,142],[6,34,62,90,118,146],[6,30,54,78,102,126,150],[6,24,50,76,102,128,154],[6,28,54,80,106,132,158],[6,32,58,84,110,136,162],[6,26,54,82,110,138,166],[6,30,58,86,114,142,170]],c={},e=function(a){for(var b=0;0!=a;)b+=1,a>>>=1;return b};c.getBCHTypeInfo=function(a){for(var b=a<<10;0<=e(b)-e(1335);)b^=1335<<e(b)-e(1335);return(a<<
10|b)^21522};c.getBCHTypeNumber=function(a){for(var b=a<<12;0<=e(b)-e(7973);)b^=7973<<e(b)-e(7973);return a<<12|b};c.getPatternPosition=function(a){return b[a-1]};c.getMaskFunction=function(a){switch(a){case 0:return function(a,b){return 0==(a+b)%2};case 1:return function(a,b){return 0==a%2};case 2:return function(a,b){return 0==b%3};case 3:return function(a,b){return 0==(a+b)%3};case 4:return function(a,b){return 0==(Math.floor(a/2)+Math.floor(b/3))%2};case 5:return function(a,b){return 0==a*b%2+
a*b%3};case 6:return function(a,b){return 0==(a*b%2+a*b%3)%2};case 7:return function(a,b){return 0==(a*b%3+(a+b)%2)%2};default:throw Error("bad maskPattern:"+a);}};c.getErrorCorrectPolynomial=function(b){for(var c=a([1],0),e=0;e<b;e+=1)c=c.multiply(a([1,d.gexp(e)],0));return c};c.getLengthInBits=function(a,b){if(1<=b&&10>b)switch(a){case 1:return 10;case 2:return 9;case 4:return 8;case 8:return 8;default:throw Error("mode:"+a);}else if(27>b)switch(a){case 1:return 12;case 2:return 11;case 4:return 16;
case 8:return 10;default:throw Error("mode:"+a);}else if(41>b)switch(a){case 1:return 14;case 2:return 13;case 4:return 16;case 8:return 12;default:throw Error("mode:"+a);}else throw Error("type:"+b);};c.getLostPoint=function(a){for(var b=a.getModuleCount(),c=0,d=0;d<b;d+=1)for(var e=0;e<b;e+=1){for(var f=0,g=a.isDark(d,e),h=-1;1>=h;h+=1)if(!(0>d+h||b<=d+h))for(var k=-1;1>=k;k+=1)0>e+k||b<=e+k||0==h&&0==k||g!=a.isDark(d+h,e+k)||(f+=1);5<f&&(c+=3+f-5)}for(d=0;d<b-1;d+=1)for(e=0;e<b-1;e+=1)if(f=0,a.isDark(d,
e)&&(f+=1),a.isDark(d+1,e)&&(f+=1),a.isDark(d,e+1)&&(f+=1),a.isDark(d+1,e+1)&&(f+=1),0==f||4==f)c+=3;for(d=0;d<b;d+=1)for(e=0;e<b-6;e+=1)a.isDark(d,e)&&!a.isDark(d,e+1)&&a.isDark(d,e+2)&&a.isDark(d,e+3)&&a.isDark(d,e+4)&&!a.isDark(d,e+5)&&a.isDark(d,e+6)&&(c+=40);for(e=0;e<b;e+=1)for(d=0;d<b-6;d+=1)a.isDark(d,e)&&!a.isDark(d+1,e)&&a.isDark(d+2,e)&&a.isDark(d+3,e)&&a.isDark(d+4,e)&&!a.isDark(d+5,e)&&a.isDark(d+6,e)&&(c+=40);for(e=f=0;e<b;e+=1)for(d=0;d<b;d+=1)a.isDark(d,e)&&(f+=1);return c+Math.abs(100*
f/b/b-50)/5*10};return c}(),d=function(){for(var a=Array(256),b=Array(256),c=0;8>c;c+=1)a[c]=1<<c;for(c=8;256>c;c+=1)a[c]=a[c-4]^a[c-5]^a[c-6]^a[c-8];for(c=0;255>c;c+=1)b[a[c]]=c;return{glog:function(a){if(1>a)throw Error("glog("+a+")");return b[a]},gexp:function(b){for(;0>b;)b+=255;for(;256<=b;)b-=255;return a[b]}}}(),k=function(){var a=[[1,26,19],[1,26,16],[1,26,13],[1,26,9],[1,44,34],[1,44,28],[1,44,22],[1,44,16],[1,70,55],[1,70,44],[2,35,17],[2,35,13],[1,100,80],[2,50,32],[2,50,24],[4,25,9],[1,
134,108],[2,67,43],[2,33,15,2,34,16],[2,33,11,2,34,12],[2,86,68],[4,43,27],[4,43,19],[4,43,15],[2,98,78],[4,49,31],[2,32,14,4,33,15],[4,39,13,1,40,14],[2,121,97],[2,60,38,2,61,39],[4,40,18,2,41,19],[4,40,14,2,41,15],[2,146,116],[3,58,36,2,59,37],[4,36,16,4,37,17],[4,36,12,4,37,13],[2,86,68,2,87,69],[4,69,43,1,70,44],[6,43,19,2,44,20],[6,43,15,2,44,16],[4,101,81],[1,80,50,4,81,51],[4,50,22,4,51,23],[3,36,12,8,37,13],[2,116,92,2,117,93],[6,58,36,2,59,37],[4,46,20,6,47,21],[7,42,14,4,43,15],[4,133,107],
[8,59,37,1,60,38],[8,44,20,4,45,21],[12,33,11,4,34,12],[3,145,115,1,146,116],[4,64,40,5,65,41],[11,36,16,5,37,17],[11,36,12,5,37,13],[5,109,87,1,110,88],[5,65,41,5,66,42],[5,54,24,7,55,25],[11,36,12,7,37,13],[5,122,98,1,123,99],[7,73,45,3,74,46],[15,43,19,2,44,20],[3,45,15,13,46,16],[1,135,107,5,136,108],[10,74,46,1,75,47],[1,50,22,15,51,23],[2,42,14,17,43,15],[5,150,120,1,151,121],[9,69,43,4,70,44],[17,50,22,1,51,23],[2,42,14,19,43,15],[3,141,113,4,142,114],[3,70,44,11,71,45],[17,47,21,4,48,22],
[9,39,13,16,40,14],[3,135,107,5,136,108],[3,67,41,13,68,42],[15,54,24,5,55,25],[15,43,15,10,44,16],[4,144,116,4,145,117],[17,68,42],[17,50,22,6,51,23],[19,46,16,6,47,17],[2,139,111,7,140,112],[17,74,46],[7,54,24,16,55,25],[34,37,13],[4,151,121,5,152,122],[4,75,47,14,76,48],[11,54,24,14,55,25],[16,45,15,14,46,16],[6,147,117,4,148,118],[6,73,45,14,74,46],[11,54,24,16,55,25],[30,46,16,2,47,17],[8,132,106,4,133,107],[8,75,47,13,76,48],[7,54,24,22,55,25],[22,45,15,13,46,16],[10,142,114,2,143,115],[19,
74,46,4,75,47],[28,50,22,6,51,23],[33,46,16,4,47,17],[8,152,122,4,153,123],[22,73,45,3,74,46],[8,53,23,26,54,24],[12,45,15,28,46,16],[3,147,117,10,148,118],[3,73,45,23,74,46],[4,54,24,31,55,25],[11,45,15,31,46,16],[7,146,116,7,147,117],[21,73,45,7,74,46],[1,53,23,37,54,24],[19,45,15,26,46,16],[5,145,115,10,146,116],[19,75,47,10,76,48],[15,54,24,25,55,25],[23,45,15,25,46,16],[13,145,115,3,146,116],[2,74,46,29,75,47],[42,54,24,1,55,25],[23,45,15,28,46,16],[17,145,115],[10,74,46,23,75,47],[10,54,24,
35,55,25],[19,45,15,35,46,16],[17,145,115,1,146,116],[14,74,46,21,75,47],[29,54,24,19,55,25],[11,45,15,46,46,16],[13,145,115,6,146,116],[14,74,46,23,75,47],[44,54,24,7,55,25],[59,46,16,1,47,17],[12,151,121,7,152,122],[12,75,47,26,76,48],[39,54,24,14,55,25],[22,45,15,41,46,16],[6,151,121,14,152,122],[6,75,47,34,76,48],[46,54,24,10,55,25],[2,45,15,64,46,16],[17,152,122,4,153,123],[29,74,46,14,75,47],[49,54,24,10,55,25],[24,45,15,46,46,16],[4,152,122,18,153,123],[13,74,46,32,75,47],[48,54,24,14,55,25],
[42,45,15,32,46,16],[20,147,117,4,148,118],[40,75,47,7,76,48],[43,54,24,22,55,25],[10,45,15,67,46,16],[19,148,118,6,149,119],[18,75,47,31,76,48],[34,54,24,34,55,25],[20,45,15,61,46,16]],b=function(a,b){var c={};c.totalCount=a;c.dataCount=b;return c},d={},e=function(b,d){switch(d){case c.L:return a[4*(b-1)+0];case c.M:return a[4*(b-1)+1];case c.Q:return a[4*(b-1)+2];case c.H:return a[4*(b-1)+3]}};d.getRSBlocks=function(a,c){var d=e(a,c);if("undefined"==typeof d)throw Error("bad rs block @ typeNumber:"+
a+"/errorCorrectLevel:"+c);for(var f=d.length/3,g=[],h=0;h<f;h+=1)for(var k=d[3*h+0],y=d[3*h+1],q=d[3*h+2],l=0;l<k;l+=1)g.push(b(y,q));return g};return d}(),l=function(){var a=[],b=0,c={getBuffer:function(){return a},getAt:function(b){return 1==(a[Math.floor(b/8)]>>>7-b%8&1)},put:function(a,b){for(var d=0;d<b;d+=1)c.putBit(1==(a>>>b-d-1&1))},getLengthInBits:function(){return b},putBit:function(c){var d=Math.floor(b/8);a.length<=d&&a.push(0);c&&(a[d]|=128>>>b%8);b+=1}};return c},g=function(a){var c=
b.stringToBytes(a);return{getMode:function(){return 4},getLength:function(a){return c.length},write:function(a){for(var b=0;b<c.length;b+=1)a.put(c[b],8)}}},h=function(){var a=[],b={writeByte:function(b){a.push(b&255)},writeShort:function(a){b.writeByte(a);b.writeByte(a>>>8)},writeBytes:function(a,c,d){c=c||0;d=d||a.length;for(var e=0;e<d;e+=1)b.writeByte(a[e+c])},writeString:function(a){for(var c=0;c<a.length;c+=1)b.writeByte(a.charCodeAt(c))},toByteArray:function(){return a},toString:function(){var b;
b="[";for(var c=0;c<a.length;c+=1)0<c&&(b+=","),b+=a[c];return b+"]"}};return b},f=function(){var a=0,b=0,c=0,d="",e={},f=function(a){if(!(0>a)){if(26>a)return 65+a;if(52>a)return 97+(a-26);if(62>a)return 48+(a-52);if(62==a)return 43;if(63==a)return 47}throw Error("n:"+a);};e.writeByte=function(e){a=a<<8|e&255;b+=8;for(c+=1;6<=b;)d+=String.fromCharCode(f(a>>>b-6&63)),b-=6};e.flush=function(){0<b&&(d+=String.fromCharCode(f(a<<6-b&63)),b=a=0);if(0!=c%3)for(var e=3-c%3,g=0;g<e;g+=1)d+="="};e.toString=
function(){return d};return e},p=function(a){var b=0,c=0,d=0,e=function(a){if(65<=a&&90>=a)return a-65;if(97<=a&&122>=a)return a-97+26;if(48<=a&&57>=a)return a-48+52;if(43==a)return 62;if(47==a)return 63;throw Error("c:"+a);};return{read:function(){for(;8>d;){if(b>=a.length){if(0==d)return-1;throw Error("unexpected end of file./"+d);}var f=a.charAt(b);b+=1;if("="==f)return d=0,-1;f.match(/^\s$/)||(c=c<<6|e(f.charCodeAt(0)),d+=6)}f=c>>>d-8&255;d-=8;return f}}},n=function(a,b){var c=Array(a*b),d=function(a){var b=
0,c=0;return{write:function(d,e){if(0!=d>>>e)throw Error("length over");for(;8<=b+e;)a.writeByte(255&(d<<b|c)),e-=8-b,d>>>=8-b,b=c=0;c|=d<<b;b+=e},flush:function(){0<b&&a.writeByte(c)}}},e=function(){var a={},b=0,c={add:function(d){if(c.contains(d))throw Error("dup key:"+d);a[d]=b;b+=1},size:function(){return b},indexOf:function(b){return a[b]},contains:function(b){return"undefined"!=typeof a[b]}};return c};return{setPixel:function(b,d,e){c[d*a+b]=e},write:function(f){f.writeString("GIF87a");f.writeShort(a);
f.writeShort(b);f.writeByte(128);f.writeByte(0);f.writeByte(0);f.writeByte(0);f.writeByte(0);f.writeByte(0);f.writeByte(255);f.writeByte(255);f.writeByte(255);f.writeString(",");f.writeShort(0);f.writeShort(0);f.writeShort(a);f.writeShort(b);f.writeByte(0);var g;g=3;for(var k=e(),l=0;4>l;l+=1)k.add(String.fromCharCode(l));k.add(String.fromCharCode(4));k.add(String.fromCharCode(5));var l=h(),y=d(l);y.write(4,g);for(var q=0,n=String.fromCharCode(c[q]),q=q+1;q<c.length;){var p=String.fromCharCode(c[q]),
q=q+1;k.contains(n+p)?n+=p:(y.write(k.indexOf(n),g),4095>k.size()&&(k.size()==1<<g&&(g+=1),k.add(n+p)),n=p)}y.write(k.indexOf(n),g);y.write(5,g);y.flush();g=l.toByteArray();f.writeByte(2);for(k=0;255<g.length-k;)f.writeByte(255),f.writeBytes(g,k,255),k+=255;f.writeByte(g.length-k);f.writeBytes(g,k,g.length-k);f.writeByte(0);f.writeString(";")}}},v=function(a,b,c,d){for(var e=n(a,b),g=0;g<b;g+=1)for(var k=0;k<a;k+=1)e.setPixel(k,g,c(k,g));c=h();e.write(c);e=f();c=c.toByteArray();for(g=0;g<c.length;g+=
1)e.writeByte(c[g]);e.flush();e='<img src="data:image/gif;base64,'+e+'" width="';e+=a;e+='"';e+=' height="';e+=b;e+='"';d&&(e+=' alt="',e+=d,e+='"');return e+="/>"};return b}();(function(a){"function"===typeof define&&define.amd?define([],a):"object"===typeof exports&&(module.exports=a())})(function(){return qrcode});
(function(a){a.stringToBytes=function(a){for(var b=[],e=0;e<a.length;e++){var d=a.charCodeAt(e);128>d?b.push(d):2048>d?b.push(192|d>>6,128|d&63):55296>d||57344<=d?b.push(224|d>>12,128|d>>6&63,128|d&63):(e++,d=65536+((d&1023)<<10|a.charCodeAt(e)&1023),b.push(240|d>>18,128|d>>12&63,128|d>>6&63,128|d&63))}return b}})(qrcode);angular.module("smsValidation",["ngResource","common-authentication"]).directive("smsValidation",["$ionicLoading","smsValidationAPI","$interval","CommonAuthenticationService",function(a,b,c,e){return{restrict:"E",scope:{presetInvitationCode:"=presetInvitationCode",success:"&onSuccess"},templateUrl:"templates/common/sms.validation.html",link:function(d){d.statusCode={waitMobile:0,waitCode:1};d.status=d.statusCode.waitMobile;d.showInvitationCode=!1;var k,l=function(a){d.count=60;angular.isDefined(k)||
(k=c(function(){1<d.count?--d.count:(angular.isDefined(k)&&(c.cancel(k),k=void 0),a())},1E3))},g=function(){a.show({template:"<ion-spinner></ion-spinner>",delay:100});b.send(d.mobile,d.captcha,function(){a.hide();d.status=d.statusCode.waitCode;l(function(){d.status===d.statusCode.waitCode&&(d.status.code=d.statusCode.waitMobile)})},function(b){a.hide();d.refreshCaptcha();d.captcha=void 0;alert(b.data.error)})};d.sendSmsValidation=function(){void 0===d.mobile?alert("\u8bf7\u6b63\u786e\u8f93\u5165\u624b\u673a\u53f7"):
void 0===d.captcha?alert("\u8bf7\u6b63\u786e\u8f93\u5165\u56fe\u7247\u9a8c\u8bc1\u7801"):g()};d.refreshCaptcha=function(){d.showCaptcha=!0;void 0!==d.mobile&&(d.captchaUrl=b.getCaptchaUrl(d.mobile))};d.checkExist=function(){d.showInvitationCode=!1;void 0!==d.mobile&&e.exist(d.mobile,function(){d.showInvitationCode=!1},function(){d.showInvitationCode=!0})};d.auth=function(){e.auth(d.mobile,d.validationCode,void 0!==d.presetInvitationCode?d.presetInvitationCode:d.invitationCode,function(a){d.success()},
function(a){alert(a)})}}}}]).service("smsValidationAPI",["$resource","urlConfig",function(a,b){var c=a(b.REST_END_POINT+"/sso/smsValidate",{phoneNumber:"@phoneNumber",captcha:"@captcha"},{send:{method:"POST",isArray:!1}},null);return{send:function(a,b,k,l){c.send({phoneNumber:a,captcha:b},function(){k()},function(a){l(a)})},getCaptchaUrl:function(a){return b.REST_END_POINT+"/sso/captcha?phoneNumber="+a+"&time="+(new Date).getTime()}}}]);angular.module("wechat",["wechat.service"]);
angular.module("wechat.service",[]).constant("wechatConstants",{SHARE_IMG_URL:"img/promotion/share.png",TIMELINE_IMG_URL:"img/promotion/share.png",PROMOTION_SHARE_ROOT:"/wechatlogin/oauth2?state=promotion:",SURVEY_SHARE_ROOT:"/wechatlogin/oauth2?state=survey:",CLAIM_SHARE_ROOT:"/#/claim/"}).service("Wechat",["urlConfig","$resource","$location","wechatConstants",function(a,b,c,e){var d,k=b(a.REST_END_POINT+"/api/wechat/config",{url:"@url"}),l=b(a.REST_END_POINT+"/wechatlogin/oauth2/bind",{openId:"@openId"}),
g=function(a,b,d){var e=new k;a=a?c.protocol()+"://"+c.host()+"/":c.absUrl();e.$get({url:a},function(a){q=a;console.log("refresh wechat mp config success");b()},function(a){q=void 0;console.log("refresh wechat mp config error by: "+a.data.error);d(a)})},h=function(a,b,c){wx.chooseImage({count:1,sizeType:["compressed"],sourceType:["album","camera"],success:function(a){b(a.localIds)}})},f=function(a,b,c){wx.uploadImage({localId:a,isShowProgressTips:1,success:function(a){b(a.serverId)}})},p=function(a,
b,c){wx.getLocation({type:"gcj02",success:function(a){b(a)},cancel:function(a){c(a)}})},n=function(a,b,c,d){wx.previewImage({current:b[a],urls:b})},v=function(a,b,c,d){wx.config({debug:!1,appId:q.appId,timestamp:q.timestamp,nonceStr:q.noncestr,signature:q.signature,jsApiList:"onMenuShareAppMessage onMenuShareTimeline chooseWXPay chooseImage uploadImage getLocation previewImage hideMenuItems".split(" ")});wx.ready(function(){a(b,c,d)})},u=function(b,c,d,f){b&&wx.hideMenuItems({menuList:["menuItem:share:appMessage"]});
wx.onMenuShareAppMessage({title:c.name,desc:c.description,link:c.url,imgUrl:a.APP_ROOT+"/"+e.SHARE_IMG_URL,trigger:function(a){},success:function(a){d()},cancel:function(a){f("\u5df2\u53d6\u6d88\u5206\u4eab")},fail:function(a){f("\u5206\u4eab\u5931\u8d25")}});wx.onMenuShareTimeline({title:c.name,link:c.url,imgUrl:a.APP_ROOT+"/"+e.TIMELINE_IMG_URL,trigger:function(a){},success:function(a){d()},cancel:function(a){f("\u5df2\u53d6\u6d88\u5206\u4eab")},fail:function(a){f("\u5206\u4eab\u5931\u8d25")}})},
t=function(a,b,c){u(!0,a,b,c)},x=function(a,b,c){u(!1,a,b,c)},r=function(a,b,c){wx.chooseWXPay({timestamp:a.timeStamp+"",nonceStr:a.nonceStr,"package":a.packagePrepayId,signType:a.signType,paySign:a.paySign,success:function(a){b()},fail:function(a){c()},cancel:function(a){c()}})},q;return{hookShareAll:function(a,b,c,d){void 0===q?g(a,function(){v(x,b,c,d)},function(a){alert("\u5fae\u4fe1\u73af\u5883\u9519\u8bef\uff0c\u8bf7\u91cd\u65b0\u6253\u5f00\u9875\u9762")}):v(x,b,c,d)},hookShareTimelineOnly:function(a,
b,c,d){void 0===q?g(a,function(){v(t,b,c,d)},function(a){alert("\u5fae\u4fe1\u73af\u5883\u9519\u8bef\uff0c\u8bf7\u91cd\u65b0\u6253\u5f00\u9875\u9762")}):v(t,b,c,d)},doWxPay:function(a,b,c){void 0===q?g(!0,function(){v(r,a,b,c)},function(a){alert("\u5fae\u4fe1\u73af\u5883\u9519\u8bef\uff0c\u8bf7\u91cd\u65b0\u6253\u5f00\u9875\u9762")}):v(r,a,b,c)},chooseImage:function(a,b){void 0===q?g(!0,function(){v(h,"",a,b)},function(a){alert("\u5fae\u4fe1\u73af\u5883\u9519\u8bef\uff0c\u8bf7\u91cd\u65b0\u6253\u5f00\u9875\u9762")}):
v(h,"",a,b)},previewImage:function(a,b,c,d){void 0===q?g(!0,function(){v(n,a,b,c,d)},function(a){alert("\u5fae\u4fe1\u73af\u5883\u9519\u8bef\uff0c\u8bf7\u91cd\u65b0\u6253\u5f00\u9875\u9762")}):v(n,a,b,c,d)},getUserLocation:function(a,b){void 0===q?g(!0,function(){v(p,"",a,b)},function(a){alert("\u5fae\u4fe1\u73af\u5883\u9519\u8bef\uff0c\u8bf7\u91cd\u65b0\u6253\u5f00\u9875\u9762")}):v(p,"",a,b)},uploadImage:function(a,b,c){void 0===q?g(!0,function(){v(f,a,b,c)},function(a){alert("\u5fae\u4fe1\u73af\u5883\u9519\u8bef\uff0c\u8bf7\u91cd\u65b0\u6253\u5f00\u9875\u9762")}):
v(f,a,b,c)},isQQBrowser:function(){return-1!==navigator.userAgent.indexOf("MQQBrowser")},bind:function(a,b,c){(new l).$save({openId:a},b,function(a){c(a.data.error)})},getOpenId:function(){return d},setOpenId:function(a){d=a}}}]);
