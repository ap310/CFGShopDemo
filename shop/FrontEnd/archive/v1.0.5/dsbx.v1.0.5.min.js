var $jscomp={scope:{}};$jscomp.defineProperty="function"==typeof Object.defineProperties?Object.defineProperty:function(a,b,c){if(c.get||c.set)throw new TypeError("ES3 does not support getters and setters.");a!=Array.prototype&&a!=Object.prototype&&(a[b]=c.value)};$jscomp.getGlobal=function(a){return"undefined"!=typeof window&&window===a?a:"undefined"!=typeof global&&null!=global?global:a};$jscomp.global=$jscomp.getGlobal(this);$jscomp.SYMBOL_PREFIX="jscomp_symbol_";
$jscomp.initSymbol=function(){$jscomp.initSymbol=function(){};$jscomp.global.Symbol||($jscomp.global.Symbol=$jscomp.Symbol)};$jscomp.symbolCounter_=0;$jscomp.Symbol=function(a){return $jscomp.SYMBOL_PREFIX+(a||"")+$jscomp.symbolCounter_++};
$jscomp.initSymbolIterator=function(){$jscomp.initSymbol();var a=$jscomp.global.Symbol.iterator;a||(a=$jscomp.global.Symbol.iterator=$jscomp.global.Symbol("iterator"));"function"!=typeof Array.prototype[a]&&$jscomp.defineProperty(Array.prototype,a,{configurable:!0,writable:!0,value:function(){return $jscomp.arrayIterator(this)}});$jscomp.initSymbolIterator=function(){}};$jscomp.arrayIterator=function(a){var b=0;return $jscomp.iteratorPrototype(function(){return b<a.length?{done:!1,value:a[b++]}:{done:!0}})};
$jscomp.iteratorPrototype=function(a){$jscomp.initSymbolIterator();a={next:a};a[$jscomp.global.Symbol.iterator]=function(){return this};return a};$jscomp.array=$jscomp.array||{};$jscomp.iteratorFromArray=function(a,b){$jscomp.initSymbolIterator();a instanceof String&&(a+="");var c=0,f={next:function(){if(c<a.length){var e=c++;return{value:b(e,a[e]),done:!1}}f.next=function(){return{done:!0,value:void 0}};return f.next()}};f[Symbol.iterator]=function(){return f};return f};
$jscomp.polyfill=function(a,b,c,f){if(b){c=$jscomp.global;a=a.split(".");for(f=0;f<a.length-1;f++){var e=a[f];e in c||(c[e]={});c=c[e]}a=a[a.length-1];f=c[a];b=b(f);b!=f&&null!=b&&$jscomp.defineProperty(c,a,{configurable:!0,writable:!0,value:b})}};$jscomp.polyfill("Array.prototype.keys",function(a){return a?a:function(){return $jscomp.iteratorFromArray(this,function(a){return a})}},"es6-impl","es3");
$jscomp.findInternal=function(a,b,c){a instanceof String&&(a=String(a));for(var f=a.length,e=0;e<f;e++){var k=a[e];if(b.call(c,k,e,a))return{i:e,v:k}}return{i:-1,v:void 0}};$jscomp.polyfill("Array.prototype.find",function(a){return a?a:function(a,c){return $jscomp.findInternal(this,a,c).v}},"es6-impl","es3");
angular.module("account.community",["account.community.service","promotion"]).controller("CommCreditCtrl",["$scope","$state","$ionicHistory","$rootScope","$ionicLoading","eventNames","CreditAPI",function(a,b,c,f,e,k,n){var g=function(){a.records=[];d(function(){e.show({template:"<ion-spinner></ion-spinner>",delay:100})},function(){e.hide()},function(){f.navToIndex()})},h=function(){a.records=void 0;a.pageNumber=void 0;a.hasRecord=void 0;a.initFinish=void 0},d=function(b,d,c){b();n.refresh(function(b){a.records=
b;a.pageNumber=0;a.hasRecord=!(void 0===a.records||0===a.records.length);a.initFinish=!0;d()},function(b){a.initFinish=!0;console.log(b);alert("\u5237\u65b0\u5931\u8d25\uff0c\u8bf7\u7a0d\u540e\u518d\u8bd5");d();c()})};a.loadMore=function(){a.canLoadMore()&&n.getPage(a.pageNumber+1,function(b){if(void 0!==b&&0!==b.length){for(var d=0;d<b.length;d++)a.records.push(b[d]);a.pageNumber++}a.$broadcast("scroll.infiniteScrollComplete")},function(b){alert(b);a.$broadcast("scroll.infiniteScrollComplete")})};
a.refresh=function(){d(function(){},function(){$timeout(function(){a.$broadcast("scroll.refreshComplete")},500)},function(){})};a.canLoadMore=function(){return void 0===a.initFinish?!1:n.hasMoreToLoad()};g();f.$on("$stateChangeStart",function(a,b,d,c,e){if("app.account.community"===b.name||"app.account.community.invite"===b.name||"app.account.community.credit"===b.name||"app.account.community.exchange"===b.name){if("app.account.community.invite"===c.name||"app.account.community.credit"===c.name)return;
g()}"app.account.sales"!==b.name&&"app.account.sales.invite"!==b.name&&"app.account.sales.credit"!==b.name||"app.account.sales.invite"===c.name||"app.account.sales.credit"===c.name||g()});f.$on("event:auth-loginCancelled",function(){h()});f.$on("event:auth-logout-complete",function(){h()});f.$on(k.CREDIT_EXCHANGE_SUCCESS,function(a,b){h()})}]).controller("CommExchangeCtrl",["$scope","$state","$ionicHistory","$rootScope","$ionicLoading","eventNames","CreditExchangeAPI",function(a,b,c,f,e,k,n){a.exchange=
function(b){b.creditAmount>a.$parent.account.credit?alert("\u7231\u5fc3\u6570\u91cf\u4e0d\u8db3\uff0c\u8bf7\u83b7\u5f97\u66f4\u591a\u7231\u5fc3\u518d\u6765\u5151\u6362"):(e.show({template:"<ion-spinner></ion-spinner>",delay:100}),n.exchange(b.id,function(){e.hide();f.$broadcast(k.CREDIT_EXCHANGE_SUCCESS);alert("\u5151\u6362\u6210\u529f")},function(a){e.hide();alert(a)}))};(function(){a.rules=[];e.show({template:"<ion-spinner></ion-spinner>",delay:100});n.getRules(function(b){a.rules=b;e.hide()},function(a){e.hide();
alert(a);f.navToIndex()})})()}]).controller("CommInviteCtrl",["$scope","$state","$ionicHistory","$rootScope","$ionicLoading","eventNames","PromotionAPI","Wechat",function(a,b,c,f,e,k,n,g){var h=function(b){void 0===a.$parent||void 0===a.$parent.account?a.$on("account-ready",function(a,d){b()}):b()},d=function(){a.invitePromotionUrl=n.getShareUrl(a.$parent.account.invitePromotionId);e.show({template:"<ion-spinner></ion-spinner>",delay:100});n.getPublicBatch(a.$parent.account.invitePromotionId,function(b){e.hide();
a.batch=b;g.hookShareAll(!0,n.convertBatchToContent(a.batch),function(){},function(a){alert(a)})},function(a){e.hide();alert("\u672a\u627e\u5230\u5206\u4eab\u6d3b\u52a8\uff0c\u8bf7\u8054\u7cfb\u7ba1\u7406\u5458\u6216\u7a0d\u540e\u518d\u8bd5")})};h(d);f.$on("$stateChangeStart",function(a,b,c,u,e){("app.account.community.invite"===b.name&&"app.account.community.invite"!==u.name&&"app.account.community.exchange"!==u.name&&"app.account.community.credit"!==u.name||"app.account.sales.invite"===b.name&&
"app.account.sales.invite"!==u.name)&&h(d)})}]);
angular.module("account.community.service",["ngResource"]).service("CreditAPI",["$resource","urlConfig",function(a,b){var c=a(b.REST_END_POINT+"/api/account/credit/record",{page:"@page"},{query:{method:"GET",isArray:!1,timeout:1E4}},null),f=function(a,b,d){c.query({page:a},function(a){for(var d=[],c=0;c<a.list.length;c++)k[a.list[c].id]=a.list[c],d.push(a.list[c]);console.log("credit record page data get page success");b(d)},function(a){d(a.data.error)})},e=function(a,b){k={};n=0;c.query({page:0},
function(b){n=b.metaData.total;for(var d=[],c=0;c<b.list.length;c++)k[b.list[c].id]=b.list[c],d.push(b.list[c]);console.log("credit record metaData init success");a(d)},function(a){b(a.data.error)})},k={},n=0;return{getPage:function(a,b,d){f(a,b,d)},get:function(a){return k[a]},refresh:function(a,b){e(a,b)},hasMoreToLoad:function(){return!!(void 0!==k&&0!==Object.keys(k).length&&Object.keys(k).length<n)},clean:function(){k=void 0;n=0}}}]).service("CreditExchangeAPI",["$resource","urlConfig",function(a,
b){var c=a(b.REST_END_POINT+"/api/account/credit/exchangeRule",{},{query:{method:"GET",isArray:!0,timeout:1E4}},null),f=a(b.REST_END_POINT+"/api/account/credit/exchangeRule/:ruleId/exchange",{ruleId:"@ruleId"},{exchange:{method:"POST",isArray:!1,timeout:1E4}},null),e=[],k=function(a,b){e=[];c.query({},function(b){e=b;console.log("credit exchange rule init success");a(e)},function(a){b("\u672a\u627e\u5230\u53ef\u5151\u6362\u5546\u54c1\uff0c\u8bf7\u8054\u7cfb\u7ba1\u7406\u5458\u6216\u7a0d\u540e\u518d\u8bd5")})},
n=function(a,b,d){f.exchange({ruleId:a},function(a){b()},function(a){d(a.data.error)})};return{getRules:function(a,b){void 0===e||0===e.length?k(a,b):a(e)},exchange:function(a,b,d){n(a,b,d)}}}]);angular.module("account",["account.service","smsValidation","wechat","account.community"]).controller("AccountCtrl",["$scope","$state","$rootScope","$ionicLoading","AccountAPI","accountConstants","eventNames",function(a,b,c,f,e,k,n){a.state={info:1,edit:2};var g=function(){a.actState=a.state.info;f.show({template:"<ion-spinner></ion-spinner>",delay:100});e.getAccount(function(b){f.hide();a.account=b;a.$broadcast("account-ready",a.account)},function(a){f.hide();console.log("error getting account, by: "+
a);alert("\u670d\u52a1\u5668\u672a\u54cd\u5e94\uff0c\u83b7\u53d6\u8d26\u6237\u4fe1\u606f\u5931\u8d25\uff0c\u8bf7\u7a0d\u540e\u518d\u8bd5");c.navToIndex()})};a.canEditCompany=function(){return a.account.type===k.ACCOUNT_TYPE_NORMAL};a.canEditEmail=function(){return a.account.type===k.ACCOUNT_TYPE_NORMAL};a.showEdit=function(){a.actState=a.state.edit;a.backupName=a.account.name;a.backupAddress=a.account.address;a.backupCompany=a.account.company;a.backupEmail=a.account.email};a.saveEdit=function(){f.show({template:"<ion-spinner></ion-spinner>",
delay:100});e.saveAccount(a.account,function(b){f.hide();a.actState=a.state.info;a.backupName=void 0;a.backupAddress=void 0;a.backupCompany=void 0;a.backupEmail=void 0},function(a){f.hide();alert(a.data.error)})};a.cancelEdit=function(){a.account.name=a.backupName;a.account.address=a.backupAddress;a.account.company=a.backupCompany;a.account.email=a.backupEmail;a.backupName=void 0;a.backupAddress=void 0;a.backupCompany=void 0;a.backupEmail=void 0;a.actState=a.state.info};g();c.$on("$stateChangeStart",
function(a,b,c,e,f){"app.account"!==b.name&&"app.account.show"!==b.name||"app.account"===e.name||"app.account.show"===e.name||g()});c.$on("event:auth-loginCancelled",function(){e.clean();a.account=void 0});c.$on("event:auth-logout-complete",function(){e.clean();a.account=void 0});c.$on(n.CREDIT_EXCHANGE_SUCCESS,function(a,b){e.clean();g()})}]).controller("SalesOrCommCtrl",["$scope","$rootScope",function(a,b){var c=function(a){a.isSuperDXK?b.navToRoot("app.account.sales.credit"):b.navToRoot("app.account.community.credit")},
f=function(){void 0===a.$parent.account?a.$on("account-ready",function(b,f){c(a.$parent.account)}):c(a.$parent.account)};f();b.$on("$stateChangeStart",function(a,b,c,g,h){"app.account.salesOrComm"===b.name&&"app.account.salesOrComm"!==g.name&&(a.preventDefault(),f())})}]);
angular.module("account.service",["ngResource","http-auth-interceptor","wechat"]).service("AccountAPI",["$resource","urlConfig","Wechat",function(a,b,c){var f,e=a(b.REST_END_POINT+"/api/account",null,{query:{method:"GET",isArray:!1,timeout:1E4},save:{method:"POST",timeout:1E4}},null);return{getAccount:function(a,b){if(void 0===f){var g=c.getOpenId();void 0!==g?c.bind(g,function(c){console.log("wechat bind succeed");e.query({},function(b){f=b;a(f)},b)},function(a){console.log("wechat bind failed by: "+
a);b(a)}):e.query({},function(b){f=b;a(f)},b)}else a(f)},saveAccount:function(a,b,c){e.save(a,function(c){f=a;b()},function(a){c(a)})},clean:function(){f=void 0}}}]);angular.module("agreement",["agreement.service","wechat","common-authentication","coupon"]).constant("agreementConstants",{AGREEMENT_ID_AUTO_PAYGO:"AUTO_PAYGO",AGREEMENT_ID_PAYGO_LOCAL_ZH:"PAYGO_LOCAL_ZH",AGREEMENT_ID_PAYGO_JB:"PAYGO_JB",AGREEMENT_ID_PAYGO_JB_LIMIT_PRICE:"PAYGO_JB_LIMIT_PRICE",AGREEMENT_ID_PAYGO_ZR:"PAYGO_ZR",AGREEMENT_ID_PAYGO_JB_LITE:"PAYGO_JB_LITE",AGREEMENT_ID_PAYGO_LOCAL_JB_LITE:"PAYGO_LOCAL_JB_LITE",AGREEMENT_ID_SIGNUP_COUPON:"SIGNUP_COUPON",AGREEMENT_ID_COUPON_TRANSACTION_25:"COUPON_TRANSACTION_25",
AGREEMENT_ID_PAYGO_ZH_COLD_CHAIN:"PAYGO_ZH_COLD_CHAIN",AGREEMENT_ID_PAYGO_ZH_LIMIT_PRICE:"PAYGO_ZH_LIMIT_PRICE",AGREEMENT_ID_SIMULATE:"SIMULATE",AGREEMENT_TYPE_USER:"USER",AGREEMENT_ROUTE_PRESET_BOTH:"BOTH",AGREEMENT_ROUTE_PRESET_NONE:"NONE",AGREEMENT_ROUTE_PRESET_EQUAL:"EQUAL",AGREEMENT_ROUTE_PRESET_DISTANCE:"DISTANCE",PUBLIC_AGREEMENT_MATRIX:{AUTO_PAYGO:{region:"\u5168\u56fd\u8303\u56f4\uff08\u6e2f\u6fb3\u53f0\u5730\u533a\u9664\u5916\uff09",mainItem:"\u7efc\u5408\u9669",description:"\u4fdd\u969c\u5168\u9762\uff0c\u5bf9\u4e8e\u8d27\u503c\u76f8\u5bf9\u8f83\u9ad8\u7684\u8d27\u7269\u3002\u5982\u5e38\u89c1\u4ea7\u6210\u54c1\uff0c\u670d\u88c5\u3001\u7535\u5b50\u8bbe\u5907\u3001\u673a\u68b0\u8bbe\u5907\u7b49\u7269\u54c1\u6700\u4e3a\u9002\u7528\u3002\u5c24\u5176\u662f\u5bf9\u4e8e100\u4e07\u4ee5\u4e0a\u8d27\u503c\u7684\u9ad8\u4ef7\u503c\u8d27\u54c1\uff0c\u6b64\u4ea7\u54c1\u53ef\u4e0a\u8c03\u989d\u5ea6\u6700\u9ad8\u8fbe500\u4e07\u5143\uff0c\u66f4\u4e3a\u9002\u7528\u3002\u6b64\u4ea7\u54c1\u4e3a\u3010\u514d\u8ffd\u507f\u3011\u4ea7\u54c1\uff0c\u5373\u627f\u4fdd\u4eba\u653e\u5f03\u5bf9\u6295\u4fdd\u4eba\u7684\u8ffd\u507f\u6743\u3002"},
PAYGO_JB:{region:"\u5168\u56fd\u8303\u56f4\uff08\u6e2f\u6fb3\u53f0\u5730\u533a\u9664\u5916\uff09",mainItem:"\u57fa\u672c\u9669",description:"\u4fdd\u8d39\u66f4\u4f18\u60e0\uff0c\u9002\u5408\u4e8e\u8de8\u7701\u4e1a\u52a1\u3002\u5bf9\u4e8e\u8d27\u503c\u4f4e\uff0c\u5bf9\u4fdd\u9669\u4fdd\u969c\u8303\u56f4\u8981\u6c42\u4e0d\u9ad8\u7684\u8d27\u7269\uff0c\u5982\u539f\u6750\u6599\uff0c\u5927\u5b97\u6563\u8d27\u7b49\u7269\u54c1\u66f4\u9002\u7528\u3002\u627f\u4fdd\u4eba\u653e\u5f03\u5bf9\u6295\u4fdd\u4eba\u7684\u8ffd\u507f\u6743\u3002\u6b64\u4ea7\u54c1\u4e3a\u3010\u514d\u8ffd\u507f\u3011\u4ea7\u54c1\uff0c\u5373\u627f\u4fdd\u4eba\u653e\u5f03\u5bf9\u6295\u4fdd\u4eba\u7684\u8ffd\u507f\u6743\u3002"},
PAYGO_LOCAL_ZH:{region:"\u8fd0\u8f93\u7ebf\u8def\u540c\u7701\u8303\u56f4\u5185\uff08\u6e2f\u6fb3\u53f0\u5730\u533a\u9664\u5916\uff09",mainItem:"\u7efc\u5408\u9669",description:"\u9002\u5408\u4e8e\u7701\u540c\u7701\u8303\u56f4\u5185\uff08\u7701\u7ea7\u533a\u57df\uff09\u7684\u914d\u9001\u4e1a\u52a1\u3002\u5bf9\u4e8e\u56de\u7a0b\u8d27\u6216\u5c3e\u8d27\u5206\u6d3e\u73af\u8282\u66f4\u52a0\u9002\u7528\u3002\u540c\u65f6\u7531\u4e8e\u4fdd\u969c\u9650\u989d\u4e3a20-100\u4e07\u5185\u76845\u6863\uff0c\u5206\u7c7b\u66f4\u7ec6\u81f4\uff0c\u9009\u62e9\u66f4\u7075\u6d3b\u3002\u627f\u4fdd\u4eba\u653e\u5f03\u5bf9\u6295\u4fdd\u4eba\u7684\u8ffd\u507f\u6743\u3002\u6b64\u4ea7\u54c1\u4e3a\u3010\u514d\u8ffd\u507f\u3011\u4ea7\u54c1\uff0c\u5373\u627f\u4fdd\u4eba\u653e\u5f03\u5bf9\u6295\u4fdd\u4eba\u7684\u8ffd\u507f\u6743\u3002"},
PAYGO_JB_LITE:{region:"\u5168\u56fd\u8303\u56f4\uff08\u6e2f\u6fb3\u53f0\u5730\u533a\u9664\u5916\uff09",mainItem:"\u57fa\u672c\u9669",description:"\u4fdd\u8d39\u66f4\u4f18\u60e0\uff0c\u9002\u5408\u4e8e\u8de8\u7701\u4e1a\u52a1\u3002\u5bf9\u4e8e\u8d27\u503c\u4f4e\uff0c\u5bf9\u4fdd\u9669\u4fdd\u969c\u8303\u56f4\u8981\u6c42\u4e0d\u9ad8\u7684\u8d27\u7269\uff0c\u5982\u539f\u6750\u6599\uff0c\u5927\u5b97\u6563\u8d27\u7b49\u7269\u54c1\u66f4\u9002\u7528\u3002\u4ec5\u627f\u4fdd\u7531\u4e8e\u706b\u707e\u3001\u7206\u70b8\u3001\u4ea4\u901a\u5de5\u5177\u610f\u5916\u4e8b\u6545\u5f15\u8d77\u7684\u8d27\u7269\u635f\u5931\u3002\u6bcf\u6b21\u4e8b\u6545\u7edd\u5bf9\u514d\u8d54\uffe525000\u5143\u6216\u8005\u635f\u5931\u91d1\u989d\u768410%\uff0c\u4ee5\u9ad8\u8005\u4e3a\u51c6\u3002\u6b64\u4ea7\u54c1\u4e3a\u3010\u514d\u8ffd\u507f\u3011\u4ea7\u54c1\uff0c\u5373\u627f\u4fdd\u4eba\u653e\u5f03\u5bf9\u6295\u4fdd\u4eba\u7684\u8ffd\u507f\u6743\u3002"},
PAYGO_LOCAL_JB_LITE:{region:"\u5168\u56fd\u8303\u56f4\uff08\u6e2f\u6fb3\u53f0\u5730\u533a\u9664\u5916\uff09",mainItem:"\u57fa\u672c\u9669",description:"\u9002\u5408\u4e8e\u7701\u540c\u7701\u8303\u56f4\u5185\uff08\u7701\u7ea7\u533a\u57df\uff09\u7684\u914d\u9001\u4e1a\u52a1\u3002\u5bf9\u4e8e\u56de\u7a0b\u8d27\u6216\u5c3e\u8d27\u5206\u6d3e\u73af\u8282\u66f4\u52a0\u9002\u7528\u3002\u4ec5\u627f\u4fdd\u7531\u4e8e\u706b\u707e\u3001\u7206\u70b8\u3001\u4ea4\u901a\u5de5\u5177\u610f\u5916\u4e8b\u6545\u5f15\u8d77\u7684\u8d27\u7269\u635f\u5931\u3002\u6bcf\u6b21\u4e8b\u6545\u7edd\u5bf9\u514d\u8d54\uffe525000\u5143\u6216\u8005\u635f\u5931\u91d1\u989d\u768410%\uff0c\u4ee5\u9ad8\u8005\u4e3a\u51c6\u3002\u6b64\u4ea7\u54c1\u4e3a\u3010\u514d\u8ffd\u507f\u3011\u4ea7\u54c1\uff0c\u5373\u627f\u4fdd\u4eba\u653e\u5f03\u5bf9\u6295\u4fdd\u4eba\u7684\u8ffd\u507f\u6743\u3002"},
PAYGO_ZR:{region:"\u5168\u56fd\u8303\u56f4\uff08\u6e2f\u6fb3\u53f0\u5730\u533a\u9664\u5916\uff09",mainItem:"\u8d23\u4efb\u9669",description:"\u4fdd\u969c\u5168\u9762\uff0c\u5bf9\u4e8e\u8d27\u503c\u76f8\u5bf9\u8f83\u9ad8\u7684\u8d27\u7269\u3002\u5982\u5e38\u89c1\u4ea7\u6210\u54c1\uff0c\u670d\u88c5\u3001\u7535\u5b50\u8bbe\u5907\u3001\u673a\u68b0\u8bbe\u5907\u7b49\u7269\u54c1\u6700\u4e3a\u9002\u7528\u3002\u5c24\u5176\u662f\u5bf9\u4e8e100\u4e07\u4ee5\u4e0a\u8d27\u503c\u7684\u9ad8\u4ef7\u503c\u8d27\u54c1\uff0c\u6b64\u4ea7\u54c1\u53ef\u4e0a\u8c03\u989d\u5ea6\u6700\u9ad8\u8fbe250\u4e07\u5143\uff0c\u66f4\u4e3a\u9002\u7528\u3002"},
PAYGO_ZH_COLD_CHAIN:{region:"\u5168\u56fd\u8303\u56f4\uff08\u6e2f\u6fb3\u53f0\u5730\u533a\u9664\u5916\uff09",mainItem:"\u7efc\u5408\u9669",description:"\u672c\u4ea7\u54c1\u4e13\u9879\u9488\u5bf9\u4e8e\u51b7\u51bb\u8089\u7c7b\u5236\u54c1\u5168\u56fd\u8303\u56f4\u5185\u7684\u8fd0\u8f93\u670d\u52a1\u3002\u4ea7\u54c1\u4fdd\u969c\u5168\u9762\uff0c\u4e0d\u4ec5\u627f\u4fdd\u5e38\u89c1\u706b\u707e\u7206\u70b8\u3001\u4ea4\u901a\u4e8b\u6545\u7b49\u8fd0\u8f93\u98ce\u9669\uff0c\u8fd8\u627f\u4fdd\u51b7\u51bb\u8089\u7c7b\u5236\u54c1\u7531\u4e8e\u51b7\u85cf\u673a\u5668\u6216\u9694\u6e29\u8bbe\u5907\u7684\u635f\u574f\u6216\u8005\u8f66\u53a2\u5185\u8d2e\u5b58\u51b0\u5757\u7684\u6eb6\u5316\u6240\u9020\u6210\u7684\u89e3\u51bb\u6eb6\u5316\u800c\u8150\u8d25\u7684\u635f\u5931\u3002\u4fdd\u969c\u989d\u5ea6\u9ad8\uff0c\u6700\u9ad8\u53ef\u6295\u4fdd\u81f3100\u4e07\u5143\u3002\u4fdd\u969c\u8303\u56f4\u5e7f\u6cdb\uff0c\u5982\u5e38\u89c1\u7684\u732a\u725b\u7f8a\u8089\u7c7b\u3001\u9e21\u8089\u7c7b\u3001\u51b7\u51bb\u9c7c\u7c7b\u5236\u54c1\u7b49\u5747\u53ef\u9002\u7528\u3002"},
PAYGO_ZH_LIMIT_PRICE:{region:"\u5168\u56fd\u8303\u56f4\uff08\u6e2f\u6fb3\u53f0\u53ca\u56db\u5ddd\u3001\u91cd\u5e86\u3001\u4e91\u5357\u3001\u6d77\u5357\u3001\u9752\u6d77\u3001\u8d35\u5dde\u3001\u65b0\u7586\u3001\u897f\u85cf\u9664\u5916\uff09",mainItem:"\u7efc\u5408\u9669",description:"\u5927\u5723\u4fdd\u9669\u5e73\u53f0\u9650\u65f6\u63a8\u51fa\u8d27\u8fd0\u9669\u4fdd\u969c\u4f18\u60e0\u65b9\u6848\uff0c11\u5143\u5373\u53ef\u627f\u4fdd50\u4e07\u8d27\u503c\u5185\u5168\u56fd\u516c\u8def\u8d27\u8fd0\u9669\u3002\u4fdd\u9669\u4fdd\u969c\u5168\u9762\uff0c\u5bf9\u4e8e\u5e38\u89c1\u8d27\u7269\uff0c\u5982\u670d\u88c5\u3001\u7535\u5b50\u8bbe\u5907\u3001\u4ea7\u6210\u54c1\u7b49\u666e\u8d27\u5747\u53ef\u9002\u7528\u3002\u4fdd\u969c\u8303\u56f4\u5e7f\uff0c\u9664\u4e2a\u522b\u6d89\u53ca\u8d39\u7387\u4e0a\u6d6e\u5730\u533a\u5916\uff08\u8be6\u89c1\u4e0b\u6587\uff09\uff0c\u672c\u4ea7\u54c1\u5747\u53ef\u4f7f\u7528\u3002\u672c\u4ea7\u54c1\u4e3a\u3010\u514d\u8ffd\u507f\u3011\u4ea7\u54c1\uff0c\u4fdd\u9669\u4eba\u653e\u5f03\u5bf9\u5b9e\u9645\u627f\u8fd0\u4eba\u7684\u8ffd\u507f\u3002"}},
BACKGROUND_ROOT:"/img/agreement-public/",PAY_METHOD_CREDIT:"credit",PAY_METHOD_H5:"h5",PAY_METHOD_COUPON:"coupon",PAY_METHOD_SIMULATE:"simulate",PAY_PROVIDER_WX:"wxmppay",PAY_PROVIDER_ALI:"alipay",PAY_PROVIDER_CREDIT:"credit",PAY_PROVIDER_COUPON:"coupon",PAY_PROVIDER_SIMULATE:"simulate",PRODUCT_NAME_SIMULATE:"\u6a21\u62df\u7efc\u5408\u9669",INVOICE_TYPES:{NORMAL:"\u666e\u901a\u53d1\u7968",VALUE_ADDED_SPECIAL:"\u589e\u503c\u7a0e\u4e13\u7528\u53d1\u7968"},INVOICE_TYPE_NORMAL:"NORMAL"}).controller("AgreementCtrl",
["$scope","$state","AgreementAPI","agreementConstants","$rootScope","$ionicLoading","eventNames",function(a,b,c,f,e,k,n){var g=function(b,m,q){a.initFinish=!1;k.show({template:"<ion-spinner></ion-spinner>",delay:100});c.findPublicByIdIn(d,function(d){a.toPropose="1"===b;a.showPaygo="1"===m;a.showUser="1"===q;a.publicAgreements=d;a.showUser?c.all(function(b){a.agreementlist=b;k.hide();a.initFinish=!0;for(b=0;b<a.agreementlist.length;b++)a.agreementlist[b].canPayWxpay=-1<a.agreementlist[b].payMethods.indexOf(f.PAY_METHOD_H5)},
function(b){k.hide();a.initFinish=!0;e.navToIndex()}):(k.hide(),a.initFinish=!0)},function(a){console.log("error initializing index, by: "+a);k.hide();alert("\u670d\u52a1\u5668\u672a\u54cd\u5e94\uff0c\u83b7\u53d6\u534f\u8bae\u5931\u8d25\uff0c\u8bf7\u7a0d\u540e\u518d\u8bd5")})},h=function(){a.agreementlist=void 0;a.toPropose=void 0;a.showPaygo=void 0;a.showUser=void 0;a.publicAgreements=void 0;a.initFinish=void 0};a.expired=function(a){return new Date(a.endDate)<new Date};var d=[f.AGREEMENT_ID_PAYGO_LOCAL_JB_LITE,
f.AGREEMENT_ID_PAYGO_LOCAL_ZH,f.AGREEMENT_ID_PAYGO_JB_LITE,f.AGREEMENT_ID_PAYGO_JB,f.AGREEMENT_ID_AUTO_PAYGO,f.AGREEMENT_ID_PAYGO_ZR,f.AGREEMENT_ID_PAYGO_ZH_COLD_CHAIN];g(b.params.toPropose,b.params.paygo,b.params.user);e.$on("$stateChangeStart",function(a,b,d,c,e){"app.agreement"!==b.name&&"app.agreement.list"!==b.name&&"app.agreement.detail"!==b.name||g(d.toPropose,d.paygo,d.user)});e.$on("event:auth-loginCancelled",function(){h()});e.$on("event:auth-logout-complete",function(){h()});e.$on(n.PROPOSAL_SUCCESS,
function(a,b){c.clean()});e.$on(n.AGREEMENT_CHARGE_SUCCESS,function(a,b){c.clean()})}]).controller("AgreementDetailCtrl",["$rootScope","$scope","$stateParams","AgreementAPI","eventNames","agreementConstants",function(a,b,c,f,e,k){var n=function(){f.find(c.id,function(a){b.agreement=a;b.agreement.canPayWxpay=-1<b.agreement.payMethods.indexOf(k.PAY_METHOD_H5)},function(a){b.message=a})};n();a.$on(e.AGREEMENT_CHARGE_SUCCESS,function(a,b){n()})}]).controller("AgreementPublicDetailCtrl",["$rootScope",
"$scope","$state","$stateParams","AgreementAPI","CouponAPI","CommonAuthenticationService",function(a,b,c,f,e,k,n){b.navToProposal=function(){"TRANSACTION"!==b.agreement.couponTag?c.go("app.proposal.start",{agreementId:b.agreement.type,payCouponId:b.defaultCouponId}):b.isLoggedIn?b.defaultCouponId?c.go("app.proposal.start",{agreementId:b.agreement.type,payCouponId:b.defaultCouponId}):alert("\u672c\u4ea7\u54c1\u4e3a\u4f18\u60e0\u5238\u4e13\u7528\uff0c\u60a8\u7684\u4f18\u60e0\u5238\u5df2\u7ecf\u7528\u5b8c\u6216\u8fd8\u6ca1\u6709\u4f18\u60e0\u5238\u3002"):
b.showLogin()};(function(){e.findPublic(f.id,function(a){b.agreement=a;b.isLoggedIn=n.isLoggedIn();b.isLoggedIn&&k.refresh(function(){},function(){})},function(a){b.message=a})})();a.$on("event:auth-loginConfirmed",function(){b.isLoggedIn=n.isLoggedIn()});a.$on("event:auth-logout-complete",function(){b.isLoggedIn=n.isLoggedIn()});a.$on("event:coupon-changed",function(){var a=k.getMetaByScope("TAG",b.agreement.couponTag),c=k.getMetaByScope("AGREEMENT_TYPE",b.agreement.type);b.couponTotal=(a.total?
a.total:0)+(c.total?c.total:0);var d;a["default"]&&(d=a["default"]);c["default"]&&(d=c["default"]);b.defaultCouponId=d})}]).controller("AgreementChargeCtrl",["$rootScope","$scope","$state","$stateParams","AgreementAPI","$ionicActionSheet","AccountAPI","agreementConstants","eventNames","Wechat","$ionicLoading","$ionicPopup",function(a,b,c,f,e,k,n,g,h,d,l,m){var q=function(){l.show({template:"<ion-spinner></ion-spinner>",delay:100});e.preOrder(b.chargeOrder,function(a){console.log("pre order succeed");
u(a)},function(a){l.hide();console.log("pre order error, by: ",a.data.error);alert(a.data.error)})},u=function(u){b.chargeOrder.orderId=u.orderId;d.doWxPay(u.paymentResponse,function(){l.hide();b.error=void 0;console.log("save order successfull");a.$broadcast(h.AGREEMENT_CHARGE_SUCCESS,suc);alert("\u5145\u503c\u91d1\u989d"+b.chargeOrder.fee+"\u5143\uff0c\u4ee3\u91d1\u5238\u5df2\u7ecf\u53d1\u653e\uff0c\u8bf7\u5230\u6211\u7684\u4f18\u60e0\u5238\u4e2d\u67e5\u770b");c.go("app.agreement.detail",{id:f.id})},
function(){l.hide();alert("\u652f\u4ed8\u5931\u8d25")})};(function(){l.show({template:"<ion-spinner></ion-spinner>",delay:100});e.find(f.id,function(a){b.agreement=a;b.agreement.invoiceTypes=g.INVOICE_TYPES;n.getAccount(function(a){b.account=a;b.chargeOrder={agreement:b.agreement,chargeRule:b.agreement.chargeRules[0],fee:b.agreement.chargeRules[0]?b.agreement.chargeRules[0].chargeAmount:0};b.account.invoiceSetting&&(b.chargeOrder.companyTaxId=b.account.invoiceSetting.companyTaxId);b.chargeOrder.invoiceType=
g.INVOICE_TYPE_NORMAL;l.hide()},function(a){console.log("error getting account, by: "+a);l.hide();alert("\u670d\u52a1\u5668\u672a\u54cd\u5e94\uff0c\u83b7\u53d6\u652f\u4ed8\u4fe1\u606f\u5931\u8d25\uff0c\u8bf7\u7a0d\u540e\u518d\u8bd5")})},function(a){l.hide();b.message=a})})();b.showRules=function(){for(var a=[],d=0;d<b.agreement.chargeRules.length;d++)a[d]={text:"<div>"+b.agreement.chargeRules[d].name+"</div><p>"+b.agreement.chargeRules[d].description+"</p>"};k.show({buttons:a,buttonClicked:function(a){b.chargeOrder.chargeRule=
b.agreement.chargeRules[a];b.chargeOrder.fee=b.chargeOrder.chargeRule.chargeAmount;return!0}})};b.canShowTaxId=function(){return void 0!==b.chargeOrder&&b.chargeOrder.invoiceType!==g.INVOICE_TYPE_NORMAL};b.wxPay=function(){void 0===d.getOpenId()?alert("\u672a\u68c0\u6d4b\u5230\u5fae\u4fe1\u652f\u4ed8\u73af\u5883\uff0c\u8bf7\u5728\u5fae\u4fe1\u516c\u4f17\u53f7\u4e2d\u64cd\u4f5c"):(b.chargeOrder.buyerId=d.getOpenId(),b.chargeOrder.payProvider=g.PAY_PROVIDER_WX,q())}}]);
angular.module("agreement.service",["ngResource"]).service("AgreementAPI",["$resource","urlConfig","agreementConstants",function(a,b,c){var f=function(a,b){return a.displayIndex-b.displayIndex},e=function(a,b){return a.pinyin>a.pinyin?1:a.pinyin<b.pinyin?-1:0},k=function(a,b){return a.value-b.value},n=a(b.REST_END_POINT+"/api/public/agreement",null,{query:{method:"GET",isArray:!1,timeout:1E4}},null),g,h,d=a(b.REST_END_POINT+"/api/agreement",null,{query:{method:"GET",isArray:!0,timeout:1E4}},null),
l=a(b.REST_END_POINT+"/api/order/charge"),m=a(b.REST_END_POINT+"/api/order/:id/finish"),q,u=function(a,b){n.query({},function(b){console.log("public agreement init success");g=b.contexts.divisions.sort(e);h=b.agreements;h[c.AGREEMENT_ID_AUTO_PAYGO].divisions=g;h[c.AGREEMENT_ID_AUTO_PAYGO].goods.sort(f);h[c.AGREEMENT_ID_AUTO_PAYGO].coverages.sort(k);h[c.AGREEMENT_ID_AUTO_PAYGO].invoiceTypes=c.INVOICE_TYPES;h[c.AGREEMENT_ID_PAYGO_LOCAL_ZH].divisions=g;h[c.AGREEMENT_ID_PAYGO_LOCAL_ZH].goods.sort(f);
h[c.AGREEMENT_ID_PAYGO_LOCAL_ZH].coverages.sort(k);h[c.AGREEMENT_ID_PAYGO_LOCAL_ZH].invoiceTypes=c.INVOICE_TYPES;h[c.AGREEMENT_ID_PAYGO_JB].divisions=g;h[c.AGREEMENT_ID_PAYGO_JB].goods.sort(f);h[c.AGREEMENT_ID_PAYGO_JB].coverages.sort(k);h[c.AGREEMENT_ID_PAYGO_JB].invoiceTypes=c.INVOICE_TYPES;h[c.AGREEMENT_ID_PAYGO_JB_LIMIT_PRICE].divisions=g.filter(function(a){return 100===a.defaultRouteFeeRate});h[c.AGREEMENT_ID_PAYGO_JB_LIMIT_PRICE].goods.sort(f);h[c.AGREEMENT_ID_PAYGO_JB_LIMIT_PRICE].coverages.sort(k);
h[c.AGREEMENT_ID_PAYGO_JB_LIMIT_PRICE].invoiceTypes=c.INVOICE_TYPES;h[c.AGREEMENT_ID_PAYGO_LOCAL_JB_LITE].divisions=g;h[c.AGREEMENT_ID_PAYGO_LOCAL_JB_LITE].goods.sort(f);h[c.AGREEMENT_ID_PAYGO_LOCAL_JB_LITE].coverages.sort(k);h[c.AGREEMENT_ID_PAYGO_LOCAL_JB_LITE].invoiceTypes=c.INVOICE_TYPES;h[c.AGREEMENT_ID_PAYGO_JB_LITE].divisions=g;h[c.AGREEMENT_ID_PAYGO_JB_LITE].goods.sort(f);h[c.AGREEMENT_ID_PAYGO_JB_LITE].coverages.sort(k);h[c.AGREEMENT_ID_PAYGO_JB_LITE].invoiceTypes=c.INVOICE_TYPES;h[c.AGREEMENT_ID_PAYGO_ZH_LIMIT_PRICE].divisions=
g.filter(function(a){return 100===a.defaultRouteFeeRate});h[c.AGREEMENT_ID_PAYGO_ZH_LIMIT_PRICE].goods.sort(f);h[c.AGREEMENT_ID_PAYGO_ZH_LIMIT_PRICE].coverages.sort(k);h[c.AGREEMENT_ID_PAYGO_ZH_LIMIT_PRICE].invoiceTypes=c.INVOICE_TYPES;h[c.AGREEMENT_ID_PAYGO_ZH_COLD_CHAIN].divisions=g;h[c.AGREEMENT_ID_PAYGO_ZH_COLD_CHAIN].goods.sort(f);h[c.AGREEMENT_ID_PAYGO_ZH_COLD_CHAIN].coverages.sort(k);h[c.AGREEMENT_ID_PAYGO_ZH_COLD_CHAIN].invoiceTypes=c.INVOICE_TYPES;h[c.AGREEMENT_ID_PAYGO_ZR].divisions=g;h[c.AGREEMENT_ID_PAYGO_ZR].goods.sort(f);
h[c.AGREEMENT_ID_PAYGO_ZR].coverages.sort(k);h[c.AGREEMENT_ID_PAYGO_ZR].invoiceTypes=c.INVOICE_TYPES;h[c.AGREEMENT_ID_SIGNUP_COUPON].divisions=g.filter(function(a){return 100===a.defaultRouteFeeRate});h[c.AGREEMENT_ID_SIGNUP_COUPON].goods.sort(f);h[c.AGREEMENT_ID_SIGNUP_COUPON].coverages.sort(k);h[c.AGREEMENT_ID_COUPON_TRANSACTION_25].divisions=g.filter(function(a){return 100===a.defaultRouteFeeRate});h[c.AGREEMENT_ID_COUPON_TRANSACTION_25].goods.sort(f);h[c.AGREEMENT_ID_COUPON_TRANSACTION_25].coverages.sort(k);
h[c.AGREEMENT_ID_SIMULATE].divisions=g;h[c.AGREEMENT_ID_SIMULATE].goods.sort(f);h[c.AGREEMENT_ID_SIMULATE].coverages.sort(k);b=Object.keys(h);for(var d=0;d<b.length;d++){for(var u=h[b[d]].coverages[0],v=h[b[d]].coverages[0],l=0;l<h[b[d]].coverages.length;l++)h[b[d]].coverages[l].discountFee=Math.round(h[b[d]].coverages[l].basefee*h[b[d]].discountRate/100),u.value>h[b[d]].coverages[l].value&&(u=h[b[d]].coverages[l]),v.value<h[b[d]].coverages[l].value&&(v=h[b[d]].coverages[l]);h[b[d]].lowCoverage=u;
h[b[d]].highCoverage=v;h[b[d]].backgroundUrl=c.BACKGROUND_ROOT+b[d]+".jpg";h[b[d]].matrix=c.PUBLIC_AGREEMENT_MATRIX[b[d]]}a()},b)},w=function(a,b){d.query({},function(b){q=b;console.log("user agreement init success");b=q;for(var d=0;d<b.length;d++)b[d].goods.sort(f),b[d].coverages.sort(k);a(q)},b)},x=function(a,b,d){void 0===h?u(function(){void 0===h||void 0===h[a]?d("\u534f\u8bae\u672a\u627e\u5230\uff0c\u8bf7\u8054\u7cfb\u7ba1\u7406\u5458"):b(h[a])},d):b(h[a])},t=function(a,b){for(var d={},c=0;c<
b.length;c++)void 0!==a[b[c]]&&(d[b[c]]=a[b[c]]);return d},r=function(a,b,d){w(function(c){for(var e,l=0;l<c.length;l++)c[l].id===parseInt(a)&&(e=c[l]);void 0===e?d("\u672a\u627e\u5230\u534f\u8bae\uff0c\u8bf7\u8054\u7cfb\u7ba1\u7406\u5458"):void 0===g?u(function(){void 0===g?d("\u534f\u8bae\u7ebf\u8def\u672a\u627e\u5230\uff0c\u8bf7\u8054\u7cfb\u7ba1\u7406\u5458"):(e.divisions=g,b(e))},d):(e.divisions=g,b(e))},d)};return{getProposal:function(a,b,d){a===c.AGREEMENT_ID_AUTO_PAYGO||a===c.AGREEMENT_ID_PAYGO_LOCAL_ZH||
a===c.AGREEMENT_ID_PAYGO_JB||a===c.AGREEMENT_ID_PAYGO_JB_LIMIT_PRICE||a===c.AGREEMENT_ID_PAYGO_ZH_LIMIT_PRICE||a===c.AGREEMENT_ID_PAYGO_ZR||a===c.AGREEMENT_ID_PAYGO_LOCAL_JB_LITE||a===c.AGREEMENT_ID_PAYGO_JB_LITE||a===c.AGREEMENT_ID_SIGNUP_COUPON||a===c.AGREEMENT_ID_COUPON_TRANSACTION_25||a===c.AGREEMENT_ID_SIMULATE||a===c.AGREEMENT_ID_PAYGO_ZH_COLD_CHAIN?x(a,b,d):r(a,b,d)},findPublicByIdIn:function(a,b,d){void 0===h?u(function(){void 0===h?d("\u534f\u8bae\u672a\u627e\u5230\uff0c\u8bf7\u8054\u7cfb\u7ba1\u7406\u5458"):
b(t(h,a))},d):b(t(h,a))},all:function(a,b){void 0===q?w(function(){a(q)},function(a){console.log(a);b(a)}):a(q)},findPublic:function(a,b,d){x(a,b,d)},find:function(a,b,d){r(a,b,d)},clean:function(){q=void 0},preOrder:function(a,b,d){(new l(a)).$save({},function(a){b(a)},function(a){d(a)})},finishOrder:function(a,b,d){(new m).$save({id:a},function(a){b(a)},function(a){d(a)})}}}]);angular.module("app",["smsValidation","wechat","account"]).controller("AppCtrl",["$scope","$ionicModal","$rootScope","$state","authService","$ionicHistory","$ionicLoading","CommonAuthenticationService","Wechat","$timeout","$ionicPopup","AccountAPI",function(a,b,c,f,e,k,n,g,h,d,l,m){d(function(){window.loading_screen.finish()},1500);a.isQQBrowser=!!h.isQQBrowser();c.navToRoot=function(a,b){k.nextViewOptions({historyRoot:!0});f.go(a,b)};c.navToIndex=function(){c.navToRoot("app.portal.category")};b.fromTemplateUrl("templates/app/login.html",
{scope:a}).then(function(b){a.modal=b});a.loginConfirmed=function(){e.loginConfirmed()};a.quit=function(){g.quit(function(){c.$broadcast("event:auth-logout-complete")})};a.cancel=function(){e.loginCancelled()};a.showLogin=function(a){a&&"function"===typeof a.stopPropagation&&a.stopPropagation();c.$broadcast("event:auth-loginRequired")};a.$on("event:auth-loginRequired",function(b,d){console.log("Login required");n.hide();a.modal.show()});a.$on("event:auth-loginConfirmed",function(){a.modal.hide()});
a.$on("event:auth-loginCancelled",function(){a.modal.hide();k.nextViewOptions({historyRoot:!0});c.navToIndex()});a.$on("event:auth-logout-complete",function(){k.nextViewOptions({historyRoot:!0});c.navToIndex()});a.$on("event:auth-forbidden",function(){console.log("Auth forbidden");n.hide();a.modal.show()});a.updateAccountPopup=function(b,d,c,e,f){a.data={};a.fieldName=d;a.data[d]=b[d];l.show({template:'<form> <textarea rows="3"  ng-model="data[fieldName]" class="value-right"></textarea></form>',title:e,
subTitle:f,scope:a,buttons:[{text:"\u53d6\u6d88"},{text:"<b>\u786e\u8ba4</b>",type:"button-positive",onTap:function(u){if(a.data[d])if("\u672a\u586b\u5199"==a.data[d]||""==a.data[d])alert("\u8bf7\u786e\u8ba4"+c+"\u540d\u79f0\u6b63\u786e\u518d\u63d0\u4ea4");else{n.show({template:"<ion-spinner></ion-spinner>",delay:100});var e=b[d];b[d]=a.data[d];m.saveAccount(b,function(a){n.hide()},function(a){b[d]=e;alert("\u4fdd\u5b58"+c+"\u4fe1\u606f\u5931\u8d25"+a.data.error);n.hide()})}else u.preventDefault()}}]})};
c.$on("$stateChangeStart",function(a,b,d,c,e){console.log(c.name+" to "+b.name)})}]);angular.module("claim",["ionic","claim.service","wechat"]).controller("ClaimCtrl",["$scope","$stateParams","$state","$ionicLoading","$timeout","ClaimAPI","$ionicHistory","Wechat","$ionicPopup","$rootScope","$ionicPopover",function(a,b,c,f,e,k,n,g,h,d,l){a.navtoroot=function(a,b){n.nextViewOptions({historyRoot:!0});c.go(a,b)};var m=function(b,d){a.transtionId=b;a.claim=void 0;f.show({template:"<ion-spinner></ion-spinner>",delay:100});k.get(b,function(b){a.claim=b;if(null!==a.claim.registerno&&void 0!==
a.claim.registerno&&""!==a.claim.registerno)a.showhistoryrecord=!0,a.navtoroot("^.result",{id:a.claim.transactionId,result:a.claim}),q();else if(a.estimaterangelist=[{id:1,name:"\u5c0f\u4e8e1\u4e07\u5143"},{id:2,name:"\u5927\u4e8e\u7b49\u4e8e1\u4e07\u5143"}],a.damageresonlist=[{id:"0100",name:"\u81ea\u7136\u707e\u5bb3"},{id:"0016",name:"\u610f\u5916\u4e8b\u6545\u81f4\u8f66\u4e0a\u8d27\u7269\u635f\u6bc1"},{id:"0018",name:"\u8f66\u8f7d\u8d27\u7269\u6389\u843d"},{id:"0019",name:"\u8f66\u8f7d\u8d27\u7269\u649e\u51fb"},
{id:"0020",name:"\u8f66\u8f86\u4e0e\u9a7e\u9a76\u5458\u540c\u65f6\u5931\u8e2a"},{id:"0024",name:"\u73bb\u7483\u5355\u72ec\u7834\u788e"},{id:"0007",name:"\u884c\u9a76\u4e2d\u5e73\u884c\u5760\u843d"},{id:"0009",name:"\u5168\u8f66\u88ab\u76d7\u7a83"},{id:"0045",name:"\u8f66\u8f86\u505c\u9a76\u635f\u5931"},{id:"0048",name:"\u8fd0\u8f7d\u8d27\u7269\u81ea\u8eab\u539f\u56e0\u8d77\u706b\u5f15\u8d77\u81ea\u71c3"},{id:"5026",name:"\u7ffb\u8f66"},{id:"1328",name:"\u7b2c\u4e09\u65b9\u539f\u56e0"},{id:"1100",
name:"\u5176\u5b83\u539f\u56e0"}],!0===d){if(void 0===a.claim.id||null===a.claim.id)a.claim.losstype=a.damageresonlist[0],a.claim.estimaterange=a.estimaterangelist[0];else{for(b=0;b<a.damageresonlist.length;b++){console.log(a.damageresonlist[b]);var c=a.damageresonlist[b];if(c.id===a.claim.losstype){a.claim.losstype=c;break}}for(b=0;b<a.estimaterangelist.length;b++)if(console.log(a.estimaterangelist[b]),c=a.estimaterangelist[b],c.id===a.claim.estimaterange){a.claim.estimaterange=c;break}}a.claim.damagedate=
new Date(a.claim.damagedate)}f.hide()},function(a){f.hide()})};a.startClaim=function(){null===a.claim.damageplace||void 0===a.claim.damageplace||""===a.claim.damageplace?alert("\u8bf7\u586b\u5199\u51fa\u9669\u5730\u70b9\u3002"):null===a.claim.damagedate||void 0===a.claim.damagedate||""===a.claim.damagedate?alert("\u8bf7\u586b\u5199\u51fa\u9669\u65f6\u95f4\u3002"):null===a.claim.notifyman||void 0===a.claim.notifyman||""===a.claim.notifyman?alert("\u8bf7\u586b\u5199\u62a5\u6848\u4eba\u59d3\u540d\u3002"):
null===a.claim.mobiletel||void 0===a.claim.mobiletel||""===a.claim.mobiletel?alert("\u8bf7\u586b\u5199\u62a5\u6848\u4eba\u624b\u673a\u53f7\u3002"):!1===/^1[3578]\d{9}$/.test(a.claim.mobiletel)?alert("\u8bf7\u586b\u5199\u6b63\u786e\u7684\u62a5\u6848\u4eba\u624b\u673a\u53f7\u3002"):null===a.claim.linkaddress||void 0===a.claim.linkaddress||""===a.claim.linkaddress?alert("\u8bf7\u586b\u5199\u62a5\u6848\u4eba\u90ae\u7bb1\u3002"):null===a.claim.damageobject||void 0===a.claim.damageobject||""===a.claim.damageobject?
alert("\u8bf7\u586b\u5199\u53d7\u635f\u6807\u7684\u3002"):null===a.claim.losstype||void 0===a.claim.losstype||""===a.claim.losstype?alert("\u8bf7\u586b\u5199\u51fa\u73b0\u539f\u56e0\u3002"):null!==a.claim.estimate&&void 0!==a.claim.estimate&&/^\d+$/.test(a.claim.estimate)?null===a.claim.damagedes||void 0===a.claim.damagedes||""===a.claim.damagedes?alert("\u8bf7\u586b\u5199\u4e8b\u6545\u7ecf\u8fc7\u3002"):(a.claim.estimaterange=1E4>=a.claim.estimate?a.estimaterangelist[0]:a.estimaterangelist[1],a.navtoroot("^.confirm",
{result:a.claim})):alert("\u8bf7\u586b\u5199\u6b63\u786e\u7684\u62a5\u635f\u91d1\u989d\u3002")};a.cancelClaim=function(){a.navtoroot("^.start",{result:a.claim})};a.saveClaim=function(){f.show({template:"<ion-spinner></ion-spinner>",delay:100});a.claim.transactionId=a.transtionId;a.claim.losstype=a.claim.losstype.id;a.claim.estimaterange=a.claim.estimaterange.id;1E4<=a.claim.estimate?k.saveClaim(a.claim,function(b){a.claim=b.data;k.commitClaim(a.claim,function(b){f.hide();a.claim=b.data;a.showhistoryrecord=
!0;a.navtoroot("^.result",{id:a.claim.transactionId,result:a.claim})},function(a){f.hide();alert("\u63d0\u4ea4\u62a5\u6848\u51fa\u73b0\u95ee\u9898\u8bf7\u7a0d\u540e\u518d\u8bd5\u3002")})},function(a){f.hide();alert("\u63d0\u4ea4\u62a5\u6848\u51fa\u73b0\u95ee\u9898\u8bf7\u7a0d\u540e\u518d\u8bd5\u3002")}):k.saveClaim(a.claim,function(b){a.navtoroot("^.upload",{id:a.claim.transactionId,result:a.claim})},function(a){f.hide();alert("\u63d0\u4ea4\u62a5\u6848\u51fa\u73b0\u95ee\u9898\u8bf7\u7a0d\u540e\u518d\u8bd5\u3002")})};
var q=function(){a.popover=l.fromTemplate('<ion-popover-view style="position: fixed;top: 0;left: 0;z-index: 10; width: 100%;height: 100%;"><ion-content scroll="false"><div id="rightDisplay" ng-if="bigImage" class="popover-backdrop" style="position: fixed;top: 0;left: 0;z-index: 10; width: 100%;height: 100%;" ng-click="hideBigImage()"><img class="img-responsive" style="position: absolute;top: 10%;left: 50%;z-index: 10;display: block;margin-top: 18px; margin-left: -165px;height: 420px;width: 330px; box-shadow: 0 1px 3px rgba(0, 0, 0, 0.4);" src="{{Url}}"/></div></ion-content></ion-popover-view>',
{scope:a})};a.openPopover=function(b){a.popover.show(b)};a.closePopover=function(){a.popover.hide()};a.bigImage=!1;a.Url="#";a.hideBigImage=function(){a.bigImage=!1;a.closePopover()};a.showBigImage=function(b,d){a.Url=b;a.bigImage=!0;a.openPopover(d)};d.$on("$stateChangeStart",function(b,d,c,e,l){"app.claim.start"!==d.name&&"app.claim.result"!==d.name||"app.claim.confirm"===e.name||void 0===c.id||""===c.id.id||m(c.id,!0);"app.claim.result"===d.name&&q();"app.claim.result"===e.name&&(a.claim=void 0);
"app.claim.upload"===d.name&&"app.claim.confirm"===e.name&&g.hookShareAll(!0,k.getShareContent(c.result),function(){},function(a){alert(a)})});void 0!==b.id&&""!==b.id&&m(b.id,!0)}]).controller("ClaimUploadCtrl",["$scope","$stateParams","$state","$ionicLoading","$timeout","ClaimAPI","$ionicHistory","Wechat","$ionicPopup","$rootScope",function(a,b,c,f,e,k,n,g,h,d){a.navtoroot=function(a,b){n.nextViewOptions({historyRoot:!0});c.go(a,b)};e(function(){window.loading_screen.finish()},1500);var l=function(b){a.transtionId=
b;a.claim=void 0;f.show({template:"<ion-spinner></ion-spinner>",delay:100});k.get(b,function(b){a.claim=b;f.hide()},function(a){f.hide()})},m=null,q=!1;a.getlocation=function(){q=!1;f.show({template:"<ion-spinner></ion-spinner>",delay:100});var b=e(function(){!1===q&&(f.hide(),alert("\u83b7\u53d6\u5730\u7406\u4f4d\u7f6e\u4fe1\u606f\u5931\u8d25\u8bf7\u7a0d\u540e\u518d\u8bd5"))},6E3);g.getUserLocation(function(d){q=!0;b&&e.cancel(b);JSON.stringify(d);var c=d.latitude;d=d.longitude;var l=new qq.maps.LatLng(c,
d);a.claim.latitude=c;a.claim.longitude=d;m.getAddress(l)},function(a){f.hide();alert(a)})};a.uploadFile=function(b){g.chooseImage(function(d){a.claim.imgList[b]=d.toString();f.show({template:"<ion-spinner></ion-spinner>",delay:100});g.uploadImage(a.claim.imgList[b],function(d){k.downloadFile(a.claim.id,d,b,function(d){f.hide();a.claim.imgList[b]=d.data;a.$apply()},function(a){f.hide()})},function(a){f.hide()})},function(a){alert(a)})};a.commitClaim=function(){if(void 0===a.claim.gpsaddress||""===
a.claim.gpsaddress)alert("\u8bf7\u70b9\u51fb\u2018\u83b7\u53d6\u5730\u7406\u4f4d\u7f6e\u4fe1\u606f\u2019\u6309\u94ae\uff0c\u8bbe\u7f6e\u5f53\u524d\u4f4d\u7f6e\u4fe1\u606f\uff01");else if(void 0===a.claim.imgList)alert("\u8bf7\u4f9d\u6b21\u9009\u62e9\u51719\u5f20\u7167\u7247\u8fdb\u884c\u4e0a\u4f20");else{for(var b=0;b<a.claim.imgList.length;b++)if(void 0===a.claim.imgList[b]){alert("\u8bf7\u4f9d\u6b21\u9009\u62e9\u51719\u5f20\u7167\u7247\u8fdb\u884c\u4e0a\u4f20");return}var b=a.claim.imgList.length,
d=9-b;9!==b?alert("\u8bf7\u4f9d\u6b21\u9009\u62e9\u51719\u5f20\u7167\u7247\u8fdb\u884c\u4e0a\u4f20,\u5df2\u4e0a\u4f20"+b+"\u5f20 \u8fd8\u9700"+d+"\u5f20"):(f.show({template:"<ion-spinner></ion-spinner>",delay:100}),k.commitClaim(a.claim,function(b){f.hide();a.claim=b.data;a.showhistoryrecord=!0;a.navtoroot("^.result",{id:a.claim.transactionId,result:a.claim})},function(a){f.hide();alert("\u63d0\u4ea4\u62a5\u6848\u51fa\u73b0\u95ee\u9898\u8bf7\u7a0d\u540e\u518d\u8bd5\u3002")}))}};d.$on("$stateChangeStart",
function(b,d,c,e,f){"app.claim.upload"===e.name&&(a.claim=void 0,q=!1);"app.claim.upload"===d.name&&(JSON.stringify(c),l(c.id))});void 0!==b.id&&""!==b.id&&l(b.id);(function(){m=new qq.maps.Geocoder({complete:function(b){f.hide();a.claim.gpsaddress=b.detail.addressComponents.province===b.detail.addressComponents.city?b.detail.addressComponents.country+b.detail.addressComponents.province+b.detail.addressComponents.city+b.detail.addressComponents.district+b.detail.addressComponents.street+b.detail.addressComponents.streetNumber:
b.detail.addressComponents.country+b.detail.addressComponents.city+b.detail.addressComponents.district+b.detail.addressComponents.street+b.detail.addressComponents.streetNumber;a.$apply()}})})()}]).controller("ClaimListCtrl",["$scope","$stateParams","$state","$ionicLoading","$timeout","ClaimAPI","$ionicHistory","Wechat","$ionicPopup","$rootScope",function(a,b,c,f,e,k,n,g,h,d){e(function(){window.loading_screen.finish()},1500);d.$on("$stateChangeStart",function(b,d,c,e,f){"app.claim.list"===e.name&&
(a.claims=void 0);"app.claim.list"===d.name&&l()});var l=function(){f.show({template:"<ion-spinner></ion-spinner>",delay:100});k.getAll(function(b){JSON.stringify(b);a.claims=b;f.hide()},function(a){f.hide();alert("\u83b7\u53d6\u7406\u8d54\u4fe1\u606f\u5931\u8d25\u8bf7\u7a0d\u540e\u518d\u8bd5\u3002")})};l()}]).controller("ClaimHistoryListCtrl",["$scope","$stateParams","$state","$ionicLoading","$timeout","ClaimAPI","$ionicHistory","Wechat","$ionicPopup",function(a,b,c,f,e,k,n,g,h){e(function(){window.loading_screen.finish()},
1500);(function(b){a.id=b.id;f.show({template:"<ion-spinner></ion-spinner>",delay:100});k.getRecord(b,function(b){JSON.stringify(b);a.claimrecords=b;f.hide()},function(a){f.hide();alert("\u83b7\u53d6\u7406\u8d54\u8bb0\u5f55\u4fe1\u606f\u5931\u8d25\u8bf7\u7a0d\u540e\u518d\u8bd5\u3002")})})(b.id)}]);
angular.module("claim.service",["ngResource"]).service("ClaimAPI",["$resource","urlConfig","wechatConstants",function(a,b,c){var f=a(b.REST_END_POINT+"/api/claim/:transtionId",{transtionId:"@transtionId"},{query:{method:"GET",isArray:!1,timeout:1E4}},null),e=a(b.REST_END_POINT+"/api/claim/queryrecord/:claimid",{claimid:"@claimid"},{query:{method:"GET",isArray:!1,timeout:1E4}},null),k=a(b.REST_END_POINT+"/api/claim/getAll",null,{query:{method:"GET",isArray:!1,timeout:1E4}},null),n=a(b.REST_END_POINT+
"/api/claim/create",null,{save:{method:"POST",isArray:!1,timeout:1E4}},null),g=a(b.REST_END_POINT+"/api/claim/downloadFile/:Id/:fileId/:fileIndex",{transtionId:"@transtionId",fileId:"@fileId",fileIndex:"@fileIndex"},{query:{method:"GET",isArray:!1,timeout:1E4}},null),h=a(b.REST_END_POINT+"/api/claim/save",null,{save:{method:"POST",isArray:!1,timeout:6E4}},null);return{get:function(a,b,c){f.query({transtionId:a},function(a){b(a.data)},function(a){c(a.error)})},getRecord:function(a,b,c){e.query({claimid:a},
function(a){b(a.data)},function(a){c(a.error)})},getAll:function(a,b){k.query(function(b){a(b.data)},function(a){b(a.error)})},saveClaim:function(a,b,c){n.save(a,function(a){b(a)},function(a){c(a)})},commitClaim:function(a,b,c){h.save(a,function(a){b(a)},function(a){c(a)})},downloadFile:function(a,b,c,e,f){g.query({Id:a,fileId:b,fileIndex:c},function(a){e(a)},function(a){f(a)})},getShareUrl:function(a){return b.APP_ROOT+c.CLAIM_SHARE_ROOT+a},getShareContent:function(a){var b={name:"[\u5927\u5723\u4fdd\u9669]\u7533\u8bf7\u7406\u8d54"};
b.description="\u8bf7\u4e0a\u4f20\u4fdd\u5355[\u4fdd\u5355\u53f7:"+a.policyno+"]\u7406\u8d54\u6240\u9700\u6750\u6599";b.url=this.getShareUrl(a.id);return b}}}]);angular.module("emessage","ionic ngCookies angular.filter monospaced.qrcode app account agreement coupon proposal transaction redirect promotion invoice invHistory claim wechat regression portal templates".split(" ")).constant("urlConfig",{REST_END_POINT:"http://m.baoxian72.com/API",APP_ROOT:"http://m.baoxian72.com"}).constant("accountConstants",{ACCOUNT_TYPE_NORMAL:0,ACCOUNT_TYPE_AGREEMENT:1}).constant("promotionConstants",{ENTRY_POINT_PAY_SUCCESS:"PAY_SUCCESS",BATCH_SOURCE_TYPE_TRANSACTION:"TRANSACTION",
PIC_URL_DEFAULT:"defaultpic",PIC_ROOT:"img/promotion/"}).constant("publicPromotionConstants",{ACTION_COLLECT:"COLLECT",PIC_ROOT:"img/promotion/"}).constant("promotionBackgroundColors",{"16036acd775e970991e0677af90449f4":"#FFF",a3fb6acd775e77af90449f4970991e06:"#FFF",a3fb6acd775e970991e0677af90449f4:"#FFF","16046acd775e970991e0677af90449f4":"#FFF",a3fb6acd775e77af90449f4970991e56:"#FFF"}).constant("couponConstants",{COUPON_TYPE_TRANS:"TRANSACTION",COUPON_TYPE_PRODUCT_VOUCHER:"PRODUCT_VOUCHER",COUPON_TYPE_DISCOUNT_VOUCHER:"DISCOUNT_VOUCHER",
COUPON_TYPE_LIMIT_PRICE:"LIMIT_PRICE",COUPON_STATUS_NOT_USED:0,COUPON_SCOPE_TYPE_AGREEMENT_TYPE:"AGREEMENT_TYPE",COUPON_SCOPE_TYPE_TAG:"TAG",COUPON_SCOPE_CONFIG_USER:"USER",COUPON_SCOPE_CONFIG_PAYGO:"PAYGO"}).constant("invoiceConstants",{HISTORY_STATUS_PROCESSING:1,HISTORY_STATUS_MAILED:7,ITEM_TYPE_TRANSACTION:"TRANSACTION",ITEM_TYPE_CHARGE_RECORD:"CHARGE_RECORD",TYPES:{NORMAL:"\u666e\u901a\u53d1\u7968",VALUE_ADDED_SPECIAL:"\u589e\u503c\u7a0e\u4e13\u7528\u53d1\u7968"},TYPE_NORMAL:"NORMAL"}).constant("eventNames",
{PROPOSAL_SUCCESS:"proposal-suc",INVOICE_APPLY_SUCCESS:"invoice-apply-suc",AGREEMENT_CHARGE_SUCCESS:"agreement-charge-suc",CREDIT_EXCHANGE_SUCCESS:"credit-exchange-suc"}).run(["$ionicPlatform",function(a){a.ready(function(){window.cordova&&window.cordova.plugins.Keyboard&&(cordova.plugins.Keyboard.hideKeyboardAccessoryBar(!0),cordova.plugins.Keyboard.disableScroll(!0));window.StatusBar&&StatusBar.styleDefault()})}]).config(["$stateProvider","$urlRouterProvider","$ionicConfigProvider",function(a,b,
c){a.state("redirect",{url:"/redirect?providerUserId&mobile&xAuthToken&state&detail",templateUrl:"",controller:"redirectCtrl"}).state("promotion",{url:"/promotion/:id",template:"",controller:"PublicPromotionCtrl"}).state("survey",{url:"/survey/:id",template:"",controller:"PublicSurveyCtrl"}).state("app",{url:"/app",templateUrl:"templates/app/menu.html",controller:"AppCtrl"}).state("app.proposal",{url:"/proposal?agreementId",views:{menuContent:{template:'<ion-nav-view name="proposalContent" class="proposal"></ion-nav-view>',
controller:"ProposalCtrl"}}}).state("app.proposal.start",{url:"/start?payCouponId",views:{proposalContent:{templateUrl:"templates/app/proposal.start.html"}}}).state("app.proposal.pay",{url:"/pay",views:{proposalContent:{templateUrl:"templates/app/proposal.pay.html"}}}).state("app.proposal.result",{url:"/result",views:{proposalContent:{templateUrl:"templates/app/proposal.result.html"}}}).state("app.transaction",{url:"/transaction",views:{menuContent:{template:'<ion-nav-view name="transactionContent" class="transaction"></ion-nav-view>',
controller:"TransactionCtrl"}}}).state("app.transaction.list",{url:"/",views:{transactionContent:{templateUrl:"templates/app/transaction.list.html",controller:"TransactionListCtrl"}}}).state("app.transaction.listQQx5",{url:"/qqx5",views:{transactionContent:{templateUrl:"templates/app/transaction.list.qqx5.html",controller:"TransactionListQQx5Ctrl"}}}).state("app.transaction.detail",{url:"/:id",views:{transactionContent:{templateUrl:"templates/app/transaction.detail.html",controller:"TransactionDetailCtrl"}}}).state("app.portal",
{url:"/portal",views:{menuContent:{template:'<ion-nav-view name="portalContent" class="portal"></ion-nav-view>',controller:"PortalCtrl"}}}).state("app.portal.category",{url:"/:id",views:{portalContent:{templateUrl:"templates/app/portal.html",controller:"PortalCategoryCtrl"}}}).state("app.agreement",{url:"/agreement",views:{menuContent:{template:'<ion-nav-view name="agreementContent" class="agreement"></ion-nav-view>',controller:"AgreementCtrl"}}}).state("app.agreement.list",{url:"/?toPropose&paygo&user",
views:{agreementContent:{templateUrl:"templates/app/agreement.list.html"}}}).state("app.agreement.publicDetail",{url:"/public/:id",views:{agreementContent:{templateUrl:"templates/app/agreement.public.detail.html",controller:"AgreementPublicDetailCtrl"}}}).state("app.agreement.detail",{url:"/:id",views:{agreementContent:{templateUrl:"templates/app/agreement.detail.html",controller:"AgreementDetailCtrl"}}}).state("app.agreement.charge",{url:"/charge/:id",views:{agreementContent:{templateUrl:"templates/app/agreement.charge.html",
controller:"AgreementChargeCtrl"}}}).state("app.claim",{url:"/claim/:id",views:{menuContent:{template:'<ion-nav-view name="claimContent" class="claim"></ion-nav-view>',controller:"ClaimCtrl"}}}).state("app.claim.start",{url:"/start/:id",views:{claimContent:{templateUrl:"templates/app/claim.start.html"}}}).state("app.claim.confirm",{url:"/confirm",views:{claimContent:{templateUrl:"templates/app/claim.confirm.html"}}}).state("app.claim.upload",{url:"/:id",views:{claimContent:{templateUrl:"templates/app/claim.upload.html",
controller:"ClaimUploadCtrl"}},params:{id:null,result:null}}).state("app.claim.historylist",{url:"/historylist/:id",views:{claimContent:{templateUrl:"templates/app/claim.detail.list.html",controller:"ClaimHistoryListCtrl"}}}).state("app.claim.list",{url:"/:id",views:{claimContent:{templateUrl:"templates/app/claim.list.html",controller:"ClaimListCtrl"}}}).state("app.claim.result",{url:"/result/:id",views:{claimContent:{templateUrl:"templates/app/claim.result.html"}},params:{id:null,result:null}}).state("app.claimIntro",
{url:"/claimIntro",views:{menuContent:{templateUrl:"templates/app/public.claimIntro.html"}}}).state("app.account",{url:"/account",views:{menuContent:{template:'<ion-nav-view name="accountContent" class="account"></ion-nav-view>',controller:"AccountCtrl"}}}).state("app.account.show",{url:"/",views:{accountContent:{templateUrl:"templates/app/account.html"}}}).state("app.account.salesOrComm",{url:"/salesOrComm",views:{accountContent:{controller:"SalesOrCommCtrl"}}}).state("app.account.community",{url:"/community",
views:{accountContent:{template:'<ion-nav-view name="communityContent" class="community"></ion-nav-view>'}}}).state("app.account.community.invite",{url:"/invite",views:{communityContent:{templateUrl:"templates/app/account.community.invite.html",controller:"CommInviteCtrl"}}}).state("app.account.community.credit",{url:"/credit",views:{communityContent:{templateUrl:"templates/app/account.community.credit.html",controller:"CommCreditCtrl"}}}).state("app.account.community.exchange",{url:"/exchange",views:{communityContent:{templateUrl:"templates/app/account.community.exchange.html",
controller:"CommExchangeCtrl"}}}).state("app.account.sales",{url:"/sales",views:{accountContent:{template:'<ion-nav-view name="salesContent" class="sales"></ion-nav-view>'}}}).state("app.account.sales.credit",{url:"/credit",views:{salesContent:{templateUrl:"templates/app/account.sales.credit.html",controller:"CommCreditCtrl"}}}).state("app.account.sales.invite",{url:"/invite",views:{salesContent:{templateUrl:"templates/app/account.sales.invite.html",controller:"CommInviteCtrl"}}}).state("app.promotion",
{url:"/promotion/:id?sourceType&sourceDetail",views:{menuContent:{templateUrl:"templates/app/promotion.html",controller:"PromotionCtrl"}}}).state("app.coupon",{url:"/coupon",views:{menuContent:{template:'<ion-nav-view name="couponContent" class="coupon"></ion-nav-view>',controller:"CouponCtrl"}}}).state("app.coupon.list",{url:"/",views:{couponContent:{templateUrl:"templates/app/coupon.list.html",controller:"CouponListCtrl"}}}).state("app.coupon.listQQx5",{url:"/qqx5",views:{couponContent:{templateUrl:"templates/app/coupon.list.qqx5.html",
controller:"CouponListQQx5Ctrl"}}}).state("app.invoice",{url:"/invoice",views:{menuContent:{template:'<ion-nav-view name="invoiceContent" class="invoice"></ion-nav-view>',controller:"InvoiceListCtrl"}}}).state("app.invoice.list",{url:"/",views:{invoiceContent:{templateUrl:"templates/app/invoice.list.html"}}}).state("app.invoice.apply",{url:"/apply",views:{invoiceContent:{templateUrl:"templates/app/invoice.apply.html",controller:"InvoiceApplyCtrl"}}}).state("app.invHistory",{url:"/invHistory",views:{menuContent:{template:'<ion-nav-view name="invHistoryContent" class="invHistory"></ion-nav-view>',
controller:"InvHistoryListCtrl"}}}).state("app.invHistory.list",{url:"/",views:{invHistoryContent:{templateUrl:"templates/app/invHistory.list.html"}}}).state("app.invHistory.detail",{url:"/:id",views:{invHistoryContent:{templateUrl:"templates/app/invHistory.detail.html",controller:"InvHistoryDetailCtrl"}}});b.otherwise("/app/portal/");c.views.transition("none");c.backButton.text("\u8fd4\u56de")}]);angular.module("coupon",["coupon.service","wechat","ng-iscroll"]).controller("CouponCtrl",["$scope","$state","$ionicHistory","CouponAPI","$rootScope","$ionicLoading","eventNames","couponConstants",function(a,b,c,f,e,k,n,g){var h=function(){a.coupons=[];a.refresh(function(){k.show({template:"<ion-spinner></ion-spinner>",delay:100})},function(){k.hide()},function(){e.navToIndex()})},d=function(){a.coupons=void 0;a.pageNumber=void 0;a.hasCoupon=void 0;a.initFinish=void 0};a.refresh=function(b,d,c){b();
f.refresh(function(b){a.coupons=b;a.pageNumber=0;a.hasCoupon=!(void 0===a.coupons||0===a.coupons.length);a.initFinish=!0;d()},function(b){a.initFinish=!0;console.log(b);alert("\u5237\u65b0\u5931\u8d25\uff0c\u8bf7\u7a0d\u540e\u518d\u8bd5");d();c()})};a.isTransType=function(a){return a.fullfillType===g.COUPON_TYPE_TRANS};a.isLimitPriceType=function(a){return a.fullfillType===g.COUPON_TYPE_LIMIT_PRICE};a.isVoucherType=function(a){return a.fullfillType===g.COUPON_TYPE_PRODUCT_VOUCHER};a.isDiscountType=
function(a){return a.fullfillType===g.COUPON_TYPE_DISCOUNT_VOUCHER};a.isNotUsed=function(a){return a.status===g.COUPON_STATUS_NOT_USED};a.navToProposal=function(a){if(a.fullfillType===g.COUPON_TYPE_TRANS)b.go("app.proposal.start",{agreementId:a.fullfillConfig,payCouponId:a.id});else{for(var d,c,e,f,l=0;l<a.scopes.length;l++)a.scopes[l].type===g.COUPON_SCOPE_TYPE_AGREEMENT_TYPE?(d=1,c=a.scopes[l].config):a.scopes[l].type===g.COUPON_SCOPE_TYPE_TAG&&a.scopes[l].config===g.COUPON_SCOPE_CONFIG_PAYGO?e=
1:a.scopes[l].type===g.COUPON_SCOPE_TYPE_TAG&&a.scopes[l].config===g.COUPON_SCOPE_CONFIG_USER&&(f=1);1===d?b.go("app.proposal.start",{agreementId:c,payCouponId:a.id}):b.go("app.agreement.list",{toPropose:"1",paygo:e,user:f})}};a.loadNext=function(b){a.canLoadNext()&&f.getPage(a.pageNumber+1,function(d){if(void 0!==d&&0!==d.length){for(var c=0;c<d.length;c++)a.coupons.push(d[c]);a.pageNumber++}b()},function(a){alert(a);b()})};a.canLoadNext=function(){return f.hasMoreToLoad()};h();e.$on("$stateChangeStart",
function(a,b,d,c,e){"app.coupon"!==b.name&&"app.coupon.list"!==b.name&&"app.coupon.detail"!==b.name&&"app.coupon.listQQx5"!==b.name||"app.coupon.detail"===c.name||"app.coupon.list"===c.name||"app.coupon.listQQx5"===c.name||h()});e.$on("event:auth-loginCancelled",function(){d()});e.$on("event:auth-logout-complete",function(){d()})}]).controller("CouponListCtrl",["$scope","$timeout",function(a,b){a.loadMore=function(){console.log("load more");a.$parent.loadNext(function(){a.$broadcast("scroll.infiniteScrollComplete")})};
a.refresh=function(){a.$parent.refresh(function(){},function(){b(function(){a.$broadcast("scroll.refreshComplete")},500)},function(){})};a.canLoadMore=function(){return a.$parent.canLoadNext()}}]).controller("CouponListQQx5Ctrl",["$scope","$rootScope",function(a,b){a.hasNext=function(){return!!(a.$parent.pageNumber>a.page||a.$parent.canLoadNext())};a.hasPrev=function(){return 0<a.page};a.nextPage=function(){a.$parent.pageNumber>a.page?a.page++:a.$parent.canLoadNext()?a.$parent.loadNext(function(){a.$parent.pageNumber>
a.page&&a.page++}):alert("\u5df2\u7ecf\u662f\u6700\u540e\u4e00\u9875")};a.preOrRefreshPage=function(){1<a.page?a.page--:1!==a.page&&0!==a.page||a.refresh()};a.refresh=function(){a.$parent.refresh(function(){},function(){a.page=0},function(){})};a.page=0;b.$on("$stateChangeStart",function(b,f,e,k,n){"app.coupon"!==f.name&&"app.coupon.list"!==f.name&&"app.coupon.detail"!==f.name&&"app.coupon.listQQx5"!==f.name||"app.coupon.detail"===k.name||"app.coupon.list"===k.name||"app.coupon.listQQx5"===k.name||
(a.page=0)})}]);
angular.module("coupon.service",["ngResource"]).service("CouponAPI",["$resource","urlConfig","$rootScope","eventNames",function(a,b,c,f){var e=a(b.REST_END_POINT+"/api/marketing/coupon",{page:"@page",agreementId:"@agreementId"},{query:{method:"GET",isArray:!1,timeout:1E4}},null),k=function(a,b,f,l){e.query({page:a,agreementId:b},function(b){for(var e=[],l=0;l<b.list.length;l++)h[b.list[l].id]=b.list[l],e.push(b.list[l]);0===a&&(d=b.scopeMeta,c.$broadcast("event:coupon-changed",d));console.log("coupon page data init success");
f(e)},function(a){l(a.data.error)})},n=function(a,b){h={};l=0;e.query({page:0},function(b){l=b.metaData.total;for(var e=[],f=0;f<b.list.length;f++)h[b.list[f].id]=b.list[f],e.push(b.list[f]);d=b.scopeMeta;console.log("coupon metaData init success");c.$broadcast("event:coupon-changed",d);a(e)},function(a){b(a.data.error)})},g=function(){h=void 0;d={};l=0;c.$broadcast("event:coupon-changed",d)},h={},d={},l=0;c.$on("event:auth-loginConfirmed",function(){n(function(){},function(){})});c.$on("event:auth-logout-complete",
function(){g()});c.$on(f.PROPOSAL_SUCCESS,function(a,b){n(function(){},function(){})});c.$on(f.CREDIT_EXCHANGE_SUCCESS,function(a,b){n(function(){},function(){})});return{getPage:function(a,b,d){k(a,void 0,b,d)},refresh:function(a,b){n(a,b)},get:function(a){return h[a]},getMetaByScope:function(a,b){return d[a]&&d[a][b]?{total:Number(d[a][b].total),"default":d[a][b]["default"]}:{total:0}},findAllByAgreementId:function(a,b,d){k(void 0,a,b,d)},hasMoreToLoad:function(){return!!(void 0!==h&&0!==Object.keys(h).length&&
Object.keys(h).length<l)},clean:function(){g()}}}]);/*
 HTTP Auth Interceptor Module for AngularJS
 (c) 2012 Witold Szczerba
 License: MIT
*/
(function(){angular.module("http-auth-interceptor",["http-auth-interceptor-buffer"]).factory("authService",["$rootScope","httpBuffer",function(a,b){return{loginConfirmed:function(c,f){var e=f||function(a){return a};a.$broadcast("event:auth-loginConfirmed",c);b.retryAll(e)},loginCancelled:function(c,f){b.rejectAll(f);a.$broadcast("event:auth-loginCancelled",c)}}}]).config(["$httpProvider",function(a){a.interceptors.push(["$rootScope","$q","httpBuffer",function(a,c,f){return{responseError:function(b){if(!b.config.ignoreAuthModule)switch(b.status){case 401:var e=
c.defer();f.append(b.config,e);a.$broadcast("event:auth-loginRequired",b);return e.promise;case 403:return e=c.defer(),f.append(b.config,e),a.$broadcast("event:auth-forbidden",b),e.promise}return c.reject(b)}}}])}]);angular.module("http-auth-interceptor-buffer",[]).factory("httpBuffer",["$injector",function(a){function b(b,c){f=f||a.get("$http");f(b).then(function(a){c.resolve(a)},function(a){c.reject(a)})}var c=[],f;return{append:function(a,b){c.push({config:a,deferred:b})},rejectAll:function(a){if(a)for(var b=
0;b<c.length;++b)c[b].deferred.reject(a);c=[]},retryAll:function(a){for(var e=0;e<c.length;++e)b(a(c[e].config),c[e].deferred);c=[]}}}])})();angular.module("invHistory",["invHistory.service"]).controller("InvHistoryListCtrl",["$scope","$state","$ionicHistory","InvHistoryAPI","$rootScope","$ionicLoading","$timeout","invoiceConstants","eventNames",function(a,b,c,f,e,k,n,g,h){var d=function(){a.invHistories=[];m(function(){k.show({template:"<ion-spinner></ion-spinner>",delay:100})},function(){k.hide()},function(){e.navToIndex()})},l=function(){a.invHistories=void 0;a.hasInvHistory=void 0;a.initFinish=void 0},m=function(b,d,c){b();f.refresh(function(b){a.invHistories=
b;a.hasInvHistory=!(void 0===a.invHistories||0===a.invHistories.length);if(a.hasInvHistory)for(var c in a.invHistories)a.invHistories[c].typeAlias=g.TYPES[a.invHistories[c].type],a.invHistories[c].isValueAdded=a.invHistories[c].type!==g.TYPE_NORMAL;a.initFinish=!0;d()},function(b){a.initFinish=!0;console.log(b);alert("\u5237\u65b0\u5931\u8d25\uff0c\u8bf7\u7a0d\u540e\u518d\u8bd5");d();c()})};a.refresh=function(){m(function(){},function(){n(function(){a.$broadcast("scroll.refreshComplete")},500)},function(){})};
a.isProcessing=function(a){return a.status===g.HISTORY_STATUS_PROCESSING};a.isMailed=function(a){return a.status===g.HISTORY_STATUS_MAILED};d();e.$on("$stateChangeStart",function(a,b,c,e,f){"app.invHistory"!==b.name&&"app.invHistory.list"!==b.name&&"app.invHistory.detail"!==b.name||"app.invHistory.detail"===e.name||"app.invHistory.list"===e.name||d()});e.$on("event:auth-loginCancelled",function(){l()});e.$on("event:auth-logout-complete",function(){l()})}]).controller("InvHistoryDetailCtrl",["$scope",
"$rootScope","$stateParams","InvHistoryAPI",function(a,b,c,f){a.invHistory=f.get(c.id);b.$on("$stateChangeStart",function(b,k,n,g,h){"app.invHistory.detail"===k.name&&(a.invHistory=f.get(c.id))})}]);
angular.module("invHistory.service",["ngResource"]).service("InvHistoryAPI",["$resource","urlConfig",function(a,b){var c=a(b.REST_END_POINT+"/api/invoice/",{},{query:{method:"GET",isArray:!0,timeout:1E4}},null),f=function(a,b){e={};c.query({},function(b){for(var c=[],d=0;d<b.length;d++)e[b[d].id]=b[d],c.push(b[d]);console.log("invoice histories init success");a(c)},function(a){b(a.data.error)})},e={};return{refresh:function(a,b){f(a,b)},get:function(a){return e[a]},clean:function(){e=void 0}}}]);angular.module("invoice",["invoice.service"]).controller("InvoiceListCtrl",["$scope","$state","$ionicHistory","InvoiceAPI","$rootScope","$ionicLoading","eventNames","invoiceConstants",function(a,b,c,f,e,k,n,g){var h=function(){a.invoices=[];a.applyInvoices=[];a.refresh(function(){k.show({template:"<ion-spinner></ion-spinner>",delay:100})},function(){k.hide()},function(){e.navToIndex()})},d=function(){a.invoices=void 0;a.applyInvoices=void 0;a.hasInvoice=void 0;a.initFinish=void 0};a.isChargeRecordType=
function(a){return a.type===g.ITEM_TYPE_CHARGE_RECORD};a.isTransactionType=function(a){return a.type===g.ITEM_TYPE_TRANSACTION};a.refresh=function(b,d,c){b();f.refresh(function(b){a.invoices=b;a.hasInvoice=!(void 0===a.invoices||0===a.invoices.length);if(a.hasInvoice)for(b=0;b<a.invoices.length;b++)a.invoices[b].invoiceTypeAlias=g.TYPES[a.invoices[b].invoiceType];a.initFinish=!0;d()},function(b){a.initFinish=!0;console.log(b);alert("\u5237\u65b0\u5931\u8d25\uff0c\u8bf7\u7a0d\u540e\u518d\u8bd5");d();
c()})};a.calcFee=function(a){var b=0,d;for(d in a)!0===a[d].add&&(b+=a[d].amount);return b};a.calcApplyFee=function(){return a.calcFee(a.invoices)};a.calcApplyNo=function(){var b=0,d;for(d in a.invoices)a.invoices.hasOwnProperty(d)&&!0===a.invoices[d].add&&(b+=1);return b};a.validateInvoices=function(b){var d=b.invoiceType,c=b.title,e=b.companyTaxId,f;for(f in a.invoices)if(a.invoices.hasOwnProperty(f)&&!0===a.invoices[f].add&&(d!==a.invoices[f].invoiceType||c!==a.invoices[f].title||e!==a.invoices[f].companyTaxId)){alert("\u65b0\u6dfb\u52a0\u7684\u5f00\u7968\u9879\u4e0e\u5df2\u9009\u4e2d\u7684\u5f00\u7968\u9879\u4fe1\u606f\u4e0d\u4e00\u81f4\uff0c\u8bf7\u5206\u4e24\u6b21\u5f00\u5177\u3002");
b.add=!1;break}};a.apply=function(){a.applyInvoices=[];for(var d in a.invoices)a.invoices.hasOwnProperty(d)&&!0===a.invoices[d].add&&a.applyInvoices.push(a.invoices[d]);void 0!==a.applyInvoices.length&&0!==a.applyInvoices.length?b.go("^.apply"):alert("\u8bf7\u9009\u62e9\u9700\u8981\u5f00\u5177\u7684\u53d1\u7968")};h();e.$on("$stateChangeStart",function(a,b,d,c,e){"app.invoice"!==b.name&&"app.invoice.list"!==b.name&&"app.invoice.apply"!==b.name||"app.invoice.list"===c.name||"app.invoice.apply"===c.name||
h()});e.$on("event:auth-loginCancelled",function(){d()});e.$on("event:auth-logout-complete",function(){d()});e.$on(n.INVOICE_APPLY_SUCCESS,function(a,b){f.clean();d();h()})}]).controller("InvoiceApplyCtrl",["$scope","InvoiceAPI","$rootScope","$state","$ionicLoading","$ionicHistory","invoiceConstants","eventNames",function(a,b,c,f,e,k,n,g){var h=function(){a.invoice={invoiceType:a.$parent.applyInvoices[0].invoiceType,invoiceTypeAlias:n.TYPES[a.$parent.applyInvoices[0].invoiceType],isValueAdded:a.$parent.applyInvoices[0].invoiceType!==
n.TYPE_NORMAL,title:a.$parent.applyInvoices[0].title,companyTaxId:a.$parent.applyInvoices[0].companyTaxId}};a.calcApplyFee=function(){return a.$parent.calcFee(a.invoices)};a.confirm=function(){if(a.invoice.isValueAdded){if(void 0===a.invoice.companyTaxId||""===a.invoice.companyTaxId){alert("\u8bf7\u8f93\u5165\u7eb3\u7a0e\u4eba\u8bc6\u522b\u53f7");return}if(void 0===a.invoice.companyRegisterAddress||""===a.invoice.companyRegisterAddress){alert("\u8bf7\u8f93\u5165\u4f01\u4e1a\u6ce8\u518c\u5730\u5740");
return}if(void 0===a.invoice.companyRegisterPhone||""===a.invoice.companyRegisterPhone){alert("\u8bf7\u8f93\u5165\u4f01\u4e1a\u6ce8\u518c\u7535\u8bdd");return}if(void 0===a.invoice.companyBankName||""===a.invoice.companyBankName){alert("\u8bf7\u8f93\u5165\u4f01\u4e1a\u5f00\u6237\u94f6\u884c");return}if(void 0===a.invoice.companyBankAccountId||""===a.invoice.companyBankAccountId){alert("\u8bf7\u8f93\u5165\u4f01\u4e1a\u94f6\u884c\u8d26\u53f7");return}}if(void 0===a.invoice.title||""===a.invoice.title)alert("\u8bf7\u8f93\u5165\u53d1\u7968\u62ac\u5934");
else if(void 0===a.invoice.name||""===a.invoice.name)alert("\u8bf7\u8f93\u5165\u6536\u4ef6\u4eba\u59d3\u540d");else if(void 0===a.invoice.phone||""===a.invoice.phone)alert("\u8bf7\u8f93\u5165\u6536\u4ef6\u7535\u8bdd");else if(void 0===a.invoice.address||""===a.invoice.address)alert("\u8bf7\u8f93\u5165\u6536\u4ef6\u5730\u5740");else{var d=[],f;for(f in a.$parent.applyInvoices)d.push(a.$parent.applyInvoices[f].id);a.invoice.items=d;e.show({template:"<ion-spinner></ion-spinner>",delay:100});b.apply(a.invoice,
function(){e.hide();alert("\u53d1\u7968\u5c06\u57287\u4e2a\u5de5\u4f5c\u65e5\u5185\u5bc4\u51fa\uff0c\u8bf7\u8010\u5fc3\u7b49\u5019");c.navToRoot("app.invHistory.list");c.$broadcast(g.INVOICE_APPLY_SUCCESS)},function(a){e.hide();alert(a)})}};h();c.$on("$stateChangeStart",function(a,b,c,e,f){"app.invoice.apply"===b.name&&"app.invoice.apply"!==e.name&&h()});c.$on(g.INVOICE_APPLY_SUCCESS,function(){a.invoice=void 0});c.$on("event:auth-loginCancelled",function(){a.invoice=void 0});c.$on("event:auth-logout-complete",
function(){a.invoice=void 0})}]);
angular.module("invoice.service",[]).service("InvoiceAPI",["$resource","urlConfig",function(a,b){var c=a(b.REST_END_POINT+"/api/invoice/item",{},{query:{method:"GET",isArray:!0,timeout:1E4}},null),f=a(b.REST_END_POINT+"/api/invoice/"),e=function(a,b){c.query({},function(b){for(var d=[],c=0;c<b.length;c++)d.push(b[c]);console.log("invoice init success");a(d)},function(a){b(a.data.error)})},k=function(a,b,c){(new f(a)).$save({},function(a){console.log("apply successful");b(a)},function(a){c(a.data.error)})};
return{apply:function(a,b,c){k(a,b,c)},refresh:function(a,b){e(a,b)},clean:function(){invoices=void 0}}}]);angular.module("portal",["category.service","agreement","common-authentication","coupon"]).controller("PortalCtrl",["$scope","$timeout","$state","$rootScope","$ionicLoading","CategoryAPI","accountConstants","eventNames","AgreementAPI","CouponAPI","CommonAuthenticationService","agreementConstants",function(a,b,c,f,e,k,n,g,h,d,l,m){a.shakeClass="animated infinite shake";var q=[m.AGREEMENT_ID_PAYGO_ZH_LIMIT_PRICE,m.AGREEMENT_ID_PAYGO_LOCAL_JB_LITE,m.AGREEMENT_ID_PAYGO_LOCAL_ZH,m.AGREEMENT_ID_PAYGO_JB_LITE,
m.AGREEMENT_ID_PAYGO_JB,m.AGREEMENT_ID_AUTO_PAYGO,m.AGREEMENT_ID_PAYGO_ZR,m.AGREEMENT_ID_PAYGO_ZH_COLD_CHAIN];(function(){e.show({template:"<ion-spinner></ion-spinner>",delay:100});h.findPublicByIdIn(q,function(c){a.publicAgreements=c;a.isLoggedIn=l.isLoggedIn();a.isLoggedIn&&d.refresh(function(){},function(){});k.findAll(function(d){a.categories=d.category;e.hide();b(function(){a.shakeClass=""},3E3)},function(d){b(function(){a.shakeClass=""},3E3);alert("\u670d\u52a1\u5668\u672a\u54cd\u5e94\uff0c\u83b7\u53d6\u54c1\u7c7b\u4fe1\u606f\u5931\u8d25\uff0c\u8bf7\u8054\u7cfb\u7ba1\u7406\u5458\u8bf4\u7a0d\u540e\u518d\u8bd5")})},
function(d){e.hide();b(function(){a.shakeClass=""},3E3);alert("\u670d\u52a1\u5668\u672a\u54cd\u5e94\uff0c\u83b7\u53d6\u4ea7\u54c1\u4fe1\u606f\u5931\u8d25\uff0c\u8bf7\u8054\u7cfb\u7ba1\u7406\u5458\u8bf4\u7a0d\u540e\u518d\u8bd5")})})();f.$on("event:auth-loginConfirmed",function(){a.isLoggedIn=l.isLoggedIn()});f.$on("event:auth-logout-complete",function(){a.isLoggedIn=l.isLoggedIn()});f.$on("event:coupon-changed",function(){console.log("refreshCouponMeta");for(var b in a.publicAgreements){var c=a.publicAgreements[b],
e=d.getMetaByScope("TAG",c.couponTag),c=d.getMetaByScope("AGREEMENT_TYPE",c.type);a.publicAgreements[b].couponMeta={total:(e.total?e.total:0)+(c.total?c.total:0)}}})}]).controller("PortalCategoryCtrl",["$scope","$stateParams",function(a,b){""===b.id?(a.showCategory=!0,a.showQuickIcons=!0,a.rootCategory=!0):(console.log(b.id+" category"),a.categoryId=b.id)}]);
angular.module("category.service",["ngResource"]).service("CategoryAPI",["$resource","urlConfig",function(a,b){var c,f=a(b.REST_END_POINT+"/api/public/category",null,{query:{method:"GET",isArray:!1,timeout:1E4}},null);return{findAll:function(a,b){void 0===c?f.query({},function(b){c=b;a(c)},b):a(c)}}}]);angular.module("promotion",["account.service","agreement.service","promotion.service","wechat.service"]).controller("PromotionCtrl",["$scope","$rootScope","PromotionAPI","promotionConstants","promotionBackgroundColors","$ionicLoading","$ionicHistory","$state","Wechat",function(a,b,c,f,e,k,n,g,h){var d=function(d,h,g){k.show({template:"<ion-spinner></ion-spinner>",delay:100});c.get(d,function(b){a.promotion=b;a.backStyle=void 0!==e[a.promotion.fromPicId]?{"background-color":e[a.promotion.fromPicId]}:
{"background-color":"#FFF"};a.promotion.fromPicUrl=f.PIC_ROOT+a.promotion.fromPicId+"_from.jpg";l(a.promotion.id,h,g)},function(a){k.hide();alert("\u672a\u627e\u5230\u4f18\u60e0\u6d3b\u52a8");b.navToIndex()})},l=function(d,e,f){c.newBatch(d,e,f,function(b){k.hide();a.batch=b.batch;a.gifts=b.gifts;void 0!==a.gifts&&void 0!==a.gifts[0]&&alert("\u611f\u8c22\u53c2\u4e0e\u6d3b\u52a8\uff0c\u5956\u52b1\u5df2\u653e\u5165\u8d26\u6237");h.hookShareTimelineOnly(!0,c.convertBatchToContent(a.batch),function(){m(a.promotion.id,
a.batch.id)},function(a){alert(a)})},function(a){k.hide();alert(a);b.navToIndex()})},m=function(d,e){k.show({template:"<ion-spinner></ion-spinner>",delay:100});c.shareAction(d,e,function(d){k.hide();a.gifts=d.gifts;void 0===a.gifts||void 0===a.gifts[0]?alert("\u6210\u529f\u5206\u4eab"):alert("\u6210\u529f\u5206\u4eab\uff0c\u5956\u52b1\u5df2\u653e\u5165\u8d26\u6237");b.navToIndex()},function(a){k.hide();alert(a);b.navToIndex()})};d(g.params.id,g.params.sourceType,g.params.sourceDetail);a.shareSuccess=
function(){m(a.promotion.id,a.batch.id)};b.$on("$stateChangeStart",function(a,b,c,e,f){"app.promotion"===b.name&&d(c.id,c.sourceType,c.sourceDetail)});b.$on("event:auth-loginCancelled",function(){a.promotion=void 0});b.$on("event:auth-logout-complete",function(){a.promotion=void 0})}]);
angular.module("promotion.service",["ngResource","wechat"]).service("PromotionAPI",["$resource","urlConfig","promotionConstants","wechatConstants",function(a,b,c,f){var e=a(b.REST_END_POINT+"/api/marketing/promotion/:id",{id:"@id",entryPoint:"@entryPoint"},{getPaySuc:{method:"GET",isArray:!0,params:{entryPoint:c.ENTRY_POINT_PAY_SUCCESS}},get:{method:"GET",isArray:!1},action:{method:"POST",isArray:!1}},null),k=a(b.REST_END_POINT+"/api/marketing/promotion/:id/batch/:batchId",{id:"@id",batchId:"@batchId",
sourceType:"@sourceType",sourceDetail:"@sourceDetail",action:"@action"},{"new":{method:"POST",isArray:!1},action:{method:"POST",isArray:!1}}),n=a(b.REST_END_POINT+"/api/public/marketing/promotion/:batchId/",{batchId:"@batchId"}),g,h={};return{getPaySucPromotion:function(a,b){void 0===g?e.getPaySuc({},function(b){g=b[0];a(g)},function(a){b(a)}):a(g)},getPublicBatch:function(a,b,c){n.get({batchId:a},function(a){b(a)},function(a){c(a)})},get:function(a,b,c){void 0===h[a]?e.get({id:a},function(d){h[a]=
d;b(h[a])},function(a){c(a)}):b(h[a])},newBatch:function(a,b,c,e,f){k["new"]({id:a,sourceType:b,sourceDetail:c},function(a){console.log("batch created received");e(a)},function(a){console.log("failed because: "+a.data.error);f(a.data.error)})},shareAction:function(a,b,c,e){k.action({id:a,batchId:b,action:"FROM_SHARE"},function(a){console.log("share success");c(a)},function(a){console.log("failed because: "+a.data.error);e(a.data.error)})},getShareUrl:function(a){return b.REST_END_POINT+f.PROMOTION_SHARE_ROOT+
a},convertBatchToContent:function(a){var b={};b.name=a.toTitle;b.description=a.toDescription;b.url=this.getShareUrl(a.id);return b}}}]);angular.module("proposal","proposal.service account.service promotion.service coupon.service wechat agreement".split(" ")).controller("ProposalCtrl",["$rootScope","$scope","AgreementAPI","AccountAPI","CouponAPI","Proposal","PromotionAPI","$state","$stateParams","$ionicHistory","$ionicLoading","agreementConstants","promotionConstants","eventNames","Wechat","$ionicActionSheet","$ionicModal",function(a,b,c,f,e,k,n,g,h,d,l,m,q,u,w,x,t){var r=function(d,e){l.show({template:"<ion-spinner></ion-spinner>",
delay:100});console.log("Initializing proposal");c.getProposal(d,function(a){b.agreement=a;b.canSetRoutePreset=b.agreement.routePreset===m.AGREEMENT_ROUTE_PRESET_BOTH;b.canSetRouteNoPreset=b.agreement.routePreset===m.AGREEMENT_ROUTE_PRESET_NONE;b.canSetRouteStartEndEqual=b.agreement.routePreset===m.AGREEMENT_ROUTE_PRESET_EQUAL;b.canSetPublicRouteStartEndDetail=b.agreement.routePreset===m.AGREEMENT_ROUTE_PRESET_DISTANCE&&b.agreement.type!==m.AGREEMENT_TYPE_USER;b.canSetPrivateRouteStartEndDetail=b.agreement.routePreset===
m.AGREEMENT_ROUTE_PRESET_DISTANCE&&b.agreement.type===m.AGREEMENT_TYPE_USER;b.proposal=k.init(b.agreement);void 0!==e&&(b.proposal.payCouponId=e);l.hide()},function(b){console.log("error intializing proposal, by: "+b);l.hide();alert("\u670d\u52a1\u5668\u672a\u54cd\u5e94\uff0c\u83b7\u53d6\u534f\u8bae\u5931\u8d25\uff0c\u8bf7\u7a0d\u540e\u518d\u8bd5");a.navToIndex()})},v={name:"\u4e0d\u4f7f\u7528"},B=function(){l.show({template:"<ion-spinner></ion-spinner>",delay:100});f.getAccount(function(a){b.account=
a;b.canPayCredit=-1<b.agreement.payMethods.indexOf(m.PAY_METHOD_CREDIT);b.canPayAlipay=!1;b.canPayWxpay=-1<b.agreement.payMethods.indexOf(m.PAY_METHOD_H5);b.canPayCoupon=-1<b.agreement.payMethods.indexOf(m.PAY_METHOD_COUPON);b.canPaySimulate=-1<b.agreement.payMethods.indexOf(m.PAY_METHOD_SIMULATE);b.canShowInvoice=b.canPayWxpay;b.isUserAgreementUseWxpay=b.canPayWxpay&&b.agreement.type===m.AGREEMENT_TYPE_USER;b.account.invoiceSetting&&(b.proposal.companyTaxId=b.account.invoiceSetting.companyTaxId);
e.findAllByAgreementId(b.agreement.id,function(a){b.optionalCoupons=a;b.optionalCoupons.unshift(v);b.proposal.optionalCoupon=1!==b.optionalCoupons.length?b.optionalCoupons[1]:b.optionalCoupons[0];b.calcfee(b.proposal);l.hide();g.go("^.pay")},function(a){l.hide();alert("\u670d\u52a1\u5668\u672a\u54cd\u5e94\uff0c\u83b7\u53d6\u652f\u4ed8\u4fe1\u606f\u5931\u8d25\uff0c\u8bf7\u7a0d\u540e\u518d\u8bd5")})},function(a){console.log("error getting account, by: "+a);l.hide();alert("\u670d\u52a1\u5668\u672a\u54cd\u5e94\uff0c\u83b7\u53d6\u652f\u4ed8\u4fe1\u606f\u5931\u8d25\uff0c\u8bf7\u7a0d\u540e\u518d\u8bd5")})},
p=function(c){b.success=c.success;b.orderId=c.orderId;b.proposalNo=c.proposalNo;g.params.agreementId!==m.AGREEMENT_ID_SIMULATE?n.getPaySucPromotion(function(c){l.hide();b.promotion=c;a.navToRoot("^.result")},function(b){console.log("No Pay Success Promotion found");l.hide();a.navToRoot("^.result")}):(console.log("No showing pay Success Promotion"),l.hide(),a.navToRoot("^.result"))},y=function(){l.show({template:"<ion-spinner></ion-spinner>",delay:100});k.preOrder(b.proposal,function(a){console.log("pre order succeed");
C(a)},function(a){l.hide();console.log("pre order error, by: ",a.data.error);alert(a.data.error)})},C=function(a){b.proposal.orderId=a.orderId;a.payProvider===m.PAY_PROVIDER_WX&&a.paymentResponse?w.doWxPay(a.paymentResponse,function(){z(a)},function(){l.hide();alert("\u652f\u4ed8\u5931\u8d25")}):z(a)},z=function(c){c.payProvider===m.PAY_PROVIDER_WX&&c.paymentResponse?(b.error=void 0,console.log("save transaction successfull"),a.$broadcast(u.PROPOSAL_SUCCESS,c),p(c)):k.finishOrder(b.proposal.orderId,
function(c){b.error=void 0;console.log("save transaction successfull");a.$broadcast(u.PROPOSAL_SUCCESS,c);p(c)},function(c){l.hide();console.log("save transaction failed, error:"+c.data.error);b.error=c.data.error;a.navToRoot("^.result")})},A=function(a){a=k.calcFeeDistance(a,function(a){success(a)},function(a){alert("\u83b7\u53d6\u91cc\u7a0b\u6570\u636e\u5931\u8d25\u8bf7\u7a0d\u540e\u518d\u8bd5\u3002")})};console.log("reloading");r(g.params.agreementId,g.params.payCouponId);b.calcfee=function(a){k.calcfee(a)};
b.showGoods=function(){for(var a=[],c=0;c<b.agreement.goods.length;c++)a[c]={text:"<div>"+b.agreement.goods[c].name+"  \u52a0\u8d39\u7387:"+b.agreement.goods[c].baseFee+"%</div><p>"+b.agreement.goods[c].remark+"</p>"};x.show({buttons:a,buttonClicked:function(a){b.proposal.goods=b.agreement.goods[a];b.calcfee(b.proposal);return!0}})};b.canShowCurFee=function(){return g.params.agreementId!==m.AGREEMENT_ID_SIGNUP_COUPON&&g.params.agreementId!==m.AGREEMENT_ID_COUPON_TRANSACTION_25&&g.params.agreementId!==
m.AGREEMENT_ID_AUTO_PAYGO&&g.params.agreementId!==m.AGREEMENT_ID_PAYGO_LOCAL_ZH&&g.params.agreementId!==m.AGREEMENT_ID_PAYGO_JB&&g.params.agreementId!==m.AGREEMENT_ID_PAYGO_JB_LIMIT_PRICE&&g.params.agreementId!==m.AGREEMENT_ID_PAYGO_LOCAL_JB_LITE&&g.params.agreementId!==m.AGREEMENT_ID_PAYGO_JB_LITE&&g.params.agreementId!==m.AGREEMENT_ID_PAYGO_ZR&&g.params.agreementId!==m.AGREEMENT_ID_PAYGO_ZH_COLD_CHAIN&&g.params.agreementId!==m.AGREEMENT_ID_PAYGO_ZH_LIMIT_PRICE};b.canShowSubTotal=function(){return g.params.agreementId!==
m.AGREEMENT_ID_SIGNUP_COUPON&&g.params.agreementId!==m.AGREEMENT_ID_COUPON_TRANSACTION_25};b.canShowCoupon=function(){return g.params.agreementId!==m.AGREEMENT_ID_SIGNUP_COUPON&&g.params.agreementId!==m.AGREEMENT_ID_COUPON_TRANSACTION_25&&g.params.agreementId!==m.AGREEMENT_ID_PAYGO_JB_LIMIT_PRICE&&g.params.agreementId!==m.AGREEMENT_ID_PAYGO_ZH_LIMIT_PRICE};b.couponDesc=function(a){return void 0!==a.expireAt?a.name+" "+a.expireAt+"\u5230\u671f":a.name};b.canShowTaxId=function(){return b.proposal.invoiceType!==
m.INVOICE_TYPE_NORMAL};b.confirm=function(){b.agreement.type!==m.AGREEMENT_TYPE_USER?(console.log("checking dxt public agreement"),t.fromTemplateUrl("templates/app/public.doc.proposal.html",{scope:b}).then(function(b){a.docProposalModal=b;a.docProposalModal.show();a.docProposalIscroll=new IScroll("#proposal-doc .i-scroll .wrapper",{})})):(console.log("confirmed, going to pay"),B())};b.acceptDoc=function(){a.docProposalModal.hide();a.docProposalIscroll.destroy();a.docProposalModal.remove();console.log("confirmed, going to pay");
B()};b.rejectDoc=function(){a.docProposalModal.hide();a.docProposalIscroll.destroy();a.docProposalModal.remove()};b.creditPay=function(){b.proposal.payProvider=m.PAY_PROVIDER_CREDIT;y()};b.aliPay=function(){b.proposal.payProvider=m.PAY_PROVIDER_ALI;alert("\u7531\u4e8e\u5fae\u4fe1\u5e73\u53f0\u5c4f\u853d\u652f\u4ed8\u5b9d\uff0c\u6682\u4e0d\u652f\u6301\u652f\u4ed8\u5b9d\u4ed8\u6b3e")};b.wxPay=function(){void 0===w.getOpenId()?alert("\u672a\u68c0\u6d4b\u5230\u5fae\u4fe1\u652f\u4ed8\u73af\u5883\uff0c\u8bf7\u5728\u5fae\u4fe1\u516c\u4f17\u53f7\u4e2d\u64cd\u4f5c"):
(b.proposal.buyerId=w.getOpenId(),b.proposal.payProvider=m.PAY_PROVIDER_WX,y())};b.couponPay=function(){b.proposal.payProvider=m.PAY_PROVIDER_COUPON;y()};b.simulatePay=function(){b.proposal.payProvider=m.PAY_PROVIDER_SIMULATE;y()};b.navToPromotion=function(){d.nextViewOptions({historyRoot:!0});g.go("app.promotion",{id:b.promotion.id,sourceType:q.BATCH_SOURCE_TYPE_TRANSACTION,sourceDetail:b.proposal.orderId})};b.changeStartProvince=function(a){a.routeStart=a.routeStartProvince.politicalCitys[0];A(a)};
b.changeEndProvince=function(a){a.routeEnd=a.routeEndProvince.politicalCitys[0];A(a)};b.changeStartCity=function(a){A(a)};b.changeEndCity=function(a){A(a)};a.$on("event:auth-logout-complete",function(){b.agreement=void 0;b.proposal=void 0;b.optionalCoupons=void 0;b.error=void 0});a.$on("$stateChangeStart",function(a,b,c,d,e){"app.proposal.start"===b.name&&"app.proposal.pay"!==d.name&&"app.proposal.result"!==d.name&&r(c.agreementId,c.payCouponId)})}]);
angular.module("proposal.service",["ngResource"]).service("Proposal",["$resource","urlConfig","agreementConstants","couponConstants",function(a,b,c,f){var e=a(b.REST_END_POINT+"/api/order/transaction"),k=a(b.REST_END_POINT+"/api/order/:id/finish",{id:"@id"},{finish:{method:"POST",isArray:!1,timeout:6E4}}),n=a(b.REST_END_POINT+"/api/public/distance",{routeStart:"@routeStart",routeEnd:"@routeEnd"},{get:{method:"GET",isArray:!1,timeout:6E4}}),g=function(a){var b=a.agreement.routeAdjust,d=1;a.agreement.canChooseTheft&&
a.theftInsure&&(d=a.agreement.productDqRate);var e=a.goods.baseFee/100+1,h=a.route.baseRate/100,g=a.agreement.discountRate/100;-1<a.agreement.payMethods.indexOf(c.PAY_METHOD_H5)&&a.agreement.type===c.AGREEMENT_TYPE_USER&&a.theftInsure?a.listPrice=Math.round(a.coverage.basefee*e*h*b)+50:a.listPrice=Math.round(a.coverage.basefee*e*h*b*d);a.feeNoCoupon=Math.round(a.listPrice*g);void 0!==a.optionalCoupon&&void 0!==a.optionalCoupon.fullfillType?a.optionalCoupon.fullfillType===f.COUPON_TYPE_PRODUCT_VOUCHER?
(a.fee=a.feeNoCoupon-a.optionalCoupon.fullfillConfig,a.optionalCouponId=a.optionalCoupon.id):a.optionalCoupon.fullfillType===f.COUPON_TYPE_LIMIT_PRICE?(a.fee=a.optionalCoupon.fullfillConfig,a.optionalCouponId=a.optionalCoupon.id):a.optionalCoupon.fullfillType===f.COUPON_TYPE_DISCOUNT_VOUCHER&&(a.fee=Math.round(a.optionalCoupon.fullfillConfig/100*a.feeNoCoupon),a.optionalCouponId=a.optionalCoupon.id):(a.fee=a.feeNoCoupon,a.optionalCouponId=void 0)},h=function(a){a.agreement.routePreset===c.AGREEMENT_ROUTE_PRESET_EQUAL&&
(a.routeEnd=a.routeStart);if(a.agreement.routePreset===c.AGREEMENT_ROUTE_PRESET_EQUAL||a.agreement.routePreset===c.AGREEMENT_ROUTE_PRESET_NONE)a.route.name=a.routeStart.name+"\u2014"+a.routeEnd.name,a.route.baseRate=a.routeStart.defaultRouteFeeRate>a.routeEnd.defaultRouteFeeRate?a.routeStart.defaultRouteFeeRate:a.routeEnd.defaultRouteFeeRate;a.agreement.routePreset===c.AGREEMENT_ROUTE_PRESET_DISTANCE&&(a.route.name=a.routeStart.name+"\u2014"+a.routeEnd.name,a.route.baseRate=100)};return{init:function(a){var b=
{};b.agreement=a;b.isZh=a.type===c.AGREEMENT_ID_SIGNUP_COUPON||a.type===c.AGREEMENT_ID_SIMULATE||a.type===c.AGREEMENT_ID_AUTO_PAYGO||a.type===c.AGREEMENT_ID_PAYGO_LOCAL_ZH||a.type===c.AGREEMENT_ID_PAYGO_ZH_COLD_CHAIN||a.type===c.AGREEMENT_ID_PAYGO_ZH_LIMIT_PRICE;b.isZR=a.type===c.AGREEMENT_ID_PAYGO_ZR;b.goods=a.goods[0];a.routePreset===c.AGREEMENT_ROUTE_PRESET_BOTH?b.route=a.routes[0]:a.routePreset===c.AGREEMENT_ROUTE_PRESET_DISTANCE?(a.type===c.AGREEMENT_ID_PAYGO_ZR&&(b.routeStartProvince=a.divisions[0],
b.routeEndProvince=a.divisions[0],b.routeStartCity=b.routeStartProvince.politicalCitys[0],b.routeEndCity=b.routeEndProvince.politicalCitys[0],b.routeStart=b.routeStartProvince.politicalCitys[0],b.routeEnd=b.routeEndProvince.politicalCitys[0],b.route={}),a.type===c.AGREEMENT_TYPE_USER&&(a.invoiceTypes=c.INVOICE_TYPES,b.routeStartProvince=a.divisions[0],b.routeEndProvince=a.divisions[0],b.routeStartCity=b.routeStartProvince.politicalCitys[0],b.routeEndCity=b.routeEndProvince.politicalCitys[0],b.routeStart=
b.routeStartProvince.politicalCitys[0],b.routeEnd=b.routeEndProvince.politicalCitys[0],b.route={})):(b.routeStart=a.divisions[0],b.routeEnd=a.divisions[0],b.route={});b.coverage=a.coverages[0];a.canChooseTheft&&(b.theftInsure=!1);b.invoiceType=c.INVOICE_TYPE_NORMAL;b.agreement.routePreset===c.AGREEMENT_ROUTE_PRESET_DISTANCE?(b.routeDistanceFees=a.routeDistanceFees,this.calcFeeDistance(b,null,null)):this.calcfee(b);return b},calcfee:function(a){h(a);g(a)},save:function(a,b,c){a=new e(a);a.$save({},
b,c);return a},preOrder:function(a,b,c){(new e(a)).$save({},function(a){b(a)},function(a){c(a)})},finishOrder:function(a,b,c){k.finish({id:a},function(a){b(a)},function(a){c(a)})},calcFeeDistance:function(a,b,e){a.agreement.routePreset===c.AGREEMENT_ROUTE_PRESET_DISTANCE&&(new n).$save({routeStart:a.routeStart.name,routeEnd:a.routeEnd.name},function(b){a.routeDistance=b.distance;b=[];for(var c=0,d=0;d<a.agreement.coverages.length;d++)for(var e=a.agreement.coverages[d],f=e.value,r=0;r<a.routeDistanceFees.length;r++){var v=
a.routeDistanceFees[r];f==v.value&&a.routeDistance>v.distanceStart&&a.routeDistance<=v.distanceEnd&&(e.basefee=v.fee,b[c++]=e)}a.distanceCoverages=b;a.coverage=b[0];h(a);g(a)},function(a){e(a)})},doWxPay:function(a,b,c){function d(){WeixinJSBridge.invoke("getBrandWCPayRequest",{appId:a.appId,timeStamp:a.timeStamp,nonceStr:a.nonceStr,"package":a.packagePrepayId,signType:a.signType,paySign:a.paySign},function(a){"get_brand_wcpay_request:ok"==a.err_msg?b():(alert(a.err_msg),c())})}"undefined"==typeof WeixinJSBridge?
document.addEventListener?document.addEventListener("WeixinJSBridgeReady",d,!1):document.attachEvent&&(document.attachEvent("WeixinJSBridgeReady",d),document.attachEvent("onWeixinJSBridgeReady",d)):d()}}}]);angular.module("redirect",["account.service","wechat","agreement"]).controller("redirectCtrl",["$stateParams","$state","$ionicHistory","agreementConstants","CommonAuthenticationService","Wechat",function(a,b,c,f,e,k){var n=!!k.isQQBrowser();void 0!==a.providerUserId&&"null"!==a.providerUserId&&k.setOpenId(a.providerUserId);void 0!=a.xAuthToken&&(e.setXAuthToken(a.xAuthToken),e.setMobile(a.mobile));c.nextViewOptions({historyRoot:!0});"agreements"===a.state?b.go("app.agreement.list",{toPropose:"0",
paygo:"0",user:"1"}):"agreementsToPropose"===a.state?b.go("app.agreement.list",{toPropose:"1",paygo:"0",user:"1"}):"coupons"===a.state?!0===n?b.go("app.coupon.listQQx5"):b.go("app.coupon.list"):"account"===a.state?b.go("app.account.show"):"transactions"===a.state?!0===n?b.go("app.transaction.listQQx5"):b.go("app.transaction.list"):"simulate"===a.state?b.go("app.proposal.start",{agreementId:f.AGREEMENT_ID_SIMULATE}):"dxk"===a.state?b.go("app.account.salesOrComm"):b.go("app.portal.category")}]);angular.module("regression",["wechat"]).controller("PublicPromotionCtrl",["$stateParams","$state","urlConfig","wechatConstants",function(a,b,c,f){window.location.replace(c.REST_END_POINT+f.PROMOTION_SHARE_ROOT+a.id)}]).controller("PublicSurveyCtrl",["$stateParams","$state","urlConfig","wechatConstants",function(a,b,c,f){window.location.replace(c.REST_END_POINT+f.SURVEY_SHARE_ROOT+a.id)}]);angular.module("transaction",["transaction.service","wechat","ng-iscroll","account.service","agreement"]).controller("TransactionCtrl",["$scope","$state","$ionicHistory","TransAPI","$rootScope","$ionicLoading","eventNames","agreementConstants",function(a,b,c,f,e,k,n,g){var h=function(){a.transactions=[];a.refresh(function(){k.show({template:"<ion-spinner></ion-spinner>",delay:100})},function(){k.hide()},function(){e.navToIndex()})},d=function(){a.transactions=void 0;a.pageNumber=void 0;a.hasTransaction=
void 0;a.initFinish=void 0};a.refresh=function(b,c,d){b();f.refresh(function(b){a.transactions=b;a.pageNumber=0;a.hasTransaction=!(void 0===a.transactions||0===a.transactions.length);a.initFinish=!0;c()},function(b){a.initFinish=!0;console.log(b);alert("\u5237\u65b0\u5931\u8d25\uff0c\u8bf7\u7a0d\u540e\u518d\u8bd5");c();d()})};a.loadNext=function(b){a.canLoadNext()&&f.getPage(a.pageNumber+1,function(c){if(void 0!==c&&0!==c.length){for(var d=0;d<c.length;d++)a.transactions.push(c[d]);a.pageNumber++}b()},
function(a){alert(a);b()})};a.canLoadNext=function(){return f.hasMoreToLoad()};a.isSimulate=function(a){return a.productName===g.PRODUCT_NAME_SIMULATE};h();e.$on("$stateChangeStart",function(a,b,c,d,e){"app.transaction"!==b.name&&"app.transaction.list"!==b.name&&"app.transaction.detail"!==b.name&&"app.transaction.listQQx5"!==b.name||"app.transaction.detail"===d.name||"app.transaction.list"===d.name||"app.transaction.listQQx5"===d.name||h()});e.$on("event:auth-loginCancelled",function(){d()});e.$on("event:auth-logout-complete",
function(){d()});e.$on(n.PROPOSAL_SUCCESS,function(a,b){f.clean()})}]).controller("TransactionListCtrl",["$scope","$timeout",function(a,b){a.loadMore=function(){console.log("load more");a.$parent.loadNext(function(){a.$broadcast("scroll.infiniteScrollComplete")})};a.refresh=function(){a.$parent.refresh(function(){},function(){b(function(){a.$broadcast("scroll.refreshComplete")},500)},function(){})};a.canLoadMore=function(){return a.$parent.canLoadNext()}}]).controller("TransactionListQQx5Ctrl",["$scope",
"$rootScope",function(a,b){a.hasNext=function(){return!!(a.$parent.pageNumber>a.page||a.$parent.canLoadNext())};a.hasPrev=function(){return 0<a.page};a.nextPage=function(){a.$parent.pageNumber>a.page?a.page++:a.$parent.canLoadNext()?a.$parent.loadNext(function(){a.$parent.pageNumber>a.page&&a.page++}):alert("\u5df2\u7ecf\u662f\u6700\u540e\u4e00\u9875")};a.preOrRefreshPage=function(){1<a.page?a.page--:1!==a.page&&0!==a.page||a.refresh()};a.refresh=function(){a.$parent.refresh(function(){},function(){a.page=
0},function(){})};a.page=0;b.$on("$stateChangeStart",function(b,f,e,k,n){"app.transaction"!==f.name&&"app.transaction.list"!==f.name&&"app.transaction.detail"!==f.name&&"app.transaction.listQQx5"!==f.name||"app.transaction.detail"===k.name||"app.transaction.list"===k.name||"app.transaction.listQQx5"===k.name||(a.page=0)})}]).controller("TransactionDetailCtrl",["$scope","$stateParams","TransAPI","AccountAPI","$ionicPopup","$ionicLoading",function(a,b,c,f,e,k){a.transaction=c.get(b.id);(function(){f.getAccount(function(b){a.account=
b},function(a){console.log(a)})})();var n=function(a,b,c){e.alert({title:a,template:b,okText:c})};a.NoEPolicy=function(a){n("\u4ea4\u6613\u672a\u5b8c\u6210","<p>\u5f53\u524d\u4ea4\u6613\u672a\u5b8c\u6210\uff0c\u65e0\u6cd5\u83b7\u53d6\u7535\u5b50\u4fdd\u5355</p>","\u786e\u8ba4")};a.sendEmail=function(b){a.data={};a.data.email=a.account.email;e.show({template:'<form name="ePolicyForm" ><input name="email" type="email" ng-model="data.email" required/> <p class="assertive" ng-show="ePolicyForm.email.$invalid">\u90ae\u7bb1\u5730\u5740\u683c\u5f0f\u9519\u8bef</p>  </form>',
title:"\u53d1\u9001\u7535\u5b50\u4fdd\u5355",subTitle:"\u7535\u5b50\u4fdd\u5355\u5c06\u53d1\u9001\u5230\u4e0b\u65b9\u7535\u5b50\u90ae\u7bb1\u4e2d",scope:a,buttons:[{text:"\u53d6\u6d88"},{text:"<b>\u53d1\u9001</b>",type:"button-positive",onTap:function(e){a.data.email?(k.show({template:"<ion-spinner></ion-spinner>",delay:100}),a.account.email=a.data.email,c.sendEmail(b,a.data.email,function(a){k.hide();n("\u7535\u5b50\u4fdd\u5355\u53d1\u9001\u6210\u529f","<p>\u7535\u5b50\u4fdd\u5355\u5df2\u7ecf\u6210\u529f\u53d1\u9001\u5230\u60a8\u7684\u7535\u5b50\u90ae\u7bb1\uff01</p>",
"\u786e\u8ba4")},function(b){k.hide();a.initFinish=!0;console.log(b);n("\u7535\u5b50\u4fdd\u5355\u53d1\u9001\u5931\u8d25","<p>"+b+"</p>","\u786e\u8ba4");after();failOver()})):e.preventDefault()}}]})}}]);
angular.module("transaction.service",["ngResource"]).service("TransAPI",["$resource","urlConfig",function(a,b){var c=a(b.REST_END_POINT+"/api/transaction",{page:"@page"},{query:{method:"GET",isArray:!1,timeout:1E4}},null),f=a(b.REST_END_POINT+"/api/transaction/:id/email",{id:"@id",email:"@email"},{send:{method:"POST",isArray:!1,timeout:1E4}},null),e=function(a,b,e){c.query({page:a},function(a){for(var c=[],d=0;d<a.list.length;d++)g[a.list[d].id]=a.list[d],c.push(a.list[d]);console.log("transaction page init success");
b(c)},function(a){e(a.data.error)})},k=function(a,b,c,e){f.send({id:a,email:b},function(a){console.log("transaction page init success");c(a)},function(a){e(a.data.error)})},n=function(a,b){g={};h=0;c.query({page:0},function(b){h=b.metaData.total;for(var c=[],d=0;d<b.list.length;d++)g[b.list[d].id]=b.list[d],c.push(b.list[d]);console.log("transaction metaData init success");a(c)},function(a){b(a.data.error)})},g={},h=0;return{getPage:function(a,b,c){e(a,b,c)},refresh:function(a,b){n(a,b)},get:function(a){return g[a]},
sendEmail:function(a,b,c,e){return k(a,b,c,e)},hasMoreToLoad:function(){return!!(void 0!==g&&0!==Object.keys(g).length&&Object.keys(g).length<h)},clean:function(){g=void 0;h=0}}}]);angular.module("common-authentication",["wechat"]).service("CommonAuthenticationService",["$resource","$rootScope","$http","urlConfig","Wechat",function(a,b,c,f,e){var k=a(f.REST_END_POINT+"/sso/userCanRegister/:id",{id:"@id"},{check:{method:"GET",isArray:!1}},null),n=function(a){c.defaults.headers.common["x-auth-token"]=a},g=function(a,b,g,k,u){var d=e.getOpenId();void 0===d&&(d="");void 0==g&&(g="");c.post(f.REST_END_POINT+"/auth","mobile="+a+"&validationCode="+b+"&invitationCode="+g+"&providerUserId="+
d,{ignoreAuthModule:!0,headers:{"Content-Type":"application/x-www-form-urlencoded"}}).success(function(a,b,c,d){n(a.xAuthToken);h=a.mobile;k(a)}).error(function(a,b,c,d){u(a.error)})},h;return{isLoggedIn:function(){return void 0!==c.defaults.headers.common["x-auth-token"]},exist:function(a,b,c){k.check({id:a},b,c)},auth:function(a,b,c,e,f){g(a,b,c,e,f)},quit:function(a){c.post(f.REST_END_POINT+"/sso/quit",{},{ignoreAuthModule:!0})["finally"](function(){delete c.defaults.headers.common["x-auth-token"];
h=void 0;a()})},setXAuthToken:function(a){n(a)},getXAuthToken:function(){return c.defaults.headers.common["x-auth-token"]},setMobile:function(a){h=a},getMobile:function(){return h},clean:function(){h=c.defaults.headers.common["x-auth-token"]=void 0}}}]);angular.module("ng-iscroll",[]).service("iScrollAccessor",function(){var a;return{set:function(b){a=b},get:function(){return a}}}).directive("iScroll",["iScrollAccessor",function(a){return{restrict:"A",link:function(b,c){var f=new IScroll(c[0],{click:!0,bounce:!0,preventDefaultException:{tagName:/^(INPUT|TEXTAREA|BUTTON|SELECT)$/,isContentEditable:/^true$/}});a.set(f);c.on("$destroy",function(){f.destroy();f=null})}}}]).directive("iScrollRefresh",["iScrollAccessor","$timeout",function(a,b){return{restrict:"A",
link:function(c){c.$last&&b(function(){a.get().refresh()})}}}]);var qrcode=function(){function a(b,c){if("undefined"==typeof b.length)throw Error(b.length+"/"+c);var d=function(){for(var a=0;a<b.length&&0==b[a];)a+=1;for(var e=Array(b.length-a+c),d=0;d<b.length-a;d+=1)e[d]=b[d+a];return e}(),f={getAt:function(a){return d[a]},getLength:function(){return d.length},multiply:function(b){for(var c=Array(f.getLength()+b.getLength()-1),d=0;d<f.getLength();d+=1)for(var r=0;r<b.getLength();r+=1)c[d+r]^=e.gexp(e.glog(f.getAt(d))+e.glog(b.getAt(r)));return a(c,0)},mod:function(b){if(0>
f.getLength()-b.getLength())return f;for(var c=e.glog(f.getAt(0))-e.glog(b.getAt(0)),d=Array(f.getLength()),r=0;r<f.getLength();r+=1)d[r]=f.getAt(r);for(r=0;r<b.getLength();r+=1)d[r]^=e.gexp(e.glog(b.getAt(r))+c);return a(d,0).mod(b)}};return f}var b=function(b,d){var e=c[d],h=null,r=0,v=null,B=[],p={},l=function(c,d){for(var g=r=4*b+17,p=Array(g),t=0;t<g;t+=1){p[t]=Array(g);for(var l=0;l<g;l+=1)p[t][l]=null}h=p;u(0,0);u(r-7,0);u(0,r-7);g=f.getPatternPosition(b);for(p=0;p<g.length;p+=1)for(t=0;t<
g.length;t+=1){var l=g[p],x=g[t];if(null==h[l][x])for(var y=-2;2>=y;y+=1)for(var m=-2;2>=m;m+=1)h[l+y][x+m]=-2==y||2==y||-2==m||2==m||0==y&&0==m?!0:!1}for(g=8;g<r-8;g+=1)null==h[g][6]&&(h[g][6]=0==g%2);for(g=8;g<r-8;g+=1)null==h[6][g]&&(h[6][g]=0==g%2);g=f.getBCHTypeInfo(e<<3|d);for(p=0;15>p;p+=1)t=!c&&1==(g>>p&1),6>p?h[p][8]=t:8>p?h[p+1][8]=t:h[r-15+p][8]=t;for(p=0;15>p;p+=1)t=!c&&1==(g>>p&1),8>p?h[8][r-p-1]=t:9>p?h[8][15-p-1+1]=t:h[8][15-p-1]=t;h[r-8][8]=!c;if(7<=b){g=f.getBCHTypeNumber(b);for(p=
0;18>p;p+=1)t=!c&&1==(g>>p&1),h[Math.floor(p/3)][p%3+r-8-3]=t;for(p=0;18>p;p+=1)t=!c&&1==(g>>p&1),h[p%3+r-8-3][Math.floor(p/3)]=t}if(null==v){g=k.getRSBlocks(b,e);p=n();for(t=0;t<B.length;t+=1)l=B[t],p.put(l.getMode(),4),p.put(l.getLength(),f.getLengthInBits(l.getMode(),b)),l.write(p);for(t=l=0;t<g.length;t+=1)l+=g[t].dataCount;if(p.getLengthInBits()>8*l)throw Error("code length overflow. ("+p.getLengthInBits()+">"+8*l+")");for(p.getLengthInBits()+4<=8*l&&p.put(0,4);0!=p.getLengthInBits()%8;)p.putBit(!1);
for(;!(p.getLengthInBits()>=8*l);){p.put(236,8);if(p.getLengthInBits()>=8*l)break;p.put(17,8)}for(var w=0,l=t=0,x=Array(g.length),y=Array(g.length),m=0;m<g.length;m+=1){var z=g[m].dataCount,A=g[m].totalCount-z,t=Math.max(t,z),l=Math.max(l,A);x[m]=Array(z);for(var q=0;q<x[m].length;q+=1)x[m][q]=255&p.getBuffer()[q+w];w+=z;q=f.getErrorCorrectPolynomial(A);z=a(x[m],q.getLength()-1).mod(q);y[m]=Array(q.getLength()-1);for(q=0;q<y[m].length;q+=1)A=q+z.getLength()-y[m].length,y[m][q]=0<=A?z.getAt(A):0}for(q=
p=0;q<g.length;q+=1)p+=g[q].totalCount;p=Array(p);for(q=w=0;q<t;q+=1)for(m=0;m<g.length;m+=1)q<x[m].length&&(p[w]=x[m][q],w+=1);for(q=0;q<l;q+=1)for(m=0;m<g.length;m+=1)q<y[m].length&&(p[w]=y[m][q],w+=1);v=p}g=v;p=-1;t=r-1;l=7;x=0;y=f.getMaskFunction(d);for(m=r-1;0<m;m-=2)for(6==m&&--m;;){for(q=0;2>q;q+=1)null==h[t][m-q]&&(w=!1,x<g.length&&(w=1==(g[x]>>>l&1)),y(t,m-q)&&(w=!w),h[t][m-q]=w,--l,-1==l&&(x+=1,l=7));t+=p;if(0>t||r<=t){t-=p;p=-p;break}}},u=function(a,b){for(var c=-1;7>=c;c+=1)if(!(-1>=a+
c||r<=a+c))for(var d=-1;7>=d;d+=1)-1>=b+d||r<=b+d||(h[a+c][b+d]=0<=c&&6>=c&&(0==d||6==d)||0<=d&&6>=d&&(0==c||6==c)||2<=c&&4>=c&&2<=d&&4>=d?!0:!1)};p.addData=function(a){a=g(a);B.push(a);v=null};p.isDark=function(a,b){if(0>a||r<=a||0>b||r<=b)throw Error(a+","+b);return h[a][b]};p.getModuleCount=function(){return r};p.make=function(){for(var a=0,b=0,c=0;8>c;c+=1){l(!0,c);var d=f.getLostPoint(p);if(0==c||a>d)a=d,b=c}l(!1,b)};p.createTableTag=function(a,b){a=a||2;var c;c='<table style=" border-width: 0px; border-style: none; border-collapse: collapse;'+
(" padding: 0px; margin: "+("undefined"==typeof b?4*a:b)+"px;")+'"><tbody>';for(var d=0;d<p.getModuleCount();d+=1){c+="<tr>";for(var e=0;e<p.getModuleCount();e+=1)c+='<td style="',c+=" border-width: 0px; border-style: none;",c+=" border-collapse: collapse;",c+=" padding: 0px; margin: 0px;",c+=" width: "+a+"px;",c+=" height: "+a+"px;",c+=" background-color: ",c+=p.isDark(d,e)?"#000000":"#ffffff",c+=";",c+='"/>';c+="</tr>"}return c+"</tbody></table>"};p.createSvgTag=function(a,b){a=a||2;b="undefined"==
typeof b?4*a:b;var c=p.getModuleCount()*a+2*b,d,e,f,g,v;v="l"+a+",0 0,"+a+" -"+a+",0 0,-"+a+"z ";g="<svg"+(' width="'+c+'px"')+(' height="'+c+'px"')+' xmlns="http://www.w3.org/2000/svg">';g+='<path d="';for(e=0;e<p.getModuleCount();e+=1)for(f=e*a+b,c=0;c<p.getModuleCount();c+=1)p.isDark(e,c)&&(d=c*a+b,g+="M"+d+","+f+v);g+='" stroke="transparent" fill="black"/>';return g+="</svg>"};p.createImgTag=function(a,b){a=a||2;b="undefined"==typeof b?4*a:b;var c=p.getModuleCount()*a+2*b,d=b,e=c-b;return q(c,
c,function(b,c){return d<=b&&b<e&&d<=c&&c<e?p.isDark(Math.floor((c-d)/a),Math.floor((b-d)/a))?0:1:1})};return p};b.stringToBytes=function(a){for(var b=[],c=0;c<a.length;c+=1){var d=a.charCodeAt(c);b.push(d&255)}return b};b.createStringToBytes=function(a,b){var c=function(){for(var c=l(a),d=function(){var a=c.read();if(-1==a)throw Error();return a},e=0,f={};;){var g=c.read();if(-1==g)break;var h=d(),k=d(),m=d(),g=String.fromCharCode(g<<8|h);f[g]=k<<8|m;e+=1}if(e!=b)throw Error(e+" != "+b);return f}();
return function(a){for(var b=[],d=0;d<a.length;d+=1){var e=a.charCodeAt(d);128>e?b.push(e):(e=c[a.charAt(d)],"number"==typeof e?(e&255)==e?b.push(e):(b.push(e>>>8),b.push(e&255)):b.push(63))}return b}};var c={L:1,M:0,Q:3,H:2},f=function(){var b=[[],[6,18],[6,22],[6,26],[6,30],[6,34],[6,22,38],[6,24,42],[6,26,46],[6,28,50],[6,30,54],[6,32,58],[6,34,62],[6,26,46,66],[6,26,48,70],[6,26,50,74],[6,30,54,78],[6,30,56,82],[6,30,58,86],[6,34,62,90],[6,28,50,72,94],[6,26,50,74,98],[6,30,54,78,102],[6,28,54,
80,106],[6,32,58,84,110],[6,30,58,86,114],[6,34,62,90,118],[6,26,50,74,98,122],[6,30,54,78,102,126],[6,26,52,78,104,130],[6,30,56,82,108,134],[6,34,60,86,112,138],[6,30,58,86,114,142],[6,34,62,90,118,146],[6,30,54,78,102,126,150],[6,24,50,76,102,128,154],[6,28,54,80,106,132,158],[6,32,58,84,110,136,162],[6,26,54,82,110,138,166],[6,30,58,86,114,142,170]],c={},d=function(a){for(var b=0;0!=a;)b+=1,a>>>=1;return b};c.getBCHTypeInfo=function(a){for(var b=a<<10;0<=d(b)-d(1335);)b^=1335<<d(b)-d(1335);return(a<<
10|b)^21522};c.getBCHTypeNumber=function(a){for(var b=a<<12;0<=d(b)-d(7973);)b^=7973<<d(b)-d(7973);return a<<12|b};c.getPatternPosition=function(a){return b[a-1]};c.getMaskFunction=function(a){switch(a){case 0:return function(a,b){return 0==(a+b)%2};case 1:return function(a,b){return 0==a%2};case 2:return function(a,b){return 0==b%3};case 3:return function(a,b){return 0==(a+b)%3};case 4:return function(a,b){return 0==(Math.floor(a/2)+Math.floor(b/3))%2};case 5:return function(a,b){return 0==a*b%2+
a*b%3};case 6:return function(a,b){return 0==(a*b%2+a*b%3)%2};case 7:return function(a,b){return 0==(a*b%3+(a+b)%2)%2};default:throw Error("bad maskPattern:"+a);}};c.getErrorCorrectPolynomial=function(b){for(var c=a([1],0),d=0;d<b;d+=1)c=c.multiply(a([1,e.gexp(d)],0));return c};c.getLengthInBits=function(a,b){if(1<=b&&10>b)switch(a){case 1:return 10;case 2:return 9;case 4:return 8;case 8:return 8;default:throw Error("mode:"+a);}else if(27>b)switch(a){case 1:return 12;case 2:return 11;case 4:return 16;
case 8:return 10;default:throw Error("mode:"+a);}else if(41>b)switch(a){case 1:return 14;case 2:return 13;case 4:return 16;case 8:return 12;default:throw Error("mode:"+a);}else throw Error("type:"+b);};c.getLostPoint=function(a){for(var b=a.getModuleCount(),c=0,d=0;d<b;d+=1)for(var e=0;e<b;e+=1){for(var f=0,g=a.isDark(d,e),h=-1;1>=h;h+=1)if(!(0>d+h||b<=d+h))for(var k=-1;1>=k;k+=1)0>e+k||b<=e+k||0==h&&0==k||g!=a.isDark(d+h,e+k)||(f+=1);5<f&&(c+=3+f-5)}for(d=0;d<b-1;d+=1)for(e=0;e<b-1;e+=1)if(f=0,a.isDark(d,
e)&&(f+=1),a.isDark(d+1,e)&&(f+=1),a.isDark(d,e+1)&&(f+=1),a.isDark(d+1,e+1)&&(f+=1),0==f||4==f)c+=3;for(d=0;d<b;d+=1)for(e=0;e<b-6;e+=1)a.isDark(d,e)&&!a.isDark(d,e+1)&&a.isDark(d,e+2)&&a.isDark(d,e+3)&&a.isDark(d,e+4)&&!a.isDark(d,e+5)&&a.isDark(d,e+6)&&(c+=40);for(e=0;e<b;e+=1)for(d=0;d<b-6;d+=1)a.isDark(d,e)&&!a.isDark(d+1,e)&&a.isDark(d+2,e)&&a.isDark(d+3,e)&&a.isDark(d+4,e)&&!a.isDark(d+5,e)&&a.isDark(d+6,e)&&(c+=40);for(e=f=0;e<b;e+=1)for(d=0;d<b;d+=1)a.isDark(d,e)&&(f+=1);return c+Math.abs(100*
f/b/b-50)/5*10};return c}(),e=function(){for(var a=Array(256),b=Array(256),c=0;8>c;c+=1)a[c]=1<<c;for(c=8;256>c;c+=1)a[c]=a[c-4]^a[c-5]^a[c-6]^a[c-8];for(c=0;255>c;c+=1)b[a[c]]=c;return{glog:function(a){if(1>a)throw Error("glog("+a+")");return b[a]},gexp:function(b){for(;0>b;)b+=255;for(;256<=b;)b-=255;return a[b]}}}(),k=function(){var a=[[1,26,19],[1,26,16],[1,26,13],[1,26,9],[1,44,34],[1,44,28],[1,44,22],[1,44,16],[1,70,55],[1,70,44],[2,35,17],[2,35,13],[1,100,80],[2,50,32],[2,50,24],[4,25,9],[1,
134,108],[2,67,43],[2,33,15,2,34,16],[2,33,11,2,34,12],[2,86,68],[4,43,27],[4,43,19],[4,43,15],[2,98,78],[4,49,31],[2,32,14,4,33,15],[4,39,13,1,40,14],[2,121,97],[2,60,38,2,61,39],[4,40,18,2,41,19],[4,40,14,2,41,15],[2,146,116],[3,58,36,2,59,37],[4,36,16,4,37,17],[4,36,12,4,37,13],[2,86,68,2,87,69],[4,69,43,1,70,44],[6,43,19,2,44,20],[6,43,15,2,44,16],[4,101,81],[1,80,50,4,81,51],[4,50,22,4,51,23],[3,36,12,8,37,13],[2,116,92,2,117,93],[6,58,36,2,59,37],[4,46,20,6,47,21],[7,42,14,4,43,15],[4,133,107],
[8,59,37,1,60,38],[8,44,20,4,45,21],[12,33,11,4,34,12],[3,145,115,1,146,116],[4,64,40,5,65,41],[11,36,16,5,37,17],[11,36,12,5,37,13],[5,109,87,1,110,88],[5,65,41,5,66,42],[5,54,24,7,55,25],[11,36,12,7,37,13],[5,122,98,1,123,99],[7,73,45,3,74,46],[15,43,19,2,44,20],[3,45,15,13,46,16],[1,135,107,5,136,108],[10,74,46,1,75,47],[1,50,22,15,51,23],[2,42,14,17,43,15],[5,150,120,1,151,121],[9,69,43,4,70,44],[17,50,22,1,51,23],[2,42,14,19,43,15],[3,141,113,4,142,114],[3,70,44,11,71,45],[17,47,21,4,48,22],
[9,39,13,16,40,14],[3,135,107,5,136,108],[3,67,41,13,68,42],[15,54,24,5,55,25],[15,43,15,10,44,16],[4,144,116,4,145,117],[17,68,42],[17,50,22,6,51,23],[19,46,16,6,47,17],[2,139,111,7,140,112],[17,74,46],[7,54,24,16,55,25],[34,37,13],[4,151,121,5,152,122],[4,75,47,14,76,48],[11,54,24,14,55,25],[16,45,15,14,46,16],[6,147,117,4,148,118],[6,73,45,14,74,46],[11,54,24,16,55,25],[30,46,16,2,47,17],[8,132,106,4,133,107],[8,75,47,13,76,48],[7,54,24,22,55,25],[22,45,15,13,46,16],[10,142,114,2,143,115],[19,
74,46,4,75,47],[28,50,22,6,51,23],[33,46,16,4,47,17],[8,152,122,4,153,123],[22,73,45,3,74,46],[8,53,23,26,54,24],[12,45,15,28,46,16],[3,147,117,10,148,118],[3,73,45,23,74,46],[4,54,24,31,55,25],[11,45,15,31,46,16],[7,146,116,7,147,117],[21,73,45,7,74,46],[1,53,23,37,54,24],[19,45,15,26,46,16],[5,145,115,10,146,116],[19,75,47,10,76,48],[15,54,24,25,55,25],[23,45,15,25,46,16],[13,145,115,3,146,116],[2,74,46,29,75,47],[42,54,24,1,55,25],[23,45,15,28,46,16],[17,145,115],[10,74,46,23,75,47],[10,54,24,
35,55,25],[19,45,15,35,46,16],[17,145,115,1,146,116],[14,74,46,21,75,47],[29,54,24,19,55,25],[11,45,15,46,46,16],[13,145,115,6,146,116],[14,74,46,23,75,47],[44,54,24,7,55,25],[59,46,16,1,47,17],[12,151,121,7,152,122],[12,75,47,26,76,48],[39,54,24,14,55,25],[22,45,15,41,46,16],[6,151,121,14,152,122],[6,75,47,34,76,48],[46,54,24,10,55,25],[2,45,15,64,46,16],[17,152,122,4,153,123],[29,74,46,14,75,47],[49,54,24,10,55,25],[24,45,15,46,46,16],[4,152,122,18,153,123],[13,74,46,32,75,47],[48,54,24,14,55,25],
[42,45,15,32,46,16],[20,147,117,4,148,118],[40,75,47,7,76,48],[43,54,24,22,55,25],[10,45,15,67,46,16],[19,148,118,6,149,119],[18,75,47,31,76,48],[34,54,24,34,55,25],[20,45,15,61,46,16]],b=function(a,b){var c={};c.totalCount=a;c.dataCount=b;return c},d={},e=function(b,d){switch(d){case c.L:return a[4*(b-1)+0];case c.M:return a[4*(b-1)+1];case c.Q:return a[4*(b-1)+2];case c.H:return a[4*(b-1)+3]}};d.getRSBlocks=function(a,c){var d=e(a,c);if("undefined"==typeof d)throw Error("bad rs block @ typeNumber:"+
a+"/errorCorrectLevel:"+c);for(var f=d.length/3,g=[],h=0;h<f;h+=1)for(var k=d[3*h+0],v=d[3*h+1],l=d[3*h+2],m=0;m<k;m+=1)g.push(b(v,l));return g};return d}(),n=function(){var a=[],b=0,c={getBuffer:function(){return a},getAt:function(b){return 1==(a[Math.floor(b/8)]>>>7-b%8&1)},put:function(a,b){for(var d=0;d<b;d+=1)c.putBit(1==(a>>>b-d-1&1))},getLengthInBits:function(){return b},putBit:function(c){var d=Math.floor(b/8);a.length<=d&&a.push(0);c&&(a[d]|=128>>>b%8);b+=1}};return c},g=function(a){var c=
b.stringToBytes(a);return{getMode:function(){return 4},getLength:function(a){return c.length},write:function(a){for(var b=0;b<c.length;b+=1)a.put(c[b],8)}}},h=function(){var a=[],b={writeByte:function(b){a.push(b&255)},writeShort:function(a){b.writeByte(a);b.writeByte(a>>>8)},writeBytes:function(a,c,d){c=c||0;d=d||a.length;for(var e=0;e<d;e+=1)b.writeByte(a[e+c])},writeString:function(a){for(var c=0;c<a.length;c+=1)b.writeByte(a.charCodeAt(c))},toByteArray:function(){return a},toString:function(){var b;
b="[";for(var c=0;c<a.length;c+=1)0<c&&(b+=","),b+=a[c];return b+"]"}};return b},d=function(){var a=0,b=0,c=0,d="",e={},f=function(a){if(!(0>a)){if(26>a)return 65+a;if(52>a)return 97+(a-26);if(62>a)return 48+(a-52);if(62==a)return 43;if(63==a)return 47}throw Error("n:"+a);};e.writeByte=function(e){a=a<<8|e&255;b+=8;for(c+=1;6<=b;)d+=String.fromCharCode(f(a>>>b-6&63)),b-=6};e.flush=function(){0<b&&(d+=String.fromCharCode(f(a<<6-b&63)),b=a=0);if(0!=c%3)for(var e=3-c%3,g=0;g<e;g+=1)d+="="};e.toString=
function(){return d};return e},l=function(a){var b=0,c=0,d=0,e=function(a){if(65<=a&&90>=a)return a-65;if(97<=a&&122>=a)return a-97+26;if(48<=a&&57>=a)return a-48+52;if(43==a)return 62;if(47==a)return 63;throw Error("c:"+a);};return{read:function(){for(;8>d;){if(b>=a.length){if(0==d)return-1;throw Error("unexpected end of file./"+d);}var f=a.charAt(b);b+=1;if("="==f)return d=0,-1;f.match(/^\s$/)||(c=c<<6|e(f.charCodeAt(0)),d+=6)}f=c>>>d-8&255;d-=8;return f}}},m=function(a,b){var c=Array(a*b),d=function(a){var b=
0,c=0;return{write:function(d,e){if(0!=d>>>e)throw Error("length over");for(;8<=b+e;)a.writeByte(255&(d<<b|c)),e-=8-b,d>>>=8-b,b=c=0;c|=d<<b;b+=e},flush:function(){0<b&&a.writeByte(c)}}},e=function(){var a={},b=0,c={add:function(d){if(c.contains(d))throw Error("dup key:"+d);a[d]=b;b+=1},size:function(){return b},indexOf:function(b){return a[b]},contains:function(b){return"undefined"!=typeof a[b]}};return c};return{setPixel:function(b,d,e){c[d*a+b]=e},write:function(f){f.writeString("GIF87a");f.writeShort(a);
f.writeShort(b);f.writeByte(128);f.writeByte(0);f.writeByte(0);f.writeByte(0);f.writeByte(0);f.writeByte(0);f.writeByte(255);f.writeByte(255);f.writeByte(255);f.writeString(",");f.writeShort(0);f.writeShort(0);f.writeShort(a);f.writeShort(b);f.writeByte(0);var g;g=3;for(var k=e(),l=0;4>l;l+=1)k.add(String.fromCharCode(l));k.add(String.fromCharCode(4));k.add(String.fromCharCode(5));var l=h(),m=d(l);m.write(4,g);for(var n=0,v=String.fromCharCode(c[n]),n=n+1;n<c.length;){var r=String.fromCharCode(c[n]),
n=n+1;k.contains(v+r)?v+=r:(m.write(k.indexOf(v),g),4095>k.size()&&(k.size()==1<<g&&(g+=1),k.add(v+r)),v=r)}m.write(k.indexOf(v),g);m.write(5,g);m.flush();g=l.toByteArray();f.writeByte(2);for(k=0;255<g.length-k;)f.writeByte(255),f.writeBytes(g,k,255),k+=255;f.writeByte(g.length-k);f.writeBytes(g,k,g.length-k);f.writeByte(0);f.writeString(";")}}},q=function(a,b,c,e){for(var f=m(a,b),g=0;g<b;g+=1)for(var k=0;k<a;k+=1)f.setPixel(k,g,c(k,g));c=h();f.write(c);f=d();c=c.toByteArray();for(g=0;g<c.length;g+=
1)f.writeByte(c[g]);f.flush();f='<img src="data:image/gif;base64,'+f+'" width="';f+=a;f+='"';f+=' height="';f+=b;f+='"';e&&(f+=' alt="',f+=e,f+='"');return f+="/>"};return b}();(function(a){"function"===typeof define&&define.amd?define([],a):"object"===typeof exports&&(module.exports=a())})(function(){return qrcode});
(function(a){a.stringToBytes=function(a){for(var b=[],f=0;f<a.length;f++){var e=a.charCodeAt(f);128>e?b.push(e):2048>e?b.push(192|e>>6,128|e&63):55296>e||57344<=e?b.push(224|e>>12,128|e>>6&63,128|e&63):(f++,e=65536+((e&1023)<<10|a.charCodeAt(f)&1023),b.push(240|e>>18,128|e>>12&63,128|e>>6&63,128|e&63))}return b}})(qrcode);angular.module("smsValidation",["ngResource","common-authentication"]).directive("smsValidation",["$ionicLoading","smsValidationAPI","$interval","CommonAuthenticationService",function(a,b,c,f){return{restrict:"E",scope:{presetInvitationCode:"=presetInvitationCode",success:"&onSuccess"},templateUrl:"templates/common/sms.validation.html",link:function(e){e.statusCode={waitMobile:0,waitCode:1};e.status=e.statusCode.waitMobile;e.showInvitationCode=!1;var k,n=function(a){e.count=60;angular.isDefined(k)||
(k=c(function(){1<e.count?--e.count:(angular.isDefined(k)&&(c.cancel(k),k=void 0),a())},1E3))},g=function(){a.show({template:"<ion-spinner></ion-spinner>",delay:100});b.send(e.mobile,e.captcha,function(){a.hide();e.status=e.statusCode.waitCode;n(function(){e.status===e.statusCode.waitCode&&(e.status.code=e.statusCode.waitMobile)})},function(b){a.hide();e.refreshCaptcha();e.captcha=void 0;alert(b.data.error)})};e.sendSmsValidation=function(){void 0===e.mobile?alert("\u8bf7\u6b63\u786e\u8f93\u5165\u624b\u673a\u53f7"):
void 0===e.captcha?alert("\u8bf7\u6b63\u786e\u8f93\u5165\u56fe\u7247\u9a8c\u8bc1\u7801"):g()};e.refreshCaptcha=function(){e.showCaptcha=!0;void 0!==e.mobile&&(e.captchaUrl=b.getCaptchaUrl(e.mobile))};e.checkExist=function(){e.showInvitationCode=!1;void 0!==e.mobile&&f.exist(e.mobile,function(){e.showInvitationCode=!1},function(){e.showInvitationCode=!0})};e.auth=function(){f.auth(e.mobile,e.validationCode,void 0!==e.presetInvitationCode?e.presetInvitationCode:e.invitationCode,function(a){e.success()},
function(a){alert(a)})}}}}]).service("smsValidationAPI",["$resource","urlConfig",function(a,b){var c=a(b.REST_END_POINT+"/sso/smsValidate",{phoneNumber:"@phoneNumber",captcha:"@captcha"},{send:{method:"POST",isArray:!1}},null);return{send:function(a,b,k,n){c.send({phoneNumber:a,captcha:b},function(){k()},function(a){n(a)})},getCaptchaUrl:function(a){return b.REST_END_POINT+"/sso/captcha?phoneNumber="+a+"&time="+(new Date).getTime()}}}]);angular.module("wechat",["wechat.service"]);
angular.module("wechat.service",[]).constant("wechatConstants",{SHARE_IMG_URL:"img/promotion/share.png",TIMELINE_IMG_URL:"img/promotion/share.png",PROMOTION_SHARE_ROOT:"/wechatlogin/oauth2?state=promotion:",SURVEY_SHARE_ROOT:"/wechatlogin/oauth2?state=survey:",CLAIM_SHARE_ROOT:"/#/claim/"}).service("Wechat",["urlConfig","$resource","$location","wechatConstants",function(a,b,c,f){var e,k=b(a.REST_END_POINT+"/api/wechat/config",{url:"@url"}),n=b(a.REST_END_POINT+"/wechatlogin/oauth2/bind",{openId:"@openId"}),
g=function(a,b,d){var e=new k;a=a?c.protocol()+"://"+c.host()+"/":c.absUrl();e.$get({url:a},function(a){r=a;console.log("refresh wechat mp config success");b()},function(a){r=void 0;console.log("refresh wechat mp config error by: "+a.data.error);d(a)})},h=function(a,b,c){wx.chooseImage({count:1,sizeType:["compressed"],sourceType:["album","camera"],success:function(a){b(a.localIds)}})},d=function(a,b,c){wx.uploadImage({localId:a,isShowProgressTips:1,success:function(a){b(a.serverId)}})},l=function(a,
b,c){wx.getLocation({type:"gcj02",success:function(a){b(a)},cancel:function(a){c(a)}})},m=function(a,b,c,d){wx.previewImage({current:b[a],urls:b})},q=function(a,b,c,d){wx.config({debug:!1,appId:r.appId,timestamp:r.timestamp,nonceStr:r.noncestr,signature:r.signature,jsApiList:"onMenuShareAppMessage onMenuShareTimeline chooseWXPay chooseImage uploadImage getLocation previewImage hideMenuItems".split(" ")});wx.ready(function(){a(b,c,d)})},u=function(b,c,d,e){b&&wx.hideMenuItems({menuList:["menuItem:share:appMessage"]});
wx.onMenuShareAppMessage({title:c.name,desc:c.description,link:c.url,imgUrl:a.APP_ROOT+"/"+f.SHARE_IMG_URL,trigger:function(a){},success:function(a){d()},cancel:function(a){e("\u5df2\u53d6\u6d88\u5206\u4eab")},fail:function(a){e("\u5206\u4eab\u5931\u8d25")}});wx.onMenuShareTimeline({title:c.name,link:c.url,imgUrl:a.APP_ROOT+"/"+f.TIMELINE_IMG_URL,trigger:function(a){},success:function(a){d()},cancel:function(a){e("\u5df2\u53d6\u6d88\u5206\u4eab")},fail:function(a){e("\u5206\u4eab\u5931\u8d25")}})},
w=function(a,b,c){u(!0,a,b,c)},x=function(a,b,c){u(!1,a,b,c)},t=function(a,b,c){wx.chooseWXPay({timestamp:a.timeStamp+"",nonceStr:a.nonceStr,"package":a.packagePrepayId,signType:a.signType,paySign:a.paySign,success:function(a){b()},fail:function(a){c()},cancel:function(a){c()}})},r;return{hookShareAll:function(a,b,c,d){void 0===r?g(a,function(){q(x,b,c,d)},function(a){alert("\u5fae\u4fe1\u73af\u5883\u9519\u8bef\uff0c\u8bf7\u91cd\u65b0\u6253\u5f00\u9875\u9762")}):q(x,b,c,d)},hookShareTimelineOnly:function(a,
b,c,d){void 0===r?g(a,function(){q(w,b,c,d)},function(a){alert("\u5fae\u4fe1\u73af\u5883\u9519\u8bef\uff0c\u8bf7\u91cd\u65b0\u6253\u5f00\u9875\u9762")}):q(w,b,c,d)},doWxPay:function(a,b,c){void 0===r?g(!0,function(){q(t,a,b,c)},function(a){alert("\u5fae\u4fe1\u73af\u5883\u9519\u8bef\uff0c\u8bf7\u91cd\u65b0\u6253\u5f00\u9875\u9762")}):q(t,a,b,c)},chooseImage:function(a,b){void 0===r?g(!0,function(){q(h,"",a,b)},function(a){alert("\u5fae\u4fe1\u73af\u5883\u9519\u8bef\uff0c\u8bf7\u91cd\u65b0\u6253\u5f00\u9875\u9762")}):
q(h,"",a,b)},previewImage:function(a,b,c,d){void 0===r?g(!0,function(){q(m,a,b,c,d)},function(a){alert("\u5fae\u4fe1\u73af\u5883\u9519\u8bef\uff0c\u8bf7\u91cd\u65b0\u6253\u5f00\u9875\u9762")}):q(m,a,b,c,d)},getUserLocation:function(a,b){void 0===r?g(!0,function(){q(l,"",a,b)},function(a){alert("\u5fae\u4fe1\u73af\u5883\u9519\u8bef\uff0c\u8bf7\u91cd\u65b0\u6253\u5f00\u9875\u9762")}):q(l,"",a,b)},uploadImage:function(a,b,c){void 0===r?g(!0,function(){q(d,a,b,c)},function(a){alert("\u5fae\u4fe1\u73af\u5883\u9519\u8bef\uff0c\u8bf7\u91cd\u65b0\u6253\u5f00\u9875\u9762")}):
q(d,a,b,c)},isQQBrowser:function(){return-1!==navigator.userAgent.indexOf("MQQBrowser")},bind:function(a,b,c){(new n).$save({openId:a},b,function(a){c(a.data.error)})},getOpenId:function(){return e},setOpenId:function(a){e=a}}}]);
