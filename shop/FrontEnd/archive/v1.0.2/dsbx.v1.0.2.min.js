angular.module("account.community",["account.community.service","promotion"]).controller("CommCreditCtrl",["$scope","$state","$ionicHistory","$rootScope","$ionicLoading","eventNames","CreditAPI",function(a,b,c,e,f,h,l){var g=function(){a.records=[];n(function(){f.show({template:"<ion-spinner></ion-spinner>",delay:100})},function(){f.hide()},function(){e.navToIndex()})},k=function(){a.records=void 0;a.pageNumber=void 0;a.hasRecord=void 0;a.initFinish=void 0},n=function(b,d,c){b();l.refresh(function(b){a.records=
b;a.pageNumber=0;a.hasRecord=!(void 0===a.records||0===a.records.length);a.initFinish=!0;d()},function(b){a.initFinish=!0;console.log(b);alert("\u5237\u65b0\u5931\u8d25\uff0c\u8bf7\u7a0d\u540e\u518d\u8bd5");d();c()})};a.loadMore=function(){a.canLoadMore()&&l.getPage(a.pageNumber+1,function(b){if(void 0!==b&&0!==b.length){for(var d=0;d<b.length;d++)a.records.push(b[d]);a.pageNumber++}a.$broadcast("scroll.infiniteScrollComplete")},function(b){alert(b);a.$broadcast("scroll.infiniteScrollComplete")})};
a.refresh=function(){n(function(){},function(){$timeout(function(){a.$broadcast("scroll.refreshComplete")},500)},function(){})};a.canLoadMore=function(){return void 0===a.initFinish?!1:l.hasMoreToLoad()};g();e.$on("$stateChangeStart",function(a,d,b,t,c){if("app.account.community"===d.name||"app.account.community.invite"===d.name||"app.account.community.credit"===d.name||"app.account.community.exchange"===d.name){if("app.account.community.invite"===t.name||"app.account.community.credit"===t.name)return;
g()}"app.account.sales"!==d.name&&"app.account.sales.invite"!==d.name&&"app.account.sales.credit"!==d.name||"app.account.sales.invite"===t.name||"app.account.sales.credit"===t.name||g()});e.$on("event:auth-loginCancelled",function(){k()});e.$on("event:auth-logout-complete",function(){k()});e.$on(h.CREDIT_EXCHANGE_SUCCESS,function(a,d){k()})}]).controller("CommExchangeCtrl",["$scope","$state","$ionicHistory","$rootScope","$ionicLoading","eventNames","CreditExchangeAPI",function(a,b,c,e,f,h,l){a.exchange=
function(b){b.creditAmount>a.$parent.account.credit?alert("\u7231\u5fc3\u6570\u91cf\u4e0d\u8db3\uff0c\u8bf7\u83b7\u5f97\u66f4\u591a\u7231\u5fc3\u518d\u6765\u5151\u6362"):(f.show({template:"<ion-spinner></ion-spinner>",delay:100}),l.exchange(b.id,function(){f.hide();e.$broadcast(h.CREDIT_EXCHANGE_SUCCESS);alert("\u5151\u6362\u6210\u529f")},function(a){f.hide();alert(a)}))};(function(){a.rules=[];f.show({template:"<ion-spinner></ion-spinner>",delay:100});l.getRules(function(b){a.rules=b;f.hide()},function(a){f.hide();
alert(a);e.navToIndex()})})()}]).controller("CommInviteCtrl",["$scope","$state","$ionicHistory","$rootScope","$ionicLoading","eventNames","PromotionAPI","Wechat",function(a,b,c,e,f,h,l,g){var k=function(b){void 0===a.$parent||void 0===a.$parent.account?a.$on("account-ready",function(a,c){b()}):b()},n=function(){a.invitePromotionUrl=l.getShareUrl(a.$parent.account.invitePromotionId);f.show({template:"<ion-spinner></ion-spinner>",delay:100});l.getPublicBatch(a.$parent.account.invitePromotionId,function(b){f.hide();
a.batch=b;g.hookShareAll(!0,l.convertBatchToContent(a.batch),function(){},function(a){alert(a)})},function(a){f.hide();alert("\u672a\u627e\u5230\u5206\u4eab\u6d3b\u52a8\uff0c\u8bf7\u8054\u7cfb\u7ba1\u7406\u5458\u6216\u7a0d\u540e\u518d\u8bd5")})};k(n);e.$on("$stateChangeStart",function(a,d,b,t,c){("app.account.community.invite"===d.name&&"app.account.community.invite"!==t.name&&"app.account.community.exchange"!==t.name&&"app.account.community.credit"!==t.name||"app.account.sales.invite"===d.name&&
"app.account.sales.invite"!==t.name)&&k(n)})}]);
angular.module("account.community.service",["ngResource"]).service("CreditAPI",["$resource","urlConfig",function(a,b){var c=a(b.REST_END_POINT+"/api/account/credit/record",{page:"@page"},{query:{method:"GET",isArray:!1,timeout:1E4}},null),e=function(a,b,f){c.query({page:a},function(a){for(var d=[],c=0;c<a.list.length;c++)h[a.list[c].id]=a.list[c],d.push(a.list[c]);console.log("credit record page data get page success");b(d)},function(a){f(a.data.error)})},f=function(a,b){h={};l=0;c.query({page:0},
function(b){l=b.metaData.total;for(var c=[],d=0;d<b.list.length;d++)h[b.list[d].id]=b.list[d],c.push(b.list[d]);console.log("credit record metaData init success");a(c)},function(a){b(a.data.error)})},h={},l=0;return{getPage:function(a,b,c){e(a,b,c)},get:function(a){return h[a]},refresh:function(a,b){f(a,b)},hasMoreToLoad:function(){return!!(void 0!==h&&0!==Object.keys(h).length&&Object.keys(h).length<l)},clean:function(){h=void 0;l=0}}}]).service("CreditExchangeAPI",["$resource","urlConfig",function(a,
b){var c=a(b.REST_END_POINT+"/api/account/credit/exchangeRule",{},{query:{method:"GET",isArray:!0,timeout:1E4}},null),e=a(b.REST_END_POINT+"/api/account/credit/exchangeRule/:ruleId/exchange",{ruleId:"@ruleId"},{exchange:{method:"POST",isArray:!1,timeout:1E4}},null),f=[],h=function(a,b){f=[];c.query({},function(b){f=b;console.log("credit exchange rule init success");a(f)},function(a){b("\u672a\u627e\u5230\u53ef\u5151\u6362\u5546\u54c1\uff0c\u8bf7\u8054\u7cfb\u7ba1\u7406\u5458\u6216\u7a0d\u540e\u518d\u8bd5")})},
l=function(a,b,c){e.exchange({ruleId:a},function(a){b()},function(a){c(a.data.error)})};return{getRules:function(a,b){void 0===f||0===f.length?h(a,b):a(f)},exchange:function(a,b,c){l(a,b,c)}}}]);angular.module("account",["account.service","smsValidation","wechat","account.community"]).controller("AccountCtrl",["$scope","$state","$rootScope","$ionicLoading","AccountAPI","accountConstants","eventNames",function(a,b,c,e,f,h,l){a.state={info:1,edit:2};var g=function(){a.actState=a.state.info;e.show({template:"<ion-spinner></ion-spinner>",delay:100});f.getAccount(function(b){e.hide();a.account=b;a.$broadcast("account-ready",a.account)},function(a){e.hide();console.log("error getting account, by: "+
a);alert("\u670d\u52a1\u5668\u672a\u54cd\u5e94\uff0c\u83b7\u53d6\u8d26\u6237\u4fe1\u606f\u5931\u8d25\uff0c\u8bf7\u7a0d\u540e\u518d\u8bd5");c.navToIndex()})};a.canEditCompany=function(){return a.account.type===h.ACCOUNT_TYPE_NORMAL};a.canEditEmail=function(){return a.account.type===h.ACCOUNT_TYPE_NORMAL};a.showEdit=function(){a.actState=a.state.edit;a.backupName=a.account.name;a.backupAddress=a.account.address;a.backupCompany=a.account.company;a.backupEmail=a.account.email};a.saveEdit=function(){e.show({template:"<ion-spinner></ion-spinner>",
delay:100});f.saveAccount(a.account,function(b){e.hide();a.actState=a.state.info;a.backupName=void 0;a.backupAddress=void 0;a.backupCompany=void 0;a.backupEmail=void 0},function(a){e.hide();alert(a.data.error)})};a.cancelEdit=function(){a.account.name=a.backupName;a.account.address=a.backupAddress;a.account.company=a.backupCompany;a.account.email=a.backupEmail;a.backupName=void 0;a.backupAddress=void 0;a.backupCompany=void 0;a.backupEmail=void 0;a.actState=a.state.info};g();c.$on("$stateChangeStart",
function(a,b,c,d,f){"app.account"!==b.name&&"app.account.show"!==b.name||"app.account"===d.name||"app.account.show"===d.name||g()});c.$on("event:auth-loginCancelled",function(){f.clean();a.account=void 0});c.$on("event:auth-logout-complete",function(){f.clean();a.account=void 0});c.$on(l.CREDIT_EXCHANGE_SUCCESS,function(a,b){f.clean();g()})}]).controller("SalesOrCommCtrl",["$scope","$rootScope",function(a,b){var c=function(a){a.isSuperDXK?b.navToRoot("app.account.sales.credit"):b.navToRoot("app.account.community.credit")},
e=function(){void 0===a.$parent.account?a.$on("account-ready",function(b,e){c(a.$parent.account)}):c(a.$parent.account)};e();b.$on("$stateChangeStart",function(a,b,c,g,k){"app.account.salesOrComm"===b.name&&"app.account.salesOrComm"!==g.name&&(a.preventDefault(),e())})}]);
angular.module("account.service",["ngResource","http-auth-interceptor","wechat"]).service("AccountAPI",["$resource","urlConfig","Wechat",function(a,b,c){var e,f=a(b.REST_END_POINT+"/api/account",null,{query:{method:"GET",isArray:!1,timeout:1E4},save:{method:"POST",timeout:1E4}},null);return{getAccount:function(a,b){if(void 0===e){var g=c.getOpenId();void 0!==g?c.bind(g,function(c){console.log("wechat bind succeed");f.query({},function(b){e=b;a(e)},b)},function(a){console.log("wechat bind failed by: "+
a);b(a)}):f.query({},function(b){e=b;a(e)},b)}else a(e)},saveAccount:function(a,b,c){f.save(a,function(c){e=a;b()},function(a){c(a)})},clean:function(){e=void 0}}}]);angular.module("agreement",["agreement.service","wechat"]).controller("AgreementCtrl",["$scope","$state","AgreementAPI","agreementConstants","$rootScope","$ionicLoading","eventNames",function(a,b,c,e,f,h,l){var g=function(b,d,p){a.initFinish=!1;h.show({template:"<ion-spinner></ion-spinner>",delay:100});c.findPublicByIdIn(n,function(t){a.toPropose="1"===b;a.showPaygo="1"===d;a.showUser="1"===p;a.publicAgreements=t;a.showUser?c.all(function(d){a.agreementlist=d;h.hide();a.initFinish=!0},function(d){h.hide();
a.initFinish=!0;f.navToIndex()}):(h.hide(),a.initFinish=!0)},function(a){console.log("error initializing index, by: "+a);h.hide();alert("\u670d\u52a1\u5668\u672a\u54cd\u5e94\uff0c\u83b7\u53d6\u534f\u8bae\u5931\u8d25\uff0c\u8bf7\u7a0d\u540e\u518d\u8bd5")})},k=function(){a.agreementlist=void 0;a.toPropose=void 0;a.showPaygo=void 0;a.showUser=void 0;a.publicAgreements=void 0;a.initFinish=void 0};a.expired=function(a){return new Date(a.endDate)<new Date};var n=[e.AGREEMENT_ID_PAYGO_LOCAL_JB_LITE,e.AGREEMENT_ID_PAYGO_LOCAL_ZH,
e.AGREEMENT_ID_PAYGO_JB_LITE,e.AGREEMENT_ID_PAYGO_JB,e.AGREEMENT_ID_AUTO_PAYGO,e.AGREEMENT_ID_PAYGO_ZR,e.AGREEMENT_ID_PAYGO_ZH_COLD_CHAIN];g(b.params.toPropose,b.params.paygo,b.params.user);f.$on("$stateChangeStart",function(a,d,b,t,c){"app.agreement"!==d.name&&"app.agreement.list"!==d.name&&"app.agreement.detail"!==d.name||g(b.toPropose,b.paygo,b.user)});f.$on("event:auth-loginCancelled",function(){k()});f.$on("event:auth-logout-complete",function(){k()});f.$on(l.PROPOSAL_SUCCESS,function(a,d){c.clean()});
f.$on(l.AGREEMENT_CHARGE_SUCCESS,function(a,d){c.clean()})}]).controller("AgreementDetailCtrl",["$rootScope","$scope","$stateParams","AgreementAPI","eventNames",function(a,b,c,e,f){var h=function(){e.find(c.id,function(a){b.agreement=a},function(a){b.message=a})};h();a.$on(f.AGREEMENT_CHARGE_SUCCESS,function(a,b){h()})}]).controller("AgreementPublicDetailCtrl",["$rootScope","$scope","$stateParams","AgreementAPI","eventNames",function(a,b,c,e,f){(function(){e.findPublic(c.id,function(a){b.agreement=
a},function(a){b.message=a})})()}]).controller("AgreementChargeCtrl",["$rootScope","$scope","$state","$stateParams","AgreementAPI","$ionicActionSheet","AccountAPI","agreementConstants","eventNames","Wechat","$ionicLoading","$ionicPopup",function(a,b,c,e,f,h,l,g,k,n,q,d){var p=function(){q.show({template:"<ion-spinner></ion-spinner>",delay:100});f.preOrder(b.chargeOrder,function(a){console.log("pre order succeed");t(a)},function(a){q.hide();console.log("pre order error, by: ",a.data.error);alert(a.data.error)})},
t=function(d){b.chargeOrder.orderId=d.orderId;n.doWxPay(d.paymentResponse,function(){q.hide();b.error=void 0;console.log("save order successfull");a.$broadcast(k.AGREEMENT_CHARGE_SUCCESS,suc);alert("\u5145\u503c\u91d1\u989d"+b.chargeOrder.fee+"\u5143\uff0c\u4ee3\u91d1\u5238\u5df2\u7ecf\u53d1\u653e\uff0c\u8bf7\u5230\u6211\u7684\u4f18\u60e0\u5238\u4e2d\u67e5\u770b");c.go("app.agreement.detail",{id:e.id})},function(){q.hide();alert("\u652f\u4ed8\u5931\u8d25")})};(function(){q.show({template:"<ion-spinner></ion-spinner>",
delay:100});f.find(e.id,function(a){b.agreement=a;b.agreement.invoiceTypes=g.INVOICE_TYPES;l.getAccount(function(a){b.account=a;b.chargeOrder={agreement:b.agreement,chargeRule:b.agreement.chargeRules[0],fee:b.agreement.chargeRules[0]?b.agreement.chargeRules[0].chargeAmount:0};b.account.invoiceSetting&&(b.chargeOrder.companyTaxId=b.account.invoiceSetting.companyTaxId);b.chargeOrder.invoiceType=g.INVOICE_TYPE_NORMAL;q.hide()},function(a){console.log("error getting account, by: "+a);q.hide();alert("\u670d\u52a1\u5668\u672a\u54cd\u5e94\uff0c\u83b7\u53d6\u652f\u4ed8\u4fe1\u606f\u5931\u8d25\uff0c\u8bf7\u7a0d\u540e\u518d\u8bd5")})},
function(a){q.hide();b.message=a})})();b.showRules=function(){for(var a=[],d=0;d<b.agreement.chargeRules.length;d++)a[d]={text:"<div>"+b.agreement.chargeRules[d].name+"</div><p>"+b.agreement.chargeRules[d].description+"</p>"};h.show({buttons:a,buttonClicked:function(a){b.chargeOrder.chargeRule=b.agreement.chargeRules[a];b.chargeOrder.fee=b.chargeOrder.chargeRule.chargeAmount;return!0}})};b.canShowTaxId=function(){return void 0!==b.chargeOrder&&b.chargeOrder.invoiceType!==g.INVOICE_TYPE_NORMAL};b.wxPay=
function(){void 0===n.getOpenId()?alert("\u672a\u68c0\u6d4b\u5230\u5fae\u4fe1\u652f\u4ed8\u73af\u5883\uff0c\u8bf7\u5728\u5fae\u4fe1\u516c\u4f17\u53f7\u4e2d\u64cd\u4f5c"):(b.chargeOrder.buyerId=n.getOpenId(),b.chargeOrder.payProvider=g.PAY_PROVIDER_WX,p())}}]);
angular.module("agreement.service",["ngResource"]).service("AgreementAPI",["$resource","urlConfig","agreementConstants",function(a,b,c){var e=function(a,d){return a.displayIndex-d.displayIndex},f=function(a,d){return a.pinyin>a.pinyin?1:a.pinyin<d.pinyin?-1:0},h=function(a,d){return a.value-d.value},l=a(b.REST_END_POINT+"/api/public/agreement",null,{query:{method:"GET",isArray:!1,timeout:1E4}},null),g,k,n=a(b.REST_END_POINT+"/api/agreement",null,{query:{method:"GET",isArray:!0,timeout:1E4}},null),
q=a(b.REST_END_POINT+"/api/order/charge"),d=a(b.REST_END_POINT+"/api/order/:id/finish"),p,t=function(a,d){l.query({},function(d){console.log("public agreement init success");g=d.contexts.divisions.sort(f);k=d.agreements;k[c.AGREEMENT_ID_AUTO_PAYGO].divisions=g;k[c.AGREEMENT_ID_AUTO_PAYGO].goods.sort(e);k[c.AGREEMENT_ID_AUTO_PAYGO].coverages.sort(h);k[c.AGREEMENT_ID_AUTO_PAYGO].invoiceTypes=c.INVOICE_TYPES;k[c.AGREEMENT_ID_PAYGO_LOCAL_ZH].divisions=g;k[c.AGREEMENT_ID_PAYGO_LOCAL_ZH].goods.sort(e);
k[c.AGREEMENT_ID_PAYGO_LOCAL_ZH].coverages.sort(h);k[c.AGREEMENT_ID_PAYGO_LOCAL_ZH].invoiceTypes=c.INVOICE_TYPES;k[c.AGREEMENT_ID_PAYGO_JB].divisions=g;k[c.AGREEMENT_ID_PAYGO_JB].goods.sort(e);k[c.AGREEMENT_ID_PAYGO_JB].coverages.sort(h);k[c.AGREEMENT_ID_PAYGO_JB].invoiceTypes=c.INVOICE_TYPES;k[c.AGREEMENT_ID_PAYGO_JB_LIMIT_PRICE].divisions=g.filter(function(a){return 100===a.defaultRouteFeeRate});k[c.AGREEMENT_ID_PAYGO_JB_LIMIT_PRICE].goods.sort(e);k[c.AGREEMENT_ID_PAYGO_JB_LIMIT_PRICE].coverages.sort(h);
k[c.AGREEMENT_ID_PAYGO_JB_LIMIT_PRICE].invoiceTypes=c.INVOICE_TYPES;k[c.AGREEMENT_ID_PAYGO_LOCAL_JB_LITE].divisions=g;k[c.AGREEMENT_ID_PAYGO_LOCAL_JB_LITE].goods.sort(e);k[c.AGREEMENT_ID_PAYGO_LOCAL_JB_LITE].coverages.sort(h);k[c.AGREEMENT_ID_PAYGO_LOCAL_JB_LITE].invoiceTypes=c.INVOICE_TYPES;k[c.AGREEMENT_ID_PAYGO_JB_LITE].divisions=g;k[c.AGREEMENT_ID_PAYGO_JB_LITE].goods.sort(e);k[c.AGREEMENT_ID_PAYGO_JB_LITE].coverages.sort(h);k[c.AGREEMENT_ID_PAYGO_JB_LITE].invoiceTypes=c.INVOICE_TYPES;k[c.AGREEMENT_ID_PAYGO_ZH_COLD_CHAIN].divisions=
g;k[c.AGREEMENT_ID_PAYGO_ZH_COLD_CHAIN].goods.sort(e);k[c.AGREEMENT_ID_PAYGO_ZH_COLD_CHAIN].coverages.sort(h);k[c.AGREEMENT_ID_PAYGO_ZH_COLD_CHAIN].invoiceTypes=c.INVOICE_TYPES;k[c.AGREEMENT_ID_PAYGO_ZR].divisions=g;k[c.AGREEMENT_ID_PAYGO_ZR].goods.sort(e);k[c.AGREEMENT_ID_PAYGO_ZR].coverages.sort(h);k[c.AGREEMENT_ID_PAYGO_ZR].invoiceTypes=c.INVOICE_TYPES;k[c.AGREEMENT_ID_SIGNUP_COUPON].divisions=g.filter(function(a){return 100===a.defaultRouteFeeRate});k[c.AGREEMENT_ID_SIGNUP_COUPON].goods.sort(e);
k[c.AGREEMENT_ID_SIGNUP_COUPON].coverages.sort(h);k[c.AGREEMENT_ID_COUPON_TRANSACTION_25].divisions=g.filter(function(a){return 100===a.defaultRouteFeeRate});k[c.AGREEMENT_ID_COUPON_TRANSACTION_25].goods.sort(e);k[c.AGREEMENT_ID_COUPON_TRANSACTION_25].coverages.sort(h);k[c.AGREEMENT_ID_SIMULATE].divisions=g;k[c.AGREEMENT_ID_SIMULATE].goods.sort(e);k[c.AGREEMENT_ID_SIMULATE].coverages.sort(h);d=Object.keys(k);for(var b=0;b<d.length;b++){for(var t=k[d[b]].coverages[0],C=k[d[b]].coverages[0],p=0;p<k[d[b]].coverages.length;p++)k[d[b]].coverages[p].discountFee=
Math.round(k[d[b]].coverages[p].basefee*k[d[b]].discountRate/100),t.value>k[d[b]].coverages[p].value&&(t=k[d[b]].coverages[p]),C.value<k[d[b]].coverages[p].value&&(C=k[d[b]].coverages[p]);k[d[b]].lowCoverage=t;k[d[b]].highCoverage=C;k[d[b]].backgroundUrl=c.BACKGROUND_ROOT+d[b]+".jpg";k[d[b]].matrix=c.PUBLIC_AGREEMENT_MATRIX[d[b]]}a()},d)},u=function(a,d){n.query({},function(d){p=d;console.log("user agreement init success");d=p;for(var b=0;b<d.length;b++)d[b].goods.sort(e),d[b].coverages.sort(h);a(p)},
d)},B=function(a,d,b){void 0===k?t(function(){void 0===k||void 0===k[a]?b("\u534f\u8bae\u672a\u627e\u5230\uff0c\u8bf7\u8054\u7cfb\u7ba1\u7406\u5458"):d(k[a])},b):d(k[a])},w=function(a,d){for(var b={},t=0;t<d.length;t++)void 0!==a[d[t]]&&(b[d[t]]=a[d[t]]);return b},y=function(a,d,b){u(function(c){for(var p,f=0;f<c.length;f++)c[f].id===parseInt(a)&&(p=c[f]);void 0===p?b("\u672a\u627e\u5230\u534f\u8bae\uff0c\u8bf7\u8054\u7cfb\u7ba1\u7406\u5458"):void 0===g?t(function(){void 0===g?b("\u534f\u8bae\u7ebf\u8def\u672a\u627e\u5230\uff0c\u8bf7\u8054\u7cfb\u7ba1\u7406\u5458"):
(p.divisions=g,d(p))},b):(p.divisions=g,d(p))},b)};return{getProposal:function(a,d,b){a===c.AGREEMENT_ID_AUTO_PAYGO||a===c.AGREEMENT_ID_PAYGO_LOCAL_ZH||a===c.AGREEMENT_ID_PAYGO_JB||a===c.AGREEMENT_ID_PAYGO_JB_LIMIT_PRICE||a===c.AGREEMENT_ID_PAYGO_ZR||a===c.AGREEMENT_ID_PAYGO_LOCAL_JB_LITE||a===c.AGREEMENT_ID_PAYGO_JB_LITE||a===c.AGREEMENT_ID_SIGNUP_COUPON||a===c.AGREEMENT_ID_COUPON_TRANSACTION_25||a===c.AGREEMENT_ID_SIMULATE||a===c.AGREEMENT_ID_PAYGO_ZH_COLD_CHAIN?B(a,d,b):y(a,d,b)},findPublicByIdIn:function(a,
d,b){void 0===k?t(function(){void 0===k?b("\u534f\u8bae\u672a\u627e\u5230\uff0c\u8bf7\u8054\u7cfb\u7ba1\u7406\u5458"):d(w(k,a))},b):d(w(k,a))},all:function(a,d){void 0===p?u(function(){a(p)},function(a){console.log(a);d(a)}):a(p)},findPublic:function(a,d,b){B(a,d,b)},find:function(a,d,b){y(a,d,b)},clean:function(){p=void 0},preOrder:function(a,d,b){(new q(a)).$save({},function(a){d(a)},function(a){b(a)})},finishOrder:function(a,b,t){(new d).$save({id:a},function(a){b(a)},function(a){t(a)})}}}]);angular.module("app",["smsValidation","wechat","account"]).controller("AppCtrl",["$scope","$ionicModal","$rootScope","$state","authService","$ionicHistory","$ionicLoading","CommonAuthenticationService","Wechat","$timeout","$ionicPopup","AccountAPI",function(a,b,c,e,f,h,l,g,k,n,q,d){n(function(){window.loading_screen.finish()},1500);a.isQQBrowser=!!k.isQQBrowser();c.navToRoot=function(a,d){h.nextViewOptions({historyRoot:!0});e.go(a,d)};c.navToIndex=function(){c.navToRoot("app.portal.category")};b.fromTemplateUrl("templates/app/login.html",
{scope:a}).then(function(d){a.modal=d});a.loginConfirmed=function(){f.loginConfirmed()};a.quit=function(){g.quit(function(){c.$broadcast("event:auth-logout-complete")})};a.cancel=function(){f.loginCancelled()};a.$on("event:auth-loginRequired",function(d,b){console.log("Login required");l.hide();a.modal.show()});a.$on("event:auth-loginConfirmed",function(){a.modal.hide()});a.$on("event:auth-loginCancelled",function(){a.modal.hide();h.nextViewOptions({historyRoot:!0});c.navToIndex()});a.$on("event:auth-logout-complete",
function(){h.nextViewOptions({historyRoot:!0});c.navToIndex()});a.$on("event:auth-forbidden",function(){console.log("Auth forbidden");l.hide();a.modal.show()});a.updateAccountPopup=function(b,t,c,f,e){a.data={};a.fieldName=t;a.data[t]=b[t];q.show({template:'<form> <textarea rows="3"  ng-model="data[fieldName]" class="value-right"></textarea></form>',title:f,subTitle:e,scope:a,buttons:[{text:"\u53d6\u6d88"},{text:"<b>\u786e\u8ba4</b>",type:"button-positive",onTap:function(f){if(a.data[t])if("\u672a\u586b\u5199"==
a.data[t]||""==a.data[t])alert("\u8bf7\u786e\u8ba4"+c+"\u540d\u79f0\u6b63\u786e\u518d\u63d0\u4ea4");else{l.show({template:"<ion-spinner></ion-spinner>",delay:100});var e=b[t];b[t]=a.data[t];d.saveAccount(b,function(a){l.hide()},function(a){b[t]=e;alert("\u4fdd\u5b58"+c+"\u4fe1\u606f\u5931\u8d25"+a.data.error);l.hide()})}else f.preventDefault()}}]})};c.$on("$stateChangeStart",function(a,d,b,c,f){console.log(c.name+" to "+d.name)})}]);angular.module("claim",["ionic","claim.service","wechat"]).controller("ClaimCtrl",["$scope","$stateParams","$state","$ionicLoading","$timeout","ClaimAPI","$ionicHistory","Wechat","$ionicPopup","$rootScope","$ionicPopover",function(a,b,c,e,f,h,l,g,k,n,q){a.navtoroot=function(a,d){l.nextViewOptions({historyRoot:!0});c.go(a,d)};var d=function(d,b){a.transtionId=d;a.claim=void 0;e.show({template:"<ion-spinner></ion-spinner>",delay:100});h.get(d,function(d){a.claim=d;if(null!==a.claim.registerno&&void 0!==
a.claim.registerno&&""!==a.claim.registerno)a.showhistoryrecord=!0,a.navtoroot("^.result",{id:a.claim.transactionId,result:a.claim}),p();else if(a.estimaterangelist=[{id:1,name:"\u5c0f\u4e8e1\u4e07\u5143"},{id:2,name:"\u5927\u4e8e\u7b49\u4e8e1\u4e07\u5143"}],a.damageresonlist=[{id:"0100",name:"\u81ea\u7136\u707e\u5bb3"},{id:"0016",name:"\u610f\u5916\u4e8b\u6545\u81f4\u8f66\u4e0a\u8d27\u7269\u635f\u6bc1"},{id:"0018",name:"\u8f66\u8f7d\u8d27\u7269\u6389\u843d"},{id:"0019",name:"\u8f66\u8f7d\u8d27\u7269\u649e\u51fb"},
{id:"0020",name:"\u8f66\u8f86\u4e0e\u9a7e\u9a76\u5458\u540c\u65f6\u5931\u8e2a"},{id:"0024",name:"\u73bb\u7483\u5355\u72ec\u7834\u788e"},{id:"0007",name:"\u884c\u9a76\u4e2d\u5e73\u884c\u5760\u843d"},{id:"0009",name:"\u5168\u8f66\u88ab\u76d7\u7a83"},{id:"0045",name:"\u8f66\u8f86\u505c\u9a76\u635f\u5931"},{id:"0048",name:"\u8fd0\u8f7d\u8d27\u7269\u81ea\u8eab\u539f\u56e0\u8d77\u706b\u5f15\u8d77\u81ea\u71c3"},{id:"5026",name:"\u7ffb\u8f66"},{id:"1328",name:"\u7b2c\u4e09\u65b9\u539f\u56e0"},{id:"1100",
name:"\u5176\u5b83\u539f\u56e0"}],!0===b){if(void 0===a.claim.id||null===a.claim.id)a.claim.losstype=a.damageresonlist[0],a.claim.estimaterange=a.estimaterangelist[0];else{for(d=0;d<a.damageresonlist.length;d++){console.log(a.damageresonlist[d]);var c=a.damageresonlist[d];if(c.id===a.claim.losstype){a.claim.losstype=c;break}}for(d=0;d<a.estimaterangelist.length;d++)if(console.log(a.estimaterangelist[d]),c=a.estimaterangelist[d],c.id===a.claim.estimaterange){a.claim.estimaterange=c;break}}a.claim.damagedate=
new Date(a.claim.damagedate)}e.hide()},function(a){e.hide()})};a.startClaim=function(){null===a.claim.damageplace||void 0===a.claim.damageplace||""===a.claim.damageplace?alert("\u8bf7\u586b\u5199\u51fa\u9669\u5730\u70b9\u3002"):null===a.claim.damagedate||void 0===a.claim.damagedate||""===a.claim.damagedate?alert("\u8bf7\u586b\u5199\u51fa\u9669\u65f6\u95f4\u3002"):null===a.claim.notifyman||void 0===a.claim.notifyman||""===a.claim.notifyman?alert("\u8bf7\u586b\u5199\u62a5\u6848\u4eba\u59d3\u540d\u3002"):
null===a.claim.mobiletel||void 0===a.claim.mobiletel||""===a.claim.mobiletel?alert("\u8bf7\u586b\u5199\u62a5\u6848\u4eba\u624b\u673a\u53f7\u3002"):!1===/^1[3578]\d{9}$/.test(a.claim.mobiletel)?alert("\u8bf7\u586b\u5199\u6b63\u786e\u7684\u62a5\u6848\u4eba\u624b\u673a\u53f7\u3002"):null===a.claim.linkaddress||void 0===a.claim.linkaddress||""===a.claim.linkaddress?alert("\u8bf7\u586b\u5199\u62a5\u6848\u4eba\u90ae\u7bb1\u3002"):null===a.claim.damageobject||void 0===a.claim.damageobject||""===a.claim.damageobject?
alert("\u8bf7\u586b\u5199\u53d7\u635f\u6807\u7684\u3002"):null===a.claim.losstype||void 0===a.claim.losstype||""===a.claim.losstype?alert("\u8bf7\u586b\u5199\u51fa\u73b0\u539f\u56e0\u3002"):null!==a.claim.estimate&&void 0!==a.claim.estimate&&/^\d+$/.test(a.claim.estimate)?null===a.claim.damagedes||void 0===a.claim.damagedes||""===a.claim.damagedes?alert("\u8bf7\u586b\u5199\u4e8b\u6545\u7ecf\u8fc7\u3002"):(a.claim.estimaterange=1E4>=a.claim.estimate?a.estimaterangelist[0]:a.estimaterangelist[1],a.navtoroot("^.confirm",
{result:a.claim})):alert("\u8bf7\u586b\u5199\u6b63\u786e\u7684\u62a5\u635f\u91d1\u989d\u3002")};a.cancelClaim=function(){a.navtoroot("^.start",{result:a.claim})};a.saveClaim=function(){e.show({template:"<ion-spinner></ion-spinner>",delay:100});a.claim.transactionId=a.transtionId;a.claim.losstype=a.claim.losstype.id;a.claim.estimaterange=a.claim.estimaterange.id;1E4<=a.claim.estimate?h.saveClaim(a.claim,function(d){a.claim=d.data;h.commitClaim(a.claim,function(d){e.hide();a.claim=d.data;a.showhistoryrecord=
!0;a.navtoroot("^.result",{id:a.claim.transactionId,result:a.claim})},function(a){e.hide();alert("\u63d0\u4ea4\u62a5\u6848\u51fa\u73b0\u95ee\u9898\u8bf7\u7a0d\u540e\u518d\u8bd5\u3002")})},function(a){e.hide();alert("\u63d0\u4ea4\u62a5\u6848\u51fa\u73b0\u95ee\u9898\u8bf7\u7a0d\u540e\u518d\u8bd5\u3002")}):h.saveClaim(a.claim,function(d){a.navtoroot("^.upload",{id:a.claim.transactionId,result:a.claim})},function(a){e.hide();alert("\u63d0\u4ea4\u62a5\u6848\u51fa\u73b0\u95ee\u9898\u8bf7\u7a0d\u540e\u518d\u8bd5\u3002")})};
var p=function(){a.popover=q.fromTemplate('<ion-popover-view style="position: fixed;top: 0;left: 0;z-index: 10; width: 100%;height: 100%;"><ion-content scroll="false"><div id="rightDisplay" ng-if="bigImage" class="popover-backdrop" style="position: fixed;top: 0;left: 0;z-index: 10; width: 100%;height: 100%;" ng-click="hideBigImage()"><img class="img-responsive" style="position: absolute;top: 10%;left: 50%;z-index: 10;display: block;margin-top: 18px; margin-left: -165px;height: 420px;width: 330px; box-shadow: 0 1px 3px rgba(0, 0, 0, 0.4);" src="{{Url}}"/></div></ion-content></ion-popover-view>',
{scope:a})};a.openPopover=function(d){a.popover.show(d)};a.closePopover=function(){a.popover.hide()};a.bigImage=!1;a.Url="#";a.hideBigImage=function(){a.bigImage=!1;a.closePopover()};a.showBigImage=function(d,b){a.Url=d;a.bigImage=!0;a.openPopover(b)};n.$on("$stateChangeStart",function(b,c,f,e,y){"app.claim.start"!==c.name&&"app.claim.result"!==c.name||"app.claim.confirm"===e.name||void 0===f.id||""===f.id.id||d(f.id,!0);"app.claim.result"===c.name&&p();"app.claim.result"===e.name&&(a.claim=void 0);
"app.claim.upload"===c.name&&"app.claim.confirm"===e.name&&g.hookShareAll(!0,h.getShareContent(f.result),function(){},function(a){alert(a)})});void 0!==b.id&&""!==b.id&&d(b.id,!0)}]).controller("ClaimUploadCtrl",["$scope","$stateParams","$state","$ionicLoading","$timeout","ClaimAPI","$ionicHistory","Wechat","$ionicPopup","$rootScope",function(a,b,c,e,f,h,l,g,k,n){a.navtoroot=function(a,d){l.nextViewOptions({historyRoot:!0});c.go(a,d)};f(function(){window.loading_screen.finish()},1500);var q=function(d){a.transtionId=
d;a.claim=void 0;e.show({template:"<ion-spinner></ion-spinner>",delay:100});h.get(d,function(d){a.claim=d;e.hide()},function(a){e.hide()})},d=null,p=!1;a.getlocation=function(){p=!1;e.show({template:"<ion-spinner></ion-spinner>",delay:100});var b=f(function(){!1===p&&(e.hide(),alert("\u83b7\u53d6\u5730\u7406\u4f4d\u7f6e\u4fe1\u606f\u5931\u8d25\u8bf7\u7a0d\u540e\u518d\u8bd5"))},6E3);g.getUserLocation(function(c){p=!0;b&&f.cancel(b);JSON.stringify(c);var e=c.latitude;c=c.longitude;var w=new qq.maps.LatLng(e,
c);a.claim.latitude=e;a.claim.longitude=c;d.getAddress(w)},function(a){e.hide();alert(a)})};a.uploadFile=function(d){g.chooseImage(function(b){a.claim.imgList[d]=b.toString();e.show({template:"<ion-spinner></ion-spinner>",delay:100});g.uploadImage(a.claim.imgList[d],function(b){h.downloadFile(a.claim.id,b,d,function(b){e.hide();a.claim.imgList[d]=b.data;a.$apply()},function(a){e.hide()})},function(a){e.hide()})},function(a){alert(a)})};a.commitClaim=function(){if(void 0===a.claim.gpsaddress||""===
a.claim.gpsaddress)alert("\u8bf7\u70b9\u51fb\u2018\u83b7\u53d6\u5730\u7406\u4f4d\u7f6e\u4fe1\u606f\u2019\u6309\u94ae\uff0c\u8bbe\u7f6e\u5f53\u524d\u4f4d\u7f6e\u4fe1\u606f\uff01");else if(void 0===a.claim.imgList)alert("\u8bf7\u4f9d\u6b21\u9009\u62e9\u51719\u5f20\u7167\u7247\u8fdb\u884c\u4e0a\u4f20");else{for(var d=0;d<a.claim.imgList.length;d++)if(void 0===a.claim.imgList[d]){alert("\u8bf7\u4f9d\u6b21\u9009\u62e9\u51719\u5f20\u7167\u7247\u8fdb\u884c\u4e0a\u4f20");return}var d=a.claim.imgList.length,
b=9-d;9!==d?alert("\u8bf7\u4f9d\u6b21\u9009\u62e9\u51719\u5f20\u7167\u7247\u8fdb\u884c\u4e0a\u4f20,\u5df2\u4e0a\u4f20"+d+"\u5f20 \u8fd8\u9700"+b+"\u5f20"):(e.show({template:"<ion-spinner></ion-spinner>",delay:100}),h.commitClaim(a.claim,function(d){e.hide();a.claim=d.data;a.showhistoryrecord=!0;a.navtoroot("^.result",{id:a.claim.transactionId,result:a.claim})},function(a){e.hide();alert("\u63d0\u4ea4\u62a5\u6848\u51fa\u73b0\u95ee\u9898\u8bf7\u7a0d\u540e\u518d\u8bd5\u3002")}))}};n.$on("$stateChangeStart",
function(d,b,c,f,e){"app.claim.upload"===f.name&&(a.claim=void 0,p=!1);"app.claim.upload"===b.name&&(JSON.stringify(c),q(c.id))});void 0!==b.id&&""!==b.id&&q(b.id);(function(){d=new qq.maps.Geocoder({complete:function(d){e.hide();a.claim.gpsaddress=d.detail.addressComponents.province===d.detail.addressComponents.city?d.detail.addressComponents.country+d.detail.addressComponents.province+d.detail.addressComponents.city+d.detail.addressComponents.district+d.detail.addressComponents.street+d.detail.addressComponents.streetNumber:
d.detail.addressComponents.country+d.detail.addressComponents.city+d.detail.addressComponents.district+d.detail.addressComponents.street+d.detail.addressComponents.streetNumber;a.$apply()}})})()}]).controller("ClaimListCtrl",["$scope","$stateParams","$state","$ionicLoading","$timeout","ClaimAPI","$ionicHistory","Wechat","$ionicPopup","$rootScope",function(a,b,c,e,f,h,l,g,k,n){f(function(){window.loading_screen.finish()},1500);n.$on("$stateChangeStart",function(d,b,c,f,e){"app.claim.list"===f.name&&
(a.claims=void 0);"app.claim.list"===b.name&&q()});var q=function(){e.show({template:"<ion-spinner></ion-spinner>",delay:100});h.getAll(function(d){JSON.stringify(d);a.claims=d;e.hide()},function(a){e.hide();alert("\u83b7\u53d6\u7406\u8d54\u4fe1\u606f\u5931\u8d25\u8bf7\u7a0d\u540e\u518d\u8bd5\u3002")})};q()}]).controller("ClaimHistoryListCtrl",["$scope","$stateParams","$state","$ionicLoading","$timeout","ClaimAPI","$ionicHistory","Wechat","$ionicPopup",function(a,b,c,e,f,h,l,g,k){f(function(){window.loading_screen.finish()},
1500);(function(b){a.id=b.id;e.show({template:"<ion-spinner></ion-spinner>",delay:100});h.getRecord(b,function(b){JSON.stringify(b);a.claimrecords=b;e.hide()},function(a){e.hide();alert("\u83b7\u53d6\u7406\u8d54\u8bb0\u5f55\u4fe1\u606f\u5931\u8d25\u8bf7\u7a0d\u540e\u518d\u8bd5\u3002")})})(b.id)}]);
angular.module("claim.service",["ngResource"]).service("ClaimAPI",["$resource","urlConfig","wechatConstants",function(a,b,c){var e=a(b.REST_END_POINT+"/api/claim/:transtionId",{transtionId:"@transtionId"},{query:{method:"GET",isArray:!1,timeout:1E4}},null),f=a(b.REST_END_POINT+"/api/claim/queryrecord/:claimid",{claimid:"@claimid"},{query:{method:"GET",isArray:!1,timeout:1E4}},null),h=a(b.REST_END_POINT+"/api/claim/getAll",null,{query:{method:"GET",isArray:!1,timeout:1E4}},null),l=a(b.REST_END_POINT+
"/api/claim/create",null,{save:{method:"POST",isArray:!1,timeout:1E4}},null),g=a(b.REST_END_POINT+"/api/claim/downloadFile/:Id/:fileId/:fileIndex",{transtionId:"@transtionId",fileId:"@fileId",fileIndex:"@fileIndex"},{query:{method:"GET",isArray:!1,timeout:1E4}},null),k=a(b.REST_END_POINT+"/api/claim/save",null,{save:{method:"POST",isArray:!1,timeout:6E4}},null);return{get:function(a,b,d){e.query({transtionId:a},function(a){b(a.data)},function(a){d(a.error)})},getRecord:function(a,b,d){f.query({claimid:a},
function(a){b(a.data)},function(a){d(a.error)})},getAll:function(a,b){h.query(function(d){a(d.data)},function(a){b(a.error)})},saveClaim:function(a,b,d){l.save(a,function(a){b(a)},function(a){d(a)})},commitClaim:function(a,b,d){k.save(a,function(a){b(a)},function(a){d(a)})},downloadFile:function(a,b,d,c,f){g.query({Id:a,fileId:b,fileIndex:d},function(a){c(a)},function(a){f(a)})},getShareUrl:function(a){return b.APP_ROOT+c.CLAIM_SHARE_ROOT+a},getShareContent:function(a){var b={name:"[\u5927\u5723\u4fdd\u9669]\u7533\u8bf7\u7406\u8d54"};
b.description="\u8bf7\u4e0a\u4f20\u4fdd\u5355[\u4fdd\u5355\u53f7:"+a.policyno+"]\u7406\u8d54\u6240\u9700\u6750\u6599";b.url=this.getShareUrl(a.id);return b}}}]);angular.module("emessage","ionic ngCookies angular.filter monospaced.qrcode app account agreement coupon proposal transaction redirect promotion invoice invHistory claim wechat regression portal templates".split(" ")).constant("urlConfig",{REST_END_POINT:"http://m.baoxian72.com/API",APP_ROOT:"http://m.baoxian72.com"}).constant("accountConstants",{ACCOUNT_TYPE_NORMAL:0,ACCOUNT_TYPE_AGREEMENT:1}).constant("agreementConstants",{AGREEMENT_ID_AUTO_PAYGO:"AUTO_PAYGO",AGREEMENT_ID_PAYGO_LOCAL_ZH:"PAYGO_LOCAL_ZH",
AGREEMENT_ID_PAYGO_JB:"PAYGO_JB",AGREEMENT_ID_PAYGO_JB_LIMIT_PRICE:"PAYGO_JB_LIMIT_PRICE",AGREEMENT_ID_PAYGO_ZR:"PAYGO_ZR",AGREEMENT_ID_PAYGO_JB_LITE:"PAYGO_JB_LITE",AGREEMENT_ID_PAYGO_LOCAL_JB_LITE:"PAYGO_LOCAL_JB_LITE",AGREEMENT_ID_SIGNUP_COUPON:"SIGNUP_COUPON",AGREEMENT_ID_COUPON_TRANSACTION_25:"COUPON_TRANSACTION_25",AGREEMENT_ID_PAYGO_ZH_COLD_CHAIN:"PAYGO_ZH_COLD_CHAIN",AGREEMENT_ID_SIMULATE:"SIMULATE",AGREEMENT_TYPE_USER:"USER",AGREEMENT_ROUTE_PRESET_BOTH:"BOTH",AGREEMENT_ROUTE_PRESET_NONE:"NONE",
AGREEMENT_ROUTE_PRESET_EQUAL:"EQUAL",AGREEMENT_ROUTE_PRESET_DISTANCE:"DISTANCE",PUBLIC_AGREEMENT_MATRIX:{AUTO_PAYGO:{region:"\u5168\u56fd\u8303\u56f4\uff08\u6e2f\u6fb3\u53f0\u5730\u533a\u9664\u5916\uff09",mainItem:"\u7efc\u5408\u9669",description:"\u4fdd\u969c\u5168\u9762\uff0c\u5bf9\u4e8e\u8d27\u503c\u76f8\u5bf9\u8f83\u9ad8\u7684\u8d27\u7269\u3002\u5982\u5e38\u89c1\u4ea7\u6210\u54c1\uff0c\u670d\u88c5\u3001\u7535\u5b50\u8bbe\u5907\u3001\u673a\u68b0\u8bbe\u5907\u7b49\u7269\u54c1\u6700\u4e3a\u9002\u7528\u3002\u5c24\u5176\u662f\u5bf9\u4e8e100\u4e07\u4ee5\u4e0a\u8d27\u503c\u7684\u9ad8\u4ef7\u503c\u8d27\u54c1\uff0c\u6b64\u4ea7\u54c1\u53ef\u4e0a\u8c03\u989d\u5ea6\u6700\u9ad8\u8fbe500\u4e07\u5143\uff0c\u66f4\u4e3a\u9002\u7528\u3002\u6b64\u4ea7\u54c1\u4e3a\u3010\u514d\u8ffd\u507f\u3011\u4ea7\u54c1\uff0c\u5373\u627f\u4fdd\u4eba\u653e\u5f03\u5bf9\u6295\u4fdd\u4eba\u7684\u8ffd\u507f\u6743\u3002"},
PAYGO_JB:{region:"\u5168\u56fd\u8303\u56f4\uff08\u6e2f\u6fb3\u53f0\u5730\u533a\u9664\u5916\uff09",mainItem:"\u57fa\u672c\u9669",description:"\u4fdd\u8d39\u66f4\u4f18\u60e0\uff0c\u9002\u5408\u4e8e\u8de8\u7701\u4e1a\u52a1\u3002\u5bf9\u4e8e\u8d27\u503c\u4f4e\uff0c\u5bf9\u4fdd\u9669\u4fdd\u969c\u8303\u56f4\u8981\u6c42\u4e0d\u9ad8\u7684\u8d27\u7269\uff0c\u5982\u539f\u6750\u6599\uff0c\u5927\u5b97\u6563\u8d27\u7b49\u7269\u54c1\u66f4\u9002\u7528\u3002\u627f\u4fdd\u4eba\u653e\u5f03\u5bf9\u6295\u4fdd\u4eba\u7684\u8ffd\u507f\u6743\u3002\u6b64\u4ea7\u54c1\u4e3a\u3010\u514d\u8ffd\u507f\u3011\u4ea7\u54c1\uff0c\u5373\u627f\u4fdd\u4eba\u653e\u5f03\u5bf9\u6295\u4fdd\u4eba\u7684\u8ffd\u507f\u6743\u3002"},
PAYGO_LOCAL_ZH:{region:"\u8fd0\u8f93\u7ebf\u8def\u540c\u7701\u8303\u56f4\u5185\uff08\u6e2f\u6fb3\u53f0\u5730\u533a\u9664\u5916\uff09",mainItem:"\u7efc\u5408\u9669",description:"\u9002\u5408\u4e8e\u7701\u540c\u7701\u8303\u56f4\u5185\uff08\u7701\u7ea7\u533a\u57df\uff09\u7684\u914d\u9001\u4e1a\u52a1\u3002\u5bf9\u4e8e\u56de\u7a0b\u8d27\u6216\u5c3e\u8d27\u5206\u6d3e\u73af\u8282\u66f4\u52a0\u9002\u7528\u3002\u540c\u65f6\u7531\u4e8e\u4fdd\u969c\u9650\u989d\u4e3a20-100\u4e07\u5185\u76845\u6863\uff0c\u5206\u7c7b\u66f4\u7ec6\u81f4\uff0c\u9009\u62e9\u66f4\u7075\u6d3b\u3002\u627f\u4fdd\u4eba\u653e\u5f03\u5bf9\u6295\u4fdd\u4eba\u7684\u8ffd\u507f\u6743\u3002\u6b64\u4ea7\u54c1\u4e3a\u3010\u514d\u8ffd\u507f\u3011\u4ea7\u54c1\uff0c\u5373\u627f\u4fdd\u4eba\u653e\u5f03\u5bf9\u6295\u4fdd\u4eba\u7684\u8ffd\u507f\u6743\u3002"},
PAYGO_JB_LITE:{region:"\u5168\u56fd\u8303\u56f4\uff08\u6e2f\u6fb3\u53f0\u5730\u533a\u9664\u5916\uff09",mainItem:"\u57fa\u672c\u9669",description:"\u4fdd\u8d39\u66f4\u4f18\u60e0\uff0c\u9002\u5408\u4e8e\u8de8\u7701\u4e1a\u52a1\u3002\u5bf9\u4e8e\u8d27\u503c\u4f4e\uff0c\u5bf9\u4fdd\u9669\u4fdd\u969c\u8303\u56f4\u8981\u6c42\u4e0d\u9ad8\u7684\u8d27\u7269\uff0c\u5982\u539f\u6750\u6599\uff0c\u5927\u5b97\u6563\u8d27\u7b49\u7269\u54c1\u66f4\u9002\u7528\u3002\u4ec5\u627f\u4fdd\u7531\u4e8e\u706b\u707e\u3001\u7206\u70b8\u3001\u4ea4\u901a\u5de5\u5177\u610f\u5916\u4e8b\u6545\u5f15\u8d77\u7684\u8d27\u7269\u635f\u5931\u3002\u6bcf\u6b21\u4e8b\u6545\u7edd\u5bf9\u514d\u8d54\uffe525000\u5143\u6216\u8005\u635f\u5931\u91d1\u989d\u768410%\uff0c\u4ee5\u9ad8\u8005\u4e3a\u51c6\u3002\u6b64\u4ea7\u54c1\u4e3a\u3010\u514d\u8ffd\u507f\u3011\u4ea7\u54c1\uff0c\u5373\u627f\u4fdd\u4eba\u653e\u5f03\u5bf9\u6295\u4fdd\u4eba\u7684\u8ffd\u507f\u6743\u3002"},
PAYGO_LOCAL_JB_LITE:{region:"\u5168\u56fd\u8303\u56f4\uff08\u6e2f\u6fb3\u53f0\u5730\u533a\u9664\u5916\uff09",mainItem:"\u57fa\u672c\u9669",description:"\u9002\u5408\u4e8e\u7701\u540c\u7701\u8303\u56f4\u5185\uff08\u7701\u7ea7\u533a\u57df\uff09\u7684\u914d\u9001\u4e1a\u52a1\u3002\u5bf9\u4e8e\u56de\u7a0b\u8d27\u6216\u5c3e\u8d27\u5206\u6d3e\u73af\u8282\u66f4\u52a0\u9002\u7528\u3002\u4ec5\u627f\u4fdd\u7531\u4e8e\u706b\u707e\u3001\u7206\u70b8\u3001\u4ea4\u901a\u5de5\u5177\u610f\u5916\u4e8b\u6545\u5f15\u8d77\u7684\u8d27\u7269\u635f\u5931\u3002\u6bcf\u6b21\u4e8b\u6545\u7edd\u5bf9\u514d\u8d54\uffe525000\u5143\u6216\u8005\u635f\u5931\u91d1\u989d\u768410%\uff0c\u4ee5\u9ad8\u8005\u4e3a\u51c6\u3002\u6b64\u4ea7\u54c1\u4e3a\u3010\u514d\u8ffd\u507f\u3011\u4ea7\u54c1\uff0c\u5373\u627f\u4fdd\u4eba\u653e\u5f03\u5bf9\u6295\u4fdd\u4eba\u7684\u8ffd\u507f\u6743\u3002"},
PAYGO_ZR:{region:"\u5168\u56fd\u8303\u56f4\uff08\u6e2f\u6fb3\u53f0\u5730\u533a\u9664\u5916\uff09",mainItem:"\u8d23\u4efb\u9669",description:"\u4fdd\u969c\u5168\u9762\uff0c\u5bf9\u4e8e\u8d27\u503c\u76f8\u5bf9\u8f83\u9ad8\u7684\u8d27\u7269\u3002\u5982\u5e38\u89c1\u4ea7\u6210\u54c1\uff0c\u670d\u88c5\u3001\u7535\u5b50\u8bbe\u5907\u3001\u673a\u68b0\u8bbe\u5907\u7b49\u7269\u54c1\u6700\u4e3a\u9002\u7528\u3002\u5c24\u5176\u662f\u5bf9\u4e8e100\u4e07\u4ee5\u4e0a\u8d27\u503c\u7684\u9ad8\u4ef7\u503c\u8d27\u54c1\uff0c\u6b64\u4ea7\u54c1\u53ef\u4e0a\u8c03\u989d\u5ea6\u6700\u9ad8\u8fbe250\u4e07\u5143\uff0c\u66f4\u4e3a\u9002\u7528\u3002"},
PAYGO_ZH_COLD_CHAIN:{region:"\u5168\u56fd\u8303\u56f4\uff08\u6e2f\u6fb3\u53f0\u5730\u533a\u9664\u5916\uff09",mainItem:"\u7efc\u5408\u9669",description:"\u672c\u4ea7\u54c1\u4e13\u9879\u9488\u5bf9\u4e8e\u51b7\u51bb\u8089\u7c7b\u5236\u54c1\u5168\u56fd\u8303\u56f4\u5185\u7684\u8fd0\u8f93\u670d\u52a1\u3002\u4ea7\u54c1\u4fdd\u969c\u5168\u9762\uff0c\u4e0d\u4ec5\u627f\u4fdd\u5e38\u89c1\u706b\u707e\u7206\u70b8\u3001\u4ea4\u901a\u4e8b\u6545\u7b49\u8fd0\u8f93\u98ce\u9669\uff0c\u8fd8\u627f\u4fdd\u51b7\u51bb\u8089\u7c7b\u5236\u54c1\u7531\u4e8e\u51b7\u85cf\u673a\u5668\u6216\u9694\u6e29\u8bbe\u5907\u7684\u635f\u574f\u6216\u8005\u8f66\u53a2\u5185\u8d2e\u5b58\u51b0\u5757\u7684\u6eb6\u5316\u6240\u9020\u6210\u7684\u89e3\u51bb\u6eb6\u5316\u800c\u8150\u8d25\u7684\u635f\u5931\u3002\u4fdd\u969c\u989d\u5ea6\u9ad8\uff0c\u6700\u9ad8\u53ef\u6295\u4fdd\u81f3100\u4e07\u5143\u3002\u4fdd\u969c\u8303\u56f4\u5e7f\u6cdb\uff0c\u5982\u5e38\u89c1\u7684\u732a\u725b\u7f8a\u8089\u7c7b\u3001\u9e21\u8089\u7c7b\u3001\u51b7\u51bb\u9c7c\u7c7b\u5236\u54c1\u7b49\u5747\u53ef\u9002\u7528\u3002"}},
BACKGROUND_ROOT:"/img/agreement-public/",PAY_METHOD_CREDIT:"credit",PAY_METHOD_H5:"h5",PAY_METHOD_COUPON:"coupon",PAY_METHOD_SIMULATE:"simulate",PAY_PROVIDER_WX:"wxmppay",PAY_PROVIDER_ALI:"alipay",PAY_PROVIDER_CREDIT:"credit",PAY_PROVIDER_COUPON:"coupon",PAY_PROVIDER_SIMULATE:"simulate",PRODUCT_NAME_SIMULATE:"\u6a21\u62df\u7efc\u5408\u9669",INVOICE_TYPES:{NORMAL:"\u666e\u901a\u53d1\u7968",VALUE_ADDED_SPECIAL:"\u589e\u503c\u7a0e\u4e13\u7528\u53d1\u7968"},INVOICE_TYPE_NORMAL:"NORMAL"}).constant("promotionConstants",
{ENTRY_POINT_PAY_SUCCESS:"PAY_SUCCESS",BATCH_SOURCE_TYPE_TRANSACTION:"TRANSACTION",PIC_URL_DEFAULT:"defaultpic",PIC_ROOT:"img/promotion/"}).constant("publicPromotionConstants",{ACTION_COLLECT:"COLLECT",PIC_ROOT:"img/promotion/"}).constant("promotionBackgroundColors",{"16036acd775e970991e0677af90449f4":"#FFF",a3fb6acd775e77af90449f4970991e06:"#FFF",a3fb6acd775e970991e0677af90449f4:"#FFF","16046acd775e970991e0677af90449f4":"#FFF",a3fb6acd775e77af90449f4970991e56:"#FFF"}).constant("couponConstants",
{COUPON_TYPE_TRANS:"TRANSACTION",COUPON_TYPE_PRODUCT_VOUCHER:"PRODUCT_VOUCHER",COUPON_TYPE_DISCOUNT_VOUCHER:"DISCOUNT_VOUCHER",COUPON_TYPE_LIMIT_PRICE:"LIMIT_PRICE",COUPON_STATUS_NOT_USED:0,COUPON_SCOPE_TYPE_AGREEMENT_TYPE:"AGREEMENT_TYPE",COUPON_SCOPE_TYPE_TAG:"TAG",COUPON_SCOPE_CONFIG_USER:"USER",COUPON_SCOPE_CONFIG_PAYGO:"PAYGO"}).constant("invoiceConstants",{HISTORY_STATUS_PROCESSING:1,HISTORY_STATUS_MAILED:7,ITEM_TYPE_TRANSACTION:"TRANSACTION",ITEM_TYPE_CHARGE_RECORD:"CHARGE_RECORD",TYPES:{NORMAL:"\u666e\u901a\u53d1\u7968",
VALUE_ADDED_SPECIAL:"\u589e\u503c\u7a0e\u4e13\u7528\u53d1\u7968"},TYPE_NORMAL:"NORMAL"}).constant("eventNames",{PROPOSAL_SUCCESS:"proposal-suc",INVOICE_APPLY_SUCCESS:"invoice-apply-suc",AGREEMENT_CHARGE_SUCCESS:"agreement-charge-suc",CREDIT_EXCHANGE_SUCCESS:"credit-exchange-suc"}).run(["$ionicPlatform",function(a){a.ready(function(){window.cordova&&window.cordova.plugins.Keyboard&&(cordova.plugins.Keyboard.hideKeyboardAccessoryBar(!0),cordova.plugins.Keyboard.disableScroll(!0));window.StatusBar&&
StatusBar.styleDefault()})}]).config(["$stateProvider","$urlRouterProvider","$ionicConfigProvider",function(a,b,c){a.state("redirect",{url:"/redirect?providerUserId&mobile&xAuthToken&state&detail",templateUrl:"",controller:"redirectCtrl"}).state("promotion",{url:"/promotion/:id",template:"",controller:"PublicPromotionCtrl"}).state("survey",{url:"/survey/:id",template:"",controller:"PublicSurveyCtrl"}).state("app",{url:"/app",templateUrl:"templates/app/menu.html",controller:"AppCtrl"}).state("app.proposal",
{url:"/proposal?agreementId",views:{menuContent:{template:'<ion-nav-view name="proposalContent" class="proposal"></ion-nav-view>',controller:"ProposalCtrl"}}}).state("app.proposal.start",{url:"/start?payCouponId",views:{proposalContent:{templateUrl:"templates/app/proposal.start.html"}}}).state("app.proposal.pay",{url:"/pay",views:{proposalContent:{templateUrl:"templates/app/proposal.pay.html"}}}).state("app.proposal.result",{url:"/result",views:{proposalContent:{templateUrl:"templates/app/proposal.result.html"}}}).state("app.transaction",
{url:"/transaction",views:{menuContent:{template:'<ion-nav-view name="transactionContent" class="transaction"></ion-nav-view>',controller:"TransactionCtrl"}}}).state("app.transaction.list",{url:"/",views:{transactionContent:{templateUrl:"templates/app/transaction.list.html",controller:"TransactionListCtrl"}}}).state("app.transaction.listQQx5",{url:"/qqx5",views:{transactionContent:{templateUrl:"templates/app/transaction.list.qqx5.html",controller:"TransactionListQQx5Ctrl"}}}).state("app.transaction.detail",
{url:"/:id",views:{transactionContent:{templateUrl:"templates/app/transaction.detail.html",controller:"TransactionDetailCtrl"}}}).state("app.portal",{url:"/portal",views:{menuContent:{template:'<ion-nav-view name="portalContent" class="portal"></ion-nav-view>',controller:"PortalCtrl"}}}).state("app.portal.category",{url:"/:id",views:{portalContent:{templateUrl:"templates/app/portal.html",controller:"PortalCategoryCtrl"}}}).state("app.agreement",{url:"/agreement",views:{menuContent:{template:'<ion-nav-view name="agreementContent" class="agreement"></ion-nav-view>',
controller:"AgreementCtrl"}}}).state("app.agreement.list",{url:"/?toPropose&paygo&user",views:{agreementContent:{templateUrl:"templates/app/agreement.list.html"}}}).state("app.agreement.publicDetail",{url:"/public/:id",views:{agreementContent:{templateUrl:"templates/app/agreement.public.detail.html",controller:"AgreementPublicDetailCtrl"}}}).state("app.agreement.detail",{url:"/:id",views:{agreementContent:{templateUrl:"templates/app/agreement.detail.html",controller:"AgreementDetailCtrl"}}}).state("app.agreement.charge",
{url:"/charge/:id",views:{agreementContent:{templateUrl:"templates/app/agreement.charge.html",controller:"AgreementChargeCtrl"}}}).state("app.claim",{url:"/claim/:id",views:{menuContent:{template:'<ion-nav-view name="claimContent" class="claim"></ion-nav-view>',controller:"ClaimCtrl"}}}).state("app.claim.start",{url:"/start/:id",views:{claimContent:{templateUrl:"templates/app/claim.start.html"}}}).state("app.claim.confirm",{url:"/confirm",views:{claimContent:{templateUrl:"templates/app/claim.confirm.html"}}}).state("app.claim.upload",
{url:"/:id",views:{claimContent:{templateUrl:"templates/app/claim.upload.html",controller:"ClaimUploadCtrl"}},params:{id:null,result:null}}).state("app.claim.historylist",{url:"/historylist/:id",views:{claimContent:{templateUrl:"templates/app/claim.detail.list.html",controller:"ClaimHistoryListCtrl"}}}).state("app.claim.list",{url:"/:id",views:{claimContent:{templateUrl:"templates/app/claim.list.html",controller:"ClaimListCtrl"}}}).state("app.claim.result",{url:"/result/:id",views:{claimContent:{templateUrl:"templates/app/claim.result.html"}},
params:{id:null,result:null}}).state("app.claimIntro",{url:"/claimIntro",views:{menuContent:{templateUrl:"templates/app/public.claimIntro.html"}}}).state("app.account",{url:"/account",views:{menuContent:{template:'<ion-nav-view name="accountContent" class="account"></ion-nav-view>',controller:"AccountCtrl"}}}).state("app.account.show",{url:"/",views:{accountContent:{templateUrl:"templates/app/account.html"}}}).state("app.account.salesOrComm",{url:"/salesOrComm",views:{accountContent:{controller:"SalesOrCommCtrl"}}}).state("app.account.community",
{url:"/community",views:{accountContent:{template:'<ion-nav-view name="communityContent" class="community"></ion-nav-view>'}}}).state("app.account.community.invite",{url:"/invite",views:{communityContent:{templateUrl:"templates/app/account.community.invite.html",controller:"CommInviteCtrl"}}}).state("app.account.community.credit",{url:"/credit",views:{communityContent:{templateUrl:"templates/app/account.community.credit.html",controller:"CommCreditCtrl"}}}).state("app.account.community.exchange",
{url:"/exchange",views:{communityContent:{templateUrl:"templates/app/account.community.exchange.html",controller:"CommExchangeCtrl"}}}).state("app.account.sales",{url:"/sales",views:{accountContent:{template:'<ion-nav-view name="salesContent" class="sales"></ion-nav-view>'}}}).state("app.account.sales.credit",{url:"/credit",views:{salesContent:{templateUrl:"templates/app/account.sales.credit.html",controller:"CommCreditCtrl"}}}).state("app.account.sales.invite",{url:"/invite",views:{salesContent:{templateUrl:"templates/app/account.sales.invite.html",
controller:"CommInviteCtrl"}}}).state("app.promotion",{url:"/promotion/:id?sourceType&sourceDetail",views:{menuContent:{templateUrl:"templates/app/promotion.html",controller:"PromotionCtrl"}}}).state("app.coupon",{url:"/coupon",views:{menuContent:{template:'<ion-nav-view name="couponContent" class="coupon"></ion-nav-view>',controller:"CouponCtrl"}}}).state("app.coupon.list",{url:"/",views:{couponContent:{templateUrl:"templates/app/coupon.list.html",controller:"CouponListCtrl"}}}).state("app.coupon.listQQx5",
{url:"/qqx5",views:{couponContent:{templateUrl:"templates/app/coupon.list.qqx5.html",controller:"CouponListQQx5Ctrl"}}}).state("app.invoice",{url:"/invoice",views:{menuContent:{template:'<ion-nav-view name="invoiceContent" class="invoice"></ion-nav-view>',controller:"InvoiceListCtrl"}}}).state("app.invoice.list",{url:"/",views:{invoiceContent:{templateUrl:"templates/app/invoice.list.html"}}}).state("app.invoice.apply",{url:"/apply",views:{invoiceContent:{templateUrl:"templates/app/invoice.apply.html",
controller:"InvoiceApplyCtrl"}}}).state("app.invHistory",{url:"/invHistory",views:{menuContent:{template:'<ion-nav-view name="invHistoryContent" class="invHistory"></ion-nav-view>',controller:"InvHistoryListCtrl"}}}).state("app.invHistory.list",{url:"/",views:{invHistoryContent:{templateUrl:"templates/app/invHistory.list.html"}}}).state("app.invHistory.detail",{url:"/:id",views:{invHistoryContent:{templateUrl:"templates/app/invHistory.detail.html",controller:"InvHistoryDetailCtrl"}}});b.otherwise("/app/portal/");
c.views.transition("none");c.backButton.text("\u8fd4\u56de")}]);angular.module("coupon",["coupon.service","wechat","ng-iscroll"]).controller("CouponCtrl",["$scope","$state","$ionicHistory","CouponAPI","$rootScope","$ionicLoading","eventNames","couponConstants","agreementConstants",function(a,b,c,e,f,h,l,g,k){var n=function(){a.coupons=[];a.refresh(function(){h.show({template:"<ion-spinner></ion-spinner>",delay:100})},function(){h.hide()},function(){f.navToIndex()})},q=function(){a.coupons=void 0;a.pageNumber=void 0;a.hasCoupon=void 0;a.initFinish=void 0};a.refresh=
function(d,b,c){d();e.refresh(function(d){a.coupons=d;a.pageNumber=0;a.hasCoupon=!(void 0===a.coupons||0===a.coupons.length);a.initFinish=!0;b()},function(d){a.initFinish=!0;console.log(d);alert("\u5237\u65b0\u5931\u8d25\uff0c\u8bf7\u7a0d\u540e\u518d\u8bd5");b();c()})};a.isTransType=function(a){return a.fullfillType===g.COUPON_TYPE_TRANS};a.isLimitPriceType=function(a){return a.fullfillType===g.COUPON_TYPE_LIMIT_PRICE};a.isVoucherType=function(a){return a.fullfillType===g.COUPON_TYPE_PRODUCT_VOUCHER};
a.isDiscountType=function(a){return a.fullfillType===g.COUPON_TYPE_DISCOUNT_VOUCHER};a.isNotUsed=function(a){return a.status===g.COUPON_STATUS_NOT_USED};a.navToProposal=function(a){if(a.fullfillType===g.COUPON_TYPE_TRANS)b.go("app.proposal.start",{agreementId:a.fullfillConfig,payCouponId:a.id});else{for(var c,f,e,k,w=0;w<a.scopes.length;w++)a.scopes[w].type===g.COUPON_SCOPE_TYPE_AGREEMENT_TYPE?(c=1,f=a.scopes[w].config):a.scopes[w].type===g.COUPON_SCOPE_TYPE_TAG&&a.scopes[w].config===g.COUPON_SCOPE_CONFIG_PAYGO?
e=1:a.scopes[w].type===g.COUPON_SCOPE_TYPE_TAG&&a.scopes[w].config===g.COUPON_SCOPE_CONFIG_USER&&(k=1);1===c?b.go("app.proposal.start",{agreementId:f,payCouponId:a.id}):b.go("app.agreement.list",{toPropose:"1",paygo:e,user:k})}};a.loadNext=function(d){a.canLoadNext()&&e.getPage(a.pageNumber+1,function(b){if(void 0!==b&&0!==b.length){for(var c=0;c<b.length;c++)a.coupons.push(b[c]);a.pageNumber++}d()},function(a){alert(a);d()})};a.canLoadNext=function(){return e.hasMoreToLoad()};n();f.$on("$stateChangeStart",
function(a,b,c,f,e){"app.coupon"!==b.name&&"app.coupon.list"!==b.name&&"app.coupon.detail"!==b.name&&"app.coupon.listQQx5"!==b.name||"app.coupon.detail"===f.name||"app.coupon.list"===f.name||"app.coupon.listQQx5"===f.name||n()});f.$on("event:auth-loginCancelled",function(){q()});f.$on("event:auth-logout-complete",function(){q()});f.$on(l.PROPOSAL_SUCCESS,function(a,b){e.clean()});f.$on(l.CREDIT_EXCHANGE_SUCCESS,function(a,b){e.clean()})}]).controller("CouponListCtrl",["$scope","$timeout",function(a,
b){a.loadMore=function(){console.log("load more");a.$parent.loadNext(function(){a.$broadcast("scroll.infiniteScrollComplete")})};a.refresh=function(){a.$parent.refresh(function(){},function(){b(function(){a.$broadcast("scroll.refreshComplete")},500)},function(){})};a.canLoadMore=function(){return a.$parent.canLoadNext()}}]).controller("CouponListQQx5Ctrl",["$scope","$rootScope",function(a,b){a.hasNext=function(){return!!(a.$parent.pageNumber>a.page||a.$parent.canLoadNext())};a.hasPrev=function(){return 0<
a.page};a.nextPage=function(){a.$parent.pageNumber>a.page?a.page++:a.$parent.canLoadNext()?a.$parent.loadNext(function(){a.$parent.pageNumber>a.page&&a.page++}):alert("\u5df2\u7ecf\u662f\u6700\u540e\u4e00\u9875")};a.preOrRefreshPage=function(){1<a.page?a.page--:1!==a.page&&0!==a.page||a.refresh()};a.refresh=function(){a.$parent.refresh(function(){},function(){a.page=0},function(){})};a.page=0;b.$on("$stateChangeStart",function(b,e,f,h,l){"app.coupon"!==e.name&&"app.coupon.list"!==e.name&&"app.coupon.detail"!==
e.name&&"app.coupon.listQQx5"!==e.name||"app.coupon.detail"===h.name||"app.coupon.list"===h.name||"app.coupon.listQQx5"===h.name||(a.page=0)})}]);
angular.module("coupon.service",["ngResource"]).service("CouponAPI",["$resource","urlConfig",function(a,b){var c=a(b.REST_END_POINT+"/api/marketing/coupon",{page:"@page",agreementId:"@agreementId"},{query:{method:"GET",isArray:!1,timeout:1E4}},null),e=function(a,b,f,e){c.query({page:a,agreementId:b},function(a){for(var b=[],c=0;c<a.list.length;c++)h[a.list[c].id]=a.list[c],b.push(a.list[c]);console.log("coupon page data init success");f(b)},function(a){e(a.data.error)})},f=function(a,b){h={};l=0;
c.query({page:0},function(b){l=b.metaData.total;for(var c=[],d=0;d<b.list.length;d++)h[b.list[d].id]=b.list[d],c.push(b.list[d]);console.log("coupon metaData init success");a(c)},function(a){b(a.data.error)})},h={},l=0;return{getPage:function(a,b,c){e(a,void 0,b,c)},refresh:function(a,b){f(a,b)},get:function(a){return h[a]},findAllByAgreementId:function(a,b,c){e(void 0,a,b,c)},hasMoreToLoad:function(){return!!(void 0!==h&&0!==Object.keys(h).length&&Object.keys(h).length<l)},clean:function(){h=void 0;
l=0}}}]);/*
 HTTP Auth Interceptor Module for AngularJS
 (c) 2012 Witold Szczerba
 License: MIT
*/
(function(){angular.module("http-auth-interceptor",["http-auth-interceptor-buffer"]).factory("authService",["$rootScope","httpBuffer",function(a,b){return{loginConfirmed:function(c,e){var f=e||function(a){return a};a.$broadcast("event:auth-loginConfirmed",c);b.retryAll(f)},loginCancelled:function(c,e){b.rejectAll(e);a.$broadcast("event:auth-loginCancelled",c)}}}]).config(["$httpProvider",function(a){a.interceptors.push(["$rootScope","$q","httpBuffer",function(a,c,e){return{responseError:function(f){if(!f.config.ignoreAuthModule)switch(f.status){case 401:var h=
c.defer();e.append(f.config,h);a.$broadcast("event:auth-loginRequired",f);return h.promise;case 403:return h=c.defer(),e.append(f.config,h),a.$broadcast("event:auth-forbidden",f),h.promise}return c.reject(f)}}}])}]);angular.module("http-auth-interceptor-buffer",[]).factory("httpBuffer",["$injector",function(a){function b(b,c){e=e||a.get("$http");e(b).then(function(a){c.resolve(a)},function(a){c.reject(a)})}var c=[],e;return{append:function(a,b){c.push({config:a,deferred:b})},rejectAll:function(a){if(a)for(var b=
0;b<c.length;++b)c[b].deferred.reject(a);c=[]},retryAll:function(a){for(var e=0;e<c.length;++e)b(a(c[e].config),c[e].deferred);c=[]}}}])})();angular.module("invHistory",["invHistory.service"]).controller("InvHistoryListCtrl",["$scope","$state","$ionicHistory","InvHistoryAPI","$rootScope","$ionicLoading","$timeout","invoiceConstants","eventNames",function(a,b,c,e,f,h,l,g,k){var n=function(){a.invHistories=[];d(function(){h.show({template:"<ion-spinner></ion-spinner>",delay:100})},function(){h.hide()},function(){f.navToIndex()})},q=function(){a.invHistories=void 0;a.hasInvHistory=void 0;a.initFinish=void 0},d=function(b,d,c){b();e.refresh(function(b){a.invHistories=
b;a.hasInvHistory=!(void 0===a.invHistories||0===a.invHistories.length);if(a.hasInvHistory)for(var c in a.invHistories)a.invHistories[c].typeAlias=g.TYPES[a.invHistories[c].type],a.invHistories[c].isValueAdded=a.invHistories[c].type!==g.TYPE_NORMAL;a.initFinish=!0;d()},function(b){a.initFinish=!0;console.log(b);alert("\u5237\u65b0\u5931\u8d25\uff0c\u8bf7\u7a0d\u540e\u518d\u8bd5");d();c()})};a.refresh=function(){d(function(){},function(){l(function(){a.$broadcast("scroll.refreshComplete")},500)},function(){})};
a.isProcessing=function(a){return a.status===g.HISTORY_STATUS_PROCESSING};a.isMailed=function(a){return a.status===g.HISTORY_STATUS_MAILED};n();f.$on("$stateChangeStart",function(a,b,d,c,f){"app.invHistory"!==b.name&&"app.invHistory.list"!==b.name&&"app.invHistory.detail"!==b.name||"app.invHistory.detail"===c.name||"app.invHistory.list"===c.name||n()});f.$on("event:auth-loginCancelled",function(){q()});f.$on("event:auth-logout-complete",function(){q()})}]).controller("InvHistoryDetailCtrl",["$scope",
"$rootScope","$stateParams","InvHistoryAPI",function(a,b,c,e){a.invHistory=e.get(c.id);b.$on("$stateChangeStart",function(b,h,l,g,k){"app.invHistory.detail"===h.name&&(a.invHistory=e.get(c.id))})}]);
angular.module("invHistory.service",["ngResource"]).service("InvHistoryAPI",["$resource","urlConfig",function(a,b){var c=a(b.REST_END_POINT+"/api/invoice/",{},{query:{method:"GET",isArray:!0,timeout:1E4}},null),e=function(a,b){f={};c.query({},function(b){for(var c=[],e=0;e<b.length;e++)f[b[e].id]=b[e],c.push(b[e]);console.log("invoice histories init success");a(c)},function(a){b(a.data.error)})},f={};return{refresh:function(a,b){e(a,b)},get:function(a){return f[a]},clean:function(){f=void 0}}}]);angular.module("invoice",["invoice.service"]).controller("InvoiceListCtrl",["$scope","$state","$ionicHistory","InvoiceAPI","$rootScope","$ionicLoading","eventNames","invoiceConstants",function(a,b,c,e,f,h,l,g){var k=function(){a.invoices=[];a.applyInvoices=[];a.refresh(function(){h.show({template:"<ion-spinner></ion-spinner>",delay:100})},function(){h.hide()},function(){f.navToIndex()})},n=function(){a.invoices=void 0;a.applyInvoices=void 0;a.hasInvoice=void 0;a.initFinish=void 0};a.isChargeRecordType=
function(a){return a.type===g.ITEM_TYPE_CHARGE_RECORD};a.isTransactionType=function(a){return a.type===g.ITEM_TYPE_TRANSACTION};a.refresh=function(b,d,c){b();e.refresh(function(b){a.invoices=b;a.hasInvoice=!(void 0===a.invoices||0===a.invoices.length);if(a.hasInvoice)for(b=0;b<a.invoices.length;b++)a.invoices[b].invoiceTypeAlias=g.TYPES[a.invoices[b].invoiceType];a.initFinish=!0;d()},function(b){a.initFinish=!0;console.log(b);alert("\u5237\u65b0\u5931\u8d25\uff0c\u8bf7\u7a0d\u540e\u518d\u8bd5");d();
c()})};a.calcFee=function(a){var b=0,c;for(c in a)!0===a[c].add&&(b+=a[c].amount);return b};a.calcApplyFee=function(){return a.calcFee(a.invoices)};a.calcApplyNo=function(){var b=0,d;for(d in a.invoices)a.invoices.hasOwnProperty(d)&&!0===a.invoices[d].add&&(b+=1);return b};a.validateInvoices=function(b){var d=b.invoiceType,c=b.title,f=b.companyTaxId,e;for(e in a.invoices)if(a.invoices.hasOwnProperty(e)&&!0===a.invoices[e].add&&(d!==a.invoices[e].invoiceType||c!==a.invoices[e].title||f!==a.invoices[e].companyTaxId)){alert("\u65b0\u6dfb\u52a0\u7684\u5f00\u7968\u9879\u4e0e\u5df2\u9009\u4e2d\u7684\u5f00\u7968\u9879\u4fe1\u606f\u4e0d\u4e00\u81f4\uff0c\u8bf7\u5206\u4e24\u6b21\u5f00\u5177\u3002");
b.add=!1;break}};a.apply=function(){a.applyInvoices=[];for(var c in a.invoices)a.invoices.hasOwnProperty(c)&&!0===a.invoices[c].add&&a.applyInvoices.push(a.invoices[c]);void 0!==a.applyInvoices.length&&0!==a.applyInvoices.length?b.go("^.apply"):alert("\u8bf7\u9009\u62e9\u9700\u8981\u5f00\u5177\u7684\u53d1\u7968")};k();f.$on("$stateChangeStart",function(a,b,c,f,e){"app.invoice"!==b.name&&"app.invoice.list"!==b.name&&"app.invoice.apply"!==b.name||"app.invoice.list"===f.name||"app.invoice.apply"===f.name||
k()});f.$on("event:auth-loginCancelled",function(){n()});f.$on("event:auth-logout-complete",function(){n()});f.$on(l.INVOICE_APPLY_SUCCESS,function(a,b){e.clean();n();k()})}]).controller("InvoiceApplyCtrl",["$scope","InvoiceAPI","$rootScope","$state","$ionicLoading","$ionicHistory","invoiceConstants","eventNames",function(a,b,c,e,f,h,l,g){var k=function(){a.invoice={invoiceType:a.$parent.applyInvoices[0].invoiceType,invoiceTypeAlias:l.TYPES[a.$parent.applyInvoices[0].invoiceType],isValueAdded:a.$parent.applyInvoices[0].invoiceType!==
l.TYPE_NORMAL,title:a.$parent.applyInvoices[0].title,companyTaxId:a.$parent.applyInvoices[0].companyTaxId}};a.calcApplyFee=function(){return a.$parent.calcFee(a.invoices)};a.confirm=function(){if(a.invoice.isValueAdded){if(void 0===a.invoice.companyTaxId||""===a.invoice.companyTaxId){alert("\u8bf7\u8f93\u5165\u7eb3\u7a0e\u4eba\u8bc6\u522b\u53f7");return}if(void 0===a.invoice.companyRegisterAddress||""===a.invoice.companyRegisterAddress){alert("\u8bf7\u8f93\u5165\u4f01\u4e1a\u6ce8\u518c\u5730\u5740");
return}if(void 0===a.invoice.companyRegisterPhone||""===a.invoice.companyRegisterPhone){alert("\u8bf7\u8f93\u5165\u4f01\u4e1a\u6ce8\u518c\u7535\u8bdd");return}if(void 0===a.invoice.companyBankName||""===a.invoice.companyBankName){alert("\u8bf7\u8f93\u5165\u4f01\u4e1a\u5f00\u6237\u94f6\u884c");return}if(void 0===a.invoice.companyBankAccountId||""===a.invoice.companyBankAccountId){alert("\u8bf7\u8f93\u5165\u4f01\u4e1a\u94f6\u884c\u8d26\u53f7");return}}if(void 0===a.invoice.title||""===a.invoice.title)alert("\u8bf7\u8f93\u5165\u53d1\u7968\u62ac\u5934");
else if(void 0===a.invoice.name||""===a.invoice.name)alert("\u8bf7\u8f93\u5165\u6536\u4ef6\u4eba\u59d3\u540d");else if(void 0===a.invoice.phone||""===a.invoice.phone)alert("\u8bf7\u8f93\u5165\u6536\u4ef6\u7535\u8bdd");else if(void 0===a.invoice.address||""===a.invoice.address)alert("\u8bf7\u8f93\u5165\u6536\u4ef6\u5730\u5740");else{var e=[],k;for(k in a.$parent.applyInvoices)e.push(a.$parent.applyInvoices[k].id);a.invoice.items=e;f.show({template:"<ion-spinner></ion-spinner>",delay:100});b.apply(a.invoice,
function(){f.hide();alert("\u53d1\u7968\u5c06\u57287\u4e2a\u5de5\u4f5c\u65e5\u5185\u5bc4\u51fa\uff0c\u8bf7\u8010\u5fc3\u7b49\u5019");c.navToRoot("app.invHistory.list");c.$broadcast(g.INVOICE_APPLY_SUCCESS)},function(a){f.hide();alert(a)})}};k();c.$on("$stateChangeStart",function(a,b,d,c,e){"app.invoice.apply"===b.name&&"app.invoice.apply"!==c.name&&k()});c.$on(g.INVOICE_APPLY_SUCCESS,function(){a.invoice=void 0});c.$on("event:auth-loginCancelled",function(){a.invoice=void 0});c.$on("event:auth-logout-complete",
function(){a.invoice=void 0})}]);
angular.module("invoice.service",[]).service("InvoiceAPI",["$resource","urlConfig",function(a,b){var c=a(b.REST_END_POINT+"/api/invoice/item",{},{query:{method:"GET",isArray:!0,timeout:1E4}},null),e=a(b.REST_END_POINT+"/api/invoice/"),f=function(a,b){c.query({},function(b){for(var c=[],e=0;e<b.length;e++)c.push(b[e]);console.log("invoice init success");a(c)},function(a){b(a.data.error)})},h=function(a,b,c){(new e(a)).$save({},function(a){console.log("apply successful");b(a)},function(a){c(a.data.error)})};
return{apply:function(a,b,c){h(a,b,c)},refresh:function(a,b){f(a,b)},clean:function(){invoices=void 0}}}]);angular.module("portal",["category.service","agreement"]).controller("PortalCtrl",["$scope","$state","$rootScope","$ionicLoading","CategoryAPI","accountConstants","eventNames","AgreementAPI","agreementConstants","categoryConstants",function(a,b,c,e,f,h,l,g,k,n){var q=[k.AGREEMENT_ID_PAYGO_LOCAL_JB_LITE,k.AGREEMENT_ID_PAYGO_LOCAL_ZH,k.AGREEMENT_ID_PAYGO_JB_LITE,k.AGREEMENT_ID_PAYGO_JB,k.AGREEMENT_ID_AUTO_PAYGO,k.AGREEMENT_ID_PAYGO_ZR,k.AGREEMENT_ID_PAYGO_ZH_COLD_CHAIN];(function(){e.show({template:"<ion-spinner></ion-spinner>",
delay:100});g.findPublicByIdIn(q,function(b){a.publicAgreements=b;f.findAll(function(b){a.categories=b.category;for(var d in a.categories)b=a.categories[d],a.categories[d].icon=void 0!==n.icon[b.id]?n.icon[b.id]:n.icon[0];e.hide()},function(a){alert("\u670d\u52a1\u5668\u672a\u54cd\u5e94\uff0c\u83b7\u53d6\u54c1\u7c7b\u4fe1\u606f\u5931\u8d25\uff0c\u8bf7\u8054\u7cfb\u7ba1\u7406\u5458\u8bf4\u7a0d\u540e\u518d\u8bd5")})},function(a){e.hide();alert("\u670d\u52a1\u5668\u672a\u54cd\u5e94\uff0c\u83b7\u53d6\u4ea7\u54c1\u4fe1\u606f\u5931\u8d25\uff0c\u8bf7\u8054\u7cfb\u7ba1\u7406\u5458\u8bf4\u7a0d\u540e\u518d\u8bd5")})})()}]).controller("PortalCategoryCtrl",
["$scope","$stateParams",function(a,b){""===b.id?(a.showCategory=!0,a.showQuickIcons=!0,a.rootCategory=!0):(console.log(b.id+" category"),a.categoryId=b.id)}]);
angular.module("category.service",["ngResource"]).constant("categoryConstants",{icon:{0:"ion-ios-list",1:"ion-ios-list",2:"ion-ios-paper",3:"ion-ios-speedometer"}}).service("CategoryAPI",["$resource","urlConfig",function(a,b){var c,e=a(b.REST_END_POINT+"/api/public/category",null,{query:{method:"GET",isArray:!1,timeout:1E4}},null);return{findAll:function(a,b){void 0===c?e.query({},function(b){c=b;a(c)},b):a(c)}}}]);angular.module("promotion",["account.service","agreement.service","promotion.service","wechat.service"]).controller("PromotionCtrl",["$scope","$rootScope","PromotionAPI","promotionConstants","promotionBackgroundColors","$ionicLoading","$ionicHistory","$state","Wechat",function(a,b,c,e,f,h,l,g,k){var n=function(d,t,k){h.show({template:"<ion-spinner></ion-spinner>",delay:100});c.get(d,function(b){a.promotion=b;a.backStyle=void 0!==f[a.promotion.fromPicId]?{"background-color":f[a.promotion.fromPicId]}:
{"background-color":"#FFF"};a.promotion.fromPicUrl=e.PIC_ROOT+a.promotion.fromPicId+"_from.jpg";q(a.promotion.id,t,k)},function(a){h.hide();alert("\u672a\u627e\u5230\u4f18\u60e0\u6d3b\u52a8");b.navToIndex()})},q=function(e,f,g){c.newBatch(e,f,g,function(b){h.hide();a.batch=b.batch;a.gifts=b.gifts;void 0!==a.gifts&&void 0!==a.gifts[0]&&alert("\u611f\u8c22\u53c2\u4e0e\u6d3b\u52a8\uff0c\u5956\u52b1\u5df2\u653e\u5165\u8d26\u6237");k.hookShareTimelineOnly(!0,c.convertBatchToContent(a.batch),function(){d(a.promotion.id,
a.batch.id)},function(a){alert(a)})},function(a){h.hide();alert(a);b.navToIndex()})},d=function(d,e){h.show({template:"<ion-spinner></ion-spinner>",delay:100});c.shareAction(d,e,function(d){h.hide();a.gifts=d.gifts;void 0===a.gifts||void 0===a.gifts[0]?alert("\u6210\u529f\u5206\u4eab"):alert("\u6210\u529f\u5206\u4eab\uff0c\u5956\u52b1\u5df2\u653e\u5165\u8d26\u6237");b.navToIndex()},function(a){h.hide();alert(a);b.navToIndex()})};n(g.params.id,g.params.sourceType,g.params.sourceDetail);a.shareSuccess=
function(){d(a.promotion.id,a.batch.id)};b.$on("$stateChangeStart",function(a,b,d,c,e){"app.promotion"===b.name&&n(d.id,d.sourceType,d.sourceDetail)});b.$on("event:auth-loginCancelled",function(){a.promotion=void 0});b.$on("event:auth-logout-complete",function(){a.promotion=void 0})}]);
angular.module("promotion.service",["ngResource","wechat"]).service("PromotionAPI",["$resource","urlConfig","promotionConstants","wechatConstants",function(a,b,c,e){var f=a(b.REST_END_POINT+"/api/marketing/promotion/:id",{id:"@id",entryPoint:"@entryPoint"},{getPaySuc:{method:"GET",isArray:!0,params:{entryPoint:c.ENTRY_POINT_PAY_SUCCESS}},get:{method:"GET",isArray:!1},action:{method:"POST",isArray:!1}},null),h=a(b.REST_END_POINT+"/api/marketing/promotion/:id/batch/:batchId",{id:"@id",batchId:"@batchId",
sourceType:"@sourceType",sourceDetail:"@sourceDetail",action:"@action"},{"new":{method:"POST",isArray:!1},action:{method:"POST",isArray:!1}}),l=a(b.REST_END_POINT+"/api/public/marketing/promotion/:batchId/",{batchId:"@batchId"}),g,k={};return{getPaySucPromotion:function(a,b){void 0===g?f.getPaySuc({},function(b){g=b[0];a(g)},function(a){b(a)}):a(g)},getPublicBatch:function(a,b,d){l.get({batchId:a},function(a){b(a)},function(a){d(a)})},get:function(a,b,d){void 0===k[a]?f.get({id:a},function(d){k[a]=
d;b(k[a])},function(a){d(a)}):b(k[a])},newBatch:function(a,b,d,c,e){h["new"]({id:a,sourceType:b,sourceDetail:d},function(a){console.log("batch created received");c(a)},function(a){console.log("failed because: "+a.data.error);e(a.data.error)})},shareAction:function(a,b,d,c){h.action({id:a,batchId:b,action:"FROM_SHARE"},function(a){console.log("share success");d(a)},function(a){console.log("failed because: "+a.data.error);c(a.data.error)})},getShareUrl:function(a){return b.REST_END_POINT+e.PROMOTION_SHARE_ROOT+
a},convertBatchToContent:function(a){var b={};b.name=a.toTitle;b.description=a.toDescription;b.url=this.getShareUrl(a.id);return b}}}]);angular.module("proposal",["proposal.service","account.service","promotion.service","coupon.service","wechat"]).controller("ProposalCtrl",["$rootScope","$scope","AgreementAPI","AccountAPI","CouponAPI","Proposal","PromotionAPI","$state","$stateParams","$ionicHistory","$ionicLoading","agreementConstants","promotionConstants","eventNames","Wechat","$ionicActionSheet","$ionicModal",function(a,b,c,e,f,h,l,g,k,n,q,d,p,t,u,B,w){var y={name:"\u4e0d\u4f7f\u7528"},z=function(){q.show({template:"<ion-spinner></ion-spinner>",
delay:100});e.getAccount(function(a){b.account=a;b.canPayCredit=-1<b.agreement.payMethods.indexOf(d.PAY_METHOD_CREDIT);b.canPayAlipay=!1;b.canPayWxpay=-1<b.agreement.payMethods.indexOf(d.PAY_METHOD_H5);b.canPayCoupon=-1<b.agreement.payMethods.indexOf(d.PAY_METHOD_COUPON);b.canPaySimulate=-1<b.agreement.payMethods.indexOf(d.PAY_METHOD_SIMULATE);b.canShowInvoice=b.canPayWxpay;b.account.invoiceSetting&&(b.proposal.companyTaxId=b.account.invoiceSetting.companyTaxId);f.findAllByAgreementId(b.agreement.id,
function(a){b.optionalCoupons=a;b.optionalCoupons.unshift(y);b.proposal.optionalCoupon=1!==b.optionalCoupons.length?b.optionalCoupons[1]:b.optionalCoupons[0];b.calcfee(b.proposal);q.hide();g.go("^.pay")},function(a){q.hide();alert("\u670d\u52a1\u5668\u672a\u54cd\u5e94\uff0c\u83b7\u53d6\u652f\u4ed8\u4fe1\u606f\u5931\u8d25\uff0c\u8bf7\u7a0d\u540e\u518d\u8bd5")})},function(a){console.log("error getting account, by: "+a);q.hide();alert("\u670d\u52a1\u5668\u672a\u54cd\u5e94\uff0c\u83b7\u53d6\u652f\u4ed8\u4fe1\u606f\u5931\u8d25\uff0c\u8bf7\u7a0d\u540e\u518d\u8bd5")})},
C=function(c){b.success=c.success;b.orderId=c.orderId;b.proposalNo=c.proposalNo;g.params.agreementId!==d.AGREEMENT_ID_SIMULATE?l.getPaySucPromotion(function(d){q.hide();b.promotion=d;a.navToRoot("^.result")},function(b){console.log("No Pay Success Promotion found");q.hide();a.navToRoot("^.result")}):(console.log("No showing pay Success Promotion"),q.hide(),a.navToRoot("^.result"))},m=function(){q.show({template:"<ion-spinner></ion-spinner>",delay:100});h.preOrder(b.proposal,function(a){console.log("pre order succeed");
r(a)},function(a){q.hide();console.log("pre order error, by: ",a.data.error);alert(a.data.error)})},r=function(a){b.proposal.orderId=a.orderId;a.payProvider===d.PAY_PROVIDER_WX&&a.paymentResponse?u.doWxPay(a.paymentResponse,function(){F(a)},function(){q.hide();alert("\u652f\u4ed8\u5931\u8d25")}):F(a)},F=function(c){c.payProvider===d.PAY_PROVIDER_WX&&c.paymentResponse?(b.error=void 0,console.log("save transaction successfull"),a.$broadcast(t.PROPOSAL_SUCCESS,c),C(c)):h.finishOrder(b.proposal.orderId,
function(d){b.error=void 0;console.log("save transaction successfull");a.$broadcast(t.PROPOSAL_SUCCESS,d);C(d)},function(d){q.hide();console.log("save transaction failed, error:"+d.data.error);b.error=d.data.error;a.navToRoot("^.result")})};console.log("reloading");(function(e,f){q.show({template:"<ion-spinner></ion-spinner>",delay:100});console.log("Initializing proposal");c.getProposal(e,function(a){b.agreement=a;b.canSetRoutePreset=b.agreement.routePreset===d.AGREEMENT_ROUTE_PRESET_BOTH;b.canSetRouteNoPreset=
b.agreement.routePreset===d.AGREEMENT_ROUTE_PRESET_NONE;b.canSetRouteStartEndEqual=b.agreement.routePreset===d.AGREEMENT_ROUTE_PRESET_EQUAL;b.canSetPublicRouteStartEndDetail=b.agreement.routePreset===d.AGREEMENT_ROUTE_PRESET_DISTANCE&&b.agreement.type!==d.AGREEMENT_TYPE_USER;b.canSetPrivateRouteStartEndDetail=b.agreement.routePreset===d.AGREEMENT_ROUTE_PRESET_DISTANCE&&b.agreement.type===d.AGREEMENT_TYPE_USER;b.proposal=h.init(b.agreement);void 0!==f&&(b.proposal.payCouponId=f);q.hide()},function(b){console.log("error intializing proposal, by: "+
b);q.hide();alert("\u670d\u52a1\u5668\u672a\u54cd\u5e94\uff0c\u83b7\u53d6\u534f\u8bae\u5931\u8d25\uff0c\u8bf7\u7a0d\u540e\u518d\u8bd5");a.navToIndex()})})(g.params.agreementId,g.params.payCouponId);b.calcfee=function(a){h.calcfee(a)};b.calcDistance=function(a){a=h.calcDistance(a,function(a){success(a)},function(a){alert("\u83b7\u53d6\u91cc\u7a0b\u6570\u636e\u5931\u8d25\u8bf7\u7a0d\u540e\u518d\u8bd5\u3002")})};b.showGoods=function(){for(var a=[],d=0;d<b.agreement.goods.length;d++)a[d]={text:"<div>"+
b.agreement.goods[d].name+"  \u52a0\u8d39\u7387:"+b.agreement.goods[d].baseFee+"%</div><p>"+b.agreement.goods[d].remark+"</p>"};B.show({buttons:a,buttonClicked:function(a){b.proposal.goods=b.agreement.goods[a];b.calcfee(b.proposal);return!0}})};b.canShowCurFee=function(){return g.params.agreementId!==d.AGREEMENT_ID_SIGNUP_COUPON&&g.params.agreementId!==d.AGREEMENT_ID_COUPON_TRANSACTION_25&&g.params.agreementId!==d.AGREEMENT_ID_AUTO_PAYGO&&g.params.agreementId!==d.AGREEMENT_ID_PAYGO_LOCAL_ZH&&g.params.agreementId!==
d.AGREEMENT_ID_PAYGO_JB&&g.params.agreementId!==d.AGREEMENT_ID_PAYGO_JB_LIMIT_PRICE&&g.params.agreementId!==d.AGREEMENT_ID_PAYGO_LOCAL_JB_LITE&&g.params.agreementId!==d.AGREEMENT_ID_PAYGO_JB_LITE&&g.params.agreementId!==d.AGREEMENT_ID_PAYGO_ZR&&g.params.agreementId!==d.AGREEMENT_ID_PAYGO_ZH_COLD_CHAIN};b.canShowSubTotal=function(){return g.params.agreementId!==d.AGREEMENT_ID_SIGNUP_COUPON&&g.params.agreementId!==d.AGREEMENT_ID_COUPON_TRANSACTION_25};b.canShowCoupon=function(){return g.params.agreementId!==
d.AGREEMENT_ID_SIGNUP_COUPON&&g.params.agreementId!==d.AGREEMENT_ID_COUPON_TRANSACTION_25&&g.params.agreementId!==d.AGREEMENT_ID_PAYGO_JB_LIMIT_PRICE};b.couponDesc=function(a){return void 0!==a.expireAt?a.name+" "+a.expireAt+"\u5230\u671f":a.name};b.canShowTaxId=function(){return b.proposal.invoiceType!==d.INVOICE_TYPE_NORMAL};b.confirm=function(){b.agreement.type!==d.AGREEMENT_TYPE_USER?(console.log("checking dxt public agreement"),w.fromTemplateUrl("templates/app/public.doc.proposal.html",{scope:b}).then(function(b){a.docProposalModal=
b;a.docProposalModal.show();a.docProposalIscroll=new IScroll("#proposal-doc .i-scroll .wrapper",{})})):(console.log("confirmed, going to pay"),z())};b.acceptDoc=function(){a.docProposalModal.hide();a.docProposalIscroll.destroy();a.docProposalModal.remove();console.log("confirmed, going to pay");z()};b.rejectDoc=function(){a.docProposalModal.hide();a.docProposalIscroll.destroy();a.docProposalModal.remove()};b.creditPay=function(){b.proposal.payProvider=d.PAY_PROVIDER_CREDIT;m()};b.aliPay=function(){b.proposal.payProvider=
d.PAY_PROVIDER_ALI;alert("\u7531\u4e8e\u5fae\u4fe1\u5e73\u53f0\u5c4f\u853d\u652f\u4ed8\u5b9d\uff0c\u6682\u4e0d\u652f\u6301\u652f\u4ed8\u5b9d\u4ed8\u6b3e")};b.wxPay=function(){void 0===u.getOpenId()?alert("\u672a\u68c0\u6d4b\u5230\u5fae\u4fe1\u652f\u4ed8\u73af\u5883\uff0c\u8bf7\u5728\u5fae\u4fe1\u516c\u4f17\u53f7\u4e2d\u64cd\u4f5c"):(b.proposal.buyerId=u.getOpenId(),b.proposal.payProvider=d.PAY_PROVIDER_WX,m())};b.couponPay=function(){b.proposal.payProvider=d.PAY_PROVIDER_COUPON;m()};b.simulatePay=
function(){b.proposal.payProvider=d.PAY_PROVIDER_SIMULATE;m()};b.navToPromotion=function(){n.nextViewOptions({historyRoot:!0});g.go("app.promotion",{id:b.promotion.id,sourceType:p.BATCH_SOURCE_TYPE_TRANSACTION,sourceDetail:b.proposal.orderId})};b.changeStartProvince=function(a){a.routeStart=a.routeStartProvince.politicalCitys[0];this.calcDistance(a)};b.changeEndProvince=function(a){a.routeEnd=a.routeEndProvince.politicalCitys[0];this.calcDistance(a)};b.changeStartCity=function(a){this.calcDistance(a)};
b.changeEndCity=function(a){this.calcDistance(a)};a.$on("event:auth-logout-complete",function(){b.agreement=void 0;b.proposal=void 0;b.optionalCoupons=void 0;b.error=void 0})}]);
angular.module("proposal.service",["ngResource"]).service("Proposal",["$resource","urlConfig","agreementConstants","couponConstants",function(a,b,c,e){var f=a(b.REST_END_POINT+"/api/order/transaction"),h=a(b.REST_END_POINT+"/api/order/:id/finish",{id:"@id"},{finish:{method:"POST",isArray:!1,timeout:6E4}}),l=a(b.REST_END_POINT+"/api/public/distance/:agreementid/:routeStart/:routeEnd"),g=a(b.REST_END_POINT+"/api/public/distanceFee",null,{query:{method:"GET",isArray:!1,timeout:1E4}},null),k=function(a){var b=
a.agreement.routeAdjust,c=1;a.agreement.canChooseTheft&&a.theftInsure&&(c=a.agreement.productDqRate);var f=a.agreement.discountRate/100;a.listPrice=Math.round(a.route.baseRate/100*(a.goods.baseFee/100+1)*a.coverage.basefee*b*c);a.feeNoCoupon=Math.round(a.listPrice*f);void 0!==a.optionalCoupon&&void 0!==a.optionalCoupon.fullfillType?a.optionalCoupon.fullfillType===e.COUPON_TYPE_PRODUCT_VOUCHER?(a.fee=a.feeNoCoupon-a.optionalCoupon.fullfillConfig,a.optionalCouponId=a.optionalCoupon.id):a.optionalCoupon.fullfillType===
e.COUPON_TYPE_LIMIT_PRICE?(a.fee=a.optionalCoupon.fullfillConfig,a.optionalCouponId=a.optionalCoupon.id):a.optionalCoupon.fullfillType===e.COUPON_TYPE_DISCOUNT_VOUCHER&&(a.fee=Math.round(a.optionalCoupon.fullfillConfig/100*a.feeNoCoupon),a.optionalCouponId=a.optionalCoupon.id):(a.fee=a.feeNoCoupon,a.optionalCouponId=void 0)},n=function(a){for(var b=[],c=0,e=0;e<a.agreement.coverages.length;e++)for(var f=a.agreement.coverages[e],w=f.value,y=0;y<a.routeDistanceFees.length;y++){var z=a.routeDistanceFees[y];
console.log("routeDistanceFees.distanceStart="+z.distanceStart);console.log("routeDistanceFees.distanceEnd="+z.distanceEnd);console.log("proposal.routeDistance="+a.routeDistance);w==z.value&&a.routeDistance>z.distanceStart&&a.routeDistance<=z.distanceEnd&&(f.basefee=z.fee,b[c++]=f)}a.distanceCoverages=b;a.coverage=b[0]},q=function(a){a.agreement.routePreset===c.AGREEMENT_ROUTE_PRESET_EQUAL&&(a.routeEnd=a.routeStart);if(a.agreement.routePreset===c.AGREEMENT_ROUTE_PRESET_EQUAL||a.agreement.routePreset===
c.AGREEMENT_ROUTE_PRESET_NONE)a.route.name=a.routeStart.name+"\u2014"+a.routeEnd.name,a.route.baseRate=a.routeStart.defaultRouteFeeRate>a.routeEnd.defaultRouteFeeRate?a.routeStart.defaultRouteFeeRate:a.routeEnd.defaultRouteFeeRate;a.agreement.routePreset===c.AGREEMENT_ROUTE_PRESET_DISTANCE&&a.agreement.type!==c.AGREEMENT_TYPE_USER&&(a.route.name=a.routeStart.name+"\u2014"+a.routeEnd.name,a.route.baseRate=100)};return{init:function(a){var b={};b.agreement=a;b.isZh=a.type===c.AGREEMENT_ID_SIGNUP_COUPON||
a.type===c.AGREEMENT_ID_SIMULATE||a.type===c.AGREEMENT_ID_AUTO_PAYGO||a.type===c.AGREEMENT_ID_PAYGO_LOCAL_ZH||a.type===c.AGREEMENT_ID_PAYGO_ZH_COLD_CHAIN;b.isZR=a.type===c.AGREEMENT_ID_PAYGO_ZR;b.goods=a.goods[0];a.routePreset===c.AGREEMENT_ROUTE_PRESET_BOTH?b.route=a.routes[0]:a.routePreset===c.AGREEMENT_ROUTE_PRESET_DISTANCE?(a.type===c.AGREEMENT_ID_PAYGO_ZR&&(b.routeStartProvince=a.divisions[0],b.routeEndProvince=a.divisions[0],b.routeStartCity=b.routeStartProvince.politicalCitys[0],b.routeEndCity=
b.routeEndProvince.politicalCitys[0],b.routeStart=b.routeStartProvince.politicalCitys[0],b.routeEnd=b.routeEndProvince.politicalCitys[0],b.route={}),a.type===c.AGREEMENT_TYPE_USER&&(b.route=a.routes[0],b.routeDistance=a.routes[0].distance)):(b.routeStart=a.divisions[0],b.routeEnd=a.divisions[0],b.route={});b.coverage=a.coverages[0];a.canChooseTheft&&(b.theftInsure=!1);b.invoiceType=c.INVOICE_TYPE_NORMAL;a.type!==c.AGREEMENT_TYPE_USER&&this.getDistanceFee(b,function(a){b.routeDistanceFees=a.distanceFees;
(new l).$save({agreementid:b.agreement.id,routeStart:b.routeStart.name,routeEnd:b.routeEnd.name},function(a){b.routeDistance=a.distance;n(b)},function(a){error(a)})},function(a){alert("\u83b7\u53d6\u7ebf\u8def\u4ef7\u683c\u8868\u5931\u8d25")});this.calcfee(b);return b},calcfee:function(a){q(a);k(a)},save:function(a,b,c){a=new f(a);a.$save({},b,c);return a},preOrder:function(a,b,c){(new f(a)).$save({},function(a){b(a)},function(a){c(a)})},finishOrder:function(a,b,c){h.finish({id:a},function(a){b(a)},
function(a){c(a)})},getDistanceFee:function(a,b,e){a.agreement.routePreset===c.AGREEMENT_ROUTE_PRESET_DISTANCE&&g.query({},function(a){b(a)},function(a){e(a)})},calcDistance:function(a,b,e){a.agreement.routePreset===c.AGREEMENT_ROUTE_PRESET_DISTANCE&&(a.agreement.type!==c.AGREEMENT_TYPE_USER?(new l).$save({agreementid:a.agreement.id,routeStart:a.routeStart.name,routeEnd:a.routeEnd.name},function(b){a.routeDistance=b.distance;n(a);q(a);k(a)},function(a){e(a)}):(n(a),q(a),k(a)))},doWxPay:function(a,
b,c){function e(){WeixinJSBridge.invoke("getBrandWCPayRequest",{appId:a.appId,timeStamp:a.timeStamp,nonceStr:a.nonceStr,"package":a.packagePrepayId,signType:a.signType,paySign:a.paySign},function(a){"get_brand_wcpay_request:ok"==a.err_msg?b():(alert(a.err_msg),c())})}"undefined"==typeof WeixinJSBridge?document.addEventListener?document.addEventListener("WeixinJSBridgeReady",e,!1):document.attachEvent&&(document.attachEvent("WeixinJSBridgeReady",e),document.attachEvent("onWeixinJSBridgeReady",e)):
e()}}}]);angular.module("redirect",["account.service","wechat"]).controller("redirectCtrl",["$stateParams","$state","$ionicHistory","agreementConstants","CommonAuthenticationService","Wechat",function(a,b,c,e,f,h){var l=!!h.isQQBrowser();void 0!==a.providerUserId&&"null"!==a.providerUserId&&h.setOpenId(a.providerUserId);void 0!=a.xAuthToken&&(f.setXAuthToken(a.xAuthToken),f.setMobile(a.mobile));c.nextViewOptions({historyRoot:!0});"agreements"===a.state?b.go("app.agreement.list",{toPropose:"0",paygo:"0",user:"1"}):
"agreementsToPropose"===a.state?b.go("app.agreement.list",{toPropose:"1",paygo:"0",user:"1"}):"coupons"===a.state?!0===l?b.go("app.coupon.listQQx5"):b.go("app.coupon.list"):"account"===a.state?b.go("app.account.show"):"transactions"===a.state?!0===l?b.go("app.transaction.listQQx5"):b.go("app.transaction.list"):"simulate"===a.state?b.go("app.proposal.start",{agreementId:e.AGREEMENT_ID_SIMULATE}):"dxk"===a.state?b.go("app.account.salesOrComm"):b.go("app.portal.category")}]);angular.module("regression",["wechat"]).controller("PublicPromotionCtrl",["$stateParams","$state","urlConfig","wechatConstants",function(a,b,c,e){window.location.replace(c.REST_END_POINT+e.PROMOTION_SHARE_ROOT+a.id)}]).controller("PublicSurveyCtrl",["$stateParams","$state","urlConfig","wechatConstants",function(a,b,c,e){window.location.replace(c.REST_END_POINT+e.SURVEY_SHARE_ROOT+a.id)}]);angular.module("transaction",["transaction.service","wechat","ng-iscroll","account.service"]).controller("TransactionCtrl",["$scope","$state","$ionicHistory","TransAPI","$rootScope","$ionicLoading","eventNames","agreementConstants",function(a,b,c,e,f,h,l,g){var k=function(){a.transactions=[];a.refresh(function(){h.show({template:"<ion-spinner></ion-spinner>",delay:100})},function(){h.hide()},function(){f.navToIndex()})},n=function(){a.transactions=void 0;a.pageNumber=void 0;a.hasTransaction=void 0;
a.initFinish=void 0};a.refresh=function(b,c,f){b();e.refresh(function(b){a.transactions=b;a.pageNumber=0;a.hasTransaction=!(void 0===a.transactions||0===a.transactions.length);a.initFinish=!0;c()},function(b){a.initFinish=!0;console.log(b);alert("\u5237\u65b0\u5931\u8d25\uff0c\u8bf7\u7a0d\u540e\u518d\u8bd5");c();f()})};a.loadNext=function(b){a.canLoadNext()&&e.getPage(a.pageNumber+1,function(c){if(void 0!==c&&0!==c.length){for(var e=0;e<c.length;e++)a.transactions.push(c[e]);a.pageNumber++}b()},function(a){alert(a);
b()})};a.canLoadNext=function(){return e.hasMoreToLoad()};a.isSimulate=function(a){return a.productName===g.PRODUCT_NAME_SIMULATE};k();f.$on("$stateChangeStart",function(a,b,c,e,f){"app.transaction"!==b.name&&"app.transaction.list"!==b.name&&"app.transaction.detail"!==b.name&&"app.transaction.listQQx5"!==b.name||"app.transaction.detail"===e.name||"app.transaction.list"===e.name||"app.transaction.listQQx5"===e.name||k()});f.$on("event:auth-loginCancelled",function(){n()});f.$on("event:auth-logout-complete",
function(){n()});f.$on(l.PROPOSAL_SUCCESS,function(a,b){e.clean()})}]).controller("TransactionListCtrl",["$scope","$timeout",function(a,b){a.loadMore=function(){console.log("load more");a.$parent.loadNext(function(){a.$broadcast("scroll.infiniteScrollComplete")})};a.refresh=function(){a.$parent.refresh(function(){},function(){b(function(){a.$broadcast("scroll.refreshComplete")},500)},function(){})};a.canLoadMore=function(){return a.$parent.canLoadNext()}}]).controller("TransactionListQQx5Ctrl",["$scope",
"$rootScope",function(a,b){a.hasNext=function(){return!!(a.$parent.pageNumber>a.page||a.$parent.canLoadNext())};a.hasPrev=function(){return 0<a.page};a.nextPage=function(){a.$parent.pageNumber>a.page?a.page++:a.$parent.canLoadNext()?a.$parent.loadNext(function(){a.$parent.pageNumber>a.page&&a.page++}):alert("\u5df2\u7ecf\u662f\u6700\u540e\u4e00\u9875")};a.preOrRefreshPage=function(){1<a.page?a.page--:1!==a.page&&0!==a.page||a.refresh()};a.refresh=function(){a.$parent.refresh(function(){},function(){a.page=
0},function(){})};a.page=0;b.$on("$stateChangeStart",function(b,e,f,h,l){"app.transaction"!==e.name&&"app.transaction.list"!==e.name&&"app.transaction.detail"!==e.name&&"app.transaction.listQQx5"!==e.name||"app.transaction.detail"===h.name||"app.transaction.list"===h.name||"app.transaction.listQQx5"===h.name||(a.page=0)})}]).controller("TransactionDetailCtrl",["$scope","$stateParams","TransAPI","AccountAPI","$ionicPopup","$ionicLoading",function(a,b,c,e,f,h){a.transaction=c.get(b.id);(function(){e.getAccount(function(b){a.account=
b},function(a){console.log(a)})})();var l=function(a,b,c){f.alert({title:a,template:b,okText:c})};a.NoEPolicy=function(a){l("\u4ea4\u6613\u672a\u5b8c\u6210","<p>\u5f53\u524d\u4ea4\u6613\u672a\u5b8c\u6210\uff0c\u65e0\u6cd5\u83b7\u53d6\u7535\u5b50\u4fdd\u5355</p>","\u786e\u8ba4")};a.SendEPolicy=function(b){a.data={};a.data.email=a.account.email;f.show({template:'<form name="ePolicyForm" ><input name="email" type="email" ng-model="data.email" required/> <p class="assertive" ng-show="ePolicyForm.email.$invalid">\u90ae\u7bb1\u5730\u5740\u683c\u5f0f\u9519\u8bef</p>  </form>',
title:"\u53d1\u9001\u7535\u5b50\u4fdd\u5355",subTitle:"\u7535\u5b50\u4fdd\u5355\u5c06\u53d1\u9001\u5230\u4e0b\u65b9\u7535\u5b50\u90ae\u7bb1\u4e2d",scope:a,buttons:[{text:"\u53d6\u6d88"},{text:"<b>\u53d1\u9001</b>",type:"button-positive",onTap:function(f){a.data.email?(h.show({template:"<ion-spinner></ion-spinner>",delay:100}),a.account.email=a.data.email,e.saveAccount(a.account,function(a){},function(a){l("\u4fe1\u606f\u63d0\u793a","<p>\u4fdd\u5b58\u90ae\u7bb1\u4fe1\u606f\u5931\u8d25\u8bf7\u68c0\u67e5\u7535\u5b50\u90ae\u4ef6\u5730\u5740\u683c\u5f0f</p>",
"\u786e\u8ba4");after()}),c.sendEPolicy(b,a.data.email,function(a){h.hide();l("\u7535\u5b50\u4fdd\u5355\u53d1\u9001\u6210\u529f","<p>\u7535\u5b50\u4fdd\u5355\u5df2\u7ecf\u6210\u529f\u53d1\u9001\u5230\u60a8\u7684\u7535\u5b50\u90ae\u7bb1\uff01</p>","\u786e\u8ba4")},function(b){h.hide();a.initFinish=!0;console.log(b);l("\u7535\u5b50\u4fdd\u5355\u53d1\u9001\u5931\u8d25","<p>"+b+"</p>","\u786e\u8ba4");after();failOver()})):f.preventDefault()}}]})}}]);
angular.module("transaction.service",["ngResource"]).service("TransAPI",["$resource","urlConfig",function(a,b){var c=a(b.REST_END_POINT+"/api/transaction",{page:"@page"},{query:{method:"GET",isArray:!1,timeout:1E4}},null),e=a(b.REST_END_POINT+"/api/transaction/getEPolicy",null,{query:{method:"POST",isArray:!1,timeout:1E4}},null),f=function(a,b,d){c.query({page:a},function(a){for(var c=[],d=0;d<a.list.length;d++)g[a.list[d].id]=a.list[d],c.push(a.list[d]);console.log("transaction page init success");
b(c)},function(a){d(a.data.error)})},h=function(a,b,c,f){e.query({id:a,email:b},function(a){console.log("transaction page init success");c(a)},function(a){f(a.data.error)})},l=function(a,b){g={};k=0;c.query({page:0},function(b){k=b.metaData.total;for(var c=[],e=0;e<b.list.length;e++)g[b.list[e].id]=b.list[e],c.push(b.list[e]);console.log("transaction metaData init success");a(c)},function(a){b(a.data.error)})},g={},k=0;return{getPage:function(a,b,c){f(a,b,c)},refresh:function(a,b){l(a,b)},get:function(a){return g[a]},
sendEPolicy:function(a,b,c,e){return h(a,b,c,e)},hasMoreToLoad:function(){return!!(void 0!==g&&0!==Object.keys(g).length&&Object.keys(g).length<k)},clean:function(){g=void 0;k=0}}}]);angular.module("common-authentication",["wechat"]).service("CommonAuthenticationService",["$resource","$rootScope","$http","urlConfig","Wechat",function(a,b,c,e,f){var h=a(e.REST_END_POINT+"/sso/userCanRegister/:id",{id:"@id"},{check:{method:"GET",isArray:!1}},null),l=function(a){c.defaults.headers.common["x-auth-token"]=a},g=function(a,b,d,h,g){var u=f.getOpenId();void 0===u&&(u="");void 0==d&&(d="");c.post(e.REST_END_POINT+"/auth","mobile="+a+"&validationCode="+b+"&invitationCode="+d+"&providerUserId="+
u,{ignoreAuthModule:!0,headers:{"Content-Type":"application/x-www-form-urlencoded"}}).success(function(a,b,c,d){l(a.xAuthToken);k=a.mobile;h(a)}).error(function(a,b,c,d){g(a.error)})},k;return{isLoggedIn:function(){return void 0!==c.defaults.headers.common["x-auth-token"]},exist:function(a,b,c){h.check({id:a},b,c)},auth:function(a,b,c,e,f){g(a,b,c,e,f)},quit:function(a){c.post(e.REST_END_POINT+"/sso/quit",{},{ignoreAuthModule:!0})["finally"](function(){delete c.defaults.headers.common["x-auth-token"];
delete k;a()})},setXAuthToken:function(a){l(a)},getXAuthToken:function(){return c.defaults.headers.common["x-auth-token"]},setMobile:function(a){k=a},getMobile:function(){return k},clean:function(){k=c.defaults.headers.common["x-auth-token"]=void 0}}}]);angular.module("ng-iscroll",[]).service("iScrollAccessor",function(){var a;return{set:function(b){a=b},get:function(){return a}}}).directive("iScroll",["iScrollAccessor",function(a){return{restrict:"A",link:function(b,c){var e=new IScroll(c[0],{click:!0,bounce:!0,preventDefaultException:{tagName:/^(INPUT|TEXTAREA|BUTTON|SELECT)$/,isContentEditable:/^true$/}});a.set(e);c.on("$destroy",function(){e.destroy();e=null})}}}]).directive("iScrollRefresh",["iScrollAccessor","$timeout",function(a,b){return{restrict:"A",
link:function(c){c.$last&&b(function(){a.get().refresh()})}}}]);var qrcode=function(){function a(b,c){if("undefined"==typeof b.length)throw Error(b.length+"/"+c);var d=function(){for(var a=0;a<b.length&&0==b[a];)a+=1;for(var d=Array(b.length-a+c),e=0;e<b.length-a;e+=1)d[e]=b[e+a];return d}(),e={getAt:function(a){return d[a]},getLength:function(){return d.length},multiply:function(b){for(var c=Array(e.getLength()+b.getLength()-1),d=0;d<e.getLength();d+=1)for(var m=0;m<b.getLength();m+=1)c[d+m]^=f.gexp(f.glog(e.getAt(d))+f.glog(b.getAt(m)));return a(c,0)},mod:function(b){if(0>
e.getLength()-b.getLength())return e;for(var c=f.glog(e.getAt(0))-f.glog(b.getAt(0)),d=Array(e.getLength()),m=0;m<e.getLength();m+=1)d[m]=e.getAt(m);for(m=0;m<b.getLength();m+=1)d[m]^=f.gexp(f.glog(b.getAt(m))+c);return a(d,0).mod(b)}};return e}var b=function(b,d){var f=c[d],w=null,k=0,z=null,C=[],m={},r=function(c,d){for(var m=k=4*b+17,g=Array(m),r=0;r<m;r+=1){g[r]=Array(m);for(var u=0;u<m;u+=1)g[r][u]=null}w=g;q(0,0);q(k-7,0);q(0,k-7);m=e.getPatternPosition(b);for(g=0;g<m.length;g+=1)for(r=0;r<
m.length;r+=1){var u=m[g],p=m[r];if(null==w[u][p])for(var n=-2;2>=n;n+=1)for(var v=-2;2>=v;v+=1)w[u+n][p+v]=-2==n||2==n||-2==v||2==v||0==n&&0==v?!0:!1}for(m=8;m<k-8;m+=1)null==w[m][6]&&(w[m][6]=0==m%2);for(m=8;m<k-8;m+=1)null==w[6][m]&&(w[6][m]=0==m%2);m=e.getBCHTypeInfo(f<<3|d);for(g=0;15>g;g+=1)r=!c&&1==(m>>g&1),6>g?w[g][8]=r:8>g?w[g+1][8]=r:w[k-15+g][8]=r;for(g=0;15>g;g+=1)r=!c&&1==(m>>g&1),8>g?w[8][k-g-1]=r:9>g?w[8][15-g-1+1]=r:w[8][15-g-1]=r;w[k-8][8]=!c;if(7<=b){m=e.getBCHTypeNumber(b);for(g=
0;18>g;g+=1)r=!c&&1==(m>>g&1),w[Math.floor(g/3)][g%3+k-8-3]=r;for(g=0;18>g;g+=1)r=!c&&1==(m>>g&1),w[g%3+k-8-3][Math.floor(g/3)]=r}if(null==z){m=h.getRSBlocks(b,f);g=l();for(r=0;r<C.length;r+=1)u=C[r],g.put(u.getMode(),4),g.put(u.getLength(),e.getLengthInBits(u.getMode(),b)),u.write(g);for(r=u=0;r<m.length;r+=1)u+=m[r].dataCount;if(g.getLengthInBits()>8*u)throw Error("code length overflow. ("+g.getLengthInBits()+">"+8*u+")");for(g.getLengthInBits()+4<=8*u&&g.put(0,4);0!=g.getLengthInBits()%8;)g.putBit(!1);
for(;!(g.getLengthInBits()>=8*u);){g.put(236,8);if(g.getLengthInBits()>=8*u)break;g.put(17,8)}for(var A=0,u=r=0,p=Array(m.length),n=Array(m.length),v=0;v<m.length;v+=1){var D=m[v].dataCount,E=m[v].totalCount-D,r=Math.max(r,D),u=Math.max(u,E);p[v]=Array(D);for(var x=0;x<p[v].length;x+=1)p[v][x]=255&g.getBuffer()[x+A];A+=D;x=e.getErrorCorrectPolynomial(E);D=a(p[v],x.getLength()-1).mod(x);n[v]=Array(x.getLength()-1);for(x=0;x<n[v].length;x+=1)E=x+D.getLength()-n[v].length,n[v][x]=0<=E?D.getAt(E):0}for(x=
g=0;x<m.length;x+=1)g+=m[x].totalCount;g=Array(g);for(x=A=0;x<r;x+=1)for(v=0;v<m.length;v+=1)x<p[v].length&&(g[A]=p[v][x],A+=1);for(x=0;x<u;x+=1)for(v=0;v<m.length;v+=1)x<n[v].length&&(g[A]=n[v][x],A+=1);z=g}m=z;g=-1;r=k-1;u=7;p=0;n=e.getMaskFunction(d);for(v=k-1;0<v;v-=2)for(6==v&&--v;;){for(x=0;2>x;x+=1)null==w[r][v-x]&&(A=!1,p<m.length&&(A=1==(m[p]>>>u&1)),n(r,v-x)&&(A=!A),w[r][v-x]=A,--u,-1==u&&(p+=1,u=7));r+=g;if(0>r||k<=r){r-=g;g=-g;break}}},q=function(a,b){for(var c=-1;7>=c;c+=1)if(!(-1>=a+
c||k<=a+c))for(var d=-1;7>=d;d+=1)-1>=b+d||k<=b+d||(w[a+c][b+d]=0<=c&&6>=c&&(0==d||6==d)||0<=d&&6>=d&&(0==c||6==c)||2<=c&&4>=c&&2<=d&&4>=d?!0:!1)};m.addData=function(a){a=g(a);C.push(a);z=null};m.isDark=function(a,b){if(0>a||k<=a||0>b||k<=b)throw Error(a+","+b);return w[a][b]};m.getModuleCount=function(){return k};m.make=function(){for(var a=0,b=0,c=0;8>c;c+=1){r(!0,c);var d=e.getLostPoint(m);if(0==c||a>d)a=d,b=c}r(!1,b)};m.createTableTag=function(a,b){a=a||2;var c;c='<table style=" border-width: 0px; border-style: none;';
c+=" border-collapse: collapse;";c+=" padding: 0px; margin: "+("undefined"==typeof b?4*a:b)+"px;";c+='">';c+="<tbody>";for(var d=0;d<m.getModuleCount();d+=1){c+="<tr>";for(var e=0;e<m.getModuleCount();e+=1)c+='<td style="',c+=" border-width: 0px; border-style: none;",c+=" border-collapse: collapse;",c+=" padding: 0px; margin: 0px;",c+=" width: "+a+"px;",c+=" height: "+a+"px;",c+=" background-color: ",c+=m.isDark(d,e)?"#000000":"#ffffff",c+=";",c+='"/>';c+="</tr>"}c+="</tbody>";return c+="</table>"};
m.createSvgTag=function(a,b){a=a||2;b="undefined"==typeof b?4*a:b;var c=m.getModuleCount()*a+2*b,d,e,f,g,z;z="l"+a+",0 0,"+a+" -"+a+",0 0,-"+a+"z ";g="<svg"+(' width="'+c+'px"');g+=' height="'+c+'px"';g+=' xmlns="http://www.w3.org/2000/svg"';g+=">";g+='<path d="';for(e=0;e<m.getModuleCount();e+=1)for(f=e*a+b,c=0;c<m.getModuleCount();c+=1)m.isDark(e,c)&&(d=c*a+b,g+="M"+d+","+f+z);g+='" stroke="transparent" fill="black"/>';return g+="</svg>"};m.createImgTag=function(a,b){a=a||2;b="undefined"==typeof b?
4*a:b;var c=m.getModuleCount()*a+2*b,d=b,e=c-b;return p(c,c,function(b,c){return d<=b&&b<e&&d<=c&&c<e?m.isDark(Math.floor((c-d)/a),Math.floor((b-d)/a))?0:1:1})};return m};b.stringToBytes=function(a){for(var b=[],c=0;c<a.length;c+=1){var d=a.charCodeAt(c);b.push(d&255)}return b};b.createStringToBytes=function(a,b){var c=function(){for(var c=q(a),d=function(){var a=c.read();if(-1==a)throw Error();return a},e=0,f={};;){var g=c.read();if(-1==g)break;var k=d(),h=d(),B=d(),g=String.fromCharCode(g<<8|k);
f[g]=h<<8|B;e+=1}if(e!=b)throw Error(e+" != "+b);return f}();return function(a){for(var b=[],d=0;d<a.length;d+=1){var e=a.charCodeAt(d);128>e?b.push(e):(e=c[a.charAt(d)],"number"==typeof e?(e&255)==e?b.push(e):(b.push(e>>>8),b.push(e&255)):b.push(63))}return b}};var c={L:1,M:0,Q:3,H:2},e=function(){var b=[[],[6,18],[6,22],[6,26],[6,30],[6,34],[6,22,38],[6,24,42],[6,26,46],[6,28,50],[6,30,54],[6,32,58],[6,34,62],[6,26,46,66],[6,26,48,70],[6,26,50,74],[6,30,54,78],[6,30,56,82],[6,30,58,86],[6,34,62,
90],[6,28,50,72,94],[6,26,50,74,98],[6,30,54,78,102],[6,28,54,80,106],[6,32,58,84,110],[6,30,58,86,114],[6,34,62,90,118],[6,26,50,74,98,122],[6,30,54,78,102,126],[6,26,52,78,104,130],[6,30,56,82,108,134],[6,34,60,86,112,138],[6,30,58,86,114,142],[6,34,62,90,118,146],[6,30,54,78,102,126,150],[6,24,50,76,102,128,154],[6,28,54,80,106,132,158],[6,32,58,84,110,136,162],[6,26,54,82,110,138,166],[6,30,58,86,114,142,170]],c={},d=function(a){for(var b=0;0!=a;)b+=1,a>>>=1;return b};c.getBCHTypeInfo=function(a){for(var b=
a<<10;0<=d(b)-d(1335);)b^=1335<<d(b)-d(1335);return(a<<10|b)^21522};c.getBCHTypeNumber=function(a){for(var b=a<<12;0<=d(b)-d(7973);)b^=7973<<d(b)-d(7973);return a<<12|b};c.getPatternPosition=function(a){return b[a-1]};c.getMaskFunction=function(a){switch(a){case 0:return function(a,b){return 0==(a+b)%2};case 1:return function(a,b){return 0==a%2};case 2:return function(a,b){return 0==b%3};case 3:return function(a,b){return 0==(a+b)%3};case 4:return function(a,b){return 0==(Math.floor(a/2)+Math.floor(b/
3))%2};case 5:return function(a,b){return 0==a*b%2+a*b%3};case 6:return function(a,b){return 0==(a*b%2+a*b%3)%2};case 7:return function(a,b){return 0==(a*b%3+(a+b)%2)%2};default:throw Error("bad maskPattern:"+a);}};c.getErrorCorrectPolynomial=function(b){for(var c=a([1],0),d=0;d<b;d+=1)c=c.multiply(a([1,f.gexp(d)],0));return c};c.getLengthInBits=function(a,b){if(1<=b&&10>b)switch(a){case 1:return 10;case 2:return 9;case 4:return 8;case 8:return 8;default:throw Error("mode:"+a);}else if(27>b)switch(a){case 1:return 12;
case 2:return 11;case 4:return 16;case 8:return 10;default:throw Error("mode:"+a);}else if(41>b)switch(a){case 1:return 14;case 2:return 13;case 4:return 16;case 8:return 12;default:throw Error("mode:"+a);}else throw Error("type:"+b);};c.getLostPoint=function(a){for(var b=a.getModuleCount(),c=0,d=0;d<b;d+=1)for(var e=0;e<b;e+=1){for(var f=0,g=a.isDark(d,e),k=-1;1>=k;k+=1)if(!(0>d+k||b<=d+k))for(var h=-1;1>=h;h+=1)0>e+h||b<=e+h||0==k&&0==h||g!=a.isDark(d+k,e+h)||(f+=1);5<f&&(c+=3+f-5)}for(d=0;d<b-
1;d+=1)for(e=0;e<b-1;e+=1)if(f=0,a.isDark(d,e)&&(f+=1),a.isDark(d+1,e)&&(f+=1),a.isDark(d,e+1)&&(f+=1),a.isDark(d+1,e+1)&&(f+=1),0==f||4==f)c+=3;for(d=0;d<b;d+=1)for(e=0;e<b-6;e+=1)a.isDark(d,e)&&!a.isDark(d,e+1)&&a.isDark(d,e+2)&&a.isDark(d,e+3)&&a.isDark(d,e+4)&&!a.isDark(d,e+5)&&a.isDark(d,e+6)&&(c+=40);for(e=0;e<b;e+=1)for(d=0;d<b-6;d+=1)a.isDark(d,e)&&!a.isDark(d+1,e)&&a.isDark(d+2,e)&&a.isDark(d+3,e)&&a.isDark(d+4,e)&&!a.isDark(d+5,e)&&a.isDark(d+6,e)&&(c+=40);for(e=f=0;e<b;e+=1)for(d=0;d<b;d+=
1)a.isDark(d,e)&&(f+=1);return c+=Math.abs(100*f/b/b-50)/5*10};return c}(),f=function(){for(var a=Array(256),b=Array(256),c=0;8>c;c+=1)a[c]=1<<c;for(c=8;256>c;c+=1)a[c]=a[c-4]^a[c-5]^a[c-6]^a[c-8];for(c=0;255>c;c+=1)b[a[c]]=c;return{glog:function(a){if(1>a)throw Error("glog("+a+")");return b[a]},gexp:function(b){for(;0>b;)b+=255;for(;256<=b;)b-=255;return a[b]}}}(),h=function(){var a=[[1,26,19],[1,26,16],[1,26,13],[1,26,9],[1,44,34],[1,44,28],[1,44,22],[1,44,16],[1,70,55],[1,70,44],[2,35,17],[2,35,
13],[1,100,80],[2,50,32],[2,50,24],[4,25,9],[1,134,108],[2,67,43],[2,33,15,2,34,16],[2,33,11,2,34,12],[2,86,68],[4,43,27],[4,43,19],[4,43,15],[2,98,78],[4,49,31],[2,32,14,4,33,15],[4,39,13,1,40,14],[2,121,97],[2,60,38,2,61,39],[4,40,18,2,41,19],[4,40,14,2,41,15],[2,146,116],[3,58,36,2,59,37],[4,36,16,4,37,17],[4,36,12,4,37,13],[2,86,68,2,87,69],[4,69,43,1,70,44],[6,43,19,2,44,20],[6,43,15,2,44,16],[4,101,81],[1,80,50,4,81,51],[4,50,22,4,51,23],[3,36,12,8,37,13],[2,116,92,2,117,93],[6,58,36,2,59,37],
[4,46,20,6,47,21],[7,42,14,4,43,15],[4,133,107],[8,59,37,1,60,38],[8,44,20,4,45,21],[12,33,11,4,34,12],[3,145,115,1,146,116],[4,64,40,5,65,41],[11,36,16,5,37,17],[11,36,12,5,37,13],[5,109,87,1,110,88],[5,65,41,5,66,42],[5,54,24,7,55,25],[11,36,12,7,37,13],[5,122,98,1,123,99],[7,73,45,3,74,46],[15,43,19,2,44,20],[3,45,15,13,46,16],[1,135,107,5,136,108],[10,74,46,1,75,47],[1,50,22,15,51,23],[2,42,14,17,43,15],[5,150,120,1,151,121],[9,69,43,4,70,44],[17,50,22,1,51,23],[2,42,14,19,43,15],[3,141,113,4,
142,114],[3,70,44,11,71,45],[17,47,21,4,48,22],[9,39,13,16,40,14],[3,135,107,5,136,108],[3,67,41,13,68,42],[15,54,24,5,55,25],[15,43,15,10,44,16],[4,144,116,4,145,117],[17,68,42],[17,50,22,6,51,23],[19,46,16,6,47,17],[2,139,111,7,140,112],[17,74,46],[7,54,24,16,55,25],[34,37,13],[4,151,121,5,152,122],[4,75,47,14,76,48],[11,54,24,14,55,25],[16,45,15,14,46,16],[6,147,117,4,148,118],[6,73,45,14,74,46],[11,54,24,16,55,25],[30,46,16,2,47,17],[8,132,106,4,133,107],[8,75,47,13,76,48],[7,54,24,22,55,25],
[22,45,15,13,46,16],[10,142,114,2,143,115],[19,74,46,4,75,47],[28,50,22,6,51,23],[33,46,16,4,47,17],[8,152,122,4,153,123],[22,73,45,3,74,46],[8,53,23,26,54,24],[12,45,15,28,46,16],[3,147,117,10,148,118],[3,73,45,23,74,46],[4,54,24,31,55,25],[11,45,15,31,46,16],[7,146,116,7,147,117],[21,73,45,7,74,46],[1,53,23,37,54,24],[19,45,15,26,46,16],[5,145,115,10,146,116],[19,75,47,10,76,48],[15,54,24,25,55,25],[23,45,15,25,46,16],[13,145,115,3,146,116],[2,74,46,29,75,47],[42,54,24,1,55,25],[23,45,15,28,46,
16],[17,145,115],[10,74,46,23,75,47],[10,54,24,35,55,25],[19,45,15,35,46,16],[17,145,115,1,146,116],[14,74,46,21,75,47],[29,54,24,19,55,25],[11,45,15,46,46,16],[13,145,115,6,146,116],[14,74,46,23,75,47],[44,54,24,7,55,25],[59,46,16,1,47,17],[12,151,121,7,152,122],[12,75,47,26,76,48],[39,54,24,14,55,25],[22,45,15,41,46,16],[6,151,121,14,152,122],[6,75,47,34,76,48],[46,54,24,10,55,25],[2,45,15,64,46,16],[17,152,122,4,153,123],[29,74,46,14,75,47],[49,54,24,10,55,25],[24,45,15,46,46,16],[4,152,122,18,
153,123],[13,74,46,32,75,47],[48,54,24,14,55,25],[42,45,15,32,46,16],[20,147,117,4,148,118],[40,75,47,7,76,48],[43,54,24,22,55,25],[10,45,15,67,46,16],[19,148,118,6,149,119],[18,75,47,31,76,48],[34,54,24,34,55,25],[20,45,15,61,46,16]],b=function(a,b){var c={};c.totalCount=a;c.dataCount=b;return c},d={},e=function(b,d){switch(d){case c.L:return a[4*(b-1)+0];case c.M:return a[4*(b-1)+1];case c.Q:return a[4*(b-1)+2];case c.H:return a[4*(b-1)+3]}};d.getRSBlocks=function(a,c){var d=e(a,c);if("undefined"==
typeof d)throw Error("bad rs block @ typeNumber:"+a+"/errorCorrectLevel:"+c);for(var f=d.length/3,g=[],k=0;k<f;k+=1)for(var h=d[3*k+0],l=d[3*k+1],B=d[3*k+2],t=0;t<h;t+=1)g.push(b(l,B));return g};return d}(),l=function(){var a=[],b=0,c={getBuffer:function(){return a},getAt:function(b){return 1==(a[Math.floor(b/8)]>>>7-b%8&1)},put:function(a,b){for(var d=0;d<b;d+=1)c.putBit(1==(a>>>b-d-1&1))},getLengthInBits:function(){return b},putBit:function(c){var d=Math.floor(b/8);a.length<=d&&a.push(0);c&&(a[d]|=
128>>>b%8);b+=1}};return c},g=function(a){var c=b.stringToBytes(a);return{getMode:function(){return 4},getLength:function(a){return c.length},write:function(a){for(var b=0;b<c.length;b+=1)a.put(c[b],8)}}},k=function(){var a=[],b={writeByte:function(b){a.push(b&255)},writeShort:function(a){b.writeByte(a);b.writeByte(a>>>8)},writeBytes:function(a,c,d){c=c||0;d=d||a.length;for(var e=0;e<d;e+=1)b.writeByte(a[e+c])},writeString:function(a){for(var c=0;c<a.length;c+=1)b.writeByte(a.charCodeAt(c))},toByteArray:function(){return a},
toString:function(){var b;b="[";for(var c=0;c<a.length;c+=1)0<c&&(b+=","),b+=a[c];return b+"]"}};return b},n=function(){var a=0,b=0,c=0,d="",e={},f=function(a){if(!(0>a)){if(26>a)return 65+a;if(52>a)return 97+(a-26);if(62>a)return 48+(a-52);if(62==a)return 43;if(63==a)return 47}throw Error("n:"+a);};e.writeByte=function(e){a=a<<8|e&255;b+=8;for(c+=1;6<=b;)d+=String.fromCharCode(f(a>>>b-6&63)),b-=6};e.flush=function(){0<b&&(d+=String.fromCharCode(f(a<<6-b&63)),b=a=0);if(0!=c%3)for(var e=3-c%3,g=0;g<
e;g+=1)d+="="};e.toString=function(){return d};return e},q=function(a){var b=0,c=0,d=0,e=function(a){if(65<=a&&90>=a)return a-65;if(97<=a&&122>=a)return a-97+26;if(48<=a&&57>=a)return a-48+52;if(43==a)return 62;if(47==a)return 63;throw Error("c:"+a);};return{read:function(){for(;8>d;){if(b>=a.length){if(0==d)return-1;throw Error("unexpected end of file./"+d);}var f=a.charAt(b);b+=1;if("="==f)return d=0,-1;f.match(/^\s$/)||(c=c<<6|e(f.charCodeAt(0)),d+=6)}f=c>>>d-8&255;d-=8;return f}}},d=function(a,
b){var c=Array(a*b),d=function(a){var b=0,c=0;return{write:function(d,e){if(0!=d>>>e)throw Error("length over");for(;8<=b+e;)a.writeByte(255&(d<<b|c)),e-=8-b,d>>>=8-b,b=c=0;c|=d<<b;b+=e},flush:function(){0<b&&a.writeByte(c)}}},e=function(){var a={},b=0,c={add:function(d){if(c.contains(d))throw Error("dup key:"+d);a[d]=b;b+=1},size:function(){return b},indexOf:function(b){return a[b]},contains:function(b){return"undefined"!=typeof a[b]}};return c};return{setPixel:function(b,d,e){c[d*a+b]=e},write:function(f){f.writeString("GIF87a");
f.writeShort(a);f.writeShort(b);f.writeByte(128);f.writeByte(0);f.writeByte(0);f.writeByte(0);f.writeByte(0);f.writeByte(0);f.writeByte(255);f.writeByte(255);f.writeByte(255);f.writeString(",");f.writeShort(0);f.writeShort(0);f.writeShort(a);f.writeShort(b);f.writeByte(0);var g;g=3;for(var h=e(),r=0;4>r;r+=1)h.add(String.fromCharCode(r));h.add(String.fromCharCode(4));h.add(String.fromCharCode(5));var r=k(),l=d(r);l.write(4,g);for(var n=0,p=String.fromCharCode(c[n]),n=n+1;n<c.length;){var q=String.fromCharCode(c[n]),
n=n+1;h.contains(p+q)?p+=q:(l.write(h.indexOf(p),g),4095>h.size()&&(h.size()==1<<g&&(g+=1),h.add(p+q)),p=q)}l.write(h.indexOf(p),g);l.write(5,g);l.flush();g=r.toByteArray();f.writeByte(2);for(h=0;255<g.length-h;)f.writeByte(255),f.writeBytes(g,h,255),h+=255;f.writeByte(g.length-h);f.writeBytes(g,h,g.length-h);f.writeByte(0);f.writeString(";")}}},p=function(a,b,c,e){for(var f=d(a,b),g=0;g<b;g+=1)for(var h=0;h<a;h+=1)f.setPixel(h,g,c(h,g));c=k();f.write(c);f=n();c=c.toByteArray();for(g=0;g<c.length;g+=
1)f.writeByte(c[g]);f.flush();c='<img src="';c+="data:image/gif;base64,";c+=f;c+='"';c+=' width="';c+=a;c+='"';c+=' height="';c+=b;c+='"';e&&(c+=' alt="',c+=e,c+='"');return c+="/>"};return b}();(function(a){"function"===typeof define&&define.amd?define([],a):"object"===typeof exports&&(module.exports=a())})(function(){return qrcode});
(function(a){a.stringToBytes=function(a){for(var c=[],e=0;e<a.length;e++){var f=a.charCodeAt(e);128>f?c.push(f):2048>f?c.push(192|f>>6,128|f&63):55296>f||57344<=f?c.push(224|f>>12,128|f>>6&63,128|f&63):(e++,f=65536+((f&1023)<<10|a.charCodeAt(e)&1023),c.push(240|f>>18,128|f>>12&63,128|f>>6&63,128|f&63))}return c}})(qrcode);angular.module("smsValidation",["ngResource","common-authentication"]).directive("smsValidation",["$ionicLoading","smsValidationAPI","$interval","CommonAuthenticationService",function(a,b,c,e){return{restrict:"E",scope:{presetInvitationCode:"=presetInvitationCode",success:"&onSuccess"},templateUrl:"templates/common/sms.validation.html",link:function(f){f.statusCode={waitMobile:0,waitCode:1};f.status=f.statusCode.waitMobile;f.showInvitationCode=!1;var h,l=function(a){f.count=60;angular.isDefined(h)||
(h=c(function(){1<f.count?--f.count:(angular.isDefined(h)&&(c.cancel(h),h=void 0),a())},1E3))},g=function(){a.show({template:"<ion-spinner></ion-spinner>",delay:100});b.send(f.mobile,f.captcha,function(){a.hide();f.status=f.statusCode.waitCode;l(function(){f.status===f.statusCode.waitCode&&(f.status.code=f.statusCode.waitMobile)})},function(b){a.hide();f.refreshCaptcha();f.captcha=void 0;alert(b.data.error)})};f.sendSmsValidation=function(){void 0===f.mobile?alert("\u8bf7\u6b63\u786e\u8f93\u5165\u624b\u673a\u53f7"):
void 0===f.captcha?alert("\u8bf7\u6b63\u786e\u8f93\u5165\u56fe\u7247\u9a8c\u8bc1\u7801"):g()};f.refreshCaptcha=function(){f.showCaptcha=!0;void 0!==f.mobile&&(f.captchaUrl=b.getCaptchaUrl(f.mobile))};f.checkExist=function(){f.showInvitationCode=!1;void 0!==f.mobile&&e.exist(f.mobile,function(){f.showInvitationCode=!1},function(){f.showInvitationCode=!0})};f.auth=function(){e.auth(f.mobile,f.validationCode,void 0!==f.presetInvitationCode?f.presetInvitationCode:f.invitationCode,function(a){f.success()},
function(a){alert(a)})}}}}]).service("smsValidationAPI",["$resource","urlConfig",function(a,b){var c=a(b.REST_END_POINT+"/sso/smsValidate",{phoneNumber:"@phoneNumber",captcha:"@captcha"},{send:{method:"POST",isArray:!1}},null);return{send:function(a,b,h,l){c.send({phoneNumber:a,captcha:b},function(){h()},function(a){l(a)})},getCaptchaUrl:function(a){return b.REST_END_POINT+"/sso/captcha?phoneNumber="+a+"&time="+(new Date).getTime()}}}]);angular.module("wechat",["wechat.service"]);
angular.module("wechat.service",[]).constant("wechatConstants",{SHARE_IMG_URL:"img/promotion/share.png",TIMELINE_IMG_URL:"img/promotion/share.png",PROMOTION_SHARE_ROOT:"/wechatlogin/oauth2?state=promotion:",SURVEY_SHARE_ROOT:"/wechatlogin/oauth2?state=survey:",CLAIM_SHARE_ROOT:"/#/claim/"}).service("Wechat",["urlConfig","$resource","$location","wechatConstants",function(a,b,c,e){var f,h=b(a.REST_END_POINT+"/api/wechat/config",{url:"@url"}),l=b(a.REST_END_POINT+"/wechatlogin/oauth2/bind",{openId:"@openId"}),
g=function(a,b,d){var e=new h;a=a?c.protocol()+"://"+c.host()+"/":c.absUrl();e.$get({url:a},function(a){y=a;console.log("refresh wechat mp config success");b()},function(a){y=void 0;console.log("refresh wechat mp config error by: "+a.data.error);d(a)})},k=function(a,b,c){wx.chooseImage({count:1,sizeType:["compressed"],sourceType:["album","camera"],success:function(a){b(a.localIds)}})},n=function(a,b,c){wx.uploadImage({localId:a,isShowProgressTips:1,success:function(a){b(a.serverId)}})},q=function(a,
b,c){wx.getLocation({type:"gcj02",success:function(a){b(a)},cancel:function(a){c(a)}})},d=function(a,b,c,d){wx.previewImage({current:b[a],urls:b})},p=function(a,b,c,d){wx.config({debug:!1,appId:y.appId,timestamp:y.timestamp,nonceStr:y.noncestr,signature:y.signature,jsApiList:"onMenuShareAppMessage onMenuShareTimeline chooseWXPay chooseImage uploadImage getLocation previewImage hideMenuItems".split(" ")});wx.ready(function(){a(b,c,d)})},t=function(b,c,d,f){b&&wx.hideMenuItems({menuList:["menuItem:share:appMessage"]});
wx.onMenuShareAppMessage({title:c.name,desc:c.description,link:c.url,imgUrl:a.APP_ROOT+"/"+e.SHARE_IMG_URL,trigger:function(a){},success:function(a){d()},cancel:function(a){f("\u5df2\u53d6\u6d88\u5206\u4eab")},fail:function(a){f("\u5206\u4eab\u5931\u8d25")}});wx.onMenuShareTimeline({title:c.name,link:c.url,imgUrl:a.APP_ROOT+"/"+e.TIMELINE_IMG_URL,trigger:function(a){},success:function(a){d()},cancel:function(a){f("\u5df2\u53d6\u6d88\u5206\u4eab")},fail:function(a){f("\u5206\u4eab\u5931\u8d25")}})},
u=function(a,b,c){t(!0,a,b,c)},B=function(a,b,c){t(!1,a,b,c)},w=function(a,b,c){wx.chooseWXPay({timestamp:a.timeStamp+"",nonceStr:a.nonceStr,"package":a.packagePrepayId,signType:a.signType,paySign:a.paySign,success:function(a){b()},fail:function(a){c()},cancel:function(a){c()}})},y;return{hookShareAll:function(a,b,c,d){void 0===y?g(a,function(){p(B,b,c,d)},function(a){alert("\u5fae\u4fe1\u73af\u5883\u9519\u8bef\uff0c\u8bf7\u91cd\u65b0\u6253\u5f00\u9875\u9762")}):p(B,b,c,d)},hookShareTimelineOnly:function(a,
b,c,d){void 0===y?g(a,function(){p(u,b,c,d)},function(a){alert("\u5fae\u4fe1\u73af\u5883\u9519\u8bef\uff0c\u8bf7\u91cd\u65b0\u6253\u5f00\u9875\u9762")}):p(u,b,c,d)},doWxPay:function(a,b,c){void 0===y?g(!0,function(){p(w,a,b,c)},function(a){alert("\u5fae\u4fe1\u73af\u5883\u9519\u8bef\uff0c\u8bf7\u91cd\u65b0\u6253\u5f00\u9875\u9762")}):p(w,a,b,c)},chooseImage:function(a,b){void 0===y?g(!0,function(){p(k,"",a,b)},function(a){alert("\u5fae\u4fe1\u73af\u5883\u9519\u8bef\uff0c\u8bf7\u91cd\u65b0\u6253\u5f00\u9875\u9762")}):
p(k,"",a,b)},previewImage:function(a,b,c,e){void 0===y?g(!0,function(){p(d,a,b,c,e)},function(a){alert("\u5fae\u4fe1\u73af\u5883\u9519\u8bef\uff0c\u8bf7\u91cd\u65b0\u6253\u5f00\u9875\u9762")}):p(d,a,b,c,e)},getUserLocation:function(a,b){void 0===y?g(!0,function(){p(q,"",a,b)},function(a){alert("\u5fae\u4fe1\u73af\u5883\u9519\u8bef\uff0c\u8bf7\u91cd\u65b0\u6253\u5f00\u9875\u9762")}):p(q,"",a,b)},uploadImage:function(a,b,c){void 0===y?g(!0,function(){p(n,a,b,c)},function(a){alert("\u5fae\u4fe1\u73af\u5883\u9519\u8bef\uff0c\u8bf7\u91cd\u65b0\u6253\u5f00\u9875\u9762")}):
p(n,a,b,c)},isQQBrowser:function(){return-1!==navigator.userAgent.indexOf("MQQBrowser")},bind:function(a,b,c){(new l).$save({openId:a},b,function(a){c(a.data.error)})},getOpenId:function(){return f},setOpenId:function(a){f=a}}}]);
