angular.module("account.community",["account.community.service","promotion"]).controller("CommCreditCtrl",["$scope","$state","$ionicHistory","$rootScope","$ionicLoading","eventNames","CreditAPI",function(a,b,d,f,c,h,k){var e=function(){a.records=[];n(function(){c.show({template:"<ion-spinner></ion-spinner>",delay:100})},function(){c.hide()},function(){f.navToIndex()})},p=function(){a.records=void 0;a.pageNumber=void 0;a.hasRecord=void 0;a.initFinish=void 0},n=function(b,g,e){b();k.refresh(function(b){a.records=
b;a.pageNumber=0;a.hasRecord=!(void 0===a.records||0===a.records.length);a.initFinish=!0;g()},function(b){a.initFinish=!0;console.log(b);alert("\u5237\u65b0\u5931\u8d25\uff0c\u8bf7\u7a0d\u540e\u518d\u8bd5");g();e()})};a.loadMore=function(){a.canLoadMore()&&k.getPage(a.pageNumber+1,function(b){if(void 0!==b&&0!==b.length){for(var g=0;g<b.length;g++)a.records.push(b[g]);a.pageNumber++}a.$broadcast("scroll.infiniteScrollComplete")},function(b){alert(b);a.$broadcast("scroll.infiniteScrollComplete")})};
a.refresh=function(){n(function(){},function(){$timeout(function(){a.$broadcast("scroll.refreshComplete")},500)},function(){})};a.canLoadMore=function(){return void 0===a.initFinish?!1:k.hasMoreToLoad()};e();f.$on("$stateChangeStart",function(a,g,b,r,c){if("app.account.community"===g.name||"app.account.community.invite"===g.name||"app.account.community.credit"===g.name||"app.account.community.exchange"===g.name){if("app.account.community.invite"===r.name||"app.account.community.credit"===r.name)return;
e()}"app.account.sales"!==g.name&&"app.account.sales.invite"!==g.name&&"app.account.sales.credit"!==g.name||"app.account.sales.invite"===r.name||"app.account.sales.credit"===r.name||e()});f.$on("event:auth-loginCancelled",function(){p()});f.$on("event:auth-logout-complete",function(){p()});f.$on(h.CREDIT_EXCHANGE_SUCCESS,function(a,g){p()})}]).controller("CommExchangeCtrl",["$scope","$state","$ionicHistory","$rootScope","$ionicLoading","eventNames","CreditExchangeAPI",function(a,b,d,f,c,h,k){a.exchange=
function(b){b.creditAmount>a.$parent.account.credit?alert("\u7231\u5fc3\u6570\u91cf\u4e0d\u8db3\uff0c\u8bf7\u83b7\u5f97\u66f4\u591a\u7231\u5fc3\u518d\u6765\u5151\u6362"):(c.show({template:"<ion-spinner></ion-spinner>",delay:100}),k.exchange(b.id,function(){c.hide();f.$broadcast(h.CREDIT_EXCHANGE_SUCCESS);alert("\u5151\u6362\u6210\u529f")},function(a){c.hide();alert(a)}))};(function(){a.rules=[];c.show({template:"<ion-spinner></ion-spinner>",delay:100});k.getRules(function(b){a.rules=b;c.hide()},function(a){c.hide();
alert(a);f.navToIndex()})})()}]).controller("CommInviteCtrl",["$scope","$state","$ionicHistory","$rootScope","$ionicLoading","eventNames","PromotionAPI","Wechat",function(a,b,d,f,c,h,k,e){var p=function(b){void 0===a.$parent||void 0===a.$parent.account?a.$on("account-ready",function(a,e){b()}):b()},n=function(){a.invitePromotionUrl=k.getShareUrl(a.$parent.account.invitePromotionId);c.show({template:"<ion-spinner></ion-spinner>",delay:100});k.getPublicBatch(a.$parent.account.invitePromotionId,function(b){c.hide();
a.batch=b;e.hookShareAll(!0,k.convertBatchToContent(a.batch),function(){},function(a){alert(a)})},function(a){c.hide();alert("\u672a\u627e\u5230\u5206\u4eab\u6d3b\u52a8\uff0c\u8bf7\u8054\u7cfb\u7ba1\u7406\u5458\u6216\u7a0d\u540e\u518d\u8bd5")})};p(n);f.$on("$stateChangeStart",function(a,g,b,r,e){("app.account.community.invite"===g.name&&"app.account.community.invite"!==r.name&&"app.account.community.exchange"!==r.name&&"app.account.community.credit"!==r.name||"app.account.sales.invite"===g.name&&
"app.account.sales.invite"!==r.name)&&p(n)})}]);
angular.module("account.community.service",["ngResource"]).service("CreditAPI",["$resource","urlConfig",function(a,b){var d=a(b.REST_END_POINT+"/api/account/credit/record",{page:"@page"},{query:{method:"GET",isArray:!1,timeout:1E4}},null),f=function(a,b,c){d.query({page:a},function(a){for(var g=[],e=0;e<a.list.length;e++)h[a.list[e].id]=a.list[e],g.push(a.list[e]);console.log("credit record page data get page success");b(g)},function(a){c(a.data.error)})},c=function(a,b){h={};k=0;d.query({page:0},
function(b){k=b.metaData.total;for(var c=[],g=0;g<b.list.length;g++)h[b.list[g].id]=b.list[g],c.push(b.list[g]);console.log("credit record metaData init success");a(c)},function(a){b(a.data.error)})},h={},k=0;return{getPage:function(a,b,c){f(a,b,c)},get:function(a){return h[a]},refresh:function(a,b){c(a,b)},hasMoreToLoad:function(){return!!(void 0!==h&&0!==Object.keys(h).length&&Object.keys(h).length<k)},clean:function(){h=void 0;k=0}}}]).service("CreditExchangeAPI",["$resource","urlConfig",function(a,
b){var d=a(b.REST_END_POINT+"/api/account/credit/exchangeRule",{},{query:{method:"GET",isArray:!0,timeout:1E4}},null),f=a(b.REST_END_POINT+"/api/account/credit/exchangeRule/:ruleId/exchange",{ruleId:"@ruleId"},{exchange:{method:"POST",isArray:!1,timeout:1E4}},null),c=[],h=function(a,b){c=[];d.query({},function(b){c=b;console.log("credit exchange rule init success");a(c)},function(a){b("\u672a\u627e\u5230\u53ef\u5151\u6362\u5546\u54c1\uff0c\u8bf7\u8054\u7cfb\u7ba1\u7406\u5458\u6216\u7a0d\u540e\u518d\u8bd5")})},
k=function(a,b,c){f.exchange({ruleId:a},function(a){b()},function(a){c(a.data.error)})};return{getRules:function(a,b){void 0===c||0===c.length?h(a,b):a(c)},exchange:function(a,b,c){k(a,b,c)}}}]);angular.module("account",["account.service","smsValidation","wechat","account.community"]).controller("AccountCtrl",["$scope","$state","$rootScope","$ionicLoading","AccountAPI","accountConstants","eventNames",function(a,b,d,f,c,h,k){a.state={info:1,edit:2};var e=function(){a.actState=a.state.info;f.show({template:"<ion-spinner></ion-spinner>",delay:100});c.getAccount(function(b){f.hide();a.account=b;a.$broadcast("account-ready",a.account)},function(a){f.hide();console.log("error getting account, by: "+
a);alert("\u670d\u52a1\u5668\u672a\u54cd\u5e94\uff0c\u83b7\u53d6\u8d26\u6237\u4fe1\u606f\u5931\u8d25\uff0c\u8bf7\u7a0d\u540e\u518d\u8bd5");d.navToIndex()})};a.canEditCompany=function(){return a.account.type===h.ACCOUNT_TYPE_NORMAL};a.canEditEmail=function(){return a.account.type===h.ACCOUNT_TYPE_NORMAL};a.showEdit=function(){a.actState=a.state.edit;a.backupName=a.account.name;a.backupAddress=a.account.address;a.backupCompany=a.account.company;a.backupEmail=a.account.email};a.saveEdit=function(){f.show({template:"<ion-spinner></ion-spinner>",
delay:100});c.saveAccount(a.account,function(b){f.hide();a.actState=a.state.info;a.backupName=void 0;a.backupAddress=void 0;a.backupCompany=void 0;a.backupEmail=void 0},function(a){f.hide();alert(a.data.error)})};a.cancelEdit=function(){a.account.name=a.backupName;a.account.address=a.backupAddress;a.account.company=a.backupCompany;a.account.email=a.backupEmail;a.backupName=void 0;a.backupAddress=void 0;a.backupCompany=void 0;a.backupEmail=void 0;a.actState=a.state.info};e();d.$on("$stateChangeStart",
function(a,b,c,g,d){"app.account"!==b.name&&"app.account.show"!==b.name||"app.account"===g.name||"app.account.show"===g.name||e()});d.$on("event:auth-loginCancelled",function(){c.clean();a.account=void 0});d.$on("event:auth-logout-complete",function(){c.clean();a.account=void 0});d.$on(k.CREDIT_EXCHANGE_SUCCESS,function(a,b){c.clean();e()})}]).controller("SalesOrCommCtrl",["$scope","$rootScope",function(a,b){var d=function(a){a.isSuperDXK?b.navToRoot("app.account.sales.credit"):b.navToRoot("app.account.community.credit")},
f=function(){void 0===a.$parent.account?a.$on("account-ready",function(b,f){d(a.$parent.account)}):d(a.$parent.account)};f();b.$on("$stateChangeStart",function(a,b,d,e,p){"app.account.salesOrComm"===b.name&&"app.account.salesOrComm"!==e.name&&(a.preventDefault(),f())})}]);
angular.module("account.service",["ngResource","http-auth-interceptor","wechat"]).service("AccountAPI",["$resource","urlConfig","Wechat",function(a,b,d){var f,c=a(b.REST_END_POINT+"/api/account",null,{query:{method:"GET",isArray:!1,timeout:1E4},save:{method:"POST",timeout:1E4}},null);return{getAccount:function(a,b){if(void 0===f){var e=d.getOpenId();void 0!==e?d.bind(e,function(d){console.log("wechat bind succeed");c.query({},function(b){f=b;a(f)},b)},function(a){console.log("wechat bind failed by: "+
a);b(a)}):c.query({},function(b){f=b;a(f)},b)}else a(f)},saveAccount:function(a,b,d){c.save(a,function(c){f=a;b()},function(a){d(a)})},clean:function(){f=void 0}}}]);angular.module("agreement",["agreement.service","wechat"]).controller("AgreementCtrl",["$scope","$state","AgreementAPI","agreementConstants","$rootScope","$ionicLoading","eventNames",function(a,b,d,f,c,h,k){var e=function(b,g,e){a.initFinish=!1;h.show({template:"<ion-spinner></ion-spinner>",delay:100});d.findPublicByIdIn(n,function(r){a.toPropose="1"===b;a.showPaygo="1"===g;a.showUser="1"===e;a.publicAgreements=r;a.showUser?d.all(function(b){a.agreementlist=b;h.hide();a.initFinish=!0},function(b){h.hide();
a.initFinish=!0;c.navToIndex()}):(h.hide(),a.initFinish=!0)},function(a){console.log("error initializing index, by: "+a);h.hide();alert("\u670d\u52a1\u5668\u672a\u54cd\u5e94\uff0c\u83b7\u53d6\u534f\u8bae\u5931\u8d25\uff0c\u8bf7\u7a0d\u540e\u518d\u8bd5")})},p=function(){a.agreementlist=void 0;a.toPropose=void 0;a.showPaygo=void 0;a.showUser=void 0;a.publicAgreements=void 0;a.initFinish=void 0};a.expired=function(a){return new Date(a.endDate)<new Date};var n=[f.AGREEMENT_ID_PAYGO_LOCAL_JB_LITE,f.AGREEMENT_ID_PAYGO_LOCAL_ZH,
f.AGREEMENT_ID_PAYGO_JB_LITE,f.AGREEMENT_ID_PAYGO_JB,f.AGREEMENT_ID_AUTO_PAYGO,f.AGREEMENT_ID_PAYGO_ZR];e(b.params.toPropose,b.params.paygo,b.params.user);c.$on("$stateChangeStart",function(a,b,c,r,d){"app.agreement"!==b.name&&"app.agreement.list"!==b.name&&"app.agreement.detail"!==b.name||e(c.toPropose,c.paygo,c.user)});c.$on("event:auth-loginCancelled",function(){p()});c.$on("event:auth-logout-complete",function(){p()});c.$on(k.PROPOSAL_SUCCESS,function(a,b){d.clean()});c.$on(k.AGREEMENT_CHARGE_SUCCESS,
function(a,b){d.clean()})}]).controller("AgreementDetailCtrl",["$rootScope","$scope","$stateParams","AgreementAPI","eventNames",function(a,b,d,f,c){var h=function(){f.find(d.id,function(a){b.agreement=a},function(a){b.message=a})};h();a.$on(c.AGREEMENT_CHARGE_SUCCESS,function(a,b){h()})}]).controller("AgreementPublicDetailCtrl",["$rootScope","$scope","$stateParams","AgreementAPI","eventNames",function(a,b,d,f,c){(function(){f.findPublic(d.id,function(a){b.agreement=a},function(a){b.message=a})})()}]).controller("AgreementChargeCtrl",
["$rootScope","$scope","$state","$stateParams","AgreementAPI","$ionicActionSheet","AccountAPI","agreementConstants","eventNames","Wechat","$ionicLoading","$ionicPopup",function(a,b,d,f,c,h,k,e,p,n,q,g){var t=function(){q.show({template:"<ion-spinner></ion-spinner>",delay:100});c.preOrder(b.chargeOrder,function(a){console.log("pre order succeed");r(a)},function(a){q.hide();console.log("pre order error, by: ",a.data.error);alert(a.data.error)})},r=function(a){b.chargeOrder.orderId=a.orderId;n.doWxPay(a.paymentResponse,
function(){m()},function(){q.hide();alert("\u652f\u4ed8\u5931\u8d25")})},m=function(){c.finishOrder(b.chargeOrder.orderId,function(g){q.hide();b.error=void 0;console.log("save order successfull");a.$broadcast(p.AGREEMENT_CHARGE_SUCCESS,g);alert("\u5145\u503c\u91d1\u989d"+b.chargeOrder.fee+"\u5143\uff0c\u4ee3\u91d1\u5238\u5df2\u7ecf\u53d1\u653e\uff0c\u8bf7\u5230\u6211\u7684\u4f18\u60e0\u5238\u4e2d\u67e5\u770b");d.go("app.agreement.detail",{id:f.id})},function(a){q.hide();console.log("save transaction failed, error:"+
a.data.error);alert(a.data.error)})};(function(){q.show({template:"<ion-spinner></ion-spinner>",delay:100});c.find(f.id,function(a){b.agreement=a;b.agreement.invoiceTypes=e.INVOICE_TYPES;k.getAccount(function(a){b.account=a;b.chargeOrder={agreement:b.agreement,chargeRule:b.agreement.chargeRules[0],fee:b.agreement.chargeRules[0]?b.agreement.chargeRules[0].chargeAmount:0};b.account.invoiceSetting&&(b.chargeOrder.companyTaxId=b.account.invoiceSetting.companyTaxId);b.chargeOrder.invoiceType=e.INVOICE_TYPE_NORMAL;
q.hide()},function(a){console.log("error getting account, by: "+a);q.hide();alert("\u670d\u52a1\u5668\u672a\u54cd\u5e94\uff0c\u83b7\u53d6\u652f\u4ed8\u4fe1\u606f\u5931\u8d25\uff0c\u8bf7\u7a0d\u540e\u518d\u8bd5")})},function(a){q.hide();b.message=a})})();b.showRules=function(){for(var a=[],g=0;g<b.agreement.chargeRules.length;g++)a[g]={text:"<div>"+b.agreement.chargeRules[g].name+"</div><p>"+b.agreement.chargeRules[g].description+"</p>"};h.show({buttons:a,buttonClicked:function(a){b.chargeOrder.chargeRule=
b.agreement.chargeRules[a];b.chargeOrder.fee=b.chargeOrder.chargeRule.chargeAmount;return!0}})};b.canShowTaxId=function(){return void 0!==b.chargeOrder&&b.chargeOrder.invoiceType!==e.INVOICE_TYPE_NORMAL};b.wxPay=function(){void 0===n.getOpenId()?alert("\u672a\u68c0\u6d4b\u5230\u5fae\u4fe1\u652f\u4ed8\u73af\u5883\uff0c\u8bf7\u5728\u5fae\u4fe1\u516c\u4f17\u53f7\u4e2d\u64cd\u4f5c"):(b.chargeOrder.buyerId=n.getOpenId(),b.chargeOrder.payProvider=e.PAY_PROVIDER_WX,t())}}]);
angular.module("agreement.service",["ngResource"]).service("AgreementAPI",["$resource","urlConfig","agreementConstants",function(a,b,d){var f=function(a,b){return a.displayIndex-b.displayIndex},c=function(a,b){return a.pinyin>a.pinyin?1:a.pinyin<b.pinyin?-1:0},h=function(a,b){return a.value-b.value},k=a(b.REST_END_POINT+"/api/public/agreement",null,{query:{method:"GET",isArray:!1,timeout:1E4}},null),e,p=a(b.REST_END_POINT+"/api/agreement",null,{query:{method:"GET",isArray:!0,timeout:1E4}},null),n=
a(b.REST_END_POINT+"/api/order/charge"),q=a(b.REST_END_POINT+"/api/order/:id/finish"),g,t=function(a,b){k.query({},function(b){console.log("public agreement init success");b.contexts.divisions.sort(c);e=b.agreements;e[d.AGREEMENT_ID_AUTO_PAYGO].divisions=b.contexts.divisions;e[d.AGREEMENT_ID_AUTO_PAYGO].goods.sort(f);e[d.AGREEMENT_ID_AUTO_PAYGO].coverages.sort(h);e[d.AGREEMENT_ID_AUTO_PAYGO].invoiceTypes=d.INVOICE_TYPES;e[d.AGREEMENT_ID_PAYGO_LOCAL_ZH].divisions=b.contexts.divisions;e[d.AGREEMENT_ID_PAYGO_LOCAL_ZH].goods.sort(f);
e[d.AGREEMENT_ID_PAYGO_LOCAL_ZH].coverages.sort(h);e[d.AGREEMENT_ID_PAYGO_LOCAL_ZH].invoiceTypes=d.INVOICE_TYPES;e[d.AGREEMENT_ID_PAYGO_JB].divisions=b.contexts.divisions;e[d.AGREEMENT_ID_PAYGO_JB].goods.sort(f);e[d.AGREEMENT_ID_PAYGO_JB].coverages.sort(h);e[d.AGREEMENT_ID_PAYGO_JB].invoiceTypes=d.INVOICE_TYPES;e[d.AGREEMENT_ID_PAYGO_LOCAL_JB_LITE].divisions=b.contexts.divisions;e[d.AGREEMENT_ID_PAYGO_LOCAL_JB_LITE].goods.sort(f);e[d.AGREEMENT_ID_PAYGO_LOCAL_JB_LITE].coverages.sort(h);e[d.AGREEMENT_ID_PAYGO_LOCAL_JB_LITE].invoiceTypes=
d.INVOICE_TYPES;e[d.AGREEMENT_ID_PAYGO_JB_LITE].divisions=b.contexts.divisions;e[d.AGREEMENT_ID_PAYGO_JB_LITE].goods.sort(f);e[d.AGREEMENT_ID_PAYGO_JB_LITE].coverages.sort(h);e[d.AGREEMENT_ID_PAYGO_JB_LITE].invoiceTypes=d.INVOICE_TYPES;e[d.AGREEMENT_ID_PAYGO_ZR].divisions=b.contexts.divisions;e[d.AGREEMENT_ID_PAYGO_ZR].goods.sort(f);e[d.AGREEMENT_ID_PAYGO_ZR].coverages.sort(h);e[d.AGREEMENT_ID_PAYGO_ZR].invoiceTypes=d.INVOICE_TYPES;e[d.AGREEMENT_ID_SIGNUP_COUPON].divisions=b.contexts.divisions.filter(function(a){return 100===
a.defaultRouteFeeRate});e[d.AGREEMENT_ID_SIGNUP_COUPON].goods.sort(f);e[d.AGREEMENT_ID_SIGNUP_COUPON].coverages.sort(h);e[d.AGREEMENT_ID_COUPON_TRANSACTION_25].divisions=b.contexts.divisions.filter(function(a){return 100===a.defaultRouteFeeRate});e[d.AGREEMENT_ID_COUPON_TRANSACTION_25].goods.sort(f);e[d.AGREEMENT_ID_COUPON_TRANSACTION_25].coverages.sort(h);e[d.AGREEMENT_ID_SIMULATE].divisions=b.contexts.divisions;e[d.AGREEMENT_ID_SIMULATE].goods.sort(f);e[d.AGREEMENT_ID_SIMULATE].coverages.sort(h);
b=Object.keys(e);for(var g=0;g<b.length;g++){for(var r=e[b[g]].coverages[0],z=e[b[g]].coverages[0],m=0;m<e[b[g]].coverages.length;m++)e[b[g]].coverages[m].discountFee=Math.round(e[b[g]].coverages[m].basefee*e[b[g]].discountRate/100),r.value>e[b[g]].coverages[m].value&&(r=e[b[g]].coverages[m]),z.value<e[b[g]].coverages[m].value&&(z=e[b[g]].coverages[m]);e[b[g]].lowCoverage=r;e[b[g]].highCoverage=z;e[b[g]].backgroundUrl=d.BACKGROUND_ROOT+b[g]+".jpg";e[b[g]].matrix=d.PUBLIC_AGREEMENT_MATRIX[b[g]]}a()},
b)},r=function(a,b){p.query({},function(b){g=b;console.log("user agreement init success");b=g;for(var r=0;r<b.length;r++)b[r].goods.sort(f),b[r].coverages.sort(h);a(g)},b)},m=function(a,b,g){void 0===e?t(function(){void 0===e||void 0===e[a]?g("\u534f\u8bae\u672a\u627e\u5230\uff0c\u8bf7\u8054\u7cfb\u7ba1\u7406\u5458"):b(e[a])},g):b(e[a])},A=function(a,b){for(var g={},r=0;r<b.length;r++)void 0!==a[b[r]]&&(g[b[r]]=a[b[r]]);return g},y=function(a,b,g){r(function(r){for(var c,d=0;d<r.length;d++)r[d].id===
parseInt(a)&&(c=r[d]);void 0===c?g("\u672a\u627e\u5230\u534f\u8bae\uff0c\u8bf7\u8054\u7cfb\u7ba1\u7406\u5458"):b(c)},g)};return{getProposal:function(a,b,g){a===d.AGREEMENT_ID_AUTO_PAYGO||a===d.AGREEMENT_ID_PAYGO_LOCAL_ZH||a===d.AGREEMENT_ID_PAYGO_JB||a===d.AGREEMENT_ID_PAYGO_ZR||a===d.AGREEMENT_ID_PAYGO_LOCAL_JB_LITE||a===d.AGREEMENT_ID_PAYGO_JB_LITE||a===d.AGREEMENT_ID_SIGNUP_COUPON||a===d.AGREEMENT_ID_COUPON_TRANSACTION_25||a===d.AGREEMENT_ID_SIMULATE?m(a,b,g):y(a,b,g)},findPublicByIdIn:function(a,
b,g){void 0===e?t(function(){void 0===e?g("\u534f\u8bae\u672a\u627e\u5230\uff0c\u8bf7\u8054\u7cfb\u7ba1\u7406\u5458"):b(A(e,a))},g):b(A(e,a))},all:function(a,b){void 0===g?r(function(){a(g)},function(a){console.log(a);b(a)}):a(g)},findPublic:function(a,b,g){m(a,b,g)},find:function(a,b,g){y(a,b,g)},clean:function(){g=void 0},preOrder:function(a,b,g){(new n(a)).$save({},function(a){b(a)},function(a){g(a)})},finishOrder:function(a,b,g){(new q).$save({id:a},function(a){b(a)},function(a){g(a)})}}}]);angular.module("app",["smsValidation","wechat","account"]).controller("AppCtrl",["$scope","$ionicModal","$rootScope","$state","authService","$ionicHistory","$ionicLoading","CommonAuthenticationService","Wechat","$timeout","$ionicPopup","AccountAPI",function(a,b,d,f,c,h,k,e,p,n,q,g){n(function(){window.loading_screen.finish()},1500);a.isQQBrowser=!!p.isQQBrowser();d.navToRoot=function(a,b){h.nextViewOptions({historyRoot:!0});f.go(a,b)};d.navToIndex=function(){d.navToRoot("app.portal.category")};b.fromTemplateUrl("templates/app/login.html",
{scope:a}).then(function(b){a.modal=b});a.loginConfirmed=function(){c.loginConfirmed()};a.quit=function(){e.quit(function(){d.$broadcast("event:auth-logout-complete")})};a.cancel=function(){c.loginCancelled()};a.$on("event:auth-loginRequired",function(b,g){console.log("Login required");k.hide();a.modal.show()});a.$on("event:auth-loginConfirmed",function(){a.modal.hide()});a.$on("event:auth-loginCancelled",function(){a.modal.hide();h.nextViewOptions({historyRoot:!0});d.navToIndex()});a.$on("event:auth-logout-complete",
function(){h.nextViewOptions({historyRoot:!0});d.navToIndex()});a.$on("event:auth-forbidden",function(){console.log("Auth forbidden");k.hide();a.modal.show()});a.updateAccountPopup=function(b,r,c,d,e){a.data={};a.fieldName=r;a.data[r]=b[r];q.show({template:'<form> <textarea rows="3"  ng-model="data[fieldName]" class="value-right"></textarea></form>',title:d,subTitle:e,scope:a,buttons:[{text:"\u53d6\u6d88"},{text:"<b>\u786e\u8ba4</b>",type:"button-positive",onTap:function(d){if(a.data[r])if("\u672a\u586b\u5199"==
a.data[r]||""==a.data[r])alert("\u8bf7\u786e\u8ba4"+c+"\u540d\u79f0\u6b63\u786e\u518d\u63d0\u4ea4");else{k.show({template:"<ion-spinner></ion-spinner>",delay:100});var e=b[r];b[r]=a.data[r];g.saveAccount(b,function(a){k.hide()},function(a){b[r]=e;alert("\u4fdd\u5b58"+c+"\u4fe1\u606f\u5931\u8d25"+a.data.error);k.hide()})}else d.preventDefault()}}]})};d.$on("$stateChangeStart",function(a,b,g,c,d){console.log(c.name+" to "+b.name)})}]);angular.module("claim",["ionic","claim.service","wechat"]).controller("ClaimCtrl",["$scope","$stateParams","$state","$ionicLoading","$timeout","ClaimAPI","$ionicHistory","Wechat","$ionicPopup","$rootScope","$ionicPopover",function(a,b,d,f,c,h,k,e,p,n,q){a.navtoroot=function(a,b){k.nextViewOptions({historyRoot:!0});d.go(a,b)};var g=function(b,g){a.transtionId=b;a.claim=void 0;f.show({template:"<ion-spinner></ion-spinner>",delay:100});h.get(b,function(b){a.claim=b;if(null!==a.claim.registerno&&void 0!==
a.claim.registerno&&""!==a.claim.registerno)a.showhistoryrecord=!0,a.navtoroot("^.result",{id:a.claim.transactionId,result:a.claim}),t();else if(a.estimaterangelist=[{id:1,name:"\u5c0f\u4e8e1\u4e07\u5143"},{id:2,name:"\u5927\u4e8e\u7b49\u4e8e1\u4e07\u5143"}],a.damageresonlist=[{id:"0100",name:"\u81ea\u7136\u707e\u5bb3"},{id:"0016",name:"\u610f\u5916\u4e8b\u6545\u81f4\u8f66\u4e0a\u8d27\u7269\u635f\u6bc1"},{id:"0018",name:"\u8f66\u8f7d\u8d27\u7269\u6389\u843d"},{id:"0019",name:"\u8f66\u8f7d\u8d27\u7269\u649e\u51fb"},
{id:"0020",name:"\u8f66\u8f86\u4e0e\u9a7e\u9a76\u5458\u540c\u65f6\u5931\u8e2a"},{id:"0024",name:"\u73bb\u7483\u5355\u72ec\u7834\u788e"},{id:"0007",name:"\u884c\u9a76\u4e2d\u5e73\u884c\u5760\u843d"},{id:"0009",name:"\u5168\u8f66\u88ab\u76d7\u7a83"},{id:"0045",name:"\u8f66\u8f86\u505c\u9a76\u635f\u5931"},{id:"0048",name:"\u8fd0\u8f7d\u8d27\u7269\u81ea\u8eab\u539f\u56e0\u8d77\u706b\u5f15\u8d77\u81ea\u71c3"},{id:"5026",name:"\u7ffb\u8f66"},{id:"1328",name:"\u7b2c\u4e09\u65b9\u539f\u56e0"},{id:"1100",
name:"\u5176\u5b83\u539f\u56e0"}],!0===g){if(void 0===a.claim.id||null===a.claim.id)a.claim.losstype=a.damageresonlist[0],a.claim.estimaterange=a.estimaterangelist[0];else{for(b=0;b<a.damageresonlist.length;b++){console.log(a.damageresonlist[b]);var r=a.damageresonlist[b];if(r.id===a.claim.losstype){a.claim.losstype=r;break}}for(b=0;b<a.estimaterangelist.length;b++)if(console.log(a.estimaterangelist[b]),r=a.estimaterangelist[b],r.id===a.claim.estimaterange){a.claim.estimaterange=r;break}}a.claim.damagedate=
new Date(a.claim.damagedate)}f.hide()},function(a){f.hide()})};a.startClaim=function(){null===a.claim.damageplace||void 0===a.claim.damageplace||""===a.claim.damageplace?alert("\u8bf7\u586b\u5199\u51fa\u9669\u5730\u70b9\u3002"):null===a.claim.damagedate||void 0===a.claim.damagedate||""===a.claim.damagedate?alert("\u8bf7\u586b\u5199\u51fa\u9669\u65f6\u95f4\u3002"):null===a.claim.notifyman||void 0===a.claim.notifyman||""===a.claim.notifyman?alert("\u8bf7\u586b\u5199\u62a5\u6848\u4eba\u59d3\u540d\u3002"):
null===a.claim.mobiletel||void 0===a.claim.mobiletel||""===a.claim.mobiletel?alert("\u8bf7\u586b\u5199\u62a5\u6848\u4eba\u624b\u673a\u53f7\u3002"):!1===/^1[3578]\d{9}$/.test(a.claim.mobiletel)?alert("\u8bf7\u586b\u5199\u6b63\u786e\u7684\u62a5\u6848\u4eba\u624b\u673a\u53f7\u3002"):null===a.claim.linkaddress||void 0===a.claim.linkaddress||""===a.claim.linkaddress?alert("\u8bf7\u586b\u5199\u62a5\u6848\u4eba\u90ae\u7bb1\u3002"):null===a.claim.damageobject||void 0===a.claim.damageobject||""===a.claim.damageobject?
alert("\u8bf7\u586b\u5199\u53d7\u635f\u6807\u7684\u3002"):null===a.claim.losstype||void 0===a.claim.losstype||""===a.claim.losstype?alert("\u8bf7\u586b\u5199\u51fa\u73b0\u539f\u56e0\u3002"):null!==a.claim.estimate&&void 0!==a.claim.estimate&&/^\d+$/.test(a.claim.estimate)?null===a.claim.damagedes||void 0===a.claim.damagedes||""===a.claim.damagedes?alert("\u8bf7\u586b\u5199\u4e8b\u6545\u7ecf\u8fc7\u3002"):(a.claim.estimaterange=1E4>=a.claim.estimate?a.estimaterangelist[0]:a.estimaterangelist[1],a.navtoroot("^.confirm",
{result:a.claim})):alert("\u8bf7\u586b\u5199\u6b63\u786e\u7684\u62a5\u635f\u91d1\u989d\u3002")};a.cancelClaim=function(){a.navtoroot("^.start",{result:a.claim})};a.saveClaim=function(){f.show({template:"<ion-spinner></ion-spinner>",delay:100});a.claim.transactionId=a.transtionId;a.claim.losstype=a.claim.losstype.id;a.claim.estimaterange=a.claim.estimaterange.id;1E4<=a.claim.estimate?h.saveClaim(a.claim,function(b){a.claim=b.data;h.commitClaim(a.claim,function(b){f.hide();a.claim=b.data;a.showhistoryrecord=
!0;a.navtoroot("^.result",{id:a.claim.transactionId,result:a.claim})},function(a){f.hide();alert("\u63d0\u4ea4\u62a5\u6848\u51fa\u73b0\u95ee\u9898\u8bf7\u7a0d\u540e\u518d\u8bd5\u3002")})},function(a){f.hide();alert("\u63d0\u4ea4\u62a5\u6848\u51fa\u73b0\u95ee\u9898\u8bf7\u7a0d\u540e\u518d\u8bd5\u3002")}):h.saveClaim(a.claim,function(b){a.navtoroot("^.upload",{id:a.claim.transactionId,result:a.claim})},function(a){f.hide();alert("\u63d0\u4ea4\u62a5\u6848\u51fa\u73b0\u95ee\u9898\u8bf7\u7a0d\u540e\u518d\u8bd5\u3002")})};
var t=function(){a.popover=q.fromTemplate('<ion-popover-view style="position: fixed;top: 0;left: 0;z-index: 10; width: 100%;height: 100%;"><ion-content scroll="false"><div id="rightDisplay" ng-if="bigImage" class="popover-backdrop" style="position: fixed;top: 0;left: 0;z-index: 10; width: 100%;height: 100%;" ng-click="hideBigImage()"><img class="img-responsive" style="position: absolute;top: 10%;left: 50%;z-index: 10;display: block;margin-top: 18px; margin-left: -165px;height: 420px;width: 330px; box-shadow: 0 1px 3px rgba(0, 0, 0, 0.4);" src="{{Url}}"/></div></ion-content></ion-popover-view>',
{scope:a})};a.openPopover=function(b){a.popover.show(b)};a.closePopover=function(){a.popover.hide()};a.bigImage=!1;a.Url="#";a.hideBigImage=function(){a.bigImage=!1;a.closePopover()};a.showBigImage=function(b,g){a.Url=b;a.bigImage=!0;a.openPopover(g)};n.$on("$stateChangeStart",function(b,c,d,f,v){"app.claim.start"!==c.name&&"app.claim.result"!==c.name||"app.claim.confirm"===f.name||void 0===d.id||""===d.id.id||g(d.id,!0);"app.claim.result"===c.name&&t();"app.claim.result"===f.name&&(a.claim=void 0);
"app.claim.upload"===c.name&&"app.claim.confirm"===f.name&&e.hookShareAll(!0,h.getShareContent(d.result),function(){},function(a){alert(a)})});void 0!==b.id&&""!==b.id&&g(b.id,!0)}]).controller("ClaimUploadCtrl",["$scope","$stateParams","$state","$ionicLoading","$timeout","ClaimAPI","$ionicHistory","Wechat","$ionicPopup","$rootScope",function(a,b,d,f,c,h,k,e,p,n){a.navtoroot=function(a,b){k.nextViewOptions({historyRoot:!0});d.go(a,b)};c(function(){window.loading_screen.finish()},1500);var q=function(b){a.transtionId=
b;a.claim=void 0;f.show({template:"<ion-spinner></ion-spinner>",delay:100});h.get(b,function(b){a.claim=b;f.hide()},function(a){f.hide()})},g=null,t=!1;a.getlocation=function(){t=!1;f.show({template:"<ion-spinner></ion-spinner>",delay:100});var b=c(function(){!1===t&&(f.hide(),alert("\u83b7\u53d6\u5730\u7406\u4f4d\u7f6e\u4fe1\u606f\u5931\u8d25\u8bf7\u7a0d\u540e\u518d\u8bd5"))},6E3);e.getUserLocation(function(d){t=!0;b&&c.cancel(b);JSON.stringify(d);var e=d.latitude;d=d.longitude;var f=new qq.maps.LatLng(e,
d);a.claim.latitude=e;a.claim.longitude=d;g.getAddress(f)},function(a){f.hide();alert(a)})};a.uploadFile=function(b){e.chooseImage(function(g){a.claim.imgList[b]=g.toString();f.show({template:"<ion-spinner></ion-spinner>",delay:100});e.uploadImage(a.claim.imgList[b],function(g){h.downloadFile(a.claim.id,g,b,function(g){f.hide();a.claim.imgList[b]=g.data;a.$apply()},function(a){f.hide()})},function(a){f.hide()})},function(a){alert(a)})};a.commitClaim=function(){if(void 0===a.claim.gpsaddress||""===
a.claim.gpsaddress)alert("\u8bf7\u70b9\u51fb\u2018\u83b7\u53d6\u5730\u7406\u4f4d\u7f6e\u4fe1\u606f\u2019\u6309\u94ae\uff0c\u8bbe\u7f6e\u5f53\u524d\u4f4d\u7f6e\u4fe1\u606f\uff01");else if(void 0===a.claim.imgList)alert("\u8bf7\u4f9d\u6b21\u9009\u62e9\u51719\u5f20\u7167\u7247\u8fdb\u884c\u4e0a\u4f20");else{for(var b=0;b<a.claim.imgList.length;b++)if(void 0===a.claim.imgList[b]){alert("\u8bf7\u4f9d\u6b21\u9009\u62e9\u51719\u5f20\u7167\u7247\u8fdb\u884c\u4e0a\u4f20");return}var b=a.claim.imgList.length,
g=9-b;9!==b?alert("\u8bf7\u4f9d\u6b21\u9009\u62e9\u51719\u5f20\u7167\u7247\u8fdb\u884c\u4e0a\u4f20,\u5df2\u4e0a\u4f20"+b+"\u5f20 \u8fd8\u9700"+g+"\u5f20"):(f.show({template:"<ion-spinner></ion-spinner>",delay:100}),h.commitClaim(a.claim,function(b){f.hide();a.claim=b.data;a.showhistoryrecord=!0;a.navtoroot("^.result",{id:a.claim.transactionId,result:a.claim})},function(a){f.hide();alert("\u63d0\u4ea4\u62a5\u6848\u51fa\u73b0\u95ee\u9898\u8bf7\u7a0d\u540e\u518d\u8bd5\u3002")}))}};n.$on("$stateChangeStart",
function(b,g,c,d,e){"app.claim.upload"===d.name&&(a.claim=void 0,t=!1);"app.claim.upload"===g.name&&(JSON.stringify(c),q(c.id))});void 0!==b.id&&""!==b.id&&q(b.id);(function(){g=new qq.maps.Geocoder({complete:function(b){f.hide();a.claim.gpsaddress=b.detail.addressComponents.province===b.detail.addressComponents.city?b.detail.addressComponents.country+b.detail.addressComponents.province+b.detail.addressComponents.city+b.detail.addressComponents.district+b.detail.addressComponents.street+b.detail.addressComponents.streetNumber:
b.detail.addressComponents.country+b.detail.addressComponents.city+b.detail.addressComponents.district+b.detail.addressComponents.street+b.detail.addressComponents.streetNumber;a.$apply()}})})()}]).controller("ClaimListCtrl",["$scope","$stateParams","$state","$ionicLoading","$timeout","ClaimAPI","$ionicHistory","Wechat","$ionicPopup","$rootScope",function(a,b,d,f,c,h,k,e,p,n){c(function(){window.loading_screen.finish()},1500);n.$on("$stateChangeStart",function(b,c,d,e,f){"app.claim.list"===e.name&&
(a.claims=void 0);"app.claim.list"===c.name&&q()});var q=function(){f.show({template:"<ion-spinner></ion-spinner>",delay:100});h.getAll(function(b){JSON.stringify(b);a.claims=b;f.hide()},function(a){f.hide();alert("\u83b7\u53d6\u7406\u8d54\u4fe1\u606f\u5931\u8d25\u8bf7\u7a0d\u540e\u518d\u8bd5\u3002")})};q()}]).controller("ClaimHistoryListCtrl",["$scope","$stateParams","$state","$ionicLoading","$timeout","ClaimAPI","$ionicHistory","Wechat","$ionicPopup",function(a,b,d,f,c,h,k,e,p){c(function(){window.loading_screen.finish()},
1500);(function(b){a.id=b.id;f.show({template:"<ion-spinner></ion-spinner>",delay:100});h.getRecord(b,function(b){JSON.stringify(b);a.claimrecords=b;f.hide()},function(a){f.hide();alert("\u83b7\u53d6\u7406\u8d54\u8bb0\u5f55\u4fe1\u606f\u5931\u8d25\u8bf7\u7a0d\u540e\u518d\u8bd5\u3002")})})(b.id)}]);
angular.module("claim.service",["ngResource"]).service("ClaimAPI",["$resource","urlConfig","wechatConstants",function(a,b,d){var f=a(b.REST_END_POINT+"/api/claim/:transtionId",{transtionId:"@transtionId"},{query:{method:"GET",isArray:!1,timeout:1E4}},null),c=a(b.REST_END_POINT+"/api/claim/queryrecord/:claimid",{claimid:"@claimid"},{query:{method:"GET",isArray:!1,timeout:1E4}},null),h=a(b.REST_END_POINT+"/api/claim/getAll",null,{query:{method:"GET",isArray:!1,timeout:1E4}},null),k=a(b.REST_END_POINT+
"/api/claim/create",null,{save:{method:"POST",isArray:!1,timeout:1E4}},null),e=a(b.REST_END_POINT+"/api/claim/downloadFile/:Id/:fileId/:fileIndex",{transtionId:"@transtionId",fileId:"@fileId",fileIndex:"@fileIndex"},{query:{method:"GET",isArray:!1,timeout:1E4}},null),p=a(b.REST_END_POINT+"/api/claim/save",null,{save:{method:"POST",isArray:!1,timeout:6E4}},null);return{get:function(a,b,g){f.query({transtionId:a},function(a){b(a.data)},function(a){g(a.error)})},getRecord:function(a,b,g){c.query({claimid:a},
function(a){b(a.data)},function(a){g(a.error)})},getAll:function(a,b){h.query(function(b){a(b.data)},function(a){b(a.error)})},saveClaim:function(a,b,g){k.save(a,function(a){b(a)},function(a){g(a)})},commitClaim:function(a,b,g){p.save(a,function(a){b(a)},function(a){g(a)})},downloadFile:function(a,b,g,c,d){e.query({Id:a,fileId:b,fileIndex:g},function(a){c(a)},function(a){d(a)})},getShareUrl:function(a){return b.APP_ROOT+d.CLAIM_SHARE_ROOT+a},getShareContent:function(a){var b={name:"[\u5927\u5723\u4fdd\u9669]\u7533\u8bf7\u7406\u8d54"};
b.description="\u8bf7\u4e0a\u4f20\u4fdd\u5355[\u4fdd\u5355\u53f7:"+a.policyno+"]\u7406\u8d54\u6240\u9700\u6750\u6599";b.url=this.getShareUrl(a.id);return b}}}]);angular.module("emessage","ionic ngCookies angular.filter monospaced.qrcode app account agreement coupon proposal transaction redirect promotion invoice invHistory claim wechat regression portal templates".split(" ")).constant("urlConfig",{REST_END_POINT:"http://m.baoxian72.com/API",APP_ROOT:"http://m.baoxian72.com"}).constant("accountConstants",{ACCOUNT_TYPE_NORMAL:0,ACCOUNT_TYPE_AGREEMENT:1}).constant("agreementConstants",{AGREEMENT_ID_AUTO_PAYGO:"AUTO_PAYGO",AGREEMENT_ID_PAYGO_LOCAL_ZH:"PAYGO_LOCAL_ZH",
AGREEMENT_ID_PAYGO_JB:"PAYGO_JB",AGREEMENT_ID_PAYGO_ZR:"PAYGO_ZR",AGREEMENT_ID_PAYGO_JB_LITE:"PAYGO_JB_LITE",AGREEMENT_ID_PAYGO_LOCAL_JB_LITE:"PAYGO_LOCAL_JB_LITE",AGREEMENT_ID_SIGNUP_COUPON:"SIGNUP_COUPON",AGREEMENT_ID_COUPON_TRANSACTION_25:"COUPON_TRANSACTION_25",AGREEMENT_ID_SIMULATE:"SIMULATE",AGREEMENT_TYPE_USER:"USER",AGREEMENT_ROUTE_PRESET_BOTH:"BOTH",AGREEMENT_ROUTE_PRESET_NONE:"NONE",AGREEMENT_ROUTE_PRESET_EQUAL:"EQUAL",AGREEMENT_ROUTE_PRESET_DISTANCE:"DISTANCE",PUBLIC_AGREEMENT_MATRIX:{AUTO_PAYGO:{region:"\u5168\u56fd\u8303\u56f4\uff08\u6e2f\u6fb3\u53f0\u5730\u533a\u9664\u5916\uff09",
mainItem:"\u7efc\u5408\u9669",description:"\u4fdd\u969c\u5168\u9762\uff0c\u5bf9\u4e8e\u8d27\u503c\u76f8\u5bf9\u8f83\u9ad8\u7684\u8d27\u7269\u3002\u5982\u5e38\u89c1\u4ea7\u6210\u54c1\uff0c\u670d\u88c5\u3001\u7535\u5b50\u8bbe\u5907\u3001\u673a\u68b0\u8bbe\u5907\u7b49\u7269\u54c1\u6700\u4e3a\u9002\u7528\u3002\u5c24\u5176\u662f\u5bf9\u4e8e100\u4e07\u4ee5\u4e0a\u8d27\u503c\u7684\u9ad8\u4ef7\u503c\u8d27\u54c1\uff0c\u6b64\u4ea7\u54c1\u53ef\u4e0a\u8c03\u989d\u5ea6\u6700\u9ad8\u8fbe500\u4e07\u5143\uff0c\u66f4\u4e3a\u9002\u7528\u3002"},
PAYGO_JB:{region:"\u5168\u56fd\u8303\u56f4\uff08\u6e2f\u6fb3\u53f0\u5730\u533a\u9664\u5916\uff09",mainItem:"\u57fa\u672c\u9669",description:"\u4fdd\u8d39\u66f4\u4f18\u60e0\uff0c\u9002\u5408\u4e8e\u8de8\u7701\u4e1a\u52a1\u3002\u5bf9\u4e8e\u8d27\u503c\u4f4e\uff0c\u5bf9\u4fdd\u9669\u4fdd\u969c\u8303\u56f4\u8981\u6c42\u4e0d\u9ad8\u7684\u8d27\u7269\uff0c\u5982\u539f\u6750\u6599\uff0c\u5927\u5b97\u6563\u8d27\u7b49\u7269\u54c1\u66f4\u9002\u7528\u3002"},PAYGO_LOCAL_ZH:{region:"\u8fd0\u8f93\u7ebf\u8def\u540c\u7701\u8303\u56f4\u5185\uff08\u6e2f\u6fb3\u53f0\u5730\u533a\u9664\u5916\uff09",
mainItem:"\u7efc\u5408\u9669",description:"\u9002\u5408\u4e8e\u7701\u540c\u7701\u8303\u56f4\u5185\uff08\u7701\u7ea7\u533a\u57df\uff09\u7684\u914d\u9001\u4e1a\u52a1\u3002\u5bf9\u4e8e\u56de\u7a0b\u8d27\u6216\u5c3e\u8d27\u5206\u6d3e\u73af\u8282\u66f4\u52a0\u9002\u7528\u3002\u540c\u65f6\u7531\u4e8e\u4fdd\u969c\u9650\u989d\u4e3a20-100\u4e07\u5185\u76845\u6863\uff0c\u5206\u7c7b\u66f4\u7ec6\u81f4\uff0c\u9009\u62e9\u66f4\u7075\u6d3b\u3002"},PAYGO_JB_LITE:{region:"\u5168\u56fd\u8303\u56f4\uff08\u6e2f\u6fb3\u53f0\u5730\u533a\u9664\u5916\uff09",
mainItem:"\u57fa\u672c\u9669",description:"\u4fdd\u8d39\u66f4\u4f18\u60e0\uff0c\u9002\u5408\u4e8e\u8de8\u7701\u4e1a\u52a1\u3002\u5bf9\u4e8e\u8d27\u503c\u4f4e\uff0c\u5bf9\u4fdd\u9669\u4fdd\u969c\u8303\u56f4\u8981\u6c42\u4e0d\u9ad8\u7684\u8d27\u7269\uff0c\u5982\u539f\u6750\u6599\uff0c\u5927\u5b97\u6563\u8d27\u7b49\u7269\u54c1\u66f4\u9002\u7528\u3002\u4ec5\u627f\u4fdd\u7531\u4e8e\u706b\u707e\u3001\u7206\u70b8\u3001\u4ea4\u901a\u5de5\u5177\u610f\u5916\u4e8b\u6545\u5f15\u8d77\u7684\u8d27\u7269\u635f\u5931\u3002\u6bcf\u6b21\u4e8b\u6545\u7edd\u5bf9\u514d\u8d54\uffe525000\u5143\u6216\u8005\u635f\u5931\u91d1\u989d\u768410%\uff0c\u4ee5\u9ad8\u8005\u4e3a\u51c6\u3002"},
PAYGO_LOCAL_JB_LITE:{region:"\u5168\u56fd\u8303\u56f4\uff08\u6e2f\u6fb3\u53f0\u5730\u533a\u9664\u5916\uff09",mainItem:"\u57fa\u672c\u9669",description:"\u9002\u5408\u4e8e\u7701\u540c\u7701\u8303\u56f4\u5185\uff08\u7701\u7ea7\u533a\u57df\uff09\u7684\u914d\u9001\u4e1a\u52a1\u3002\u5bf9\u4e8e\u56de\u7a0b\u8d27\u6216\u5c3e\u8d27\u5206\u6d3e\u73af\u8282\u66f4\u52a0\u9002\u7528\u3002\u4ec5\u627f\u4fdd\u7531\u4e8e\u706b\u707e\u3001\u7206\u70b8\u3001\u4ea4\u901a\u5de5\u5177\u610f\u5916\u4e8b\u6545\u5f15\u8d77\u7684\u8d27\u7269\u635f\u5931\u3002\u6bcf\u6b21\u4e8b\u6545\u7edd\u5bf9\u514d\u8d54\uffe525000\u5143\u6216\u8005\u635f\u5931\u91d1\u989d\u768410%\uff0c\u4ee5\u9ad8\u8005\u4e3a\u51c6\u3002"},
PAYGO_ZR:{region:"\u5168\u56fd\u8303\u56f4\uff08\u6e2f\u6fb3\u53f0\u5730\u533a\u9664\u5916\uff09",mainItem:"\u8d23\u4efb\u9669",description:"\u4fdd\u969c\u5168\u9762\uff0c\u5bf9\u4e8e\u8d27\u503c\u76f8\u5bf9\u8f83\u9ad8\u7684\u8d27\u7269\u3002\u5982\u5e38\u89c1\u4ea7\u6210\u54c1\uff0c\u670d\u88c5\u3001\u7535\u5b50\u8bbe\u5907\u3001\u673a\u68b0\u8bbe\u5907\u7b49\u7269\u54c1\u6700\u4e3a\u9002\u7528\u3002\u5c24\u5176\u662f\u5bf9\u4e8e100\u4e07\u4ee5\u4e0a\u8d27\u503c\u7684\u9ad8\u4ef7\u503c\u8d27\u54c1\uff0c\u6b64\u4ea7\u54c1\u53ef\u4e0a\u8c03\u989d\u5ea6\u6700\u9ad8\u8fbe500\u4e07\u5143\uff0c\u66f4\u4e3a\u9002\u7528\u3002"}},
BACKGROUND_ROOT:"/img/agreement-public/",PAY_METHOD_CREDIT:"credit",PAY_METHOD_H5:"h5",PAY_METHOD_COUPON:"coupon",PAY_METHOD_SIMULATE:"simulate",PAY_PROVIDER_WX:"wxmppay",PAY_PROVIDER_ALI:"alipay",PAY_PROVIDER_CREDIT:"credit",PAY_PROVIDER_COUPON:"coupon",PAY_PROVIDER_SIMULATE:"simulate",PRODUCT_NAME_SIMULATE:"\u6a21\u62df\u7efc\u5408\u9669",INVOICE_TYPES:{NORMAL:"\u666e\u901a\u53d1\u7968",VALUE_ADDED_SPECIAL:"\u589e\u503c\u7a0e\u4e13\u7528\u53d1\u7968"},INVOICE_TYPE_NORMAL:"NORMAL"}).constant("promotionConstants",
{ENTRY_POINT_PAY_SUCCESS:"PAY_SUCCESS",BATCH_SOURCE_TYPE_TRANSACTION:"TRANSACTION",PIC_URL_DEFAULT:"defaultpic",PIC_ROOT:"img/promotion/"}).constant("publicPromotionConstants",{ACTION_COLLECT:"COLLECT",PIC_ROOT:"img/promotion/"}).constant("promotionBackgroundColors",{"16036acd775e970991e0677af90449f4":"#FFF",a3fb6acd775e77af90449f4970991e06:"#FFF",a3fb6acd775e970991e0677af90449f4:"#FFF","16046acd775e970991e0677af90449f4":"#FFF",a3fb6acd775e77af90449f4970991e56:"#FFF"}).constant("couponConstants",
{COUPON_TYPE_TRANS:"TRANSACTION",COUPON_TYPE_PRODUCT_VOUCHER:"PRODUCT_VOUCHER",COUPON_TYPE_DISCOUNT_VOUCHER:"DISCOUNT_VOUCHER",COUPON_STATUS_NOT_USED:0,COUPON_SCOPE_USER:"USER",COUPON_SCOPE_PAYGO:"PAYGO",COUPON_SCOPE_USER_PAYGO:"USER_PAYGO"}).constant("invoiceConstants",{HISTORY_STATUS_PROCESSING:1,HISTORY_STATUS_MAILED:7,ITEM_TYPE_TRANSACTION:"TRANSACTION",ITEM_TYPE_CHARGE_RECORD:"CHARGE_RECORD",TYPES:{NORMAL:"\u666e\u901a\u53d1\u7968",VALUE_ADDED_SPECIAL:"\u589e\u503c\u7a0e\u4e13\u7528\u53d1\u7968"},
TYPE_NORMAL:"NORMAL"}).constant("eventNames",{PROPOSAL_SUCCESS:"proposal-suc",INVOICE_APPLY_SUCCESS:"invoice-apply-suc",AGREEMENT_CHARGE_SUCCESS:"agreement-charge-suc",CREDIT_EXCHANGE_SUCCESS:"credit-exchange-suc"}).run(["$ionicPlatform",function(a){a.ready(function(){window.cordova&&window.cordova.plugins.Keyboard&&(cordova.plugins.Keyboard.hideKeyboardAccessoryBar(!0),cordova.plugins.Keyboard.disableScroll(!0));window.StatusBar&&StatusBar.styleDefault()})}]).config(["$stateProvider","$urlRouterProvider",
"$ionicConfigProvider",function(a,b,d){a.state("redirect",{url:"/redirect?providerUserId&mobile&xAuthToken&state&detail",templateUrl:"",controller:"redirectCtrl"}).state("promotion",{url:"/promotion/:id",template:"",controller:"PublicPromotionCtrl"}).state("survey",{url:"/survey/:id",template:"",controller:"PublicSurveyCtrl"}).state("app",{url:"/app",templateUrl:"templates/app/menu.html",controller:"AppCtrl"}).state("app.proposal",{url:"/proposal?agreementId",views:{menuContent:{template:'<ion-nav-view name="proposalContent" class="proposal"></ion-nav-view>',
controller:"ProposalCtrl"}}}).state("app.proposal.start",{url:"/start?payCouponId",views:{proposalContent:{templateUrl:"templates/app/proposal.start.html"}}}).state("app.proposal.pay",{url:"/pay",views:{proposalContent:{templateUrl:"templates/app/proposal.pay.html"}}}).state("app.proposal.result",{url:"/result",views:{proposalContent:{templateUrl:"templates/app/proposal.result.html"}}}).state("app.transaction",{url:"/transaction",views:{menuContent:{template:'<ion-nav-view name="transactionContent" class="transaction"></ion-nav-view>',
controller:"TransactionCtrl"}}}).state("app.transaction.list",{url:"/",views:{transactionContent:{templateUrl:"templates/app/transaction.list.html",controller:"TransactionListCtrl"}}}).state("app.transaction.listQQx5",{url:"/qqx5",views:{transactionContent:{templateUrl:"templates/app/transaction.list.qqx5.html",controller:"TransactionListQQx5Ctrl"}}}).state("app.transaction.detail",{url:"/:id",views:{transactionContent:{templateUrl:"templates/app/transaction.detail.html",controller:"TransactionDetailCtrl"}}}).state("app.portal",
{url:"/portal",views:{menuContent:{template:'<ion-nav-view name="portalContent" class="portal"></ion-nav-view>',controller:"PortalCtrl"}}}).state("app.portal.category",{url:"/:id",views:{portalContent:{templateUrl:"templates/app/portal.html",controller:"PortalCategoryCtrl"}}}).state("app.agreement",{url:"/agreement",views:{menuContent:{template:'<ion-nav-view name="agreementContent" class="agreement"></ion-nav-view>',controller:"AgreementCtrl"}}}).state("app.agreement.list",{url:"/?toPropose&paygo&user",
views:{agreementContent:{templateUrl:"templates/app/agreement.list.html"}}}).state("app.agreement.publicDetail",{url:"/public/:id",views:{agreementContent:{templateUrl:"templates/app/agreement.public.detail.html",controller:"AgreementPublicDetailCtrl"}}}).state("app.agreement.detail",{url:"/:id",views:{agreementContent:{templateUrl:"templates/app/agreement.detail.html",controller:"AgreementDetailCtrl"}}}).state("app.agreement.charge",{url:"/charge/:id",views:{agreementContent:{templateUrl:"templates/app/agreement.charge.html",
controller:"AgreementChargeCtrl"}}}).state("app.claim",{url:"/claim/:id",views:{menuContent:{template:'<ion-nav-view name="claimContent" class="claim"></ion-nav-view>',controller:"ClaimCtrl"}}}).state("app.claim.start",{url:"/start/:id",views:{claimContent:{templateUrl:"templates/app/claim.start.html"}}}).state("app.claim.confirm",{url:"/confirm",views:{claimContent:{templateUrl:"templates/app/claim.confirm.html"}}}).state("app.claim.upload",{url:"/:id",views:{claimContent:{templateUrl:"templates/app/claim.upload.html",
controller:"ClaimUploadCtrl"}},params:{id:null,result:null}}).state("app.claim.historylist",{url:"/historylist/:id",views:{claimContent:{templateUrl:"templates/app/claim.detail.list.html",controller:"ClaimHistoryListCtrl"}}}).state("app.claim.list",{url:"/:id",views:{claimContent:{templateUrl:"templates/app/claim.list.html",controller:"ClaimListCtrl"}}}).state("app.claim.result",{url:"/result/:id",views:{claimContent:{templateUrl:"templates/app/claim.result.html"}},params:{id:null,result:null}}).state("app.claimIntro",
{url:"/claimIntro",views:{menuContent:{templateUrl:"templates/app/public.claimIntro.html"}}}).state("app.account",{url:"/account",views:{menuContent:{template:'<ion-nav-view name="accountContent" class="account"></ion-nav-view>',controller:"AccountCtrl"}}}).state("app.account.show",{url:"/",views:{accountContent:{templateUrl:"templates/app/account.html"}}}).state("app.account.salesOrComm",{url:"/salesOrComm",views:{accountContent:{controller:"SalesOrCommCtrl"}}}).state("app.account.community",{url:"/community",
views:{accountContent:{template:'<ion-nav-view name="communityContent" class="community"></ion-nav-view>'}}}).state("app.account.community.invite",{url:"/invite",views:{communityContent:{templateUrl:"templates/app/account.community.invite.html",controller:"CommInviteCtrl"}}}).state("app.account.community.credit",{url:"/credit",views:{communityContent:{templateUrl:"templates/app/account.community.credit.html",controller:"CommCreditCtrl"}}}).state("app.account.community.exchange",{url:"/exchange",views:{communityContent:{templateUrl:"templates/app/account.community.exchange.html",
controller:"CommExchangeCtrl"}}}).state("app.account.sales",{url:"/sales",views:{accountContent:{template:'<ion-nav-view name="salesContent" class="sales"></ion-nav-view>'}}}).state("app.account.sales.credit",{url:"/credit",views:{salesContent:{templateUrl:"templates/app/account.sales.credit.html",controller:"CommCreditCtrl"}}}).state("app.account.sales.invite",{url:"/invite",views:{salesContent:{templateUrl:"templates/app/account.sales.invite.html",controller:"CommInviteCtrl"}}}).state("app.promotion",
{url:"/promotion/:id?sourceType&sourceDetail",views:{menuContent:{templateUrl:"templates/app/promotion.html",controller:"PromotionCtrl"}}}).state("app.coupon",{url:"/coupon",views:{menuContent:{template:'<ion-nav-view name="couponContent" class="coupon"></ion-nav-view>',controller:"CouponCtrl"}}}).state("app.coupon.list",{url:"/",views:{couponContent:{templateUrl:"templates/app/coupon.list.html",controller:"CouponListCtrl"}}}).state("app.coupon.listQQx5",{url:"/qqx5",views:{couponContent:{templateUrl:"templates/app/coupon.list.qqx5.html",
controller:"CouponListQQx5Ctrl"}}}).state("app.invoice",{url:"/invoice",views:{menuContent:{template:'<ion-nav-view name="invoiceContent" class="invoice"></ion-nav-view>',controller:"InvoiceListCtrl"}}}).state("app.invoice.list",{url:"/",views:{invoiceContent:{templateUrl:"templates/app/invoice.list.html"}}}).state("app.invoice.apply",{url:"/apply",views:{invoiceContent:{templateUrl:"templates/app/invoice.apply.html",controller:"InvoiceApplyCtrl"}}}).state("app.invHistory",{url:"/invHistory",views:{menuContent:{template:'<ion-nav-view name="invHistoryContent" class="invHistory"></ion-nav-view>',
controller:"InvHistoryListCtrl"}}}).state("app.invHistory.list",{url:"/",views:{invHistoryContent:{templateUrl:"templates/app/invHistory.list.html"}}}).state("app.invHistory.detail",{url:"/:id",views:{invHistoryContent:{templateUrl:"templates/app/invHistory.detail.html",controller:"InvHistoryDetailCtrl"}}});b.otherwise("/app/portal/");d.views.transition("none");d.backButton.text("\u8fd4\u56de")}]);angular.module("coupon",["coupon.service","wechat","ng-iscroll"]).controller("CouponCtrl",["$scope","$state","$ionicHistory","CouponAPI","$rootScope","$ionicLoading","eventNames","couponConstants","agreementConstants",function(a,b,d,f,c,h,k,e,p){var n=function(){a.coupons=[];a.refresh(function(){h.show({template:"<ion-spinner></ion-spinner>",delay:100})},function(){h.hide()},function(){c.navToIndex()})},q=function(){a.coupons=void 0;a.pageNumber=void 0;a.hasCoupon=void 0;a.initFinish=void 0};a.refresh=
function(b,c,d){b();f.refresh(function(b){a.coupons=b;a.pageNumber=0;a.hasCoupon=!(void 0===a.coupons||0===a.coupons.length);a.initFinish=!0;c()},function(b){a.initFinish=!0;console.log(b);alert("\u5237\u65b0\u5931\u8d25\uff0c\u8bf7\u7a0d\u540e\u518d\u8bd5");c();d()})};a.isTransType=function(a){return a.fullfillType===e.COUPON_TYPE_TRANS};a.isVoucherType=function(a){return a.fullfillType===e.COUPON_TYPE_PRODUCT_VOUCHER};a.isDiscountType=function(a){return a.fullfillType===e.COUPON_TYPE_DISCOUNT_VOUCHER};
a.isNotUsed=function(a){return a.status===e.COUPON_STATUS_NOT_USED};a.navToProposal=function(a){a.fullfillType===e.COUPON_TYPE_TRANS?b.go("app.proposal.start",{agreementId:a.fullfillConfig,payCouponId:a.id}):a.scope===e.COUPON_SCOPE_USER?b.go("app.agreement.list",{toPropose:"1",paygo:"0",user:"1"}):a.scope===e.COUPON_SCOPE_PAYGO?b.go("app.agreement.list",{toPropose:"1",paygo:"1",user:"0"}):a.scope===e.COUPON_SCOPE_USER_PAYGO?b.go("app.agreement.list",{toPropose:"1",paygo:"1",user:"1"}):alert("\u6b64\u4f18\u60e0\u5238\u5c1a\u4e0d\u80fd\u6295\u4fdd\uff0c\u8bf7\u8054\u7cfb\u7ba1\u7406\u5458\u6216\u7a0d\u540e\u518d\u8bd5")};
a.loadNext=function(b){a.canLoadNext()&&f.getPage(a.pageNumber+1,function(c){if(void 0!==c&&0!==c.length){for(var d=0;d<c.length;d++)a.coupons.push(c[d]);a.pageNumber++}b()},function(a){alert(a);b()})};a.canLoadNext=function(){return f.hasMoreToLoad()};n();c.$on("$stateChangeStart",function(a,b,c,d,e){"app.coupon"!==b.name&&"app.coupon.list"!==b.name&&"app.coupon.detail"!==b.name&&"app.coupon.listQQx5"!==b.name||"app.coupon.detail"===d.name||"app.coupon.list"===d.name||"app.coupon.listQQx5"===d.name||
n()});c.$on("event:auth-loginCancelled",function(){q()});c.$on("event:auth-logout-complete",function(){q()});c.$on(k.PROPOSAL_SUCCESS,function(a,b){f.clean()});c.$on(k.CREDIT_EXCHANGE_SUCCESS,function(a,b){f.clean()})}]).controller("CouponListCtrl",["$scope","$timeout",function(a,b){a.loadMore=function(){console.log("load more");a.$parent.loadNext(function(){a.$broadcast("scroll.infiniteScrollComplete")})};a.refresh=function(){a.$parent.refresh(function(){},function(){b(function(){a.$broadcast("scroll.refreshComplete")},
500)},function(){})};a.canLoadMore=function(){return a.$parent.canLoadNext()}}]).controller("CouponListQQx5Ctrl",["$scope","$rootScope",function(a,b){a.hasNext=function(){return!!(a.$parent.pageNumber>a.page||a.$parent.canLoadNext())};a.hasPrev=function(){return 0<a.page};a.nextPage=function(){a.$parent.pageNumber>a.page?a.page++:a.$parent.canLoadNext()?a.$parent.loadNext(function(){a.$parent.pageNumber>a.page&&a.page++}):alert("\u5df2\u7ecf\u662f\u6700\u540e\u4e00\u9875")};a.preOrRefreshPage=function(){1<
a.page?a.page--:1!==a.page&&0!==a.page||a.refresh()};a.refresh=function(){a.$parent.refresh(function(){},function(){a.page=0},function(){})};a.page=0;b.$on("$stateChangeStart",function(b,f,c,h,k){"app.coupon"!==f.name&&"app.coupon.list"!==f.name&&"app.coupon.detail"!==f.name&&"app.coupon.listQQx5"!==f.name||"app.coupon.detail"===h.name||"app.coupon.list"===h.name||"app.coupon.listQQx5"===h.name||(a.page=0)})}]);
angular.module("coupon.service",["ngResource"]).service("CouponAPI",["$resource","urlConfig",function(a,b){var d=a(b.REST_END_POINT+"/api/marketing/coupon",{page:"@page",productId:"@productId",status:"@status"},{query:{method:"GET",isArray:!1,timeout:1E4}},null),f=function(a,b,c,f,g,t){d.query({page:a,productId:b,status:c,forSelecting:f},function(a){for(var b=[],c=0;c<a.list.length;c++)h[a.list[c].id]=a.list[c],b.push(a.list[c]);console.log("coupon page data init success");g(b)},function(a){t(a.data.error)})},
c=function(a,b){h={};k=0;d.query({page:0},function(b){k=b.metaData.total;for(var c=[],g=0;g<b.list.length;g++)h[b.list[g].id]=b.list[g],c.push(b.list[g]);console.log("coupon metaData init success");a(c)},function(a){b(a.data.error)})},h={},k=0;return{getPage:function(a,b,c){f(a,void 0,void 0,!1,b,c)},refresh:function(a,b){c(a,b)},get:function(a){return h[a]},findAllByProductId:function(a,b,c){f(void 0,a,0,!0,b,c)},hasMoreToLoad:function(){return!!(void 0!==h&&0!==Object.keys(h).length&&Object.keys(h).length<
k)},clean:function(){h=void 0;k=0}}}]);/*
 HTTP Auth Interceptor Module for AngularJS
 (c) 2012 Witold Szczerba
 License: MIT
*/
(function(){angular.module("http-auth-interceptor",["http-auth-interceptor-buffer"]).factory("authService",["$rootScope","httpBuffer",function(a,b){return{loginConfirmed:function(d,f){var c=f||function(a){return a};a.$broadcast("event:auth-loginConfirmed",d);b.retryAll(c)},loginCancelled:function(d,f){b.rejectAll(f);a.$broadcast("event:auth-loginCancelled",d)}}}]).config(["$httpProvider",function(a){a.interceptors.push(["$rootScope","$q","httpBuffer",function(a,d,f){return{responseError:function(c){if(!c.config.ignoreAuthModule)switch(c.status){case 401:var h=
d.defer();f.append(c.config,h);a.$broadcast("event:auth-loginRequired",c);return h.promise;case 403:return h=d.defer(),f.append(c.config,h),a.$broadcast("event:auth-forbidden",c),h.promise}return d.reject(c)}}}])}]);angular.module("http-auth-interceptor-buffer",[]).factory("httpBuffer",["$injector",function(a){function b(b,d){f=f||a.get("$http");f(b).then(function(a){d.resolve(a)},function(a){d.reject(a)})}var d=[],f;return{append:function(a,b){d.push({config:a,deferred:b})},rejectAll:function(a){if(a)for(var b=
0;b<d.length;++b)d[b].deferred.reject(a);d=[]},retryAll:function(a){for(var f=0;f<d.length;++f)b(a(d[f].config),d[f].deferred);d=[]}}}])})();angular.module("invHistory",["invHistory.service"]).controller("InvHistoryListCtrl",["$scope","$state","$ionicHistory","InvHistoryAPI","$rootScope","$ionicLoading","$timeout","invoiceConstants","eventNames",function(a,b,d,f,c,h,k,e,p){var n=function(){a.invHistories=[];g(function(){h.show({template:"<ion-spinner></ion-spinner>",delay:100})},function(){h.hide()},function(){c.navToIndex()})},q=function(){a.invHistories=void 0;a.hasInvHistory=void 0;a.initFinish=void 0},g=function(b,g,c){b();f.refresh(function(b){a.invHistories=
b;a.hasInvHistory=!(void 0===a.invHistories||0===a.invHistories.length);if(a.hasInvHistory)for(var c in a.invHistories)a.invHistories[c].typeAlias=e.TYPES[a.invHistories[c].type],a.invHistories[c].isValueAdded=a.invHistories[c].type!==e.TYPE_NORMAL;a.initFinish=!0;g()},function(b){a.initFinish=!0;console.log(b);alert("\u5237\u65b0\u5931\u8d25\uff0c\u8bf7\u7a0d\u540e\u518d\u8bd5");g();c()})};a.refresh=function(){g(function(){},function(){k(function(){a.$broadcast("scroll.refreshComplete")},500)},function(){})};
a.isProcessing=function(a){return a.status===e.HISTORY_STATUS_PROCESSING};a.isMailed=function(a){return a.status===e.HISTORY_STATUS_MAILED};n();c.$on("$stateChangeStart",function(a,b,g,c,d){"app.invHistory"!==b.name&&"app.invHistory.list"!==b.name&&"app.invHistory.detail"!==b.name||"app.invHistory.detail"===c.name||"app.invHistory.list"===c.name||n()});c.$on("event:auth-loginCancelled",function(){q()});c.$on("event:auth-logout-complete",function(){q()})}]).controller("InvHistoryDetailCtrl",["$scope",
"$rootScope","$stateParams","InvHistoryAPI",function(a,b,d,f){a.invHistory=f.get(d.id);b.$on("$stateChangeStart",function(b,h,k,e,p){"app.invHistory.detail"===h.name&&(a.invHistory=f.get(d.id))})}]);
angular.module("invHistory.service",["ngResource"]).service("InvHistoryAPI",["$resource","urlConfig",function(a,b){var d=a(b.REST_END_POINT+"/api/invoice/",{},{query:{method:"GET",isArray:!0,timeout:1E4}},null),f=function(a,b){c={};d.query({},function(b){for(var d=[],f=0;f<b.length;f++)c[b[f].id]=b[f],d.push(b[f]);console.log("invoice histories init success");a(d)},function(a){b(a.data.error)})},c={};return{refresh:function(a,b){f(a,b)},get:function(a){return c[a]},clean:function(){c=void 0}}}]);angular.module("invoice",["invoice.service"]).controller("InvoiceListCtrl",["$scope","$state","$ionicHistory","InvoiceAPI","$rootScope","$ionicLoading","eventNames","invoiceConstants",function(a,b,d,f,c,h,k,e){var p=function(){a.invoices=[];a.applyInvoices=[];a.refresh(function(){h.show({template:"<ion-spinner></ion-spinner>",delay:100})},function(){h.hide()},function(){c.navToIndex()})},n=function(){a.invoices=void 0;a.applyInvoices=void 0;a.hasInvoice=void 0;a.initFinish=void 0};a.isChargeRecordType=
function(a){return a.type===e.ITEM_TYPE_CHARGE_RECORD};a.isTransactionType=function(a){return a.type===e.ITEM_TYPE_TRANSACTION};a.refresh=function(b,g,c){b();f.refresh(function(b){a.invoices=b;a.hasInvoice=!(void 0===a.invoices||0===a.invoices.length);if(a.hasInvoice)for(b=0;b<a.invoices.length;b++)a.invoices[b].invoiceTypeAlias=e.TYPES[a.invoices[b].invoiceType];a.initFinish=!0;g()},function(b){a.initFinish=!0;console.log(b);alert("\u5237\u65b0\u5931\u8d25\uff0c\u8bf7\u7a0d\u540e\u518d\u8bd5");g();
c()})};a.calcFee=function(a){var b=0,c;for(c in a)!0===a[c].add&&(b+=a[c].amount);return b};a.calcApplyFee=function(){return a.calcFee(a.invoices)};a.calcApplyNo=function(){var b=0,g;for(g in a.invoices)a.invoices.hasOwnProperty(g)&&!0===a.invoices[g].add&&(b+=1);return b};a.validateInvoices=function(b){var g=b.invoiceType,c=b.title,d=b.companyTaxId,f;for(f in a.invoices)if(a.invoices.hasOwnProperty(f)&&!0===a.invoices[f].add&&(g!==a.invoices[f].invoiceType||c!==a.invoices[f].title||d!==a.invoices[f].companyTaxId)){alert("\u65b0\u6dfb\u52a0\u7684\u5f00\u7968\u9879\u4e0e\u5df2\u9009\u4e2d\u7684\u5f00\u7968\u9879\u4fe1\u606f\u4e0d\u4e00\u81f4\uff0c\u8bf7\u5206\u4e24\u6b21\u5f00\u5177\u3002");
b.add=!1;break}};a.apply=function(){a.applyInvoices=[];for(var c in a.invoices)a.invoices.hasOwnProperty(c)&&!0===a.invoices[c].add&&a.applyInvoices.push(a.invoices[c]);void 0!==a.applyInvoices.length&&0!==a.applyInvoices.length?b.go("^.apply"):alert("\u8bf7\u9009\u62e9\u9700\u8981\u5f00\u5177\u7684\u53d1\u7968")};p();c.$on("$stateChangeStart",function(a,b,c,d,f){"app.invoice"!==b.name&&"app.invoice.list"!==b.name&&"app.invoice.apply"!==b.name||"app.invoice.list"===d.name||"app.invoice.apply"===d.name||
p()});c.$on("event:auth-loginCancelled",function(){n()});c.$on("event:auth-logout-complete",function(){n()});c.$on(k.INVOICE_APPLY_SUCCESS,function(a,b){f.clean();n();p()})}]).controller("InvoiceApplyCtrl",["$scope","InvoiceAPI","$rootScope","$state","$ionicLoading","$ionicHistory","invoiceConstants","eventNames",function(a,b,d,f,c,h,k,e){var p=function(){a.invoice={invoiceType:a.$parent.applyInvoices[0].invoiceType,invoiceTypeAlias:k.TYPES[a.$parent.applyInvoices[0].invoiceType],isValueAdded:a.$parent.applyInvoices[0].invoiceType!==
k.TYPE_NORMAL,title:a.$parent.applyInvoices[0].title,companyTaxId:a.$parent.applyInvoices[0].companyTaxId}};a.calcApplyFee=function(){return a.$parent.calcFee(a.invoices)};a.confirm=function(){if(a.invoice.isValueAdded){if(void 0===a.invoice.companyTaxId||""===a.invoice.companyTaxId){alert("\u8bf7\u8f93\u5165\u7eb3\u7a0e\u4eba\u8bc6\u522b\u53f7");return}if(void 0===a.invoice.companyRegisterAddress||""===a.invoice.companyRegisterAddress){alert("\u8bf7\u8f93\u5165\u4f01\u4e1a\u6ce8\u518c\u5730\u5740");
return}if(void 0===a.invoice.companyRegisterPhone||""===a.invoice.companyRegisterPhone){alert("\u8bf7\u8f93\u5165\u4f01\u4e1a\u6ce8\u518c\u7535\u8bdd");return}if(void 0===a.invoice.companyBankName||""===a.invoice.companyBankName){alert("\u8bf7\u8f93\u5165\u4f01\u4e1a\u5f00\u6237\u94f6\u884c");return}if(void 0===a.invoice.companyBankAccountId||""===a.invoice.companyBankAccountId){alert("\u8bf7\u8f93\u5165\u4f01\u4e1a\u94f6\u884c\u8d26\u53f7");return}}if(void 0===a.invoice.title||""===a.invoice.title)alert("\u8bf7\u8f93\u5165\u53d1\u7968\u62ac\u5934");
else if(void 0===a.invoice.name||""===a.invoice.name)alert("\u8bf7\u8f93\u5165\u6536\u4ef6\u4eba\u59d3\u540d");else if(void 0===a.invoice.phone||""===a.invoice.phone)alert("\u8bf7\u8f93\u5165\u6536\u4ef6\u7535\u8bdd");else if(void 0===a.invoice.address||""===a.invoice.address)alert("\u8bf7\u8f93\u5165\u6536\u4ef6\u5730\u5740");else{var f=[],h;for(h in a.$parent.applyInvoices)f.push(a.$parent.applyInvoices[h].id);a.invoice.items=f;c.show({template:"<ion-spinner></ion-spinner>",delay:100});b.apply(a.invoice,
function(){c.hide();alert("\u53d1\u7968\u5c06\u57287\u4e2a\u5de5\u4f5c\u65e5\u5185\u5bc4\u51fa\uff0c\u8bf7\u8010\u5fc3\u7b49\u5019");d.navToRoot("app.invHistory.list");d.$broadcast(e.INVOICE_APPLY_SUCCESS)},function(a){c.hide();alert(a)})}};p();d.$on("$stateChangeStart",function(a,b,g,c,d){"app.invoice.apply"===b.name&&"app.invoice.apply"!==c.name&&p()});d.$on(e.INVOICE_APPLY_SUCCESS,function(){a.invoice=void 0});d.$on("event:auth-loginCancelled",function(){a.invoice=void 0});d.$on("event:auth-logout-complete",
function(){a.invoice=void 0})}]);
angular.module("invoice.service",[]).service("InvoiceAPI",["$resource","urlConfig",function(a,b){var d=a(b.REST_END_POINT+"/api/invoice/item",{},{query:{method:"GET",isArray:!0,timeout:1E4}},null),f=a(b.REST_END_POINT+"/api/invoice/"),c=function(a,b){d.query({},function(b){for(var c=[],d=0;d<b.length;d++)c.push(b[d]);console.log("invoice init success");a(c)},function(a){b(a.data.error)})},h=function(a,b,c){(new f(a)).$save({},function(a){console.log("apply successful");b(a)},function(a){c(a.data.error)})};
return{apply:function(a,b,c){h(a,b,c)},refresh:function(a,b){c(a,b)},clean:function(){invoices=void 0}}}]);angular.module("portal",["category.service","agreement"]).controller("PortalCtrl",["$scope","$state","$rootScope","$ionicLoading","CategoryAPI","accountConstants","eventNames","AgreementAPI","agreementConstants","categoryConstants",function(a,b,d,f,c,h,k,e,p,n){var q=[p.AGREEMENT_ID_PAYGO_LOCAL_JB_LITE,p.AGREEMENT_ID_PAYGO_LOCAL_ZH,p.AGREEMENT_ID_PAYGO_JB_LITE,p.AGREEMENT_ID_PAYGO_JB,p.AGREEMENT_ID_AUTO_PAYGO,p.AGREEMENT_ID_PAYGO_ZR];(function(){f.show({template:"<ion-spinner></ion-spinner>",delay:100});
e.findPublicByIdIn(q,function(b){a.publicAgreements=b;c.findAll(function(b){a.categories=b.category;for(var g in a.categories)b=a.categories[g],a.categories[g].icon=void 0!==n.icon[b.id]?n.icon[b.id]:n.icon[0];f.hide()},function(a){alert("\u670d\u52a1\u5668\u672a\u54cd\u5e94\uff0c\u83b7\u53d6\u54c1\u7c7b\u4fe1\u606f\u5931\u8d25\uff0c\u8bf7\u8054\u7cfb\u7ba1\u7406\u5458\u8bf4\u7a0d\u540e\u518d\u8bd5")})},function(a){f.hide();alert("\u670d\u52a1\u5668\u672a\u54cd\u5e94\uff0c\u83b7\u53d6\u4ea7\u54c1\u4fe1\u606f\u5931\u8d25\uff0c\u8bf7\u8054\u7cfb\u7ba1\u7406\u5458\u8bf4\u7a0d\u540e\u518d\u8bd5")})})()}]).controller("PortalCategoryCtrl",
["$scope","$stateParams",function(a,b){""===b.id?(a.showCategory=!0,a.showQuickIcons=!0,a.rootCategory=!0):(console.log(b.id+" category"),a.categoryId=b.id)}]);
angular.module("category.service",["ngResource"]).constant("categoryConstants",{icon:{0:"ion-ios-list",1:"ion-ios-list",2:"ion-ios-paper",3:"ion-ios-speedometer"}}).service("CategoryAPI",["$resource","urlConfig",function(a,b){var d,f=a(b.REST_END_POINT+"/api/public/category",null,{query:{method:"GET",isArray:!1,timeout:1E4}},null);return{findAll:function(a,b){void 0===d?f.query({},function(b){d=b;a(d)},b):a(d)}}}]);angular.module("promotion",["account.service","agreement.service","promotion.service","wechat.service"]).controller("PromotionCtrl",["$scope","$rootScope","PromotionAPI","promotionConstants","promotionBackgroundColors","$ionicLoading","$ionicHistory","$state","Wechat",function(a,b,d,f,c,h,k,e,p){var n=function(g,e,m){h.show({template:"<ion-spinner></ion-spinner>",delay:100});d.get(g,function(b){a.promotion=b;a.backStyle=void 0!==c[a.promotion.fromPicId]?{"background-color":c[a.promotion.fromPicId]}:
{"background-color":"#FFF"};a.promotion.fromPicUrl=f.PIC_ROOT+a.promotion.fromPicId+"_from.jpg";q(a.promotion.id,e,m)},function(a){h.hide();alert("\u672a\u627e\u5230\u4f18\u60e0\u6d3b\u52a8");b.navToIndex()})},q=function(c,f,e){d.newBatch(c,f,e,function(b){h.hide();a.batch=b.batch;a.gifts=b.gifts;void 0!==a.gifts&&void 0!==a.gifts[0]&&alert("\u611f\u8c22\u53c2\u4e0e\u6d3b\u52a8\uff0c\u5956\u52b1\u5df2\u653e\u5165\u8d26\u6237");p.hookShareTimelineOnly(!0,d.convertBatchToContent(a.batch),function(){g(a.promotion.id,
a.batch.id)},function(a){alert(a)})},function(a){h.hide();alert(a);b.navToIndex()})},g=function(g,c){h.show({template:"<ion-spinner></ion-spinner>",delay:100});d.shareAction(g,c,function(g){h.hide();a.gifts=g.gifts;void 0===a.gifts||void 0===a.gifts[0]?alert("\u6210\u529f\u5206\u4eab"):alert("\u6210\u529f\u5206\u4eab\uff0c\u5956\u52b1\u5df2\u653e\u5165\u8d26\u6237");b.navToIndex()},function(a){h.hide();alert(a);b.navToIndex()})};n(e.params.id,e.params.sourceType,e.params.sourceDetail);a.shareSuccess=
function(){g(a.promotion.id,a.batch.id)};b.$on("$stateChangeStart",function(a,b,g,c,d){"app.promotion"===b.name&&n(g.id,g.sourceType,g.sourceDetail)});b.$on("event:auth-loginCancelled",function(){a.promotion=void 0});b.$on("event:auth-logout-complete",function(){a.promotion=void 0})}]);
angular.module("promotion.service",["ngResource","wechat"]).service("PromotionAPI",["$resource","urlConfig","promotionConstants","wechatConstants",function(a,b,d,f){var c=a(b.REST_END_POINT+"/api/marketing/promotion/:id",{id:"@id",entryPoint:"@entryPoint"},{getPaySuc:{method:"GET",isArray:!0,params:{entryPoint:d.ENTRY_POINT_PAY_SUCCESS}},get:{method:"GET",isArray:!1},action:{method:"POST",isArray:!1}},null),h=a(b.REST_END_POINT+"/api/marketing/promotion/:id/batch/:batchId",{id:"@id",batchId:"@batchId",
sourceType:"@sourceType",sourceDetail:"@sourceDetail",action:"@action"},{"new":{method:"POST",isArray:!1},action:{method:"POST",isArray:!1}}),k=a(b.REST_END_POINT+"/api/public/marketing/promotion/:batchId/",{batchId:"@batchId"}),e,p={};return{getPaySucPromotion:function(a,b){void 0===e?c.getPaySuc({},function(b){e=b[0];a(e)},function(a){b(a)}):a(e)},getPublicBatch:function(a,b,g){k.get({batchId:a},function(a){b(a)},function(a){g(a)})},get:function(a,b,g){void 0===p[a]?c.get({id:a},function(g){p[a]=
g;b(p[a])},function(a){g(a)}):b(p[a])},newBatch:function(a,b,g,c,d){h["new"]({id:a,sourceType:b,sourceDetail:g},function(a){console.log("batch created received");c(a)},function(a){console.log("failed because: "+a.data.error);d(a.data.error)})},shareAction:function(a,b,g,c){h.action({id:a,batchId:b,action:"FROM_SHARE"},function(a){console.log("share success");g(a)},function(a){console.log("failed because: "+a.data.error);c(a.data.error)})},getShareUrl:function(a){return b.REST_END_POINT+f.PROMOTION_SHARE_ROOT+
a},convertBatchToContent:function(a){var b={};b.name=a.toTitle;b.description=a.toDescription;b.url=this.getShareUrl(a.id);return b}}}]);angular.module("proposal",["proposal.service","account.service","promotion.service","coupon.service","wechat"]).controller("ProposalCtrl",["$rootScope","$scope","AgreementAPI","AccountAPI","CouponAPI","Proposal","PromotionAPI","$state","$stateParams","$ionicHistory","$ionicLoading","agreementConstants","promotionConstants","eventNames","Wechat","$ionicActionSheet","$ionicModal",function(a,b,d,f,c,h,k,e,p,n,q,g,t,r,m,A,y){var v={name:"\u4e0d\u4f7f\u7528"},z=function(){q.show({template:"<ion-spinner></ion-spinner>",
delay:100});f.getAccount(function(a){b.account=a;b.canPayCredit=-1<b.agreement.payMethods.indexOf(g.PAY_METHOD_CREDIT);b.canPayAlipay=!1;b.canPayWxpay=-1<b.agreement.payMethods.indexOf(g.PAY_METHOD_H5);b.canPayCoupon=-1<b.agreement.payMethods.indexOf(g.PAY_METHOD_COUPON);b.canPaySimulate=-1<b.agreement.payMethods.indexOf(g.PAY_METHOD_SIMULATE);b.canShowInvoice=b.canPayWxpay;b.account.invoiceSetting&&(b.proposal.companyTaxId=b.account.invoiceSetting.companyTaxId);c.findAllByProductId(b.agreement.productId,
function(a){b.optionalCoupons=a;b.optionalCoupons.unshift(v);b.proposal.optionalCoupon=1!==b.optionalCoupons.length?b.optionalCoupons[1]:b.optionalCoupons[0];b.calcfee(b.proposal);q.hide();e.go("^.pay")},function(a){q.hide();alert("\u670d\u52a1\u5668\u672a\u54cd\u5e94\uff0c\u83b7\u53d6\u652f\u4ed8\u4fe1\u606f\u5931\u8d25\uff0c\u8bf7\u7a0d\u540e\u518d\u8bd5")})},function(a){console.log("error getting account, by: "+a);q.hide();alert("\u670d\u52a1\u5668\u672a\u54cd\u5e94\uff0c\u83b7\u53d6\u652f\u4ed8\u4fe1\u606f\u5931\u8d25\uff0c\u8bf7\u7a0d\u540e\u518d\u8bd5")})},
C=function(c){b.success=c.success;b.orderId=c.orderId;b.proposalNo=c.proposalNo;e.params.agreementId!==g.AGREEMENT_ID_SIMULATE?k.getPaySucPromotion(function(g){q.hide();b.promotion=g;a.navToRoot("^.result")},function(b){console.log("No Pay Success Promotion found");q.hide();a.navToRoot("^.result")}):(console.log("No showing pay Success Promotion"),q.hide(),a.navToRoot("^.result"))},l=function(){q.show({template:"<ion-spinner></ion-spinner>",delay:100});h.preOrder(b.proposal,function(a){console.log("pre order succeed");
x(a)},function(a){q.hide();console.log("pre order error, by: ",a.data.error);alert(a.data.error)})},x=function(a){b.proposal.orderId=a.orderId;a.payProvider===g.PAY_PROVIDER_WX&&a.paymentResponse?m.doWxPay(a.paymentResponse,function(){F()},function(){q.hide();alert("\u652f\u4ed8\u5931\u8d25")}):F()},F=function(){h.finishOrder(b.proposal.orderId,function(g){b.error=void 0;console.log("save transaction successfull");a.$broadcast(r.PROPOSAL_SUCCESS,g);C(g)},function(g){q.hide();console.log("save transaction failed, error:"+
g.data.error);b.error=g.data.error;a.navToRoot("^.result")})};console.log("reloading");(function(c,f){q.show({template:"<ion-spinner></ion-spinner>",delay:100});console.log("Initializing proposal");d.getProposal(c,function(a){b.agreement=a;b.canSetRoutePreset=b.agreement.routePreset===g.AGREEMENT_ROUTE_PRESET_BOTH;b.canSetRouteNoPreset=b.agreement.routePreset===g.AGREEMENT_ROUTE_PRESET_NONE;b.canSetRouteStartEndEqual=b.agreement.routePreset===g.AGREEMENT_ROUTE_PRESET_EQUAL;b.canSetPublicRouteStartEndDetail=
b.agreement.routePreset===g.AGREEMENT_ROUTE_PRESET_DISTANCE&&b.agreement.type!==g.AGREEMENT_TYPE_USER;b.canSetPrivateRouteStartEndDetail=b.agreement.routePreset===g.AGREEMENT_ROUTE_PRESET_DISTANCE&&b.agreement.type===g.AGREEMENT_TYPE_USER;b.proposal=h.init(b.agreement);void 0!==f&&(b.proposal.payCouponId=f);q.hide()},function(b){console.log("error intializing proposal, by: "+b);q.hide();alert("\u670d\u52a1\u5668\u672a\u54cd\u5e94\uff0c\u83b7\u53d6\u534f\u8bae\u5931\u8d25\uff0c\u8bf7\u7a0d\u540e\u518d\u8bd5");
a.navToIndex()})})(e.params.agreementId,e.params.payCouponId);b.calcfee=function(a){h.calcfee(a)};b.calcDistance=function(a){a=h.calcDistance(a,function(a){success(a)},function(a){alert("\u83b7\u53d6\u91cc\u7a0b\u6570\u636e\u5931\u8d25\u8bf7\u7a0d\u540e\u518d\u8bd5\u3002")})};b.showGoods=function(){for(var a=[],g=0;g<b.agreement.goods.length;g++)a[g]={text:"<div>"+b.agreement.goods[g].name+"  \u52a0\u8d39\u7387:"+b.agreement.goods[g].baseFee+"%</div><p>"+b.agreement.goods[g].remark+"</p>"};A.show({buttons:a,
buttonClicked:function(a){b.proposal.goods=b.agreement.goods[a];b.calcfee(b.proposal);return!0}})};b.canShowCurFee=function(){return e.params.agreementId!==g.AGREEMENT_ID_SIGNUP_COUPON&&e.params.agreementId!==g.AGREEMENT_ID_COUPON_TRANSACTION_25&&e.params.agreementId!==g.AGREEMENT_ID_AUTO_PAYGO&&e.params.agreementId!==g.AGREEMENT_ID_PAYGO_LOCAL_ZH&&e.params.agreementId!==g.AGREEMENT_ID_PAYGO_JB&&e.params.agreementId!==g.AGREEMENT_ID_PAYGO_LOCAL_JB_LITE&&e.params.agreementId!==g.AGREEMENT_ID_PAYGO_JB_LITE&&
e.params.agreementId!==g.AGREEMENT_ID_PAYGO_ZR};b.canShowSubTotal=function(){return e.params.agreementId!==g.AGREEMENT_ID_SIGNUP_COUPON&&e.params.agreementId!==g.AGREEMENT_ID_COUPON_TRANSACTION_25};b.canShowCoupon=function(){return e.params.agreementId!==g.AGREEMENT_ID_SIGNUP_COUPON&&e.params.agreementId!==g.AGREEMENT_ID_COUPON_TRANSACTION_25};b.couponDesc=function(a){return void 0!==a.expireAt?a.name+" "+a.expireAt+"\u5230\u671f":a.name};b.canShowTaxId=function(){return b.proposal.invoiceType!==
g.INVOICE_TYPE_NORMAL};b.confirm=function(){b.agreement.type!==g.AGREEMENT_TYPE_USER?(console.log("checking dxt public agreement"),y.fromTemplateUrl("templates/app/public.doc.proposal.html",{scope:b}).then(function(b){a.docProposalModal=b;a.docProposalModal.show();a.docProposalIscroll=new IScroll("#proposal-doc .i-scroll .wrapper",{})})):(console.log("confirmed, going to pay"),z())};b.acceptDoc=function(){a.docProposalModal.hide();a.docProposalIscroll.destroy();a.docProposalModal.remove();console.log("confirmed, going to pay");
z()};b.rejectDoc=function(){a.docProposalModal.hide();a.docProposalIscroll.destroy();a.docProposalModal.remove()};b.creditPay=function(){b.proposal.payProvider=g.PAY_PROVIDER_CREDIT;l()};b.aliPay=function(){b.proposal.payProvider=g.PAY_PROVIDER_ALI;alert("\u7531\u4e8e\u5fae\u4fe1\u5e73\u53f0\u5c4f\u853d\u652f\u4ed8\u5b9d\uff0c\u6682\u4e0d\u652f\u6301\u652f\u4ed8\u5b9d\u4ed8\u6b3e")};b.wxPay=function(){void 0===m.getOpenId()?alert("\u672a\u68c0\u6d4b\u5230\u5fae\u4fe1\u652f\u4ed8\u73af\u5883\uff0c\u8bf7\u5728\u5fae\u4fe1\u516c\u4f17\u53f7\u4e2d\u64cd\u4f5c"):
(b.proposal.buyerId=m.getOpenId(),b.proposal.payProvider=g.PAY_PROVIDER_WX,l())};b.couponPay=function(){b.proposal.payProvider=g.PAY_PROVIDER_COUPON;l()};b.simulatePay=function(){b.proposal.payProvider=g.PAY_PROVIDER_SIMULATE;l()};b.navToPromotion=function(){n.nextViewOptions({historyRoot:!0});e.go("app.promotion",{id:b.promotion.id,sourceType:t.BATCH_SOURCE_TYPE_TRANSACTION,sourceDetail:b.proposal.orderId})};b.changeStartProvince=function(a){a.routeStart=a.routeStartProvince.politicalCitys[0];this.calcDistance(a)};
b.changeEndProvince=function(a){a.routeEnd=a.routeEndProvince.politicalCitys[0];this.calcDistance(a)};b.changeStartCity=function(a){this.calcDistance(a)};b.changeEndCity=function(a){this.calcDistance(a)};a.$on("event:auth-logout-complete",function(){b.agreement=void 0;b.proposal=void 0;b.optionalCoupons=void 0;b.error=void 0})}]);
angular.module("proposal.service",["ngResource"]).service("Proposal",["$resource","urlConfig","agreementConstants","couponConstants",function(a,b,d,f){var c=a(b.REST_END_POINT+"/api/order/transaction"),h=a(b.REST_END_POINT+"/api/order/:id/finish",{id:"@id"},{finish:{method:"POST",isArray:!1,timeout:6E4}}),k=a(b.REST_END_POINT+"/api/public/distance/:agreementid/:routeStart/:routeEnd"),e=a(b.REST_END_POINT+"/api/public/distanceFee",null,{query:{method:"GET",isArray:!1,timeout:1E4}},null),p=function(a){var b=
a.agreement.routeAdjust,c=1;a.agreement.canChooseTheft&&a.theftInsure&&(c=a.agreement.productDqRate);var d=a.agreement.discountRate/100;a.listPrice=Math.round(a.route.baseRate/100*(a.goods.baseFee/100+1)*a.coverage.basefee*b*c);a.feeNoCoupon=Math.round(a.listPrice*d);void 0!==a.optionalCoupon&&void 0!==a.optionalCoupon.fullfillType?a.optionalCoupon.fullfillType===f.COUPON_TYPE_PRODUCT_VOUCHER?(a.fee=a.feeNoCoupon-a.optionalCoupon.fullfillConfig,a.optionalCouponId=a.optionalCoupon.id):a.optionalCoupon.fullfillType===
f.COUPON_TYPE_DISCOUNT_VOUCHER&&(a.fee=Math.round(a.optionalCoupon.fullfillConfig/100*a.feeNoCoupon),a.optionalCouponId=a.optionalCoupon.id):(a.fee=a.feeNoCoupon,a.optionalCouponId=void 0)},n=function(a){for(var b=[],c=0,d=0;d<a.agreement.coverages.length;d++)for(var f=a.agreement.coverages[d],e=f.value,v=0;v<a.routeDistanceFees.length;v++){var z=a.routeDistanceFees[v];console.log("routeDistanceFees.distanceStart="+z.distanceStart);console.log("routeDistanceFees.distanceEnd="+z.distanceEnd);console.log("proposal.routeDistance="+
a.routeDistance);e==z.value&&a.routeDistance>z.distanceStart&&a.routeDistance<=z.distanceEnd&&(f.basefee=z.fee,b[c++]=f)}a.distanceCoverages=b;a.coverage=b[0]},q=function(a){a.agreement.routePreset===d.AGREEMENT_ROUTE_PRESET_EQUAL&&(a.routeEnd=a.routeStart);if(a.agreement.routePreset===d.AGREEMENT_ROUTE_PRESET_EQUAL||a.agreement.routePreset===d.AGREEMENT_ROUTE_PRESET_NONE)a.route.name=a.routeStart.name+"\u2014"+a.routeEnd.name,a.route.baseRate=a.routeStart.defaultRouteFeeRate>a.routeEnd.defaultRouteFeeRate?
a.routeStart.defaultRouteFeeRate:a.routeEnd.defaultRouteFeeRate;a.agreement.routePreset===d.AGREEMENT_ROUTE_PRESET_DISTANCE&&a.agreement.type!==d.AGREEMENT_TYPE_USER&&(a.route.name=a.routeStart.name+"\u2014"+a.routeEnd.name,a.route.baseRate=100)};return{init:function(a){var b={};b.agreement=a;b.isZh=a.type===d.AGREEMENT_ID_SIGNUP_COUPON||a.type===d.AGREEMENT_ID_SIMULATE||a.type===d.AGREEMENT_ID_AUTO_PAYGO||a.type===d.AGREEMENT_ID_PAYGO_LOCAL_ZH;b.isZR=a.type===d.AGREEMENT_ID_PAYGO_ZR;b.goods=a.goods[0];
a.routePreset===d.AGREEMENT_ROUTE_PRESET_BOTH?b.route=a.routes[0]:a.routePreset===d.AGREEMENT_ROUTE_PRESET_DISTANCE?(a.type===d.AGREEMENT_ID_PAYGO_ZR&&(b.routeStartProvince=a.divisions[0],b.routeEndProvince=a.divisions[0],b.routeStartCity=b.routeStartProvince.politicalCitys[0],b.routeEndCity=b.routeEndProvince.politicalCitys[0],b.routeStart=b.routeStartProvince.politicalCitys[0],b.routeEnd=b.routeEndProvince.politicalCitys[0],b.route={}),a.type===d.AGREEMENT_TYPE_USER&&(b.route=a.routes[0],b.routeDistance=
a.routes[0].distance)):(b.routeStart=a.divisions[0],b.routeEnd=a.divisions[0],b.route={});b.coverage=a.coverages[0];a.canChooseTheft&&(b.theftInsure=!1);b.invoiceType=d.INVOICE_TYPE_NORMAL;a.type!==d.AGREEMENT_TYPE_USER&&this.getDistanceFee(b,function(a){b.routeDistanceFees=a.distanceFees;(new k).$save({agreementid:b.agreement.id,routeStart:b.routeStart.name,routeEnd:b.routeEnd.name},function(a){b.routeDistance=a.distance;n(b)},function(a){error(a)})},function(a){alert("\u83b7\u53d6\u7ebf\u8def\u4ef7\u683c\u8868\u5931\u8d25")});
this.calcfee(b);return b},calcfee:function(a){q(a);p(a)},save:function(a,b,d){a=new c(a);a.$save({},b,d);return a},preOrder:function(a,b,d){(new c(a)).$save({},function(a){b(a)},function(a){d(a)})},finishOrder:function(a,b,c){h.finish({id:a},function(a){b(a)},function(a){c(a)})},getDistanceFee:function(a,b,c){a.agreement.routePreset===d.AGREEMENT_ROUTE_PRESET_DISTANCE&&e.query({},function(a){b(a)},function(a){c(a)})},calcDistance:function(a,b,c){a.agreement.routePreset===d.AGREEMENT_ROUTE_PRESET_DISTANCE&&
(a.agreement.type!==d.AGREEMENT_TYPE_USER?(new k).$save({agreementid:a.agreement.id,routeStart:a.routeStart.name,routeEnd:a.routeEnd.name},function(b){a.routeDistance=b.distance;n(a);q(a);p(a)},function(a){c(a)}):(n(a),q(a),p(a)))},doWxPay:function(a,b,c){function d(){WeixinJSBridge.invoke("getBrandWCPayRequest",{appId:a.appId,timeStamp:a.timeStamp,nonceStr:a.nonceStr,"package":a.packagePrepayId,signType:a.signType,paySign:a.paySign},function(a){"get_brand_wcpay_request:ok"==a.err_msg?b():(alert(a.err_msg),
c())})}"undefined"==typeof WeixinJSBridge?document.addEventListener?document.addEventListener("WeixinJSBridgeReady",d,!1):document.attachEvent&&(document.attachEvent("WeixinJSBridgeReady",d),document.attachEvent("onWeixinJSBridgeReady",d)):d()}}}]);angular.module("redirect",["account.service","wechat"]).controller("redirectCtrl",["$stateParams","$state","$ionicHistory","agreementConstants","CommonAuthenticationService","Wechat",function(a,b,d,f,c,h){var k=!!h.isQQBrowser();void 0!==a.providerUserId&&"null"!==a.providerUserId&&h.setOpenId(a.providerUserId);void 0!=a.xAuthToken&&(c.setXAuthToken(a.xAuthToken),c.setMobile(a.mobile));d.nextViewOptions({historyRoot:!0});"agreements"===a.state?b.go("app.agreement.list",{toPropose:"0",paygo:"0",user:"1"}):
"agreementsToPropose"===a.state?b.go("app.agreement.list",{toPropose:"1",paygo:"0",user:"1"}):"coupons"===a.state?!0===k?b.go("app.coupon.listQQx5"):b.go("app.coupon.list"):"account"===a.state?b.go("app.account.show"):"transactions"===a.state?!0===k?b.go("app.transaction.listQQx5"):b.go("app.transaction.list"):"simulate"===a.state?b.go("app.proposal.start",{agreementId:f.AGREEMENT_ID_SIMULATE}):"dxk"===a.state?b.go("app.account.salesOrComm"):b.go("app.portal.category")}]);angular.module("regression",["wechat"]).controller("PublicPromotionCtrl",["$stateParams","$state","urlConfig","wechatConstants",function(a,b,d,f){window.location.replace(d.REST_END_POINT+f.PROMOTION_SHARE_ROOT+a.id)}]).controller("PublicSurveyCtrl",["$stateParams","$state","urlConfig","wechatConstants",function(a,b,d,f){window.location.replace(d.REST_END_POINT+f.SURVEY_SHARE_ROOT+a.id)}]);angular.module("transaction",["transaction.service","wechat","ng-iscroll","account.service"]).controller("TransactionCtrl",["$scope","$state","$ionicHistory","TransAPI","$rootScope","$ionicLoading","eventNames","agreementConstants",function(a,b,d,f,c,h,k,e){var p=function(){a.transactions=[];a.refresh(function(){h.show({template:"<ion-spinner></ion-spinner>",delay:100})},function(){h.hide()},function(){c.navToIndex()})},n=function(){a.transactions=void 0;a.pageNumber=void 0;a.hasTransaction=void 0;
a.initFinish=void 0};a.refresh=function(b,c,d){b();f.refresh(function(b){a.transactions=b;a.pageNumber=0;a.hasTransaction=!(void 0===a.transactions||0===a.transactions.length);a.initFinish=!0;c()},function(b){a.initFinish=!0;console.log(b);alert("\u5237\u65b0\u5931\u8d25\uff0c\u8bf7\u7a0d\u540e\u518d\u8bd5");c();d()})};a.loadNext=function(b){a.canLoadNext()&&f.getPage(a.pageNumber+1,function(c){if(void 0!==c&&0!==c.length){for(var d=0;d<c.length;d++)a.transactions.push(c[d]);a.pageNumber++}b()},function(a){alert(a);
b()})};a.canLoadNext=function(){return f.hasMoreToLoad()};a.isSimulate=function(a){return a.productName===e.PRODUCT_NAME_SIMULATE};p();c.$on("$stateChangeStart",function(a,b,c,d,f){"app.transaction"!==b.name&&"app.transaction.list"!==b.name&&"app.transaction.detail"!==b.name&&"app.transaction.listQQx5"!==b.name||"app.transaction.detail"===d.name||"app.transaction.list"===d.name||"app.transaction.listQQx5"===d.name||p()});c.$on("event:auth-loginCancelled",function(){n()});c.$on("event:auth-logout-complete",
function(){n()});c.$on(k.PROPOSAL_SUCCESS,function(a,b){f.clean()})}]).controller("TransactionListCtrl",["$scope","$timeout",function(a,b){a.loadMore=function(){console.log("load more");a.$parent.loadNext(function(){a.$broadcast("scroll.infiniteScrollComplete")})};a.refresh=function(){a.$parent.refresh(function(){},function(){b(function(){a.$broadcast("scroll.refreshComplete")},500)},function(){})};a.canLoadMore=function(){return a.$parent.canLoadNext()}}]).controller("TransactionListQQx5Ctrl",["$scope",
"$rootScope",function(a,b){a.hasNext=function(){return!!(a.$parent.pageNumber>a.page||a.$parent.canLoadNext())};a.hasPrev=function(){return 0<a.page};a.nextPage=function(){a.$parent.pageNumber>a.page?a.page++:a.$parent.canLoadNext()?a.$parent.loadNext(function(){a.$parent.pageNumber>a.page&&a.page++}):alert("\u5df2\u7ecf\u662f\u6700\u540e\u4e00\u9875")};a.preOrRefreshPage=function(){1<a.page?a.page--:1!==a.page&&0!==a.page||a.refresh()};a.refresh=function(){a.$parent.refresh(function(){},function(){a.page=
0},function(){})};a.page=0;b.$on("$stateChangeStart",function(b,f,c,h,k){"app.transaction"!==f.name&&"app.transaction.list"!==f.name&&"app.transaction.detail"!==f.name&&"app.transaction.listQQx5"!==f.name||"app.transaction.detail"===h.name||"app.transaction.list"===h.name||"app.transaction.listQQx5"===h.name||(a.page=0)})}]).controller("TransactionDetailCtrl",["$scope","$stateParams","TransAPI","AccountAPI","$ionicPopup","$ionicLoading",function(a,b,d,f,c,h){a.transaction=d.get(b.id);(function(){f.getAccount(function(b){a.account=
b},function(a){console.log(a)})})();var k=function(a,b,d){c.alert({title:a,template:b,okText:d})};a.NoEPolicy=function(a){k("\u4ea4\u6613\u672a\u5b8c\u6210","<p>\u5f53\u524d\u4ea4\u6613\u672a\u5b8c\u6210\uff0c\u65e0\u6cd5\u83b7\u53d6\u7535\u5b50\u4fdd\u5355</p>","\u786e\u8ba4")};a.SendEPolicy=function(b){a.data={};a.data.email=a.account.email;c.show({template:'<form name="ePolicyForm" ><input name="email" type="email" ng-model="data.email" required/> <p class="assertive" ng-show="ePolicyForm.email.$invalid">\u90ae\u7bb1\u5730\u5740\u683c\u5f0f\u9519\u8bef</p>  </form>',
title:"\u53d1\u9001\u7535\u5b50\u4fdd\u5355",subTitle:"\u7535\u5b50\u4fdd\u5355\u5c06\u53d1\u9001\u5230\u4e0b\u65b9\u7535\u5b50\u90ae\u7bb1\u4e2d",scope:a,buttons:[{text:"\u53d6\u6d88"},{text:"<b>\u53d1\u9001</b>",type:"button-positive",onTap:function(c){a.data.email?(h.show({template:"<ion-spinner></ion-spinner>",delay:100}),a.account.email=a.data.email,f.saveAccount(a.account,function(a){},function(a){k("\u4fe1\u606f\u63d0\u793a","<p>\u4fdd\u5b58\u90ae\u7bb1\u4fe1\u606f\u5931\u8d25\u8bf7\u68c0\u67e5\u7535\u5b50\u90ae\u4ef6\u5730\u5740\u683c\u5f0f</p>",
"\u786e\u8ba4");after()}),d.sendEPolicy(b,a.data.email,function(a){h.hide();k("\u7535\u5b50\u4fdd\u5355\u53d1\u9001\u6210\u529f","<p>\u7535\u5b50\u4fdd\u5355\u5df2\u7ecf\u6210\u529f\u53d1\u9001\u5230\u60a8\u7684\u7535\u5b50\u90ae\u7bb1\uff01</p>","\u786e\u8ba4")},function(b){h.hide();a.initFinish=!0;console.log(b);k("\u7535\u5b50\u4fdd\u5355\u53d1\u9001\u5931\u8d25","<p>"+b+"</p>","\u786e\u8ba4");after();failOver()})):c.preventDefault()}}]})}}]);
angular.module("transaction.service",["ngResource"]).service("TransAPI",["$resource","urlConfig",function(a,b){var d=a(b.REST_END_POINT+"/api/transaction",{page:"@page"},{query:{method:"GET",isArray:!1,timeout:1E4}},null),f=a(b.REST_END_POINT+"/api/transaction/getEPolicy",null,{query:{method:"POST",isArray:!1,timeout:1E4}},null),c=function(a,b,c){d.query({page:a},function(a){for(var c=[],d=0;d<a.list.length;d++)e[a.list[d].id]=a.list[d],c.push(a.list[d]);console.log("transaction page init success");
b(c)},function(a){c(a.data.error)})},h=function(a,b,c,d){f.query({id:a,email:b},function(a){console.log("transaction page init success");c(a)},function(a){d(a.data.error)})},k=function(a,b){e={};p=0;d.query({page:0},function(b){p=b.metaData.total;for(var c=[],d=0;d<b.list.length;d++)e[b.list[d].id]=b.list[d],c.push(b.list[d]);console.log("transaction metaData init success");a(c)},function(a){b(a.data.error)})},e={},p=0;return{getPage:function(a,b,d){c(a,b,d)},refresh:function(a,b){k(a,b)},get:function(a){return e[a]},
sendEPolicy:function(a,b,c,d){return h(a,b,c,d)},hasMoreToLoad:function(){return!!(void 0!==e&&0!==Object.keys(e).length&&Object.keys(e).length<p)},clean:function(){e=void 0;p=0}}}]);angular.module("common-authentication",["wechat"]).service("CommonAuthenticationService",["$resource","$rootScope","$http","urlConfig","Wechat",function(a,b,d,f,c){var h=a(f.REST_END_POINT+"/sso/userCanRegister/:id",{id:"@id"},{check:{method:"GET",isArray:!1}},null),k=function(a){d.defaults.headers.common["x-auth-token"]=a},e=function(a,b,g,e,h){var m=c.getOpenId();void 0===m&&(m="");void 0==g&&(g="");d.post(f.REST_END_POINT+"/auth","mobile="+a+"&validationCode="+b+"&invitationCode="+g+"&providerUserId="+
m,{ignoreAuthModule:!0,headers:{"Content-Type":"application/x-www-form-urlencoded"}}).success(function(a,b,c,d){k(a.xAuthToken);p=a.mobile;e(a)}).error(function(a,b,c,d){h(a.error)})},p;return{isLoggedIn:function(){return void 0!==d.defaults.headers.common["x-auth-token"]},exist:function(a,b,c){h.check({id:a},b,c)},auth:function(a,b,c,d,f){e(a,b,c,d,f)},quit:function(a){d.post(f.REST_END_POINT+"/sso/quit",{},{ignoreAuthModule:!0})["finally"](function(){delete d.defaults.headers.common["x-auth-token"];
delete p;a()})},setXAuthToken:function(a){k(a)},getXAuthToken:function(){return d.defaults.headers.common["x-auth-token"]},setMobile:function(a){p=a},getMobile:function(){return p},clean:function(){p=d.defaults.headers.common["x-auth-token"]=void 0}}}]);angular.module("ng-iscroll",[]).service("iScrollAccessor",function(){var a;return{set:function(b){a=b},get:function(){return a}}}).directive("iScroll",["iScrollAccessor",function(a){return{restrict:"A",link:function(b,d){var f=new IScroll(d[0],{click:!0,bounce:!0,preventDefaultException:{tagName:/^(INPUT|TEXTAREA|BUTTON|SELECT)$/,isContentEditable:/^true$/}});a.set(f);d.on("$destroy",function(){f.destroy();f=null})}}}]).directive("iScrollRefresh",["iScrollAccessor","$timeout",function(a,b){return{restrict:"A",
link:function(d){d.$last&&b(function(){a.get().refresh()})}}}]);var qrcode=function(){function a(b,d){if("undefined"==typeof b.length)throw Error(b.length+"/"+d);var f=function(){for(var a=0;a<b.length&&0==b[a];)a+=1;for(var c=Array(b.length-a+d),f=0;f<b.length-a;f+=1)c[f]=b[f+a];return c}(),g={getAt:function(a){return f[a]},getLength:function(){return f.length},multiply:function(b){for(var d=Array(g.getLength()+b.getLength()-1),f=0;f<g.getLength();f+=1)for(var e=0;e<b.getLength();e+=1)d[f+e]^=c.gexp(c.glog(g.getAt(f))+c.glog(b.getAt(e)));return a(d,0)},mod:function(b){if(0>
g.getLength()-b.getLength())return g;for(var d=c.glog(g.getAt(0))-c.glog(b.getAt(0)),f=Array(g.getLength()),e=0;e<g.getLength();e+=1)f[e]=g.getAt(e);for(e=0;e<b.getLength();e+=1)f[e]^=c.gexp(c.glog(b.getAt(e))+d);return a(f,0).mod(b)}};return g}var b=function(b,c){var g=d[c],y=null,v=0,z=null,C=[],l={},x=function(c,d){for(var e=v=4*b+17,l=Array(e),m=0;m<e;m+=1){l[m]=Array(e);for(var x=0;x<e;x+=1)l[m][x]=null}y=l;p(0,0);p(v-7,0);p(0,v-7);e=f.getPatternPosition(b);for(l=0;l<e.length;l+=1)for(m=0;m<
e.length;m+=1){var x=e[l],q=e[m];if(null==y[x][q])for(var n=-2;2>=n;n+=1)for(var u=-2;2>=u;u+=1)y[x+n][q+u]=-2==n||2==n||-2==u||2==u||0==n&&0==u?!0:!1}for(e=8;e<v-8;e+=1)null==y[e][6]&&(y[e][6]=0==e%2);for(e=8;e<v-8;e+=1)null==y[6][e]&&(y[6][e]=0==e%2);e=f.getBCHTypeInfo(g<<3|d);for(l=0;15>l;l+=1)m=!c&&1==(e>>l&1),6>l?y[l][8]=m:8>l?y[l+1][8]=m:y[v-15+l][8]=m;for(l=0;15>l;l+=1)m=!c&&1==(e>>l&1),8>l?y[8][v-l-1]=m:9>l?y[8][15-l-1+1]=m:y[8][15-l-1]=m;y[v-8][8]=!c;if(7<=b){e=f.getBCHTypeNumber(b);for(l=
0;18>l;l+=1)m=!c&&1==(e>>l&1),y[Math.floor(l/3)][l%3+v-8-3]=m;for(l=0;18>l;l+=1)m=!c&&1==(e>>l&1),y[l%3+v-8-3][Math.floor(l/3)]=m}if(null==z){e=h.getRSBlocks(b,g);l=k();for(m=0;m<C.length;m+=1)x=C[m],l.put(x.getMode(),4),l.put(x.getLength(),f.getLengthInBits(x.getMode(),b)),x.write(l);for(m=x=0;m<e.length;m+=1)x+=e[m].dataCount;if(l.getLengthInBits()>8*x)throw Error("code length overflow. ("+l.getLengthInBits()+">"+8*x+")");for(l.getLengthInBits()+4<=8*x&&l.put(0,4);0!=l.getLengthInBits()%8;)l.putBit(!1);
for(;!(l.getLengthInBits()>=8*x);){l.put(236,8);if(l.getLengthInBits()>=8*x)break;l.put(17,8)}for(var t=0,x=m=0,q=Array(e.length),n=Array(e.length),u=0;u<e.length;u+=1){var B=e[u].dataCount,D=e[u].totalCount-B,m=Math.max(m,B),x=Math.max(x,D);q[u]=Array(B);for(var w=0;w<q[u].length;w+=1)q[u][w]=255&l.getBuffer()[w+t];t+=B;w=f.getErrorCorrectPolynomial(D);B=a(q[u],w.getLength()-1).mod(w);n[u]=Array(w.getLength()-1);for(w=0;w<n[u].length;w+=1)D=w+B.getLength()-n[u].length,n[u][w]=0<=D?B.getAt(D):0}for(w=
l=0;w<e.length;w+=1)l+=e[w].totalCount;l=Array(l);for(w=t=0;w<m;w+=1)for(u=0;u<e.length;u+=1)w<q[u].length&&(l[t]=q[u][w],t+=1);for(w=0;w<x;w+=1)for(u=0;u<e.length;u+=1)w<n[u].length&&(l[t]=n[u][w],t+=1);z=l}e=z;l=-1;m=v-1;x=7;q=0;n=f.getMaskFunction(d);for(u=v-1;0<u;u-=2)for(6==u&&--u;;){for(w=0;2>w;w+=1)null==y[m][u-w]&&(t=!1,q<e.length&&(t=1==(e[q]>>>x&1)),n(m,u-w)&&(t=!t),y[m][u-w]=t,--x,-1==x&&(q+=1,x=7));m+=l;if(0>m||v<=m){m-=l;l=-l;break}}},p=function(a,b){for(var c=-1;7>=c;c+=1)if(!(-1>=a+
c||v<=a+c))for(var d=-1;7>=d;d+=1)-1>=b+d||v<=b+d||(y[a+c][b+d]=0<=c&&6>=c&&(0==d||6==d)||0<=d&&6>=d&&(0==c||6==c)||2<=c&&4>=c&&2<=d&&4>=d?!0:!1)};l.addData=function(a){a=e(a);C.push(a);z=null};l.isDark=function(a,b){if(0>a||v<=a||0>b||v<=b)throw Error(a+","+b);return y[a][b]};l.getModuleCount=function(){return v};l.make=function(){for(var a=0,b=0,c=0;8>c;c+=1){x(!0,c);var d=f.getLostPoint(l);if(0==c||a>d)a=d,b=c}x(!1,b)};l.createTableTag=function(a,b){a=a||2;var c;c='<table style=" border-width: 0px; border-style: none;';
c+=" border-collapse: collapse;";c+=" padding: 0px; margin: "+("undefined"==typeof b?4*a:b)+"px;";c+='">';c+="<tbody>";for(var d=0;d<l.getModuleCount();d+=1){c+="<tr>";for(var e=0;e<l.getModuleCount();e+=1)c+='<td style="',c+=" border-width: 0px; border-style: none;",c+=" border-collapse: collapse;",c+=" padding: 0px; margin: 0px;",c+=" width: "+a+"px;",c+=" height: "+a+"px;",c+=" background-color: ",c+=l.isDark(d,e)?"#000000":"#ffffff",c+=";",c+='"/>';c+="</tr>"}c+="</tbody>";return c+="</table>"};
l.createSvgTag=function(a,b){a=a||2;b="undefined"==typeof b?4*a:b;var c=l.getModuleCount()*a+2*b,d,e,f,g,z;z="l"+a+",0 0,"+a+" -"+a+",0 0,-"+a+"z ";g="<svg"+(' width="'+c+'px"');g+=' height="'+c+'px"';g+=' xmlns="http://www.w3.org/2000/svg"';g+=">";g+='<path d="';for(e=0;e<l.getModuleCount();e+=1)for(f=e*a+b,c=0;c<l.getModuleCount();c+=1)l.isDark(e,c)&&(d=c*a+b,g+="M"+d+","+f+z);g+='" stroke="transparent" fill="black"/>';return g+="</svg>"};l.createImgTag=function(a,b){a=a||2;b="undefined"==typeof b?
4*a:b;var c=l.getModuleCount()*a+2*b,d=b,e=c-b;return t(c,c,function(b,c){return d<=b&&b<e&&d<=c&&c<e?l.isDark(Math.floor((c-d)/a),Math.floor((b-d)/a))?0:1:1})};return l};b.stringToBytes=function(a){for(var b=[],c=0;c<a.length;c+=1){var d=a.charCodeAt(c);b.push(d&255)}return b};b.createStringToBytes=function(a,b){var c=function(){for(var c=q(a),d=function(){var a=c.read();if(-1==a)throw Error();return a},e=0,f={};;){var g=c.read();if(-1==g)break;var h=d(),A=d(),k=d(),g=String.fromCharCode(g<<8|h);
f[g]=A<<8|k;e+=1}if(e!=b)throw Error(e+" != "+b);return f}();return function(a){for(var b=[],d=0;d<a.length;d+=1){var e=a.charCodeAt(d);128>e?b.push(e):(e=c[a.charAt(d)],"number"==typeof e?(e&255)==e?b.push(e):(b.push(e>>>8),b.push(e&255)):b.push(63))}return b}};var d={L:1,M:0,Q:3,H:2},f=function(){var b=[[],[6,18],[6,22],[6,26],[6,30],[6,34],[6,22,38],[6,24,42],[6,26,46],[6,28,50],[6,30,54],[6,32,58],[6,34,62],[6,26,46,66],[6,26,48,70],[6,26,50,74],[6,30,54,78],[6,30,56,82],[6,30,58,86],[6,34,62,
90],[6,28,50,72,94],[6,26,50,74,98],[6,30,54,78,102],[6,28,54,80,106],[6,32,58,84,110],[6,30,58,86,114],[6,34,62,90,118],[6,26,50,74,98,122],[6,30,54,78,102,126],[6,26,52,78,104,130],[6,30,56,82,108,134],[6,34,60,86,112,138],[6,30,58,86,114,142],[6,34,62,90,118,146],[6,30,54,78,102,126,150],[6,24,50,76,102,128,154],[6,28,54,80,106,132,158],[6,32,58,84,110,136,162],[6,26,54,82,110,138,166],[6,30,58,86,114,142,170]],d={},e=function(a){for(var b=0;0!=a;)b+=1,a>>>=1;return b};d.getBCHTypeInfo=function(a){for(var b=
a<<10;0<=e(b)-e(1335);)b^=1335<<e(b)-e(1335);return(a<<10|b)^21522};d.getBCHTypeNumber=function(a){for(var b=a<<12;0<=e(b)-e(7973);)b^=7973<<e(b)-e(7973);return a<<12|b};d.getPatternPosition=function(a){return b[a-1]};d.getMaskFunction=function(a){switch(a){case 0:return function(a,b){return 0==(a+b)%2};case 1:return function(a,b){return 0==a%2};case 2:return function(a,b){return 0==b%3};case 3:return function(a,b){return 0==(a+b)%3};case 4:return function(a,b){return 0==(Math.floor(a/2)+Math.floor(b/
3))%2};case 5:return function(a,b){return 0==a*b%2+a*b%3};case 6:return function(a,b){return 0==(a*b%2+a*b%3)%2};case 7:return function(a,b){return 0==(a*b%3+(a+b)%2)%2};default:throw Error("bad maskPattern:"+a);}};d.getErrorCorrectPolynomial=function(b){for(var d=a([1],0),e=0;e<b;e+=1)d=d.multiply(a([1,c.gexp(e)],0));return d};d.getLengthInBits=function(a,b){if(1<=b&&10>b)switch(a){case 1:return 10;case 2:return 9;case 4:return 8;case 8:return 8;default:throw Error("mode:"+a);}else if(27>b)switch(a){case 1:return 12;
case 2:return 11;case 4:return 16;case 8:return 10;default:throw Error("mode:"+a);}else if(41>b)switch(a){case 1:return 14;case 2:return 13;case 4:return 16;case 8:return 12;default:throw Error("mode:"+a);}else throw Error("type:"+b);};d.getLostPoint=function(a){for(var b=a.getModuleCount(),c=0,d=0;d<b;d+=1)for(var e=0;e<b;e+=1){for(var f=0,g=a.isDark(d,e),h=-1;1>=h;h+=1)if(!(0>d+h||b<=d+h))for(var m=-1;1>=m;m+=1)0>e+m||b<=e+m||0==h&&0==m||g!=a.isDark(d+h,e+m)||(f+=1);5<f&&(c+=3+f-5)}for(d=0;d<b-
1;d+=1)for(e=0;e<b-1;e+=1)if(f=0,a.isDark(d,e)&&(f+=1),a.isDark(d+1,e)&&(f+=1),a.isDark(d,e+1)&&(f+=1),a.isDark(d+1,e+1)&&(f+=1),0==f||4==f)c+=3;for(d=0;d<b;d+=1)for(e=0;e<b-6;e+=1)a.isDark(d,e)&&!a.isDark(d,e+1)&&a.isDark(d,e+2)&&a.isDark(d,e+3)&&a.isDark(d,e+4)&&!a.isDark(d,e+5)&&a.isDark(d,e+6)&&(c+=40);for(e=0;e<b;e+=1)for(d=0;d<b-6;d+=1)a.isDark(d,e)&&!a.isDark(d+1,e)&&a.isDark(d+2,e)&&a.isDark(d+3,e)&&a.isDark(d+4,e)&&!a.isDark(d+5,e)&&a.isDark(d+6,e)&&(c+=40);for(e=f=0;e<b;e+=1)for(d=0;d<b;d+=
1)a.isDark(d,e)&&(f+=1);return c+=Math.abs(100*f/b/b-50)/5*10};return d}(),c=function(){for(var a=Array(256),b=Array(256),c=0;8>c;c+=1)a[c]=1<<c;for(c=8;256>c;c+=1)a[c]=a[c-4]^a[c-5]^a[c-6]^a[c-8];for(c=0;255>c;c+=1)b[a[c]]=c;return{glog:function(a){if(1>a)throw Error("glog("+a+")");return b[a]},gexp:function(b){for(;0>b;)b+=255;for(;256<=b;)b-=255;return a[b]}}}(),h=function(){var a=[[1,26,19],[1,26,16],[1,26,13],[1,26,9],[1,44,34],[1,44,28],[1,44,22],[1,44,16],[1,70,55],[1,70,44],[2,35,17],[2,35,
13],[1,100,80],[2,50,32],[2,50,24],[4,25,9],[1,134,108],[2,67,43],[2,33,15,2,34,16],[2,33,11,2,34,12],[2,86,68],[4,43,27],[4,43,19],[4,43,15],[2,98,78],[4,49,31],[2,32,14,4,33,15],[4,39,13,1,40,14],[2,121,97],[2,60,38,2,61,39],[4,40,18,2,41,19],[4,40,14,2,41,15],[2,146,116],[3,58,36,2,59,37],[4,36,16,4,37,17],[4,36,12,4,37,13],[2,86,68,2,87,69],[4,69,43,1,70,44],[6,43,19,2,44,20],[6,43,15,2,44,16],[4,101,81],[1,80,50,4,81,51],[4,50,22,4,51,23],[3,36,12,8,37,13],[2,116,92,2,117,93],[6,58,36,2,59,37],
[4,46,20,6,47,21],[7,42,14,4,43,15],[4,133,107],[8,59,37,1,60,38],[8,44,20,4,45,21],[12,33,11,4,34,12],[3,145,115,1,146,116],[4,64,40,5,65,41],[11,36,16,5,37,17],[11,36,12,5,37,13],[5,109,87,1,110,88],[5,65,41,5,66,42],[5,54,24,7,55,25],[11,36,12,7,37,13],[5,122,98,1,123,99],[7,73,45,3,74,46],[15,43,19,2,44,20],[3,45,15,13,46,16],[1,135,107,5,136,108],[10,74,46,1,75,47],[1,50,22,15,51,23],[2,42,14,17,43,15],[5,150,120,1,151,121],[9,69,43,4,70,44],[17,50,22,1,51,23],[2,42,14,19,43,15],[3,141,113,4,
142,114],[3,70,44,11,71,45],[17,47,21,4,48,22],[9,39,13,16,40,14],[3,135,107,5,136,108],[3,67,41,13,68,42],[15,54,24,5,55,25],[15,43,15,10,44,16],[4,144,116,4,145,117],[17,68,42],[17,50,22,6,51,23],[19,46,16,6,47,17],[2,139,111,7,140,112],[17,74,46],[7,54,24,16,55,25],[34,37,13],[4,151,121,5,152,122],[4,75,47,14,76,48],[11,54,24,14,55,25],[16,45,15,14,46,16],[6,147,117,4,148,118],[6,73,45,14,74,46],[11,54,24,16,55,25],[30,46,16,2,47,17],[8,132,106,4,133,107],[8,75,47,13,76,48],[7,54,24,22,55,25],
[22,45,15,13,46,16],[10,142,114,2,143,115],[19,74,46,4,75,47],[28,50,22,6,51,23],[33,46,16,4,47,17],[8,152,122,4,153,123],[22,73,45,3,74,46],[8,53,23,26,54,24],[12,45,15,28,46,16],[3,147,117,10,148,118],[3,73,45,23,74,46],[4,54,24,31,55,25],[11,45,15,31,46,16],[7,146,116,7,147,117],[21,73,45,7,74,46],[1,53,23,37,54,24],[19,45,15,26,46,16],[5,145,115,10,146,116],[19,75,47,10,76,48],[15,54,24,25,55,25],[23,45,15,25,46,16],[13,145,115,3,146,116],[2,74,46,29,75,47],[42,54,24,1,55,25],[23,45,15,28,46,
16],[17,145,115],[10,74,46,23,75,47],[10,54,24,35,55,25],[19,45,15,35,46,16],[17,145,115,1,146,116],[14,74,46,21,75,47],[29,54,24,19,55,25],[11,45,15,46,46,16],[13,145,115,6,146,116],[14,74,46,23,75,47],[44,54,24,7,55,25],[59,46,16,1,47,17],[12,151,121,7,152,122],[12,75,47,26,76,48],[39,54,24,14,55,25],[22,45,15,41,46,16],[6,151,121,14,152,122],[6,75,47,34,76,48],[46,54,24,10,55,25],[2,45,15,64,46,16],[17,152,122,4,153,123],[29,74,46,14,75,47],[49,54,24,10,55,25],[24,45,15,46,46,16],[4,152,122,18,
153,123],[13,74,46,32,75,47],[48,54,24,14,55,25],[42,45,15,32,46,16],[20,147,117,4,148,118],[40,75,47,7,76,48],[43,54,24,22,55,25],[10,45,15,67,46,16],[19,148,118,6,149,119],[18,75,47,31,76,48],[34,54,24,34,55,25],[20,45,15,61,46,16]],b=function(a,b){var c={};c.totalCount=a;c.dataCount=b;return c},c={},e=function(b,c){switch(c){case d.L:return a[4*(b-1)+0];case d.M:return a[4*(b-1)+1];case d.Q:return a[4*(b-1)+2];case d.H:return a[4*(b-1)+3]}};c.getRSBlocks=function(a,c){var d=e(a,c);if("undefined"==
typeof d)throw Error("bad rs block @ typeNumber:"+a+"/errorCorrectLevel:"+c);for(var f=d.length/3,g=[],h=0;h<f;h+=1)for(var k=d[3*h+0],r=d[3*h+1],p=d[3*h+2],A=0;A<k;A+=1)g.push(b(r,p));return g};return c}(),k=function(){var a=[],b=0,c={getBuffer:function(){return a},getAt:function(b){return 1==(a[Math.floor(b/8)]>>>7-b%8&1)},put:function(a,b){for(var d=0;d<b;d+=1)c.putBit(1==(a>>>b-d-1&1))},getLengthInBits:function(){return b},putBit:function(c){var d=Math.floor(b/8);a.length<=d&&a.push(0);c&&(a[d]|=
128>>>b%8);b+=1}};return c},e=function(a){var c=b.stringToBytes(a);return{getMode:function(){return 4},getLength:function(a){return c.length},write:function(a){for(var b=0;b<c.length;b+=1)a.put(c[b],8)}}},p=function(){var a=[],b={writeByte:function(b){a.push(b&255)},writeShort:function(a){b.writeByte(a);b.writeByte(a>>>8)},writeBytes:function(a,c,d){c=c||0;d=d||a.length;for(var e=0;e<d;e+=1)b.writeByte(a[e+c])},writeString:function(a){for(var c=0;c<a.length;c+=1)b.writeByte(a.charCodeAt(c))},toByteArray:function(){return a},
toString:function(){var b;b="[";for(var c=0;c<a.length;c+=1)0<c&&(b+=","),b+=a[c];return b+"]"}};return b},n=function(){var a=0,b=0,c=0,d="",e={},f=function(a){if(!(0>a)){if(26>a)return 65+a;if(52>a)return 97+(a-26);if(62>a)return 48+(a-52);if(62==a)return 43;if(63==a)return 47}throw Error("n:"+a);};e.writeByte=function(e){a=a<<8|e&255;b+=8;for(c+=1;6<=b;)d+=String.fromCharCode(f(a>>>b-6&63)),b-=6};e.flush=function(){0<b&&(d+=String.fromCharCode(f(a<<6-b&63)),b=a=0);if(0!=c%3)for(var e=3-c%3,g=0;g<
e;g+=1)d+="="};e.toString=function(){return d};return e},q=function(a){var b=0,c=0,d=0,e=function(a){if(65<=a&&90>=a)return a-65;if(97<=a&&122>=a)return a-97+26;if(48<=a&&57>=a)return a-48+52;if(43==a)return 62;if(47==a)return 63;throw Error("c:"+a);};return{read:function(){for(;8>d;){if(b>=a.length){if(0==d)return-1;throw Error("unexpected end of file./"+d);}var f=a.charAt(b);b+=1;if("="==f)return d=0,-1;f.match(/^\s$/)||(c=c<<6|e(f.charCodeAt(0)),d+=6)}f=c>>>d-8&255;d-=8;return f}}},g=function(a,
b){var c=Array(a*b),d=function(a){var b=0,c=0;return{write:function(d,e){if(0!=d>>>e)throw Error("length over");for(;8<=b+e;)a.writeByte(255&(d<<b|c)),e-=8-b,d>>>=8-b,b=c=0;c|=d<<b;b+=e},flush:function(){0<b&&a.writeByte(c)}}},e=function(){var a={},b=0,c={add:function(d){if(c.contains(d))throw Error("dup key:"+d);a[d]=b;b+=1},size:function(){return b},indexOf:function(b){return a[b]},contains:function(b){return"undefined"!=typeof a[b]}};return c};return{setPixel:function(b,d,e){c[d*a+b]=e},write:function(f){f.writeString("GIF87a");
f.writeShort(a);f.writeShort(b);f.writeByte(128);f.writeByte(0);f.writeByte(0);f.writeByte(0);f.writeByte(0);f.writeByte(0);f.writeByte(255);f.writeByte(255);f.writeByte(255);f.writeString(",");f.writeShort(0);f.writeShort(0);f.writeShort(a);f.writeShort(b);f.writeByte(0);var g;g=3;for(var h=e(),k=0;4>k;k+=1)h.add(String.fromCharCode(k));h.add(String.fromCharCode(4));h.add(String.fromCharCode(5));var k=p(),q=d(k);q.write(4,g);for(var n=0,t=String.fromCharCode(c[n]),n=n+1;n<c.length;){var E=String.fromCharCode(c[n]),
n=n+1;h.contains(t+E)?t+=E:(q.write(h.indexOf(t),g),4095>h.size()&&(h.size()==1<<g&&(g+=1),h.add(t+E)),t=E)}q.write(h.indexOf(t),g);q.write(5,g);q.flush();g=k.toByteArray();f.writeByte(2);for(h=0;255<g.length-h;)f.writeByte(255),f.writeBytes(g,h,255),h+=255;f.writeByte(g.length-h);f.writeBytes(g,h,g.length-h);f.writeByte(0);f.writeString(";")}}},t=function(a,b,c,d){for(var e=g(a,b),f=0;f<b;f+=1)for(var h=0;h<a;h+=1)e.setPixel(h,f,c(h,f));c=p();e.write(c);e=n();c=c.toByteArray();for(f=0;f<c.length;f+=
1)e.writeByte(c[f]);e.flush();c='<img src="';c+="data:image/gif;base64,";c+=e;c+='"';c+=' width="';c+=a;c+='"';c+=' height="';c+=b;c+='"';d&&(c+=' alt="',c+=d,c+='"');return c+="/>"};return b}();(function(a){"function"===typeof define&&define.amd?define([],a):"object"===typeof exports&&(module.exports=a())})(function(){return qrcode});
(function(a){a.stringToBytes=function(a){for(var d=[],f=0;f<a.length;f++){var c=a.charCodeAt(f);128>c?d.push(c):2048>c?d.push(192|c>>6,128|c&63):55296>c||57344<=c?d.push(224|c>>12,128|c>>6&63,128|c&63):(f++,c=65536+((c&1023)<<10|a.charCodeAt(f)&1023),d.push(240|c>>18,128|c>>12&63,128|c>>6&63,128|c&63))}return d}})(qrcode);angular.module("smsValidation",["ngResource","common-authentication"]).directive("smsValidation",["$ionicLoading","smsValidationAPI","$interval","CommonAuthenticationService",function(a,b,d,f){return{restrict:"E",scope:{presetInvitationCode:"=presetInvitationCode",success:"&onSuccess"},templateUrl:"templates/common/sms.validation.html",link:function(c){c.statusCode={waitMobile:0,waitCode:1};c.status=c.statusCode.waitMobile;c.showInvitationCode=!1;var h,k=function(a){c.count=60;angular.isDefined(h)||
(h=d(function(){1<c.count?--c.count:(angular.isDefined(h)&&(d.cancel(h),h=void 0),a())},1E3))},e=function(){a.show({template:"<ion-spinner></ion-spinner>",delay:100});b.send(c.mobile,c.captcha,function(){a.hide();c.status=c.statusCode.waitCode;k(function(){c.status===c.statusCode.waitCode&&(c.status.code=c.statusCode.waitMobile)})},function(b){a.hide();c.refreshCaptcha();c.captcha=void 0;alert(b.data.error)})};c.sendSmsValidation=function(){void 0===c.mobile?alert("\u8bf7\u6b63\u786e\u8f93\u5165\u624b\u673a\u53f7"):
void 0===c.captcha?alert("\u8bf7\u6b63\u786e\u8f93\u5165\u56fe\u7247\u9a8c\u8bc1\u7801"):e()};c.refreshCaptcha=function(){c.showCaptcha=!0;void 0!==c.mobile&&(c.captchaUrl=b.getCaptchaUrl(c.mobile))};c.checkExist=function(){c.showInvitationCode=!1;void 0!==c.mobile&&f.exist(c.mobile,function(){c.showInvitationCode=!1},function(){c.showInvitationCode=!0})};c.auth=function(){f.auth(c.mobile,c.validationCode,void 0!==c.presetInvitationCode?c.presetInvitationCode:c.invitationCode,function(a){c.success()},
function(a){alert(a)})}}}}]).service("smsValidationAPI",["$resource","urlConfig",function(a,b){var d=a(b.REST_END_POINT+"/sso/smsValidate",{phoneNumber:"@phoneNumber",captcha:"@captcha"},{send:{method:"POST",isArray:!1}},null);return{send:function(a,b,h,k){d.send({phoneNumber:a,captcha:b},function(){h()},function(a){k(a)})},getCaptchaUrl:function(a){return b.REST_END_POINT+"/sso/captcha?phoneNumber="+a+"&time="+(new Date).getTime()}}}]);angular.module("wechat",["wechat.service"]);
angular.module("wechat.service",[]).constant("wechatConstants",{SHARE_IMG_URL:"img/promotion/share.png",TIMELINE_IMG_URL:"img/promotion/share.png",PROMOTION_SHARE_ROOT:"/wechatlogin/oauth2?state=promotion:",SURVEY_SHARE_ROOT:"/wechatlogin/oauth2?state=survey:",CLAIM_SHARE_ROOT:"/#/claim/"}).service("Wechat",["urlConfig","$resource","$location","wechatConstants",function(a,b,d,f){var c,h=b(a.REST_END_POINT+"/api/wechat/config",{url:"@url"}),k=b(a.REST_END_POINT+"/wechatlogin/oauth2/bind",{openId:"@openId"}),
e=function(a,b,c){var e=new h;a=a?d.protocol()+"://"+d.host()+"/":d.absUrl();e.$get({url:a},function(a){v=a;console.log("refresh wechat mp config success");b()},function(a){v=void 0;console.log("refresh wechat mp config error by: "+a.data.error);c(a)})},p=function(a,b,c){wx.chooseImage({count:1,sizeType:["compressed"],sourceType:["album","camera"],success:function(a){b(a.localIds)}})},n=function(a,b,c){wx.uploadImage({localId:a,isShowProgressTips:1,success:function(a){b(a.serverId)}})},q=function(a,
b,c){wx.getLocation({type:"gcj02",success:function(a){b(a)},cancel:function(a){c(a)}})},g=function(a,b,c,d){wx.previewImage({current:b[a],urls:b})},t=function(a,b,c,d){wx.config({debug:!1,appId:v.appId,timestamp:v.timestamp,nonceStr:v.noncestr,signature:v.signature,jsApiList:"onMenuShareAppMessage onMenuShareTimeline chooseWXPay chooseImage uploadImage getLocation previewImage hideMenuItems".split(" ")});wx.ready(function(){a(b,c,d)})},r=function(b,c,d,e){b&&wx.hideMenuItems({menuList:["menuItem:share:appMessage"]});
wx.onMenuShareAppMessage({title:c.name,desc:c.description,link:c.url,imgUrl:a.APP_ROOT+"/"+f.SHARE_IMG_URL,trigger:function(a){},success:function(a){d()},cancel:function(a){e("\u5df2\u53d6\u6d88\u5206\u4eab")},fail:function(a){e("\u5206\u4eab\u5931\u8d25")}});wx.onMenuShareTimeline({title:c.name,link:c.url,imgUrl:a.APP_ROOT+"/"+f.TIMELINE_IMG_URL,trigger:function(a){},success:function(a){d()},cancel:function(a){e("\u5df2\u53d6\u6d88\u5206\u4eab")},fail:function(a){e("\u5206\u4eab\u5931\u8d25")}})},
m=function(a,b,c){r(!0,a,b,c)},A=function(a,b,c){r(!1,a,b,c)},y=function(a,b,c){wx.chooseWXPay({timestamp:a.timeStamp+"",nonceStr:a.nonceStr,"package":a.packagePrepayId,signType:a.signType,paySign:a.paySign,success:function(a){b()},fail:function(a){c()},cancel:function(a){c()}})},v;return{hookShareAll:function(a,b,c,d){void 0===v?e(a,function(){t(A,b,c,d)},function(a){alert("\u5fae\u4fe1\u73af\u5883\u9519\u8bef\uff0c\u8bf7\u91cd\u65b0\u6253\u5f00\u9875\u9762")}):t(A,b,c,d)},hookShareTimelineOnly:function(a,
b,c,d){void 0===v?e(a,function(){t(m,b,c,d)},function(a){alert("\u5fae\u4fe1\u73af\u5883\u9519\u8bef\uff0c\u8bf7\u91cd\u65b0\u6253\u5f00\u9875\u9762")}):t(m,b,c,d)},doWxPay:function(a,b,c){void 0===v?e(!0,function(){t(y,a,b,c)},function(a){alert("\u5fae\u4fe1\u73af\u5883\u9519\u8bef\uff0c\u8bf7\u91cd\u65b0\u6253\u5f00\u9875\u9762")}):t(y,a,b,c)},chooseImage:function(a,b){void 0===v?e(!0,function(){t(p,"",a,b)},function(a){alert("\u5fae\u4fe1\u73af\u5883\u9519\u8bef\uff0c\u8bf7\u91cd\u65b0\u6253\u5f00\u9875\u9762")}):
t(p,"",a,b)},previewImage:function(a,b,c,d){void 0===v?e(!0,function(){t(g,a,b,c,d)},function(a){alert("\u5fae\u4fe1\u73af\u5883\u9519\u8bef\uff0c\u8bf7\u91cd\u65b0\u6253\u5f00\u9875\u9762")}):t(g,a,b,c,d)},getUserLocation:function(a,b){void 0===v?e(!0,function(){t(q,"",a,b)},function(a){alert("\u5fae\u4fe1\u73af\u5883\u9519\u8bef\uff0c\u8bf7\u91cd\u65b0\u6253\u5f00\u9875\u9762")}):t(q,"",a,b)},uploadImage:function(a,b,c){void 0===v?e(!0,function(){t(n,a,b,c)},function(a){alert("\u5fae\u4fe1\u73af\u5883\u9519\u8bef\uff0c\u8bf7\u91cd\u65b0\u6253\u5f00\u9875\u9762")}):
t(n,a,b,c)},isQQBrowser:function(){return-1!==navigator.userAgent.indexOf("MQQBrowser")},bind:function(a,b,c){(new k).$save({openId:a},b,function(a){c(a.data.error)})},getOpenId:function(){return c},setOpenId:function(a){c=a}}}]);
